!function(e,t){function n(e,t){if(e instanceof Array)for(var r=0;r<e.length;r++)t.push(),n(e[r],t[r]);if(e instanceof Object)for(var i in e){if(null==e[i]||"object"!=typeof e[i])t[i]=e[i];else if(e[i]instanceof Array)t[i]=[],n(e[i],t[i]);else if(e[i]instanceof Object){t[i]={};for(var a in e[i])n(e[i],t[i])}}}if("function"==typeof define&&define.amd)define(t);else{var r={},i={},a=!1;if(window.OData&&window.datajs&&(a=!0,n(window.OData,r),n(window.datajs,i)),e.annService=t(),a)window.OData=r,window.datajs=i;else{if(window.OData){window.OData=void 0;try{delete window.OData}catch(o){}}if(window.datajs){window.datajs=void 0;try{delete window.datajs}catch(o){}}}}}(this,function(){var e,t,n;return function(r){function i(e,t){return S.call(e,t)}function a(e,t){var n,r,i,a,o,s,u,d,l,c,f=t&&t.split("/"),p=y.map,_=p&&p["*"]||{};if(e&&"."===e.charAt(0))if(t){for(f=f.slice(0,f.length-1),e=f.concat(e.split("/")),d=0;d<e.length;d+=1)if(c=e[d],"."===c)e.splice(d,1),d-=1;else if(".."===c){if(1===d&&(".."===e[2]||".."===e[0]))break;d>0&&(e.splice(d-1,2),d-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((f||_)&&p){for(n=e.split("/"),d=n.length;d>0;d-=1){if(r=n.slice(0,d).join("/"),f)for(l=f.length;l>0;l-=1)if(i=p[f.slice(0,l).join("/")],i&&(i=i[r])){a=i,o=d;break}if(a)break;!s&&_&&_[r]&&(s=_[r],u=d)}!a&&s&&(a=s,o=u),a&&(n.splice(0,o,a),e=n.join("/"))}return e}function o(e,t){return function(){return p.apply(r,R.call(arguments,0).concat([e,t]))}}function s(e){return function(t){return a(t,e)}}function u(e){return function(t){m[e]=t}}function d(e){if(i(g,e)){var t=g[e];delete g[e],E[e]=!0,f.apply(r,t)}if(!i(m,e)&&!i(E,e))throw new Error("No "+e);return m[e]}function l(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function c(e){return function(){return y&&y.config&&y.config[e]||{}}}var f,p,_,h,m={},g={},y={},E={},S=Object.prototype.hasOwnProperty,R=[].slice;_=function(e,t){var n,r=l(e),i=r[0];return e=r[1],i&&(i=a(i,t),n=d(i)),i?e=n&&n.normalize?n.normalize(e,s(t)):a(e,t):(e=a(e,t),r=l(e),i=r[0],e=r[1],i&&(n=d(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},h={require:function(e){return o(e)},exports:function(e){var t=m[e];return"undefined"!=typeof t?t:m[e]={}},module:function(e){return{id:e,uri:"",exports:m[e],config:c(e)}}},f=function(e,t,n,a){var s,l,c,f,p,y,S=[];if(a=a||e,"function"==typeof n){for(t=!t.length&&n.length?["require","exports","module"]:t,p=0;p<t.length;p+=1)if(f=_(t[p],a),l=f.f,"require"===l)S[p]=h.require(e);else if("exports"===l)S[p]=h.exports(e),y=!0;else if("module"===l)s=S[p]=h.module(e);else if(i(m,l)||i(g,l)||i(E,l))S[p]=d(l);else{if(!f.p)throw new Error(e+" missing "+l);f.p.load(f.n,o(a,!0),u(l),{}),S[p]=m[l]}c=n.apply(m[e],S),e&&(s&&s.exports!==r&&s.exports!==m[e]?m[e]=s.exports:c===r&&y||(m[e]=c))}else e&&(m[e]=n)},e=t=p=function(e,t,n,i,a){return"string"==typeof e?h[e]?h[e](t):d(_(e,t).f):(e.splice||(y=e,t.splice?(e=t,t=n,n=null):e=r),t=t||function(){},"function"==typeof n&&(n=i,i=a),i?f(r,e,t,n):setTimeout(function(){f(r,e,t,n)},4),p)},p.config=function(e){return y=e,y.deps&&p(y.deps,y.callback),p},n=function(e,t,n){t.splice||(n=t,t=[]),i(m,e)||i(g,e)||(g[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("almond",function(){}),function(){var e=this,t=e._,r={},i=Array.prototype,a=Object.prototype,o=Function.prototype,s=i.push,u=i.slice,d=i.concat,l=a.toString,c=a.hasOwnProperty,f=i.forEach,p=i.map,_=i.reduce,h=i.reduceRight,m=i.filter,g=i.every,y=i.some,E=i.indexOf,S=i.lastIndexOf,R=Array.isArray,v=Object.keys,A=o.bind,T=function(e){return e instanceof T?e:this instanceof T?void(this._wrapped=e):new T(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=T),exports._=T):e._=T,T.VERSION="1.6.0";var I=T.each=T.forEach=function(e,t,n){if(null==e)return e;if(f&&e.forEach===f)e.forEach(t,n);else if(e.length===+e.length){for(var i=0,a=e.length;a>i;i++)if(t.call(n,e[i],i,e)===r)return}else for(var o=T.keys(e),i=0,a=o.length;a>i;i++)if(t.call(n,e[o[i]],o[i],e)===r)return;return e};T.map=T.collect=function(e,t,n){var r=[];return null==e?r:p&&e.map===p?e.map(t,n):(I(e,function(e,i,a){r.push(t.call(n,e,i,a))}),r)};var P="Reduce of empty array with no initial value";T.reduce=T.foldl=T.inject=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),_&&e.reduce===_)return r&&(t=T.bind(t,r)),i?e.reduce(t,n):e.reduce(t);if(I(e,function(e,a,o){i?n=t.call(r,n,e,a,o):(n=e,i=!0)}),!i)throw new TypeError(P);return n},T.reduceRight=T.foldr=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),h&&e.reduceRight===h)return r&&(t=T.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var a=e.length;if(a!==+a){var o=T.keys(e);a=o.length}if(I(e,function(s,u,d){u=o?o[--a]:--a,i?n=t.call(r,n,e[u],u,d):(n=e[u],i=!0)}),!i)throw new TypeError(P);return n},T.find=T.detect=function(e,t,n){var r;return N(e,function(e,i,a){return t.call(n,e,i,a)?(r=e,!0):void 0}),r},T.filter=T.select=function(e,t,n){var r=[];return null==e?r:m&&e.filter===m?e.filter(t,n):(I(e,function(e,i,a){t.call(n,e,i,a)&&r.push(e)}),r)},T.reject=function(e,t,n){return T.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},T.every=T.all=function(e,t,n){t||(t=T.identity);var i=!0;return null==e?i:g&&e.every===g?e.every(t,n):(I(e,function(e,a,o){return(i=i&&t.call(n,e,a,o))?void 0:r}),!!i)};var N=T.some=T.any=function(e,t,n){t||(t=T.identity);var i=!1;return null==e?i:y&&e.some===y?e.some(t,n):(I(e,function(e,a,o){return i||(i=t.call(n,e,a,o))?r:void 0}),!!i)};T.contains=T.include=function(e,t){return null==e?!1:E&&e.indexOf===E?-1!=e.indexOf(t):N(e,function(e){return e===t})},T.invoke=function(e,t){var n=u.call(arguments,2),r=T.isFunction(t);return T.map(e,function(e){return(r?t:e[t]).apply(e,n)})},T.pluck=function(e,t){return T.map(e,T.property(t))},T.where=function(e,t){return T.filter(e,T.matches(t))},T.findWhere=function(e,t){return T.find(e,T.matches(t))},T.max=function(e,t,n){if(!t&&T.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);var r=-1/0,i=-1/0;return I(e,function(e,a,o){var s=t?t.call(n,e,a,o):e;s>i&&(r=e,i=s)}),r},T.min=function(e,t,n){if(!t&&T.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);var r=1/0,i=1/0;return I(e,function(e,a,o){var s=t?t.call(n,e,a,o):e;i>s&&(r=e,i=s)}),r},T.shuffle=function(e){var t,n=0,r=[];return I(e,function(e){t=T.random(n++),r[n-1]=r[t],r[t]=e}),r},T.sample=function(e,t,n){return null==t||n?(e.length!==+e.length&&(e=T.values(e)),e[T.random(e.length-1)]):T.shuffle(e).slice(0,Math.max(0,t))};var O=function(e){return null==e?T.identity:T.isFunction(e)?e:T.property(e)};T.sortBy=function(e,t,n){return t=O(t),T.pluck(T.map(e,function(e,r,i){return{value:e,index:r,criteria:t.call(n,e,r,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(r>n||void 0===r)return-1}return e.index-t.index}),"value")};var b=function(e){return function(t,n,r){var i={};return n=O(n),I(t,function(a,o){var s=n.call(r,a,o,t);e(i,s,a)}),i}};T.groupBy=b(function(e,t,n){T.has(e,t)?e[t].push(n):e[t]=[n]}),T.indexBy=b(function(e,t,n){e[t]=n}),T.countBy=b(function(e,t){T.has(e,t)?e[t]++:e[t]=1}),T.sortedIndex=function(e,t,n,r){n=O(n);for(var i=n.call(r,t),a=0,o=e.length;o>a;){var s=a+o>>>1;n.call(r,e[s])<i?a=s+1:o=s}return a},T.toArray=function(e){return e?T.isArray(e)?u.call(e):e.length===+e.length?T.map(e,T.identity):T.values(e):[]},T.size=function(e){return null==e?0:e.length===+e.length?e.length:T.keys(e).length},T.first=T.head=T.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:0>t?[]:u.call(e,0,t)},T.initial=function(e,t,n){return u.call(e,0,e.length-(null==t||n?1:t))},T.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:u.call(e,Math.max(e.length-t,0))},T.rest=T.tail=T.drop=function(e,t,n){return u.call(e,null==t||n?1:t)},T.compact=function(e){return T.filter(e,T.identity)};var C=function(e,t,n,r){if(t&&T.every(e,T.isArray))return d.apply(r,e);for(var i=0,a=e.length;a>i;i++){var o=e[i];T.isArray(o)||T.isArguments(o)?t?s.apply(r,o):C(o,t,n,r):n||r.push(o)}return r};T.flatten=function(e,t){return C(e,t,!1,[])},T.without=function(e){return T.difference(e,u.call(arguments,1))},T.partition=function(e,t,n){t=O(t);var r=[],i=[];return I(e,function(e){(t.call(n,e)?r:i).push(e)}),[r,i]},T.uniq=T.unique=function(e,t,n,r){if(null==e)return[];T.isFunction(t)&&(r=n,n=t,t=!1);for(var i=[],a=[],o=0,s=e.length;s>o;o++){var u=e[o];n&&(u=n.call(r,u,o,e)),(t?o&&a===u:T.contains(a,u))||(t?a=u:a.push(u),i.push(e[o]))}return i},T.union=function(){return T.uniq(C(arguments,!0,!0,[]))},T.intersection=function(e){var t=u.call(arguments,1);return T.filter(T.uniq(e),function(e){return T.every(t,function(t){return T.contains(t,e)})})},T.difference=function(e){var t=C(u.call(arguments,1),!0,!0,[]);return T.filter(e,function(e){return!T.contains(t,e)})},T.zip=function(){for(var e=T.max(T.pluck(arguments,"length").concat(0)),t=new Array(e),n=0;e>n;n++)t[n]=T.pluck(arguments,""+n);return t},T.object=function(e,t){if(null==e)return{};for(var n={},r=0,i=e.length;i>r;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},T.indexOf=function(e,t,n){if(null==e)return-1;var r=0,i=e.length;if(n){if("number"!=typeof n)return r=T.sortedIndex(e,t),e[r]===t?r:-1;r=0>n?Math.max(0,i+n):n}if(E&&e.indexOf===E)return e.indexOf(t,n);for(;i>r;r++)if(e[r]===t)return r;return-1},T.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=null!=n;if(S&&e.lastIndexOf===S)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var i=r?n:e.length;i--;)if(e[i]===t)return i;return-1},T.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=0,a=new Array(r);r>i;)a[i++]=e,e+=n;return a};var U=function(){};T.bind=function(e,t){var n,r;if(A&&e.bind===A)return A.apply(e,u.call(arguments,1));if(!T.isFunction(e))throw new TypeError;return n=u.call(arguments,2),r=function(){if(!(this instanceof r))return e.apply(t,n.concat(u.call(arguments)));U.prototype=e.prototype;var i=new U;U.prototype=null;var a=e.apply(i,n.concat(u.call(arguments)));return Object(a)===a?a:i}},T.partial=function(e){var t=u.call(arguments,1);return function(){for(var n=0,r=t.slice(),i=0,a=r.length;a>i;i++)r[i]===T&&(r[i]=arguments[n++]);for(;n<arguments.length;)r.push(arguments[n++]);return e.apply(this,r)}},T.bindAll=function(e){var t=u.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return I(t,function(t){e[t]=T.bind(e[t],e)}),e},T.memoize=function(e,t){var n={};return t||(t=T.identity),function(){var r=t.apply(this,arguments);return T.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},T.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},T.defer=function(e){return T.delay.apply(T,[e,1].concat(u.call(arguments,1)))},T.throttle=function(e,t,n){var r,i,a,o=null,s=0;n||(n={});var u=function(){s=n.leading===!1?0:T.now(),o=null,a=e.apply(r,i),r=i=null};return function(){var d=T.now();s||n.leading!==!1||(s=d);var l=t-(d-s);return r=this,i=arguments,0>=l?(clearTimeout(o),o=null,s=d,a=e.apply(r,i),r=i=null):o||n.trailing===!1||(o=setTimeout(u,l)),a}},T.debounce=function(e,t,n){var r,i,a,o,s,u=function(){var d=T.now()-o;t>d?r=setTimeout(u,t-d):(r=null,n||(s=e.apply(a,i),a=i=null))};return function(){a=this,i=arguments,o=T.now();var d=n&&!r;return r||(r=setTimeout(u,t)),d&&(s=e.apply(a,i),a=i=null),s}},T.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},T.wrap=function(e,t){return T.partial(t,e)},T.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},T.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},T.keys=function(e){if(!T.isObject(e))return[];if(v)return v(e);var t=[];for(var n in e)T.has(e,n)&&t.push(n);return t},T.values=function(e){for(var t=T.keys(e),n=t.length,r=new Array(n),i=0;n>i;i++)r[i]=e[t[i]];return r},T.pairs=function(e){for(var t=T.keys(e),n=t.length,r=new Array(n),i=0;n>i;i++)r[i]=[t[i],e[t[i]]];return r},T.invert=function(e){for(var t={},n=T.keys(e),r=0,i=n.length;i>r;r++)t[e[n[r]]]=n[r];return t},T.functions=T.methods=function(e){var t=[];for(var n in e)T.isFunction(e[n])&&t.push(n);return t.sort()},T.extend=function(e){return I(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},T.pick=function(e){var t={},n=d.apply(i,u.call(arguments,1));return I(n,function(n){n in e&&(t[n]=e[n])}),t},T.omit=function(e){var t={},n=d.apply(i,u.call(arguments,1));for(var r in e)T.contains(n,r)||(t[r]=e[r]);return t},T.defaults=function(e){return I(u.call(arguments,1),function(t){if(t)for(var n in t)void 0===e[n]&&(e[n]=t[n])}),e},T.clone=function(e){return T.isObject(e)?T.isArray(e)?e.slice():T.extend({},e):e},T.tap=function(e,t){return t(e),e};var D=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof T&&(e=e._wrapped),t instanceof T&&(t=t._wrapped);var i=l.call(e);if(i!=l.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var a=n.length;a--;)if(n[a]==e)return r[a]==t;var o=e.constructor,s=t.constructor;if(o!==s&&!(T.isFunction(o)&&o instanceof o&&T.isFunction(s)&&s instanceof s)&&"constructor"in e&&"constructor"in t)return!1;n.push(e),r.push(t);var u=0,d=!0;if("[object Array]"==i){if(u=e.length,d=u==t.length)for(;u--&&(d=D(e[u],t[u],n,r)););}else{for(var c in e)if(T.has(e,c)&&(u++,!(d=T.has(t,c)&&D(e[c],t[c],n,r))))break;if(d){for(c in t)if(T.has(t,c)&&!u--)break;d=!u}}return n.pop(),r.pop(),d};T.isEqual=function(e,t){return D(e,t,[],[])},T.isEmpty=function(e){if(null==e)return!0;if(T.isArray(e)||T.isString(e))return 0===e.length;for(var t in e)if(T.has(e,t))return!1;return!0},T.isElement=function(e){return!(!e||1!==e.nodeType)},T.isArray=R||function(e){return"[object Array]"==l.call(e)},T.isObject=function(e){return e===Object(e)},I(["Arguments","Function","String","Number","Date","RegExp"],function(e){T["is"+e]=function(t){return l.call(t)=="[object "+e+"]"}}),T.isArguments(arguments)||(T.isArguments=function(e){return!(!e||!T.has(e,"callee"))}),"function"!=typeof/./&&(T.isFunction=function(e){return"function"==typeof e}),T.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},T.isNaN=function(e){return T.isNumber(e)&&e!=+e},T.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==l.call(e)},T.isNull=function(e){return null===e},T.isUndefined=function(e){return void 0===e},T.has=function(e,t){return c.call(e,t)},T.noConflict=function(){return e._=t,this},T.identity=function(e){return e},T.constant=function(e){return function(){return e}},T.property=function(e){return function(t){return t[e]}},T.matches=function(e){return function(t){if(t===e)return!0;for(var n in e)if(e[n]!==t[n])return!1;return!0}},T.times=function(e,t,n){for(var r=Array(Math.max(0,e)),i=0;e>i;i++)r[i]=t.call(n,i);return r},T.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},T.now=Date.now||function(){return(new Date).getTime()};var L={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};L.unescape=T.invert(L.escape);var x={escape:new RegExp("["+T.keys(L.escape).join("")+"]","g"),unescape:new RegExp("("+T.keys(L.unescape).join("|")+")","g")};T.each(["escape","unescape"],function(e){T[e]=function(t){return null==t?"":(""+t).replace(x[e],function(t){return L[e][t]})}}),T.result=function(e,t){if(null==e)return void 0;var n=e[t];return T.isFunction(n)?n.call(e):n},T.mixin=function(e){I(T.functions(e),function(t){var n=T[t]=e[t];T.prototype[t]=function(){var e=[this._wrapped];return s.apply(e,arguments),M.call(this,n.apply(T,e))}})};var F=0;T.uniqueId=function(e){var t=++F+"";return e?e+t:t},T.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};T.chain=function(e){return T(e).chain()};var M=function(e){return this._chain?T(e).chain():e};T.mixin(T),I(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=i[e];T.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],M.call(this,n)}}),I(["concat","join","slice"],function(e){var t=i[e];T.prototype[e]=function(){return M.call(this,t.apply(this._wrapped,arguments))}}),T.extend(T.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof n&&n.amd&&n("underscore",[],function(){return T})}.call(this),n("underscorenc",["underscore"],function(e){return e.mixin({deepExtend:function(t){return e.each(Array.prototype.slice.call(arguments,1),function(n){var r,i;for(var a in n)r=n[a],!e.isObject(r)||r.constructor!==Object&&r.constructor!==Array?n.hasOwnProperty(a)&&(t[a]=r):(i=t[a]=t[a]||new r.constructor,e.deepExtend(i,r))}),t},deepClone:function(t){return e.deepExtend({},t)},isArrayOf:function(t){var n=Array.prototype.slice.call(arguments,1);if(0===n.length||!e.every(n,function(t){return e.isFunction(t)}))throw"This method takes an array and one or more validation functions.";return e.isArray(t)&&t.length>0&&e.every(t,function(t){return e.some(n,function(e){return e(t)})})},isArrayOfStrings:function(t){return e.isArrayOf(t,e.isString)},isObjectNotArray:function(t){return e.isObject(t)&&!e.isArray(t)},isNullUndef:function(t){return e.isNull(t)||e.isUndefined(t)},isFalsy:function(t){return e.isNullUndef(t)||t===!1||0===t||e.isEmpty(t)},getFirstIndex:function(t,n){if(!e.isArray(t))return null;if(!e.isFunction(n))throw"Callback with predicate is required, i.e. function(item) {return item.isMain;}";var r=null;return e.some(t,function(e,t){return n(e)?(r=t,!0):!1}),r},wrapInto:function(t,n){if(e.isNullUndef(t)||e.isNullUndef(n))throw"string and char are required";return n.toString()+t.toString()+n.toString()},isNonEmptyString:function(t){return e.isString(t)&&t.length>0},isNonEmptyArray:function(t){return e.isArray(t)&&!e.isEmpty(t)},reorderArray:function(e,t){var n,r=[];for(n=0;n<e.length;n++)r[n]=t[e[n]];for(n=0;n<t.length;n++)-1===e.indexOf(n)&&r.push(t[n]);return r},getStringOfLen:function(t,n){return e.map(e.range(t),function(){return n||" "}).join("")}}),e.noConflict()}),n("namedMaps",[],function(){var e={object:function(e){return e=e||1,{argIndex:e,c:["object"]}},error:function(e){return e=e||2,{argIndex:e,p:"errorHandler",c:[{len:3},"function"]}},success:function(e){return e=e||1,{argIndex:e,p:"successHandler",c:["function"]}}};return e}),n("namedValidators",[],function(){var e={handlers:{p:["successHandler","errorHandler"],c:["function"]}};return e}),n("metadata",[],function(){return{Annotation:{navigationProperties:{Annotation_parent_Source:{navigationProperty:"parent",field:"parent_id"},Annotation_createdByTool_Source:{navigationProperty:"createdByTool",field:"created_by_tool_id"},Annotation_container_Source:{navigationProperty:"container",field:"container_id"},Tag_annotation_Target:{navigationProperty:"tags"},AnnotationSharedWith_annotation_Target:{navigationProperty:"shared_with"}},fields:[{name:"annotation_id",type:"Number",nullable:"false"},{name:"annotator_id",type:"Number",nullable:"false"},{name:"content_id",maxLength:"60",type:"String",nullable:"false"},{name:"object_id",maxLength:"32",type:"String"},{name:"type_id",type:"Number",nullable:"false"},{name:"l0",maxLength:"10",type:"String"},{name:"l1",maxLength:"10",type:"String"},{name:"l2",maxLength:"10",type:"String"},{name:"l3",maxLength:"10",type:"String"},{name:"l4",maxLength:"10",type:"String"},{name:"l5",maxLength:"10",type:"String"},{name:"l6",maxLength:"10",type:"String"},{name:"title",maxLength:"300",type:"String"},{name:"body_text",maxLength:"10000",type:"String"},{name:"body_url",maxLength:"500",type:"String"},{name:"start_pos",type:"Number",nullable:"false"},{name:"end_pos",type:"Number",nullable:"false"},{name:"coord_x",type:"Number",nullable:"false"},{name:"coord_y",type:"Number",nullable:"false"},{name:"style",maxLength:"500",type:"String"},{name:"color",maxLength:"10",type:"String"},{name:"parent_id",type:"Number"},{name:"visibility_id",type:"Number",nullable:"false"},{name:"created_by_tool_id",type:"Number",nullable:"false"},{name:"container_id",type:"Number"},{name:"path",maxLength:"500",type:"String"},{name:"flag_id",type:"Number",nullable:"false"},{name:"data",maxLength:"10000",type:"String"},{name:"created_date",type:"Date"},{name:"updated_date",type:"Date"},{name:"deleted_date",type:"Date"},{name:"Version",maxLength:"8",type:"Edm.Binary",nullable:"false"},{name:"hmh_id",maxLength:"32",type:"String"}],keyField:"annotation_id"},Tag:{navigationProperties:{Tag_annotation_Source:{navigationProperty:"annotation",field:"annotation_id"}},fields:[{name:"tag_id",type:"Number",nullable:"false"},{name:"annotation_id",type:"Number",nullable:"false"},{name:"annotator_id",type:"Number",nullable:"false"},{name:"content_id",maxLength:"60",type:"String"},{name:"value",maxLength:"60",type:"String",nullable:"false"},{name:"Version",maxLength:"8",type:"Edm.Binary",nullable:"false"}],keyField:"tag_id"},Container:{navigationProperties:{Container_parent_Source:{navigationProperty:"parent",field:"parent_id"}},fields:[{name:"id",type:"Number",nullable:"false"},{name:"annotator_id",type:"Number",nullable:"false"},{name:"parent_id",type:"Number"},{name:"created_date",type:"Date",nullable:"false"},{name:"title",maxLength:"50",type:"String"},{name:"summary_text",maxLength:"50",type:"String"},{name:"order_number",type:"Number"},{name:"Version",maxLength:"8",type:"Edm.Binary",nullable:"false"},{name:"submitted_for_annotator_id",type:"Number"},{name:"submitted_status",type:"Number",nullable:"false"},{name:"submitted_date",type:"Date"}],keyField:"id"},AnnotationSharedWith:{navigationProperties:{AnnotationSharedWith_annotation_Source:{navigationProperty:"annotation",field:"annotation_id"}},fields:[{name:"id",type:"Number",nullable:"false"},{name:"annotation_id",type:"Number",nullable:"false"},{name:"annotator_id",type:"Number",nullable:"false"},{name:"annotation_annotator_id",type:"Number",nullable:"false"},{name:"created_date",type:"Date"},{name:"Version",maxLength:"8",type:"Edm.Binary",nullable:"false"}],keyField:"id"}}}),n("defaults",["metadata"],function(e){return{AnnotationTypes:[{id:1,name:"Bookmark"},{id:2,name:"Highlight"},{id:3,name:"Static Note"},{id:4,name:"Interactive Note"},{id:5,name:"HighlightMX"},{id:6,name:"StaticNoteMX"},{id:7,name:"TeacherComment"},{id:8,name:"Automatic Bookmark"},{id:9,name:"eBook Answer"},{id:10,name:"Student Cover Note"},{id:11,name:"Teacher Cover Note"},{id:12,name:"Graphic Organizer"},{id:13,name:"Maps Wizard"},{id:14,name:"Config Data"},{id:15,name:"Reporting"},{id:16,name:"Enhanced Answer"}],AppSettings:{AWSMaxLenghtUploadedFileKB:"20481",AWSMaxObjectsClonable:"50",ETagMaxLengthInChars:"23",MaxChangesetCount:"50",MaxCountOnInsert:"50",MaxExpandCount:"3",MaxExpandDepth:"3",MaxResults:"50",UrlExpirySeconds:"1800"},ClientTools:{Undefined:0,eBook:1,Notebook:2,MX:4,Portfolio:8,DLO:16},FieldsSettableOnCreationOnly:{Annotations:["type_id","created_by_tool_id"]},Metadata:e,ReadOnlyFields:{Annotations:["annotation_id","annotator_id","created_date","updated_date"],Containers:["id","annotator_id","created_date"],Tags:["tag_id","annotator_id"]},RequiredFields:{Annotations:["type_id","content_id"],Tags:["value","annotation_id"]},ContainerStatus:{NotSubmitted:0,Submitted:1,Returned:2}}}),n("config",["namedMaps","namedValidators","defaults"],function(e,t,n){var r=-1,i={userId:"user_id",userIds:"user_ids",userGuid:"user_guid",submittedForUserId:"submitted_for_user_id",contentId:"content_id",objectId:"object_id",typeId:"type_id",clientId:"client_id",containerId:"container_id",recursive:"recursive",submitTo:"submitTo",option:"option",classId:"class_id",text:"text",annotationId:"annotation_id",visibility_id:"visibility_id"};return{API_VERSION:{client:"2.5.3",service:"Service version is not available."},UNDEF_NUM:r,DEBUG_MODE_ON:!0,SERVER_URL:"/",SERVICE_PREFIX:"api/data/",SERVICE_DPS:"services/",SERVICE_APP_SETTINGS:"AppSettings",ACTION_STORAGE_UPLOAD_URL:"action/storage/upload",ACTION_DOWNLOAD_GET_URL:"action/download/geturl/?annotation_id=",ACTION_UPDATE_URL:"action/update/UpdateObjectAndAnnotationByAnnotationId/?annotation_id=",ACTION_DELETE_URL:"action/delete/RemoveObjectAndAnnotationByAnnotationId/?annotation_id=",INTERNAL_DEFAULTS:{SERVER_URL:"/",USE_POST_TUNNELING:!0,TOKEN_AUTHN:null,FORCE_ODATA_VERSION:void 0,CORS:!1,SUPPRESS_VALIDATION:!1,REQUEST_TIMEOUT:2e4,NEXT_LINK_DOMAIN_STRIPPING:!0,CLIENT_ID:r,USE_CAS_V2:!1,DEFAULT_PARSE_DATE:!1,PLATFORM_KEEPALIVE_DEFAULT_DELAY:84e4},REQ_TYPE_GET:"GET",REQ_TYPE_POST:"POST",REQ_TYPE_PUT:"PUT",REQ_TYPE_MERGE:"MERGE",REQ_TYPE_DELETE:"DELETE",ANNO2_WITH_NO_SHARED:0,ANNO2_WITH_SHARED_ONLY:1,ANNO2_WITH_SHARED:2,ANNO2_MY_NOT_SHARED_TO_OTHERS:3,TRANSPORT_NAMES:{ODATA:"oData",AJAX:"ajax"},NAMED_MAPS:e,NAMED_VALIDATORS:t,CRUD:{create:"create",update:"update",remove:"remove",find:"find",findOne:"findOne"},CUSTOM_ENDPOINTS:{FIND_COMMENTS:"findComments",DISTINCT_TAGS:"getDistinctTags",FIND_ALL_ANNOTATIONS_BY_TEXT:"findAllAnnotationsByText",GET_SUBMITTED:"getSubmitted",GET_USERS_FOR_ANNOTATION_ID:"getUsersForAnnotationId",FIND_COMMENTED_ANNOTATIONS:"findCommentedAnnotations",CREATE_IMAGE:"createImage",FIND_IMAGE:"findImage",UPDATE_IMAGE:"updateImage",REMOVE_IMAGE:"removeImage"},COLLECTIONS:{annotations:{name:"annotations",entity:"Annotation",nameUppercase:"Annotations",expandName:"annotation"},tags:{name:"tags",entity:"Tag",nameUppercase:"Tags",expandName:"tags"},containers:{name:"containers",entity:"Container",nameUppercase:"Containers",expandName:"container"},clientIDs:{name:"client_tools",entity:"ClientTool",nameUppercase:"ClientTools"},annotationSharedWith:{name:"annotationSharedWith",entity:"AnnotationSharedWith",nameUppercase:"AnnotationSharedWith",expandName:"shared_with"},entityless:{name:"entityless",entity:"entityless",nameUppercase:"entityless"}},QUERY_PARAMS:i,QUERY_PARAMS_ASSIGNMENTS:{getDistinctTags:[i.content_id,i.client_id,i.container_id,i.recursive]},FORCE_ODATA_VERSION:void 0,FORCE_DEFAULT_SERVICE_SETTINGS:!1,ERROR_DOCUMENTATION_URL:"http://dubconf.hmhpub.com:8080/display/DP2/Error+handling",ERROR_DOCUMENTATION_ANCHOR:"#Errorhandling-",EXPAND:"$expand=",EXPANDING_METHODS:{mySharedToOthers:"mySharedToOthers",withTags:"withTags",withShared:"withShared",withSharedOnly:"withSharedOnly",withSharedAnnotations:"withSharedAnnotations"},CONFLICTED_METHODS:{find:{myNotSharedToOthers:{name:"myNotSharedToOthers",methods:["getFileUrl","findImage","mySharedToOthers","withShared","withSharedOnly"]},mySharedToOthers:{name:"mySharedToOthers",methods:["getFileUrl","findImage","myNotSharedToOthers","withShared","withSharedOnly"]},withShared:{name:"withShared",methods:["getFileUrl","findImage","myNotSharedToOthers","mySharedToOthers","withSharedOnly"]},withSharedOnly:{name:"withSharedOnly",methods:["getFileUrl","findImage","myNotSharedToOthers","withShared","mySharedToOthers"]},findImage:{name:"findImage",methods:["withTags","myNotSharedToOthers","mySharedToOthers","withShared","withSharedOnly"]},getFileUrl:{name:"getFileUrl",methods:["withTags","myNotSharedToOthers","mySharedToOthers","withShared","withSharedOnly"]},withTags:{name:"withTags",methods:["getFileUrl","findImage"]}},create:{createImage:{name:"createImage",methods:["tags","childAnnotations"]},createWithFile:{name:"createWithFile",methods:["tags","childAnnotations"]},tags:{name:"tags",methods:["createImage","createWithFile"]},childAnnotations:{name:"childAnnotations",methods:["createImage","createWithFile"]}}},SETTINGS:{AnnotationTypes:[],AppSettings:{},ClientTools:{},FieldsSettableOnCreationOnly:{},Metadata:{},ReadOnlyFields:{},RequiredFields:{},ContainerStatus:{},ExcludeNonServiceSettingsProperties:["Version"],ExcludeFromServiceSettingsParsing:["AnnotationTypes","ClientTools","Metadata"],Source:"",serviceSettingsStatuses:[]},SETTINGS_SOURCES:{CLIENT_DEFAULTS:"client_defaults",SERVICE_WITH_CLIENT_DEFAULTS:"service_with_client_defaults",SERVICE:"service",FORCED_CLIENT_DEFAULTS:"forced_client_defaults"},DEFAULTS:n,API_INITIALIZED:!1}}),n("errorList",[],function(){return[{code:"API_ERR_AJAX_1",error:"method {0} expects {1} parameters {2}"},{code:"API_ERR_AJAX_2",error:"{0} is required to use {1}"},{code:"API_ERR_AJAX_3",error:"{0} is already running, stop it with {1} first!"},{code:"API_ERR_GENERAL_1",error:"param {0} for method {1} must be {2}, but it is {3} instead"},{code:"API_ERR_GENERAL_2",error:'The {0} provided: "{1}" is not supported by data persistence!'},{code:"API_ERR_GENERAL_3",error:"Missing required parameter {0} when calling {1}."},{code:"API_ERR_GENERAL_4",error:"The {0} endpoint is not available when using CAS V2."},{code:"API_ERR_QUERY_API_1",error:"{0}: method {1} must be called empty or with {2} (type {3})"},{code:"API_ERR_QUERY_API_2",error:"{0}: param {1} is required when method {2} is used with {3}"},{code:"API_ERR_QUERY_API_3",error:"{0}: param {1} for method {2} must be {3}, but it is {4} instead"},{code:"API_ERR_QUERY_API_4",error:"{0}: method {1} expects {2}"},{code:"API_ERR_QUERY_API_5",error:"{0}: {1} method can be used only with {2} operation(s)"},{code:"API_ERR_QUERY_API_6",error:"{0}: {1} method cannot be used with multiple {2} passed"},{code:"API_ERR_QUERY_API_7",error:"{0}: {1} field is populated automatically, so {1} : {2} is invalid and it cannot be used in {3} method"},{code:"API_ERR_QUERY_API_8",error:"queryAPI: {0}: operation already set, check if you mixed CRUD operations in single query"},{code:"API_ERR_QUERY_API_9",error:"fields [{0}] are not allowed"},{code:"API_ERR_QUERY_API_10",error:"{0}: {1} is not a function"},{code:"API_ERR_QUERY_API_11",error:"{0}: {1} field is not allowed in {2} operation"},{code:"API_ERR_QUERY_API_12",error:"Length of field {0} exceeds maximum allowed length (length: {1}, allowed: {2})"},{code:"API_ERR_QUERY_API_13",error:"Annotation service API isn't initialized or annService.init method hasn't finished"},{code:"API_ERR_QUERY_API_14",error:"method {0} can be used only with {1}"},{code:"API_ERR_QUERY_API_15",error:"Operation must be set in order to call {0} function"},{code:"API_ERR_QUERY_API_16",error:"method {0} can be only called once"},{code:"API_ERR_QUERY_API_17",error:"fields {0} for object {1} are required"},{code:"API_ERR_QUERY_API_18",error:"In batch operations, number of items in {0} and number of {1} has to be the same"},{code:"API_ERR_QUERY_API_19",error:"etags: etag with value {0} and length {1} is not the right length (expected less than {2} and greater than 0)"},{code:"API_ERR_QUERY_API_20",error:"{0}: {1} method cannot be used with any of the following methods: {2}"},{code:"API_ERR_QUERY_API_21",error:"In batch operations, number of items in {0} method has to match a numer of subrequests"},{code:"API_ERR_TRANSPORT_1",error:"oDataTransport: number of batch request items have exceeded the server side imposed limit of {0}"},{code:"API_ERR_TRANSPORT_2",error:'filtersParser: validate: key "{0}" is not one of valid operators: {1}'},{code:"API_ERR_TRANSPORT_3",error:'filtersParser: buildComparator: could not find compare operation for key "{0}". Valid keys: {1}'}]}),n("resetManager",["underscorenc"],function(e){function t(){e.each(r,function(e){e()})}function n(t){if(!e.isFunction(t))throw"ResetManager:addSubscriber: Metdhod accepts only functions.";r.push(t)}var r=[],i={resetLib:t,subscribe:n};return i}),n("errorManager",["underscorenc","errorList","config","resetManager"],function(e,t,n,r){var i={},a=function(e,t){var n=e+"",r=new RegExp("{-?[0-9]+}","g");return n.replace(r,function(e){var n,r=parseInt(e.substring(1,e.length-1));return n=r>=0?t[r]:-1===r?"{":-2===r?"}":""
})};return i.throwError=function(i,o,s){if(!n.SUPPRESS_VALIDATION){var u=e.find(t,function(e){return e.code===i});r.resetLib();var d="Code: {0} Message: {1}, Help page: {2}";if(e.isNumber(s)&&(d="Code: {0} Message: (for sub-query index "+s+") {1}, Help page: {2}"),e.isUndefined(u))throw"Code not found in error messages";var l=a(u.error,o);throw a(d,[u.code,l,n.ERROR_DOCUMENTATION_URL+n.ERROR_DOCUMENTATION_ANCHOR+u.code])}},i}),n("helpers",["underscorenc","config","errorManager"],function(e,t,n){function r(e){return encodeURIComponent(e.replace(/'/g,"%27"))}function i(e,n){if(t.DEBUG_MODE_ON)throw new Error("Error in '"+n+"': "+e)}function a(t){var n,r="";if(e.isObject(t))for(n in t)r+="["+n+': "'+t[n]+'"]';else r+=t;return r}var o={};o.encodeUrlString=r,o.isUserTokenSet=function(){return void 0!=t.TOKEN_AUTHN},o.isServiceReady=function(){return t.API_INITIALIZED||t.SUPPRESS_VALIDATION||this.throwQueryError("API_ERR_QUERY_API_13",null),!0},o.debugContainsAnnotationsId=function(e,n,r,i){if(t.DEBUG_MODE_ON){i=i||"";var a=!1;return a=void 0!==n[e],a&&alert(e+" found in fieldsValues for "+r+". "+i),a}},o.debugParseResults=function(e){var t,n="";if(e.hasOwnProperty("results"))for(t=0;t<e.results.length;t++)n+=a(e.results[t]);else n+=a(e);return n},o.getEmptyParams=function(){return{successHandler:null,errorHandler:null,visibility:null,visibilityId:null,contentId:null,fields:null,filters:null,orderBy:null,orderDesc:!1,getCount:!1,orderAscending:null,limitFrom:null,limitCount:null,parseDate:null}},o.getHeader=function(n,r){e.isString(n)||(r=n);var i={};return i.Accept="application/json;odata=fullmetadata;q=0.8, application/atom+xml;q=0.7, application/json;q=0.5, */*;q=0.1",e.extend(i,r),o.isUserTokenSet()&&(i.Authorization=t.TOKEN_AUTHN),!t.USE_POST_TUNNELING&&void 0!=[].indexOf||n!==t.REQ_TYPE_MERGE||(i["X-HTTP-Method"]=n),e.isUndefined(t.FORCE_ODATA_VERSION)||(i.DataServiceVersion=t.FORCE_ODATA_VERSION,i.MaxDataServiceVersion=t.FORCE_ODATA_VERSION),i},o.getHTTPMethod=function(e){return!t.USE_POST_TUNNELING&&void 0!=[].indexOf||e!==t.REQ_TYPE_MERGE?e:t.REQ_TYPE_POST};var s={"function":e.isFunction,number:e.isNumber,array:e.isArray,object:e.isObject,string:e.isString,"boolean":e.isBoolean};o.areArgsValidType=function(e){var t,r,i,a;for(t=0;t<e.length;t++)for(r=0;r<e[t].o.length&&(void 0!==e[t].o[r]&&null!==e[t].o[r]);r++){for(a=!1,i=0;i<e[t].t.length;i++){if(!s[e[t].t[i]])throw e[t].t[i]+" is not defined in typeMap.";if(a=s[e[t].t[i]](e[t].o[r]))break}a||n.throwError("API_ERR_GENERAL_1",["","",e[t].t,e[t].o[r]])}},o.setParams=function(e,t,r,i){var a;for(e=e||{},t=t||[],i=i||"(unknown)",a=0;a<t.length;a++)e[t[a]]=void 0==e[t[a]]?null:e[t[a]],e[t[a]]||n.throwError("API_ERR_GENERAL_3",[t[a],i]);if(r)for(a=0;a<r.length;a++)e[r[a]]=void 0==e[r[a]]?null:e[r[a]];return e},o.consoleLog=function(){t.DEBUG_MODE_ON&&console&&console.log&&(console.log.apply?console.log.apply(console,arguments):Array.prototype.slice.call(arguments))},o.defSuccessCb=function(e){o.consoleLog("---------* Results: *---------\n",e,"\n------------------------------")},o.defErrorCb=function(e){o.consoleLog("----------! ERROR !-----------\n",e,"\n------------------------------")},o.getRequestURL=function(e,n){return t.SERVER_URL+(t.SERVICE_PREFIX+(t.USE_CAS_V2?"v2/":""))+(n?"":t.SERVICE_DPS)+e},o.checkLength=function(e){{var t=e.len;e.com}return function(e){return!(e.length!==t)}},o.throwError=i;var u=function(n,r){var i={navigationProperties:{}},a={"Edm.DateTime":"Date","Edm.Int32":"Number","Edm.String":"String"},s=e.findWhere(t.SETTINGS.serviceSettingsStatuses,{name:"Metadata"}),u=r&&r["edmx:Edmx"]&&r["edmx:Edmx"]["edmx:DataServices"]&&r["edmx:Edmx"]["edmx:DataServices"].Schema&&r["edmx:Edmx"]["edmx:DataServices"].Schema.EntityType,d=r&&r["edmx:Edmx"]&&r["edmx:Edmx"]["edmx:DataServices"]&&r["edmx:Edmx"]["edmx:DataServices"].Schema&&r["edmx:Edmx"]["edmx:DataServices"].Schema.Association;if(!u||!e.isArray(u)||!e.contains(e.pluck(u,"@Name"),n))return o.consoleLog("* Can't parse metadata for entity: "+n+". Using the default value."),t.DEFAULTS.Metadata[n];if(s.received=!0,s.correctFormat=!0,!d||!e.isArray(d))return o.consoleLog("* Can't navigation properties for entity: "+n+". Using the default value."),t.DEFAULTS.Metadata[n].navigationProperties;var l=e.find(u,function(t){return e.isUndefined(t.Property)||!e.isArray(t.Property)?void 0:e.isUndefined(t.NavigationProperty)||!e.isArray(t.NavigationProperty)&&!e.isObject(t.NavigationProperty)?void 0:!(!t||t["@Name"]!=n)});return e.isUndefined(l)?t.DEFAULTS.Metadata[n]:(i.fields=e.map(l.Property,function(t){return t=e.object(e.map(t,function(e,t){return[t.charAt(1).toLowerCase()+t.slice(2),e]})),t.type=a[t.type]||t.type,e.pick(t,["name","maxLength","type","nullable"])}),e.isArray(l.NavigationProperty)||(l.NavigationProperty=[l.NavigationProperty]),e.each(l.NavigationProperty,function(t){i.navigationProperties[t["@FromRole"]]={},i.navigationProperties[t["@FromRole"]].navigationProperty=e.first(e.values(e.pick(t,"@Name"))),e.each(d,function(n){e.contains(n.ReferentialConstraint.Dependent,t["@FromRole"])&&(i.navigationProperties[t["@FromRole"]].field=n.ReferentialConstraint.Dependent.PropertyRef["@Name"])})}),i.keyField=l.Key&&l.Key.PropertyRef&&l.Key.PropertyRef["@Name"],i)};return o.parseMetadata=function(n){var r={},i=e.findWhere(t.SETTINGS.serviceSettingsStatuses,{name:"Metadata"});return r[t.COLLECTIONS.annotations.entity]=u(t.COLLECTIONS.annotations.entity,n),r[t.COLLECTIONS.tags.entity]=u(t.COLLECTIONS.tags.entity,n),r[t.COLLECTIONS.containers.entity]=u(t.COLLECTIONS.containers.entity,n),r[t.COLLECTIONS.annotationSharedWith.entity]=u(t.COLLECTIONS.annotationSharedWith.entity,n),i.upToDate=void 0!==i,r},o.getArrayLengthIE8=function(e){for(var t=e.length;!e.hasOwnProperty(--t););return++t,t},o.templatify=function(e){return function(t){for(var n,r=/<%= (.+?) %>/g,i=e;n=r.exec(e);)i=i.replace(n[0],t[n[1]]);return i}},o.getResponseAdditionalData=function(t){var n={},r=e.keys(t.headers);return n.headers={},e.each(r,function(e){n.headers[e]=t.headers[e]}),n.statusCode=t.statusCode,n.statusText=t.statusText,t&&t.data&&t.data.__count&&(n.totalCount=t.data.__count),n},o.getAjaxResponseAdditionalData=function(e){var t={};return t.headers=e&&e.getAllResponseHeaders?o.parseAjaxResponseHeaders(e.getAllResponseHeaders()):e.headers,t.statusCode="function"!=typeof e.statusCode?e.statusCode:e.status,t.statusText="function"!=typeof e.statusText?e.statusText:e.status,t},o.parseAjaxResponseHeaders=function(e){var t={};if(!e)return t;for(var n=e.split("\r\n"),r=0;r<n.length;r++){var i=n[r],a=i.indexOf(": ");if(a>0){var o=i.substring(0,a),s=i.substring(a+2);t[o]=s}}return t},o.getPropertyValueCaseInsensitive=function(t,n){var r;return n=(n+"").toLowerCase(),!e.isUndefined(t)&&e.isObject(t)&&(r=t[e.find(e.keys(t),function(e){return e.toLowerCase()===n})]),r},o.updateVisibilityIdByNames=function(e){var t="updateVisibilityIdByClientNames";o.areArgsValidType([{o:[e.previousVisibility_id],t:["number"]},{o:[e.includeClients,e.excludeClients],t:["array","string"]}],t),(void 0===e.currentVisibilityId||void 0===e.includeClients&&void 0===e.excludeClients)&&n.throwError("API_ERR_CLIENT_2",[t]);var r=e.currentVisibilityId,i=e.includeClients?o.convertNamesToID(e.includeClients):null,a=e.excludeClients?o.convertNamesToID(e.excludeClients):null;return i&&(r|=i),a&&(r&=~a),r},o.convertNamesToID=function(r){var i,a=0;for(r=e.isString(r)?[r]:r,i=0;i<r.length;i++)void 0===t.SETTINGS.ClientTools[r[i]]?n.throwError("API_ERR_GENERAL_2",["client_id",r[i]]):a|=t.SETTINGS.ClientTools[r[i]];return a},o.concatenateStrings=function(t,n,r){if(!e.isArray(n))throw"concatenateStrings: stringCollection must be an array";var i=this;return n=e.reject(n,function(t){return e.isNull(t)||e.isUndefined(t)||e.isString(t)&&""===i.trim(t)}),t=n.length>0&&e.isString(t)?t:"",r=e.isString(r)?r:"",t+n.join(r)},o.isFunSwitchEnabled=function(e){return 0===e.length||!!e[0]},o.tempAndUglyGetEntityName=function(n){var r;return e.some(t.COLLECTIONS,function(e){return e.nameUppercase===n?(r=e.entity,!0):!1}),r},o.trim=function(e){return"function"!=typeof String.prototype.trim?e.replace(/^\s+|\s+$/g,""):e.trim()},o.makeFirstLetterLowercase=function(t){return e.isString(t)?t.substr(0,1).toLowerCase()+t.substr(1):void 0},o.getMetadataByEntityName=function(n){if(e.isString(n)){var r=e.find(t.COLLECTIONS,function(e){return n.toLowerCase()===e.name.toLowerCase()});if(r)return t.SETTINGS.Metadata[r.entity]}},o.toType=function(t){return e.isNull(t)?"null":e.isUndefined(t)?"undefined":{}.toString.call(t).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},o.ServiceSettingsStatus=function(e){this.name=e,this.received=!1,this.correctFormat=!1,this.upToDate=!1,this.unknown=!1,this.forced=!1},o}),n("client",["underscorenc","config","helpers","errorManager"],function(e,t,n,r){var i={init:function(){return this}},a=t.UNDEF_NUM;return i.getID=function(){return a},i._parseClientIds=function(n){if(n){var r=e.findWhere(t.SETTINGS.serviceSettingsStatuses,{name:"ClientTools"});if(r.received=!0,n.length&&e.isArray(n)){r.correctFormat=!0;var i={};if(e.each(n,function(t){e.isUndefined(t.client_tool_description)||e.isUndefined(t.client_tool_id)||(i[t.client_tool_description]=t.client_tool_id)}),e.size(i)>0)return e.isEqual(i,t.DEFAULTS.ClientTools)&&(r.upToDate=!0),void(t.SETTINGS.ClientTools=i)}else t.SETTINGS.ClientTools=t.DEFAULTS.ClientTools}},i.convertNamesToID=function(n){var i,a=0;for(n=e.isString(n)?[n]:n,i=0;i<n.length;i++)void 0===t.SETTINGS.ClientTools[n[i]]?r.throwError("API_ERR_GENERAL_2",["client_id",n[i]]):a|=t.SETTINGS.ClientTools[n[i]];return a},i.convertIDToNames=function(e){var n,r=[];for(n in t.SETTINGS.ClientTools)t.SETTINGS.ClientTools[n]&e&&r.push(n);return r},i.setID=function(e){a=i.convertNamesToID(e)||t.UNDEF_NUM},i.isSet=function(){return a!==t.UNDEF_NUM},i.updateVisibilityIdByNames=function(e){var t="updateVisibilityIdByClientNames";n.areArgsValidType([{o:[e.previousVisibility_id],t:["number"]},{o:[e.includeClients,e.excludeClients],t:["array","string"]}],t),(void 0===e.currentVisibilityId||void 0===e.includeClients&&void 0===e.excludeClients)&&r.throwError("API_ERR_QUERY_API_4",[t,"currentVisibilityId and includeClients or excludeClients"]);var a=e.currentVisibilityId,o=e.includeClients?i.convertNamesToID(e.includeClients):null,s=e.excludeClients?i.convertNamesToID(e.excludeClients):null;return o&&(a|=o),s&&(a&=~s),a},i.convertNamesToVisibilityIds=function(n,a){for(var o=e.keys(t.SETTINGS.ClientTools).length-1,s=[],u=[],d=0;d<Math.pow(o,2);d++)u.push(d);if(n=e.isString(n)?[n]:n,n&&n.length>0)if(a&&0===a.length&&(a="or"),"and"===a)s.push(i.convertNamesToID(n));else for(d=0;d<u.length;d++)for(var l=0;l<n.length;l++)e.each(n,function(){void 0===t.SETTINGS.ClientTools[n[l]]&&r.throwError("API_ERR_GENERAL_2",["client_id",n[d]]),t.SETTINGS.ClientTools[n[l]]&u[d]&&-1===e.indexOf(u[d],s)&&s.push(u[d])});return s},i.convertNamesToVisibilityIdsForGet=function(n){var i=[];return e.isString(n)&&(n=[n]),e.each(n,function(e){t.SETTINGS.ClientTools[e]?i.push(t.SETTINGS.ClientTools[e]):r.throwError("API_ERR_GENERAL_2",["client_id",e])}),i},i.init()}),function(e,t){var n=e.datajs||{},r=e.OData||{};e.datajs=n,e.OData=r,n.version={major:1,minor:1,build:1};var i=function(t){return e.ActiveXObject?new e.ActiveXObject(t):null},a=function(e){return null!==e&&e!==t},o=function(e,t){var n,r;for(n=0,r=e.length;r>n;n++)if(e[n]===t)return!0;return!1},s=function(e,n){return e!==t?e:n},u=function(t){if(1===arguments.length)return void e.setTimeout(t,0);var n=Array.prototype.slice.call(arguments,1);e.setTimeout(function(){t.apply(this,n)},0)},d=function(e,t){for(var n in t)e[n]=t[n];return e},l=function(e,t){if(e){var n,r;for(n=0,r=e.length;r>n;n++)if(t(e[n]))return e[n]}return null},c=function(e){return"[object Array]"===Object.prototype.toString.call(e)},f=function(e){return"[object Date]"===Object.prototype.toString.call(e)},p=function(e){return"object"==typeof e},_=function(e){return parseInt(e,10)},h=function(e,t,n){e.hasOwnProperty(t)&&(e[n]=e[t],delete e[t])},m=function(e){throw e},g=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},y=/^([^:\/?#]+:)?(\/\/[^\/?#]*)?([^?#:]+)?(\?[^#]*)?(#.*)?/,E=["scheme","authority","path","query","fragment"],S=function(e){var t={isAbsolute:!1};if(e){var n=y.exec(e);if(n){var r,i;for(r=0,i=E.length;i>r;r++)n[r+1]&&(t[E[r]]=n[r+1])}t.scheme&&(t.isAbsolute=!0)}return t},R=function(e){return"".concat(e.scheme||"",e.authority||"",e.path||"",e.query||"",e.fragment||"")},v=function(e,t){if(!t)return e;var n=S(e);if(n.isAbsolute)return e;var r,i=S(t),a={};return n.authority?(a.authority=n.authority,r=n.path,a.query=n.query):(n.path?(r="/"===n.path.charAt(0)?n.path:A(n.path,i.path),a.query=n.query):(r=i.path,a.query=n.query||i.query),a.authority=i.authority),a.path=T(r),a.scheme=i.scheme,a.fragment=n.fragment,R(a)},A=function(e,t){var n,r="/";return t&&(n=t.lastIndexOf("/"),r=t.substring(0,n),"/"!==r.charAt(r.length-1)&&(r+="/")),r+e},T=function(e){for(var t,n="",r="";e;)0===e.indexOf("..")||0===e.indexOf(".")?e=e.replace(/^\.\.?\/?/g,""):0===e.indexOf("/..")?(e=e.replace(/^\/\..\/?/g,"/"),t=n.lastIndexOf("/"),n=-1===t?"":n.substring(0,t)):0===e.indexOf("/.")?e=e.replace(/^\/\.\/?/g,"/"):(r=e,t=e.indexOf("/",1),-1!==t&&(r=e.substring(0,t)),n+=r,e=e.replace(r,""));return n},I=function(n){var r=[];if(e.atob===t)r=P(n);else for(var i=e.atob(n),a=0;a<i.length;a++)r.push(i.charCodeAt(a));for(var o="",s="0123456789ABCDEF",u=0;u<r.length;u++){var d=r[u];o+=s[d>>4],o+=s[15&d]}return o},P=function(e){for(var t="",n=0;n<e.length;n++){var r=N(e[n]),i="";null!==r&&(i=r.toString(2),t+=O(i))}var a=[],o=parseInt(t.length/8,10);for(n=0;o>n;n++){var s=parseInt(t.substring(8*n,8*(n+1)),2);a.push(s)}return a},N=function(e){var t=e.charCodeAt(0),n=65,r=6;return t>=65&&90>=t?t-n:t>=97&&122>=t?t-n-r:t>=48&&57>=t?t+4:"+"==e?62:"/"==e?63:null},O=function(e){for(;e.length<6;)e="0"+e;return e},b="http://",C=b+"www.w3.org/",U=C+"1999/xhtml",D=C+"2000/xmlns/",L=C+"XML/1998/namespace",x=b+"www.mozilla.org/newlayout/xml/parsererror.xml",F=function(e){var t=/(^\s)|(\s$)/;return t.test(e)},M=function(e){var t=/^\s*$/;return null===e||t.test(e)},w=function(e){for(;null!==e&&1===e.nodeType;){var t=W(e,"space",L);if("preserve"===t)return!0;if("default"===t)break;e=e.parentNode}return!1},V=function(e){var t=e.nodeName;return"xmlns"==t||0===t.indexOf("xmlns:")},j=function(e,t,n){try{e.setProperty(t,n)}catch(r){}},k=function(){var e=i("Msxml2.DOMDocument.3.0");return e&&(j(e,"ProhibitDTD",!0),j(e,"MaxElementDepth",256),j(e,"AllowDocumentFunction",!1),j(e,"AllowXsltScript",!1)),e},G=function(){try{var e=i("Msxml2.DOMDocument.6.0");return e&&(e.async=!0),e}catch(t){return k()}},q=function(e){var t=G();if(!t)return null;t.loadXML(e);var n=t.parseError;return 0!==n.errorCode&&Q(n.reason,n.srcText,e),t},Q=function(e,t,n){throw"string"==typeof e&&(e={message:e}),d(e,{srcText:t||"",errorXmlText:n||""})},H=function(t){var n,r=e.DOMParser&&new e.DOMParser;if(!r)return n=q(t),n||Q("XML DOM parser not supported"),n;try{n=r.parseFromString(t,"text/xml")}catch(i){Q(i,"",t)}var a=n.documentElement,o=a.namespaceURI,s=it(a);if("parsererror"===s&&o===x){var u=et(a,x,"sourcetext"),d=u?ot(u):"";Q(rt(a)||"",d,t)}if("h3"===s&&o===U||tt(a,U,"h3")){for(var l="",c=[],f=a.firstChild;f;)1===f.nodeType&&(l+=rt(f)||""),c.push(f.nextSibling),f=f.firstChild||c.shift();l+=rt(a)||"",Q(l,"",t)}return n},Y=function(e,t){return e?e+":"+t:t},B=function(e,t){if(F(t.data)){var n=X(e,L,"space");n||(n=ft(e.ownerDocument,L,Y("xml","space")),ct(e,n)),n.value="preserve"}return e.appendChild(t),e},$=function(e,t){var n,r,i=e.attributes;for(n=0,r=i.length;r>n;n++)t(i.item(n))},W=function(e,t,n){var r=X(e,t,n);return r?ot(r):null},X=function(e,t,n){var r=e.attributes;return r.getNamedItemNS?r.getNamedItemNS(n||null,t):r.getQualifiedItem(t,n)||null},K=function(e,t){var n=X(e,"base",L);return(n?v(n.value,t):t)||null},J=function(e,t){st(e,!1,function(e){return 1===e.nodeType&&t(e),!0})},z=function(e,t,n){var r,i,a=n.split("/");for(r=0,i=a.length;i>r;r++)e=e&&et(e,t,a[r]);return e||null},Z=function(e,t,n){var r=n.lastIndexOf("/"),i=n.substring(r+1),a=n.substring(0,r),o=a?z(e,t,a):e;return o?"@"===i.charAt(0)?X(o,i.substring(1),t):et(o,t,i):null},et=function(e,t,n){return nt(e,t,n,!1)},tt=function(e,t,n){if(e.getElementsByTagNameNS){var r=e.getElementsByTagNameNS(t,n);return r.length>0?r[0]:null}return nt(e,t,n,!0)},nt=function(e,t,n,r){var i=null;return st(e,r,function(e){if(1===e.nodeType){var r=!t||at(e)===t,a=!n||it(e)===n;r&&a&&(i=e)}return null===i}),i},rt=function(e){var n,r=null,i=9===e.nodeType&&e.documentElement?e.documentElement:e,a=i.ownerDocument.preserveWhiteSpace===!1;return st(i,!1,function(e){if(3===e.nodeType||4===e.nodeType){var o=ot(e),s=a||!M(o);s||(n===t&&(n=w(i)),s=n),s&&(r?r+=o:r=o)}return!0}),r},it=function(e){return e.localName||e.baseName},at=function(e){return e.namespaceURI||null},ot=function(e){return 1===e.nodeType?rt(e):e.nodeValue},st=function(e,t,n){for(var r=[],i=e.firstChild,a=!0;i&&a;)a=n(i),a&&(t&&i.firstChild&&r.push(i.firstChild),i=i.nextSibling||r.shift())},ut=function(e,t,n){for(var r=e.nextSibling;r;){if(1===r.nodeType){var i=!t||at(r)===t,a=!n||it(r)===n;if(i&&a)return r}r=r.nextSibling}return null},dt=function(){var t=e.document.implementation;return t&&t.createDocument?t.createDocument(null,null,null):G()},lt=function(e,t){if(!c(t))return ct(e,t);var n,r;for(n=0,r=t.length;r>n;n++)t[n]&&ct(e,t[n]);return e},ct=function(e,t){if(t){if("string"==typeof t)return B(e,mt(e.ownerDocument,t));2===t.nodeType?e.setAttributeNodeNS?e.setAttributeNodeNS(t):e.setAttributeNode(t):e.appendChild(t)}return e},ft=function(e,n,r,i){var a=e.createAttributeNS&&e.createAttributeNS(n,r)||e.createNode(2,r,n||t);return a.value=i||"",a},pt=function(e,n,r,i){var a=e.createElementNS&&e.createElementNS(n,r)||e.createNode(1,r,n||t);return lt(a,i||[])},_t=function(e,t,n){return ft(e,D,Y("xmlns",n),t)},ht=function(e,t){for(var n="<c>"+t+"</c>",r=H(n),i=r.documentElement,a=("importNode"in e?e.importNode(i,!0):i),o=e.createDocumentFragment(),s=a.firstChild;s;)o.appendChild(s),s=s.nextSibling;return o},mt=function(e,t){return e.createTextNode(t)},gt=function(e,t,n,r,i){var a,o,s="",u=i.split("/"),d=et,l=pt,c=t;for(a=0,o=u.length;o>a;a++){s=u[a],"@"===s.charAt(0)&&(s=s.substring(1),d=X,l=ft);var f=d(c,n,s);f||(f=l(e,n,Y(r,s)),ct(c,f)),c=f}return c},yt=function(t){var n=e.XMLSerializer;if(n){var r=new n;return r.serializeToString(t)}if(t.xml)return t.xml;throw{message:"XML serialization unsupported"}},Et=function(e){var t,n=e.childNodes,r=n.length;if(0===r)return"";var i=e.ownerDocument,a=i.createDocumentFragment(),o=i.createElement("c");for(a.appendChild(o),t=0;r>t;t++)o.appendChild(n[t]);var s=yt(a);for(s=s.substr(3,s.length-7),t=0;r>t;t++)e.appendChild(o.childNodes[t]);return s},St=function(e,t,n){return function(){return e[t].apply(e,arguments),n}},Rt=function(){this._arguments=t,this._done=t,this._fail=t,this._resolved=!1,this._rejected=!1};Rt.prototype={then:function(e,t){return e&&(this._done?this._done.push(e):this._done=[e]),t&&(this._fail?this._fail.push(t):this._fail=[t]),this._resolved?this.resolve.apply(this,this._arguments):this._rejected&&this.reject.apply(this,this._arguments),this},resolve:function(){if(this._done){var e,n;for(e=0,n=this._done.length;n>e;e++)this._done[e].apply(null,arguments);this._done=t,this._resolved=!1,this._arguments=t}else this._resolved=!0,this._arguments=arguments},reject:function(){if(this._fail){var e,n;for(e=0,n=this._fail.length;n>e;e++)this._fail[e].apply(null,arguments);this._fail=t,this._rejected=!1,this._arguments=t}else this._rejected=!0,this._arguments=arguments},promise:function(){var e={};return e.then=St(this,"then",e),e}};var vt=function(e,t){var n=(e&&e.__metadata||{}).type;return n||(t?t.type:null)},At="Edm.",Tt=At+"Binary",It=At+"Boolean",Pt=At+"Byte",Nt=At+"DateTime",Ot=At+"DateTimeOffset",bt=At+"Decimal",Ct=At+"Double",Ut=At+"Guid",Dt=At+"Int16",Lt=At+"Int32",xt=At+"Int64",Ft=At+"SByte",Mt=At+"Single",wt=At+"String",Vt=At+"Time",jt=At+"Geography",kt=jt+"Point",Gt=jt+"LineString",qt=jt+"Polygon",Qt=jt+"Collection",Ht=jt+"MultiPolygon",Yt=jt+"MultiLineString",Bt=jt+"MultiPoint",$t=At+"Geometry",Wt=$t+"Point",Xt=$t+"LineString",Kt=$t+"Polygon",Jt=$t+"Collection",zt=$t+"MultiPolygon",Zt=$t+"MultiLineString",en=$t+"MultiPoint",tn="Point",nn="LineString",rn="Polygon",an="MultiPoint",on="MultiLineString",sn="MultiPolygon",un="GeometryCollection",dn=[wt,Lt,xt,It,Ct,Mt,Nt,Ot,Vt,bt,Ut,Pt,Dt,Ft,Tt],ln=[$t,Wt,Xt,Kt,Jt,zt,Zt,en],cn=[jt,kt,Gt,qt,Qt,Ht,Yt,Bt],fn=function(e,t){if(!e)return null;if(c(e)){var n,r,i;for(n=0,r=e.length;r>n;n++)if(i=fn(e[n],t))return i;return null}return e.dataServices?fn(e.dataServices.schema,t):t(e)},pn=function(e,t){return e=0===e?"":"."+mn(e.toString(),3),t>0&&(""===e&&(e=".000"),e+=mn(t.toString(),4)),e},_n=function(e){if("string"==typeof e)return e;var t=In(e),n=gn(e.__offset);if(t&&"Z"!==n){e=new Date(e.valueOf());var r=ir(n),i=e.getUTCHours()+r.d*r.h,a=e.getUTCMinutes()+r.d*r.m;e.setUTCHours(i,a)}else t||(n="");var o=e.getUTCFullYear(),s=e.getUTCMonth()+1,u="";0>=o&&(o=-(o-1),u="-");var d=pn(e.getUTCMilliseconds(),e.__ns);return u+mn(o,4)+"-"+mn(s,2)+"-"+mn(e.getUTCDate(),2)+"T"+mn(e.getUTCHours(),2)+":"+mn(e.getUTCMinutes(),2)+":"+mn(e.getUTCSeconds(),2)+d+n},hn=function(e){var t=e.ms,n="";0>t&&(n="-",t=-t);var r=Math.floor(t/864e5);t-=864e5*r;var i=Math.floor(t/36e5);t-=36e5*i;var a=Math.floor(t/6e4);t-=6e4*a;var o=Math.floor(t/1e3);return t-=1e3*o,n+"P"+mn(r,2)+"DT"+mn(i,2)+"H"+mn(a,2)+"M"+mn(o,2)+pn(t,e.ns)+"S"},mn=function(e,t,n){for(var r=e.toString(10);r.length<t;)n?r+="0":r="0"+r;return r},gn=function(e){return e&&"Z"!==e&&"+00:00"!==e&&"-00:00"!==e?e:"Z"},yn=function(e){if("string"==typeof e){var t=e.indexOf(")",10);if(0===e.indexOf("Collection(")&&t>0)return e.substring(11,t)}return null},En=function(e,n,r,i,a,o){return a.request(e,function(a){try{a.headers&&Kn(a.headers),a.data===t&&204!==a.statusCode&&i.read(a,o)}catch(s){return s.request===t&&(s.request=e),s.response===t&&(s.response=a),void r(s)}n(a.data,a)},r)},Sn=function(e){return Tn(e)&&c(e.__batchRequests)},Rn=/Collection\((.*)\)/,vn=function(e,t){var n=e&&e.results||e;return!!n&&An(t)||!t&&c(n)&&!Tn(n[0])},An=function(e){return Rn.test(e)},Tn=function(e){return!!e&&p(e)&&!c(e)&&!f(e)},In=function(e){return"Edm.DateTimeOffset"===e.__edmType||!e.__edmType&&e.__offset},Pn=function(e){if(!e&&!Tn(e))return!1;var t=e.__metadata||{},n=e.__deferred||{};return!t.type&&!!n.uri},Nn=function(e){return Tn(e)&&e.__metadata&&"uri"in e.__metadata},On=function(e,t){var n=e&&e.results||e;return c(n)&&!An(t)&&Tn(n[0])},bn=function(e){return o(cn,e)},Cn=function(e){return o(ln,e)},Un=function(e){if(!e&&!Tn(e))return!1;var t=e.__metadata,n=e.__mediaresource;return!t&&!!n&&!!n.media_src},Dn=function(e){return f(e)||"string"==typeof e||"number"==typeof e||"boolean"==typeof e},Ln=function(e){return o(dn,e)},xn=function(e,n){return Pn(e)?"deferred":Nn(e)?"entry":On(e)?"feed":n&&n.relationship?null!==e&&e!==t&&On(e)?"feed":"entry":null},Fn=function(e,t){return l(e,function(e){return e.name===t})},Mn=function(e,t,n){return e?fn(t,function(t){return $n(e,t,n)}):null},wn=function(e,t){return l(e,function(e){return e.name===t})},Vn=function(e,t){return Mn(e,t,"complexType")},jn=function(e,t){return Mn(e,t,"entityType")},kn=function(e){return fn(e,function(e){return l(e.entityContainer,function(e){return Jn(e.isDefaultEntityContainer)})})},Gn=function(e,t){return Mn(e,t,"entityContainer")},qn=function(e,t){return l(e,function(e){return e.name===t})},Qn=function(e,t){var n=null;if(e){var r=e.relationship,i=fn(t,function(e){var t=Bn(e.namespace,r),n=e.association;if(t&&n){var i,a;for(i=0,a=n.length;a>i;i++)if(n[i].name===t)return n[i]}return null});if(i){var a=i.end[0];a.role!==e.toRole&&(a=i.end[1]),n=a.type}}return n},Hn=function(e,t,n){if(e){var r=e.relationship,i=fn(n,function(e){for(var t=e.entityContainer,n=0;n<t.length;n++){var i=t[n].associationSet;if(i)for(var a=0;a<i.length;a++)if(i[a].association==r)return i[a]}return null});if(i&&i.end[0]&&i.end[1])return i.end[0].entitySet==t?i.end[1].entitySet:i.end[0].entitySet}return null},Yn=function(e,t){var n=fn(t,function(t){for(var n=t.entityContainer,r=0;r<n.length;r++){var i=n[r].entitySet;if(i)for(var a=0;a<i.length;a++)if(i[a].name==e)return{entitySet:i[a],containerName:n[r].name,functionImport:n[r].functionImport}}return null});return n},Bn=function(e,t){return 0===t.indexOf(e)&&"."===t.charAt(e.length)?t.substr(e.length+1):null},$n=function(e,t,n){if(e&&t){var r=Bn(t.namespace,e);if(r)return l(t[n],function(e){return e.name===r})}return null},Wn=function(e,t){if(e===t)return e;for(var n=e.split("."),r=t.split("."),i=n.length>=r.length?n.length:r.length,a=0;i>a;a++){var o=n[a]&&_(n[a]),s=r[a]&&_(r[a]);if(o>s)return e;if(s>o)return t}},Xn={accept:"Accept","content-type":"Content-Type",dataserviceversion:"DataServiceVersion",maxdataserviceversion:"MaxDataServiceVersion"},Kn=function(e){for(var t in e){var n=t.toLowerCase(),r=Xn[n];if(r&&t!==r){var i=e[t];delete e[t],e[r]=i}}},Jn=function(e){return"boolean"==typeof e?e:"string"==typeof e&&"true"===e.toLowerCase()},zn=/^(-?\d{4,})-(\d{2})-(\d{2})T(\d{2}):(\d{2})(?::(\d{2}))?(?:\.(\d+))?(.*)$/,Zn=function(e,t,n){var r=zn.exec(e),i=r?gn(r[8]):null;if(!r||!t&&"Z"!==i){if(n)return null;throw{message:"Invalid date/time value"}}var a=_(r[1]);0>=a&&a++;var o=r[7],s=0;if(o){if(o.length>7){if(n)return null;throw{message:"Cannot parse date/time value to given precision."}}s=mn(o.substring(3),4,!0),o=mn(o.substring(0,3),3,!0),o=_(o),s=_(s)}else o=0;var u=_(r[4]),d=_(r[5]),l=_(r[6])||0;if("Z"!==i){var c=ir(i),f=-c.d;u+=c.h*f,d+=c.m*f}var p=new Date;if(p.setUTCFullYear(a,_(r[2])-1,_(r[3])),p.setUTCHours(u,d,l,o),isNaN(p.valueOf())){if(n)return null;throw{message:"Invalid date/time value"}}return t&&(p.__edmType="Edm.DateTimeOffset",p.__offset=i),s&&(p.__ns=s),p},er=function(e,t){return Zn(e,!1,t)},tr=function(e,t){return Zn(e,!0,t)},nr=/^([+-])?P(?:(\d+)Y)?(?:(\d+)M)?(?:(\d+)D)?(?:T(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)(?:\.(\d+))?S)?)?/,rr=function(e){var t=nr.exec(e);if(null===t)throw{message:"Invalid duration value."};var n=t[2]||"0",r=t[3]||"0",i=_(t[4]||0),a=_(t[5]||0),o=_(t[6]||0),s=parseFloat(t[7]||0);if("0"!==n||"0"!==r)throw{message:"Unsupported duration value."};var u=t[8],d=0;if(u){if(u.length>7)throw{message:"Cannot parse duration value to given precision."};d=mn(u.substring(3),4,!0),u=mn(u.substring(0,3),3,!0),u=_(u),d=_(d)}else u=0;u+=1e3*s+6e4*o+36e5*a+864e5*i,"-"===t[1]&&(u=-u);var l={ms:u,__edmType:"Edm.Time"};return d&&(l.ns=d),l},ir=function(e){var t=e.substring(0,1);t="+"===t?1:-1;var n=_(e.substring(1)),r=_(e.substring(e.indexOf(":")+1));return{d:t,h:n,m:r}},ar=function(e,n,r){e.method||(e.method="GET"),e.headers?Kn(e.headers):e.headers={},e.headers.Accept===t&&(e.headers.Accept=n.accept),a(e.data)&&e.body===t&&n.write(e,r),a(e.headers.MaxDataServiceVersion)||(e.headers.MaxDataServiceVersion=n.maxDataServiceVersion||"1.0")},or=function(e,n,r){if(e&&"object"==typeof e)for(var i in e){var a=e[i],o=or(a,i,r);o=r(i,o,n),o!==a&&(a===t?delete e[i]:e[i]=o)}return e},sr=function(e,t){return t("",or(e,"",t))},ur=0,dr=function(e){return e.method&&"GET"!==e.method?!1:!0},lr=function(t){var n=e.document.createElement("IFRAME");n.style.display="none";var r=t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/\</g,"&lt;"),i='<html><head><script type="text/javascript" src="'+r+'"></script></head><body></body></html>',a=e.document.getElementsByTagName("BODY")[0];return a.appendChild(n),gr(n,i),n},cr=function(){if(e.XMLHttpRequest)return new e.XMLHttpRequest;var t;if(e.ActiveXObject)try{return new e.ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(n){try{return new e.ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(r){t=r}}else t={message:"XMLHttpRequest not supported"};throw t},fr=function(e){return 0===e.indexOf("http://")||0===e.indexOf("https://")||0===e.indexOf("file://")},pr=function(t){if(!fr(t))return!0;var n=e.location,r=n.protocol+"//"+n.host+"/";return 0===t.indexOf(r)},_r=function(n,r){try{delete e[n]}catch(i){e[n]=t,r===ur-1&&(ur-=1)}},hr=function(e){return e&&(gr(e,""),e.parentNode.removeChild(e)),null},mr=function(e,n){var r,i,a=e.getAllResponseHeaders().split(/\r?\n/);for(r=0,i=a.length;i>r;r++)if(a[r]){var o=a[r].split(": ");n[o[0]]=o[1]}var s=["Content-Type","DataServiceVersion"];for(r=0;r<s.length;r++)n[s[r]]===t&&e.getResponseHeader(s[r])&&(n[s[r]]=e.getResponseHeader(s[r]))},gr=function(e,t){var n=e.contentWindow?e.contentWindow.document:e.contentDocument.document;n.open(),n.write(t),n.close()};r.defaultHttpClient={callbackParameterName:"$callback",formatQueryString:"$format=json",enableJsonpCallback:!1,request:function(n,r,i){var a,o={},d=null,l=!1,c=function(e,t,n,r){1223===t&&(t=204,n="No Content");var i=[];mr(d,i);var a={requestUri:e,statusCode:t,statusText:n,headers:i,body:r};return l=!0,d=null,a};o.abort=function(){a=hr(a),l||(l=!0,d&&(d.abort(),d=null),i({message:"Request aborted"}))};var f,p=function(){if(a=hr(a),!l&&null!==d){var e=c(_,598,"Request timed out",[],d.responseText);i({message:"Request timed out",request:n,response:e})}},_=n.requestUri,h=s(n.enableJsonpCallback,this.enableJsonpCallback),m=s(n.callbackParameterName,this.callbackParameterName),g=s(n.formatQueryString,this.formatQueryString);if(!h||pr(_)){if(d=cr(),d.onload=function(){if(!l&&null!==d){var e=c(_,d.status,d.statusText,d.responseText);e.statusCode>=200&&e.statusCode<=299?r(e):i({message:"HTTP request failed",request:n,response:e})}},d.onerror=function(){if(!l&&null!==d){var e=c(_,d.status,d.statusText,d.responseText);i({message:"HTTP request failed",request:n,response:e})}},d.open(n.method||"GET",_,!0,n.user,n.password),n.headers)for(f in n.headers)d.setRequestHeader(f,n.headers[f]);n.timeoutMS&&(d.timeout=n.timeoutMS,d.ontimeout=p),d.send(n.body)}else{if(!dr(n))throw{message:"Request is not local and cannot be done through JSONP."};var y=ur;ur+=1;var E,S=y.toString(),R=!1;f="handleJSONP_"+S,e[f]=function(n){if(a=hr(a),!l){R=!0,e.clearTimeout(E),_r(f,y),e.ActiveXObject&&(n=e.JSON.parse(e.JSON.stringify(n)));var i;i=n.d===t?{"Content-Type":"application/json;odata=minimalmetadata",dataServiceVersion:"3.0"}:{"Content-Type":"application/json"},u(function(){hr(a),r({body:n,statusCode:200,headers:i})})}};var v=n.timeoutMS?n.timeoutMS:12e4;E=e.setTimeout(p,v);var A=m+"=parent."+f;this.formatQueryString&&(A+="&"+g);var T=_.indexOf("?");-1===T?_=_+"?"+A:T===_.length-1?_+=A:_=_+"&"+A,a=lr(_)}return o}};var yr="3.0",Er=function(e){if(!e)return null;var t,n,r=e.split(";"),i={};for(t=1,n=r.length;n>t;t++){var a=r[t].split("=");i[g(a[0])]=a[1]}return{mediaType:g(r[0]),properties:i}},Sr=function(e){if(!e)return t;var n,r=e.mediaType;for(n in e.properties)r+=";"+n+"="+e.properties[n];return r},Rr=function(e,t,n,r){var i={};return d(i,n),d(i,{contentType:e,dataServiceVersion:t,handler:r}),i},vr=function(e,t,n){if(e){var r=e.headers;r[t]||(r[t]=n)}},Ar=function(e,t){if(e){var n=e.headers,r=n.DataServiceVersion;n.DataServiceVersion=r?Wn(r,t):t}},Tr=function(e,n){var r=e.headers;return r&&r[n]||t},Ir=function(e){return Er(Tr(e,"Content-Type"))},Pr=/^\s?(\d+\.\d+);?.*$/,Nr=function(e){var t=Tr(e,"DataServiceVersion");if(t){var n=Pr.exec(t);if(n&&n.length)return n[1]}},Or=function(e,t){return e.accept.indexOf(t.mediaType)>=0},br=function(e,n,r,i){if(!r||!r.headers)return!1;var o=Ir(r),s=Nr(r)||"",u=r.body;if(!a(u))return!1;if(Or(e,o)){var d=Rr(o,s,i,e);return d.response=r,r.data=n(e,u,d),r.data!==t}return!1},Cr=function(e,n,r,i){if(!r||!r.headers)return!1;var a=Ir(r),o=Nr(r);if(!a||Or(e,a)){var s=Rr(a,o,i,e);if(s.request=r,r.body=n(e,r.data,s),r.body!==t)return Ar(r,s.dataServiceVersion||"1.0"),vr(r,"Content-Type",Sr(s.contentType)),vr(r,"MaxDataServiceVersion",e.maxDataServiceVersion),!0}return!1},Ur=function(e,t,n,r){return{accept:n,maxDataServiceVersion:r,read:function(t,n){return br(this,e,t,n)
},write:function(e,n){return Cr(this,t,e,n)}}},Dr=function(e,t){return t},Lr=function(e,n){return a(n)?n.toString():t};r.textHandler=Ur(Dr,Lr,"text/plain",yr);var xr=b+"www.opengis.net",Fr=xr+"/gml",Mr=xr+"/def/crs/EPSG/0/",wr="gml",Vr=function(e,t,n){var r={type:e};return r[t]=n,r},jr=function(e){if(c(e)&&e.length>=2){var t=e[0];e[0]=e[1],e[1]=t}return e},kr=function(e,t,n,r,i,a){var o=Gr(e,n,r,i,a);return Vr(t,"coordinates",o)},Gr=function(e,t,n,r,i){var a=[];return J(e,function(e){if(at(e)===Fr){var o=it(e);if(o!==t)o===n&&J(e,function(e){if(at(e)===Fr){var t=r(e,i);t&&a.push(t)}});else{var s=et(e,Fr);if(s){var u=r(s,i);u&&a.push(u)}}}}),a},qr=function(e,t){var n=Gr(e,"geometryMember","geometryMembers",ni,t);return Vr(un,"geometries",n)},Qr=function(e,t){return Vr(nn,"coordinates",Xr(e,t))},Hr=function(e,t){return kr(e,on,"curveMember","curveMembers",Xr,t)},Yr=function(e,t){return kr(e,an,"pointMember","pointMembers",Kr,t)},Br=function(e,t){return kr(e,sn,"surfaceMember","surfaceMembers",zr,t)},$r=function(e,t){return Vr(tn,"coordinates",Kr(e,t))},Wr=function(e,t){return Vr(rn,"coordinates",zr(e,t))},Xr=function(e,t){var n=[];return J(e,function(e){var r=at(e);if(r===Fr){var i=it(e);return"posList"===i?void(n=ei(e,t)):"pointProperty"===i?void n.push(Jr(e,t)):"pos"===i?void n.push(ti(e,t)):void 0}}),n},Kr=function(e,t){var n=et(e,Fr,"pos");return n?ti(n,t):[]},Jr=function(e,t){var n=et(e,Fr,"Point");return n?Kr(n,t):[]},zr=function(e,t){var n=[],r=!1;return J(e,function(e){if(at(e)===Fr){var i=it(e);return"exterior"===i?(r=!0,void n.unshift(Zr(e,t))):"interior"===i?void n.push(Zr(e,t)):void 0}}),!r&&n.length>0&&n.unshift([[]]),n},Zr=function(e,t){var n=[];return J(e,function(e){at(e)===Fr&&"LinearRing"===it(e)&&(n=Xr(e,t))}),n},ei=function(e,t){var n=ti(e,!1),r=n.length;if(r%2!==0)throw{message:"GML posList element has an uneven number of numeric values"};for(var i=[],a=0;r>a;a+=2){var o=n.slice(a,a+2);i.push(t?jr(o):o)}return i},ti=function(e,t){var n=[],r=" 	\r\n",i=rt(e);if(i)for(var a=i.length,o=0,s=0;a>=s;){if(-1!==r.indexOf(i.charAt(s))){var u=i.substring(o,s);u&&n.push(parseFloat(u)),o=s+1}s++}return t?jr(n):n},ni=function(e,t){var n,r=it(e);switch(r){case"Point":n=$r;break;case"Polygon":n=Wr;break;case"LineString":n=Qr;break;case"MultiPoint":n=Yr;break;case"MultiCurve":n=Hr;break;case"MultiSurface":n=Br;break;case"MultiGeometry":n=qr;break;default:throw{message:"Unsupported element: "+r,element:e}}var i=n(e,t),a=W(e,"srsName",Fr)||W(e,"srsName");if(a){if(0!==a.indexOf(Mr))throw{message:"Unsupported srs name: "+a,element:e};var o=a.substring(Mr.length);o&&(i.crs={type:"name",properties:{name:"EPSG:"+o}})}return i},ri=function(e,t,n,r){var i;switch(n){case tn:i=ci;break;case nn:i=fi;break;case rn:i=pi;break;case an:i=hi;break;case on:i=mi;break;case sn:i=gi;break;case un:i=Ei;break;default:return null}var a=i(e,t,r),o=t.crs;if(o&&"name"===o.type){var s=o.properties,u=s&&s.name;if(u&&0===u.indexOf("ESPG:")&&u.length>5){var d=u.substring(5),l=ft(e,null,"srsName",wr+d);ct(a,l)}}return a},ii=function(e,t,n){return pt(e,Fr,Y(wr,t),n)},ai=function(e,t,n){var r=c(t)?t:[];return r=n?jr(r):r,ii(e,"pos",r.join(" "))},oi=function(e,t,n,r){var i=ii(e,t);if(c(n)){var a,o;for(a=0,o=n.length;o>a;a++)ct(i,ai(e,n[a],r));0===o&&ct(i,ii(e,"posList"))}return i},si=function(e,t,n){return ii(e,"Point",ai(e,t,n))},ui=function(e,t,n){return oi(e,"LineString",t,n)},di=function(e,t,n,r){var i=ii(e,t);if(c(n)&&n.length>0){var a=oi(e,"LinearRing",n,r);ct(i,a)}return i},li=function(e,t,n){var r=t&&t.length,i=ii(e,"Polygon");if(c(t)&&r>0){ct(i,di(e,"exterior",t[0],n));var a;for(a=1;r>a;a++)ct(i,di(e,"interior",t[a],n))}return i},ci=function(e,t,n){return si(e,t.coordinates,n)},fi=function(e,t,n){return ui(e,t.coordinates,n)},pi=function(e,t,n){return li(e,t.coordinates,n)},_i=function(e,t,n,r,i,a){var o=r&&r.length,s=ii(e,t);if(c(r)&&o>0){var u,d=ii(e,n);for(u=0;o>u;u++)ct(d,i(e,r[u],a));ct(s,d)}return s},hi=function(e,t,n){return _i(e,"MultiPoint","pointMembers",t.coordinates,si,n)},mi=function(e,t,n){return _i(e,"MultiCurve","curveMembers",t.coordinates,ui,n)},gi=function(e,t,n){return _i(e,"MultiSurface","surfaceMembers",t.coordinates,li,n)},yi=function(e,t,n){return ri(e,t,t.type,n)},Ei=function(e,t,n){return _i(e,"MultiGeometry","geometryMembers",t.geometries,yi,n)},Si="application/xml",Ri=b+"schemas.microsoft.com/ado/",vi=Ri+"2007/08/dataservices",Ai=Ri+"2007/06/edmx",Ti=Ri+"2006/04/edm",Ii=Ri+"2007/05/edm",Pi=Ri+"2008/01/edm",Ni=Ri+"2008/09/edm",Oi=Ri+"2009/08/edm",bi=Ri+"2009/11/edm",Ci=vi,Ui=vi+"/metadata",Di=vi+"/related/",Li=vi+"/scheme",xi="d",Fi="m",Mi=function(e,t){var n={name:it(e),value:e.value};return n[t?"namespaceURI":"namespace"]=at(e),n},wi=function(e,t){var n,r,i=[],a=[],o=e.attributes;for(n=0,r=o.length;r>n;n++){var s=o[n];at(s)!==D&&i.push(Mi(s,t))}for(var u=e.firstChild;null!=u;)1===u.nodeType&&a.push(wi(u,t)),u=u.nextSibling;var d={name:it(e),value:rt(e),attributes:i,children:a};return d[t?"namespaceURI":"namespace"]=at(e),d},Vi=function(e){return at(e)===Ci&&"element"===it(e)},ji=function(e,t){return{type:e,extensions:t}},ki=function(e){if(et(e,Fr))return $t;var t=et(e,Ci);if(!t)return wt;if(Vi(t)){var n=ut(t,Ci);if(n&&Vi(n))return"Collection()"}return null},Gi=function(e){var t=null,n=!1,r=[];return $(e,function(e){var i=at(e),a=it(e),o=ot(e);if(i===Ui){if("null"===a)return void(n="true"===o.toLowerCase());if("type"===a)return void(t=o)}return i!==L&&i!==D?void r.push(Mi(e,!0)):void 0}),{type:!t&&n?wt:t,isNull:n,extensions:r}},qi=function(e){if(at(e)!==Ci)return null;var t=it(e),n=Gi(e),r=n.isNull,i=n.type,a=ji(i,n.extensions),o=r?null:Qi(e,i,a);return{name:t,value:o,metadata:a}},Qi=function(e,t,n){t||(t=ki(e),n.type=t);var r=bn(t);return r||Cn(t)?Hi(e,t,r):Ln(t)?Yi(e,t):An(t)?$i(e,t,n):Bi(e,t,n)},Hi=function(e,t,n){var r=et(e,Fr),i=ni(r,n);return i.__metadata={type:t},i},Yi=function(e,t){var n=ot(e)||"";switch(t){case It:return Jn(n);case Tt:case bt:case Ut:case xt:case wt:return n;case Pt:case Dt:case Lt:case Ft:return _(n);case Ct:case Mt:return parseFloat(n);case Vt:return rr(n);case Nt:return er(n);case Ot:return tr(n)}return n},Bi=function(e,t,n){var r={__metadata:{type:t}};return J(e,function(e){var t=qi(e),i=t.name;n.properties=n.properties||{},n.properties[i]=t.metadata,r[i]=t.value}),r},$i=function(e,t,n){var r=[],i=n.elements=[],a=yn(t);return J(e,function(e){if(Vi(e)){var t=Gi(e),n=t.extensions,o=t.type||a,s=ji(o,n),u=Qi(e,o,s);r.push(u),i.push(s)}}),{__metadata:{type:"Collection()"===t?null:t},results:r}},Wi=function(e,n){if(at(e)===Ci){n=K(e,n);var r=it(e);if("links"===r)return Xi(e,n);if("uri"===r)return Ki(e,n)}return t},Xi=function(e,t){var n=[];return J(e,function(e){"uri"===it(e)&&at(e)===Ci&&n.push(Ki(e,t))}),{results:n}},Ki=function(e,t){var n=rt(e)||"";return{uri:v(n,t)}},Ji=function(e,t){return t===$t||t===jt?e&&e.type:t===Wt||t===kt?tn:t===Xt||t===Gt?nn:t===Kt||t===qt?rn:t===Jt||t===Qt?un:t===zt||t===Ht?sn:t===Zt||t===Yt?on:t===en||t===Bt?an:null},zi=function(e,t,n){return pt(e,Ui,Y(Fi,t),n)},Zi=function(e,t,n){return ft(e,Ui,Y(Fi,t),n)},ea=function(e,t,n){return pt(e,Ci,Y(xi,t),n)},ta=function(e,t){return t===Nt||t===Ot||f(e)?_n(e):t===Vt?hn(e):e.toString()},na=function(e,t){return{element:e,dsv:t}},ra=function(e,t,n,r){var i=n?Zi(e,"type",n):null,a=ea(e,t,i);return lt(a,r)},ia=function(e,t,n,r){var i=ta(n,r),a=ra(e,t,r,i);return na(a,"1.0")},aa=function(e,t,n,r){var i=Zi(e,"null","true"),a=ra(e,t,n,i),o=Vn(n,r)?"2.0":"1.0";return na(a,o)},oa=function(e,t,n,r,i,a,o){var s=yn(r),u=c(n)?n:n.results,d=r?{type:s}:{};d.properties=i.properties;var l,f,p=ra(e,t,s?r:null);for(l=0,f=u.length;f>l;l++){var _=u[l],h=da(e,"element",_,d,a,o);ct(p,h.element)}return na(p,"3.0")},sa=function(e,t,n,r,i,a,o){var s=ra(e,t,r),u=i.properties||{},d=Vn(r,o)||{},l="1.0";for(var c in n)if("__metadata"!==c){var f=n[c],p=Fn(d.property,c),_=u[c]||{},h=da(e,c,f,_,p,o);l=Wn(l,h.dsv),ct(s,h.element)}return na(s,l)},ua=function(e,t,n,r,i){var a=Ji(n,r),o=ri(e,n,a,i),s=ra(e,t,r,o);return na(s,"3.0")},da=function(e,t,n,r,i,a){var o=vt(n,r,i);if(Dn(n))return ia(e,t,n,o||wt);var s=bn(o);if(s||Cn(o))return ua(e,t,n,o,s);if(vn(n,o))return oa(e,t,n,o,r,i,a);if(Un(n))return null;var u=xn(n,i);return null!==u?null:null===n?aa(e,t,o):sa(e,t,n,o,r,i,a)},la=function(e){if(e&&p(e)){var t=dt();return ct(t,ea(t,"uri",e.uri))}},ca=function(e,t){if(t){var n=H(t),r=et(n);if(r)return Wi(r)}},fa=function(e,n,r){var i=r.contentType=r.contentType||Er(Si);return i&&i.mediaType===Si?yt(la(n)):t};r.xmlHandler=Ur(ca,fa,Si,yr);var pa="a",_a=C+"2005/Atom",ha=C+"2007/app",ma=vi+"/edit-media/",ga=vi+"/mediaresource/",ya=vi+"/relatedlinks/",Ea=["application/atom+xml","application/atomsvc+xml","application/xml"],Sa=Ea[0],Ra=[_a,ha,L,D],va={SyndicationAuthorEmail:"author/email",SyndicationAuthorName:"author/name",SyndicationAuthorUri:"author/uri",SyndicationContributorEmail:"contributor/email",SyndicationContributorName:"contributor/name",SyndicationContributorUri:"contributor/uri",SyndicationPublished:"published",SyndicationRights:"rights",SyndicationSummary:"summary",SyndicationTitle:"title",SyndicationUpdated:"updated"},Aa=function(e){return va[e]||e},Ta=function(e){return!o(Ra,e)},Ia=function(e,t,n,r,i){i=i||"";var a=e["FC_TargetPath"+i];if(!a)return null;var o=e["FC_SourcePath"+i],s=Aa(a),u=r?r+(o?"/"+o:""):o,d=u&&ja(n,t,u),l=e["FC_NsUri"+i]||null,c=e["FC_NsPrefix"+i]||null,f=e["FC_KeepInContent"+i]||"";return a!==s&&(l=_a,c=pa),{contentKind:e["FC_ContentKind"+i],keepInContent:"true"===f.toLowerCase(),nsPrefix:c,nsURI:l,propertyPath:u,propertyType:d,entryPath:s}},Pa=function(e,t,n){for(var r=[];e;){var i=(e.FC_SourcePath,Ia(e,e,t));i&&n(i);var a,o,s=e.property||[];for(a=0,o=s.length;o>a;a++)for(var u=s[a],d=0,l="";i=Ia(u,e,t,u.name,l);)n(i),d++,l="_"+d;e=jn(e.baseType,t)}return r},Na=function(e){var t=[];return $(e,function(e){var n=at(e);Ta(n)&&t.push(Mi(e,!0))}),t},Oa=function(e){return wi(e,!0)},ba=function(e,t,n){var r=at(e),i=it(e);if(r===ha&&"service"===i)return za(e,t);if(r===_a){if("feed"===i)return La(e,t,n);if("entry"===i)return ka(e,t,n)}},Ca=function(e,t){var n=[],r={extensions:n};return $(e,function(i){var a=it(i),o=at(i),s=ot(i);if(null===o){if("title"===a||"metadata"===a)return void(r[a]=s);if("target"===a)return void(r.target=v(s,K(e,t)))}Ta(o)&&n.push(Mi(i,!0))}),r},Ua=function(e,t,n){var r=n.actions=n.actions||[];r.push(Ca(e,t))},Da=function(e,t,n){var r=n.functions=n.functions||[];r.push(Ca(e,t))},La=function(e,t,n){var r=Na(e),i={feed_extensions:r},a=[],o={__metadata:i,results:a};return t=K(e,t),J(e,function(e){var s=at(e),u=it(e);if(s===Ui){if("count"===u)return void(o.__count=parseInt(rt(e),10));if("action"===u)return void Ua(e,t,i);if("function"===u)return void Da(e,t,i)}return Ta(s)?void r.push(wi(e)):"entry"===u?void a.push(ka(e,t,n)):"link"===u?void xa(e,o,t):"id"===u?(i.uri=v(rt(e),t),void(i.uri_extensions=Na(e))):"title"===u?(i.title=rt(e)||"",void(i.title_extensions=Na(e))):void 0}),o},xa=function(e,t,n){var r=Fa(e,n),i=r.href,a=r.rel,o=r.extensions,s=t.__metadata;return"next"===a?(t.__next=i,void(s.next_extensions=o)):"self"===a?(s.self=i,void(s.self_extensions=o)):void 0},Fa=function(e,t){t=K(e,t);var n=[],r={extensions:n,baseURI:t};if($(e,function(e){var i=at(e),a=it(e),o=e.value;return"href"===a?void(r.href=v(o,t)):"type"===a||"rel"===a?void(r[a]=o):void(Ta(i)&&n.push(Mi(e,!0)))}),!r.href)throw{error:"href attribute missing on link element",element:e};return r},Ma=function(e,n){if(-1===e.indexOf("/"))return n[e];var r,i,a=e.split("/");for(r=0,i=a.length;i>r;r++){if(null===n)return t;if(n=n[a[r]],n===t)return n}return n},wa=function(e,n,r,i){var a;if(-1===e.indexOf("/"))n[e]=r,a=e;else{var o,s,u=e.split("/");for(o=0,s=u.length-1;s>o;o++){var d=n[u[o]];if(d===t)d={},n[u[o]]=d;else if(null===d)return;n=d}a=u[o],n[a]=r}if(i){var l=n.__metadata=n.__metadata||{},c=l.properties=l.properties||{},f=c[a]=c[a]||{};f.type=i}},Va=function(e,t,n){var r=e.propertyPath;if(!e.keepInContent&&null!==Ma(r,n)){var i=Z(t,e.nsURI,e.entryPath);if(i){var a,o=e.propertyType;a="xhtml"===e.contentKind?Et(i):Yi(i,o||"Edm.String"),wa(r,n,a,o)}}},ja=function(e,t,n){for(var r,i,a=n.split("/");t;){var o=t;for(r=0,i=a.length;i>r;r++){var s=o.property;if(!s)break;var u=Fn(s,a[r]);if(!u)break;var d=u.type;if(!d||Ln(d))return d||null;if(o=Vn(d,e),!o)return null}t=jn(t.baseType,e)}return null},ka=function(e,t,n){var r={},i={__metadata:r},a=W(e,"etag",Ui);a&&(r.etag=a),t=K(e,t),J(e,function(e){var a=at(e),o=it(e);if(a!==_a){if(a===Ui){if("properties"===o)return void Ja(e,i,r);if("action"===o)return void Ua(e,t,r);if("function"===o)return void Da(e,t,r)}}else{if("id"===o)return void Ga(e,r,t);if("category"===o)return void qa(e,r);if("content"===o)return void Qa(e,i,r,t);if("link"===o)return void Ha(e,i,r,t,n)}});var o=jn(r.type,n);return Pa(o,n,function(t){Va(t,e,i)}),i},Ga=function(e,t,n){t.uri=v(rt(e),K(e,n)),t.uri_extensions=Na(e)},qa=function(e,t){if(W(e,"scheme")===Li){if(t.type)throw{message:"Invalid AtomPub document: multiple category elements defining the entry type were encounterd withing an entry",element:e};var n=[];$(e,function(e){var t=at(e),r=it(e);return t?void(Ta(t)&&n.push(Mi(e,!0))):void("scheme"!==r&&"term"!==r&&n.push(Mi(e,!0)))}),t.type=W(e,"term"),t.type_extensions=n}},Qa=function(e,t,n,r){var i=W(e,"src"),a=W(e,"type");if(i){if(!a)throw{message:"Invalid AtomPub document: content element must specify the type attribute if the src attribute is also specified",element:e};n.media_src=v(i,K(e,r)),n.content_type=a}J(e,function(r){if(i)throw{message:"Invalid AtomPub document: content element must not have child elements if the src attribute is specified",element:e};at(r)===Ui&&"properties"===it(r)&&Ja(r,t,n)})},Ha=function(e,t,n,r,i){var a=Fa(e,r),o=a.rel,s=a.href,u=a.extensions;return"self"===o?(n.self=s,void(n.self_link_extensions=u)):"edit"===o?(n.edit=s,void(n.edit_link_extensions=u)):"edit-media"===o?(n.edit_media=a.href,n.edit_media_extensions=u,void Ka(a,n)):0===o.indexOf(ma)?void $a(a,t,n):0===o.indexOf(ga)?void Wa(a,t,n):0===o.indexOf(Di)?void Ba(e,a,t,n,i):0===o.indexOf(ya)?void Ya(a,n):void 0},Ya=function(e,t){var n=e.rel.substring(ya.length);t.properties=t.properties||{};var r=t.properties[n]=t.properties[n]||{};r.associationuri=e.href,r.associationuri_extensions=e.extensions},Ba=function(e,t,n,r,i){var a,o=et(e,Ui,"inline");if(o){var s=et(o),u=K(o,t.baseURI);a=s?ba(s,u,i):null}else a={__deferred:{uri:t.href}};var d=t.rel.substring(Di.length);n[d]=a,r.properties=r.properties||{};var l=r.properties[d]=r.properties[d]||{};l.extensions=t.extensions},$a=function(e,t,n){var r=e.rel.substring(ma.length),i=Xa(r,t,n),a=i.value,o=i.metadata,s=e.href;a.edit_media=s,a.content_type=e.type,o.edit_media_extensions=e.extensions,a.media_src=a.media_src||s,o.media_src_extensions=o.media_src_extensions||[],Ka(e,a)},Wa=function(e,t,n){var r=e.rel.substring(ga.length),i=Xa(r,t,n),a=i.value,o=i.metadata;a.media_src=e.href,o.media_src_extensions=e.extensions,a.content_type=e.type},Xa=function(e,t,n){n.properties=n.properties||{};var r=n.properties[e],i=t[e]&&t[e].__mediaresource;return i||(i={},t[e]={__mediaresource:i},n.properties[e]=r={}),{value:i,metadata:r}},Ka=function(e,t){var n,r,i=e.extensions;for(n=0,r=i.length;r>n;n++)if(i[n].namespaceURI===Ui&&"etag"===i[n].name)return t.media_etag=i[n].value,void i.splice(n,1)},Ja=function(e,t,n){J(e,function(e){var r=qi(e);if(r){var i=r.name,a=n.properties=n.properties||{};a[i]=r.metadata,t[i]=r.value}})},za=function(e,t){var n=[],r=[];if(t=K(e,t),J(e,function(e){return at(e)===ha&&"workspace"===it(e)?void n.push(Za(e,t)):void r.push(wi(e))}),0===n.length)throw{message:"Invalid AtomPub service document: No workspace element found.",element:e};return{workspaces:n,extensions:r}},Za=function(e,n){var r,i=[],a=[];return n=K(e,n),J(e,function(e){var o=at(e),s=it(e);if(o===_a&&"title"===s){if(r!==t)throw{message:"Invalid AtomPub service document: workspace has more than one child title element",element:e};return void(r=rt(e))}return o===ha?void("collection"===s&&i.push(eo(e,n))):void a.push(Oa(e))}),{title:r||"",collections:i,extensions:a}},eo=function(e,n){var r=W(e,"href");if(!r)throw{message:"Invalid AtomPub service document: collection has no href attribute",element:e};n=K(e,n),r=v(r,K(e,n));var i,a=[];if(J(e,function(n){var r=at(n),o=it(n);if(r!==_a)r!==ha&&a.push(Oa(e));else if("title"===o){if(i!==t)throw{message:"Invalid AtomPub service document: collection has more than one child title element",element:n};i=rt(n)}}),!i)throw{message:"Invalid AtomPub service document: collection has no title element",element:e};return{title:i,href:r,extensions:a}},to=function(e,t,n){return pt(e,_a,Y(pa,t),n)},no=function(e,t,n){return ft(e,null,t,n)},ro=function(e){if(e.childNodes.length>0)return!1;var t,n,r=!0,i=e.attributes;for(t=0,n=i.length;n>t&&r;t++){var a=i[t];r=r&&V(a)||at(a)==Ui&&"type"===it(a)}return r},io=function(e,t,n,r,i){var a=null,o=null,s=null,u="";"deferred"!==n?(a=no(e,"type","application/atom+xml;type="+n),o=zi(e,"inline"),r&&(u=r.__metadata&&r.__metadata.uri||"",s=uo(e,r,i)||so(e,r,i),ct(o,s.element))):u=r.__deferred.uri;var d=to(e,"link",[no(e,"href",u),no(e,"rel",v(t,Di)),a,o]);return na(d,s?s.dsv:"1.0")},ao=function(e,t,n,r,i,a){if(Un(n))return null;var o=da(e,t,n,r,i,a);if(!o){var s=xn(n,i);o=io(e,t,s,n,a)}return o},oo=function(e,t,n,r){var i,a=z(n,Ci,r.propertyPath),o=a&&X(a,"null",Ui),s="1.0";if(o&&"true"===o.value)return s;if(a&&(i=rt(a)||"",!r.keepInContent)){s="2.0";var u=a.parentNode,d=u;for(u.removeChild(a);d!==n&&ro(d);)u=d.parentNode,u.removeChild(d),d=u}var l=gt(e,t,r.nsURI,r.nsPrefix,r.entryPath);if(2===l.nodeType)return l.value=i,s;var c=r.contentKind;return lt(l,[c&&ft(e,null,"type",c),"xhtml"===c?ht(e,i):i]),s},so=function(e,t,n){var r=t.__metadata||{},i=r.properties||{},a=r.etag,o=r.uri,s=r.type,u=jn(s,n),d=zi(e,"properties"),l=to(e,"entry",[to(e,"author",to(e,"name")),a&&Zi(e,"etag",a),o&&to(e,"id",o),s&&to(e,"category",[no(e,"term",s),no(e,"scheme",Li)]),to(e,"content",[no(e,"type","application/xml"),d])]),c="1.0";for(var f in t)if("__metadata"!==f){var p=i[f]||{},_=u&&(Fn(u.property,f)||Fn(u.navigationProperty,f)),h=ao(e,f,t[f],p,_,n);if(h){var m=h.element,g=at(m)===_a?l:d;ct(g,m),c=Wn(c,h.dsv)}}return Pa(u,n,function(t){var n=oo(e,l,d,t);c=Wn(c,n)}),na(l,c)},uo=function(e,t,n){var r=c(t)?t:t.results;if(!r)return null;var i,a,o="1.0",s=to(e,"feed");for(i=0,a=r.length;a>i;i++){var u=so(e,r[i],n);ct(s,u.element),o=Wn(o,u.dsv)}return na(s,o)},lo=function(e,t){if(e){var n=On(e)&&uo||p(e)&&so;if(n){var r=dt(),i=n(r,e,t);if(i){var a=i.element;return lt(a,[_t(r,Ui,Fi),_t(r,Ci,xi)]),na(ct(r,a),i.dsv)}}}return null},co=function(e,t,n){if(t){var r=H(t),i=et(r);if(i)return ba(i,null,n.metadata)}},fo=function(e,t,n){var r=n.contentType=n.contentType||Er(Sa);if(r&&r.mediaType===Sa){var i=lo(t,n.metadata);if(i)return n.dataServiceVersion=Wn(n.dataServiceVersion||"1.0",i.dsv),yt(i.element)}};r.atomHandler=Ur(co,fo,Ea.join(","),yr);var po=function(e,t,n,r){return{attributes:e,elements:t,text:n||!1,ns:r}},_o={elements:{Annotations:po(["Target","Qualifier"],["TypeAnnotation*","ValueAnnotation*"]),Association:po(["Name"],["End*","ReferentialConstraint","TypeAnnotation*","ValueAnnotation*"]),AssociationSet:po(["Name","Association"],["End*","TypeAnnotation*","ValueAnnotation*"]),Binary:po(null,null,!0),Bool:po(null,null,!0),Collection:po(null,["String*","Int*","Float*","Decimal*","Bool*","DateTime*","DateTimeOffset*","Guid*","Binary*","Time*","Collection*","Record*"]),CollectionType:po(["ElementType","Nullable","DefaultValue","MaxLength","FixedLength","Precision","Scale","Unicode","Collation","SRID"],["CollectionType","ReferenceType","RowType","TypeRef"]),ComplexType:po(["Name","BaseType","Abstract"],["Property*","TypeAnnotation*","ValueAnnotation*"]),DateTime:po(null,null,!0),DateTimeOffset:po(null,null,!0),Decimal:po(null,null,!0),DefiningExpression:po(null,null,!0),Dependent:po(["Role"],["PropertyRef*"]),Documentation:po(null,null,!0),End:po(["Type","Role","Multiplicity","EntitySet"],["OnDelete"]),EntityContainer:po(["Name","Extends"],["EntitySet*","AssociationSet*","FunctionImport*","TypeAnnotation*","ValueAnnotation*"]),EntitySet:po(["Name","EntityType"],["TypeAnnotation*","ValueAnnotation*"]),EntityType:po(["Name","BaseType","Abstract","OpenType"],["Key","Property*","NavigationProperty*","TypeAnnotation*","ValueAnnotation*"]),EnumType:po(["Name","UnderlyingType","IsFlags"],["Member*"]),Float:po(null,null,!0),Function:po(["Name","ReturnType"],["Parameter*","DefiningExpression","ReturnType","TypeAnnotation*","ValueAnnotation*"]),FunctionImport:po(["Name","ReturnType","EntitySet","IsSideEffecting","IsComposable","IsBindable","EntitySetPath"],["Parameter*","ReturnType","TypeAnnotation*","ValueAnnotation*"]),Guid:po(null,null,!0),Int:po(null,null,!0),Key:po(null,["PropertyRef*"]),LabeledElement:po(["Name"],["Path","String","Int","Float","Decimal","Bool","DateTime","DateTimeOffset","Guid","Binary","Time","Collection","Record","LabeledElement","Null"]),Member:po(["Name","Value"]),NavigationProperty:po(["Name","Relationship","ToRole","FromRole","ContainsTarget"],["TypeAnnotation*","ValueAnnotation*"]),Null:po(null,null),OnDelete:po(["Action"]),Path:po(null,null,!0),Parameter:po(["Name","Type","Mode","Nullable","DefaultValue","MaxLength","FixedLength","Precision","Scale","Unicode","Collation","ConcurrencyMode","SRID"],["CollectionType","ReferenceType","RowType","TypeRef","TypeAnnotation*","ValueAnnotation*"]),Principal:po(["Role"],["PropertyRef*"]),Property:po(["Name","Type","Nullable","DefaultValue","MaxLength","FixedLength","Precision","Scale","Unicode","Collation","ConcurrencyMode","CollectionKind","SRID"],["CollectionType","ReferenceType","RowType","TypeAnnotation*","ValueAnnotation*"]),PropertyRef:po(["Name"]),PropertyValue:po(["Property","Path","String","Int","Float","Decimal","Bool","DateTime","DateTimeOffset","Guid","Binary","Time"],["Path","String","Int","Float","Decimal","Bool","DateTime","DateTimeOffset","Guid","Binary","Time","Collection","Record","LabeledElement","Null"]),ReferenceType:po(["Type"]),ReferentialConstraint:po(null,["Principal","Dependent"]),ReturnType:po(["ReturnType","Type","EntitySet"],["CollectionType","ReferenceType","RowType"]),RowType:po(["Property*"]),String:po(null,null,!0),Schema:po(["Namespace","Alias"],["Using*","EntityContainer*","EntityType*","Association*","ComplexType*","Function*","ValueTerm*","Annotations*"]),Time:po(null,null,!0),TypeAnnotation:po(["Term","Qualifier"],["PropertyValue*"]),TypeRef:po(["Type","Nullable","DefaultValue","MaxLength","FixedLength","Precision","Scale","Unicode","Collation","SRID"]),Using:po(["Namespace","Alias"]),ValueAnnotation:po(["Term","Qualifier","Path","String","Int","Float","Decimal","Bool","DateTime","DateTimeOffset","Guid","Binary","Time"],["Path","String","Int","Float","Decimal","Bool","DateTime","DateTimeOffset","Guid","Binary","Time","Collection","Record","LabeledElement","Null"]),ValueTerm:po(["Name","Type"],["TypeAnnotation*","ValueAnnotation*"]),Edmx:po(["Version"],["DataServices","Reference*","AnnotationsReference*"],!1,Ai),DataServices:po(null,["Schema*"],!1,Ai)}},ho=["m:FC_ContentKind","m:FC_KeepInContent","m:FC_NsPrefix","m:FC_NsUri","m:FC_SourcePath","m:FC_TargetPath"];_o.elements.Property.attributes=_o.elements.Property.attributes.concat(ho),_o.elements.EntityType.attributes=_o.elements.EntityType.attributes.concat(ho),_o.elements.Edmx={attributes:["Version"],elements:["DataServices"],ns:Ai},_o.elements.DataServices={elements:["Schema*"],ns:Ai},_o.elements.EntityContainer.attributes.push("m:IsDefaultEntityContainer"),_o.elements.Property.attributes.push("m:MimeType"),_o.elements.FunctionImport.attributes.push("m:HttpMethod"),_o.elements.FunctionImport.attributes.push("m:IsAlwaysBindable"),_o.elements.EntityType.attributes.push("m:HasStream"),_o.elements.DataServices.attributes=["m:DataServiceVersion","m:MaxDataServiceVersion"];var mo=function(e){if(!e)return e;if(e.length>1){var t=e.substr(0,2);return t===t.toUpperCase()?e:e.charAt(0).toLowerCase()+e.substr(1)}return e.charAt(0).toLowerCase()},go=function(e,t){if("Documentation"===t)return{isArray:!0,propertyName:"documentation"};var n=e.elements;if(!n)return null;var r,i;for(r=0,i=n.length;i>r;r++){var a=n[r],o=!1;if("*"===a.charAt(a.length-1)&&(o=!0,a=a.substr(0,a.length-1)),t===a){var s=mo(a);return{isArray:o,propertyName:s}}}return null},yo=/^(m:FC_.*)_[0-9]+$/,Eo=function(e){return e===Ti||e===Ii||e===Pi||e===Ni||e===Oi||e===bi},So=function(e){var t=it(e),n=at(e),r=_o.elements[t];if(!r)return null;if(r.ns){if(n!==r.ns)return null}else if(!Eo(n))return null;var i={},a=[],s=r.attributes||[];return $(e,function(e){var t=it(e),n=at(e),r=e.value;if(n!==D){var u=null,d=!1;if(Eo(n)||null===n?u="":n===Ui&&(u="m:"),null!==u){u+=t;var l=yo.exec(u);l&&(u=l[1]),o(s,u)&&(d=!0,i[mo(t)]=r)}d||a.push(Mi(e))}}),J(e,function(e){var t=it(e),n=go(r,t);if(n)if(n.isArray){var o=i[n.propertyName];o||(o=[],i[n.propertyName]=o),o.push(So(e))}else i[n.propertyName]=So(e);else a.push(wi(e))}),r.text&&(i.text=rt(e)),a.length&&(i.extensions=a),i},Ro=function(e,n){var r=H(n),i=et(r);return So(i)||t};r.metadataHandler=Ur(Ro,null,Si,yr);var vo="o",Ao="f",To="p",Io="c",Po="s",No="l",Oo="odata",bo=Oo+".",Co="@"+bo+"bind",Uo=bo+"metadata",Do=bo+"navigationLinkUrl",Lo=bo+"type",xo={readLink:"self",editLink:"edit",nextLink:"__next",mediaReadLink:"media_src",mediaEditLink:"edit_media",mediaContentType:"content_type",mediaETag:"media_etag",count:"__count",media_src:"mediaReadLink",edit_media:"mediaEditLink",content_type:"mediaContentType",media_etag:"mediaETag",url:"uri"},Fo={metadata:"odata.metadata",count:"odata.count",next:"odata.nextLink",id:"odata.id",etag:"odata.etag",read:"odata.readLink",edit:"odata.editLink",mediaRead:"odata.mediaReadLink",mediaEdit:"odata.mediaEditLink",mediaEtag:"odata.mediaETag",mediaContentType:"odata.mediaContentType",actions:"odata.actions",functions:"odata.functions",navigationUrl:"odata.navigationLinkUrl",associationUrl:"odata.associationLinkUrl",type:"odata.type"},Mo=function(e){if(e.indexOf(".")>0){var t=e.indexOf("@"),n=t>-1?e.substring(0,t):null,r=e.substring(t+1);return{target:n,name:r,isOData:0===r.indexOf(bo)}}return null},wo=function(e,t,n,r,i){return Tn(t)&&t[Lo]||n&&n[e+"@"+Lo]||r&&r.type||Qn(r,i)||null},Vo=function(e,t){return t?Fn(t.property,e)||Fn(t.navigationProperty,e):null},jo=function(e){return Tn(e)&&bo+"id"in e},ko=function(e,t,n){if(t[e+"@"+Do]||n&&n.relationship)return!0;var r=c(t[e])?t[e][0]:t[e];return jo(r)},Go=function(e){return Ln(e)||bn(e)||Cn(e)},qo=function(e,t,n,r,i){for(var a in e)if(a.indexOf(".")>0&&"#"!==a.charAt(0)){var o=Mo(a);if(o){var s=o.name,u=o.target,d=null,l=null;u&&(d=Vo(u,r),l=wo(u,e[u],e,d,i)),o.isOData?Qo(s,u,l,e[a],e,t,n):t[a]=e[a]}}return t},Qo=function(e,t,n,r,i,a,o){var s=e.substring(bo.length);switch(s){case"navigationLinkUrl":return void $o(s,t,n,r,i,a,o);case"nextLink":case"count":return void Yo(s,t,r,a,o);case"mediaReadLink":case"mediaEditLink":case"mediaContentType":case"mediaETag":return void Bo(s,t,n,r,a,o);default:return void Ho(s,t,r,a,o)}},Ho=function(e,t,n,r,i){var a=r.__metadata=r.__metadata||{},o=xo[e]||e;if("editLink"===e)return a.uri=v(n,i),void(a[o]=a.uri);if(("readLink"===e||"associationLinkUrl"===e)&&(n=v(n,i)),t){var s=a.properties=a.properties||{},u=s[t]=s[t]||{};return"type"===e?void(u[o]=u[o]||n):void(u[o]=n)}a[o]=n},Yo=function(e,t,n,r,i){var a=xo[e],o=t?r[t]:r;o[a]="nextLink"===e?v(n,i):n},Bo=function(e,t,n,r,i,a){var o=i.__metadata=i.__metadata||{},s=xo[e];if(("mediaReadLink"===e||"mediaEditLink"===e)&&(r=v(r,a)),t){var u=o.properties=o.properties||{},d=u[t]=u[t]||{};return d.type=d.type||n,i.__metadata=o,i[t]=i[t]||{__mediaresource:{}},void(i[t].__mediaresource[s]=r)}o[s]=r},$o=function(e,t,n,r,i,a,o){var s=a.__metadata=a.__metadata||{},u=s.properties=s.properties||{},d=u[t]=u[t]||{},l=v(r,o);return i.hasOwnProperty(t)?void(d.navigationLinkUrl=l):(a[t]={__deferred:{uri:l}},void(d.type=d.type||n))},Wo=function(e,t,n,r,i,a,o){if("string"==typeof e)return Xo(e,t,o);if(!Go(t)){if(c(e))return Ko(e,t,n,r,a,o);if(Tn(e))return Jo(e,t,n,r,a,o)}return e},Xo=function(e,t,n){switch(t){case Vt:return rr(e);case Nt:return er(e,!1);case Ot:return tr(e,!1)}return n?er(e,!0)||tr(e,!0)||e:e},Ko=function(e,t,n,r,i,a){var o,s,u=yn(t),d=[],l=[];for(o=0,s=e.length;s>o;o++){var c=wo(null,e[o])||u,f={type:c},p=Wo(e[o],c,f,r,null,i,a);Go(c)||Dn(e[o])||d.push(f),l.push(p)}return d.length>0&&(n.elements=d),{__metadata:{type:t},results:l}},Jo=function(e,t,n,r,i,a){var o=Zo(e,{type:t},r,i,a),s=o.__metadata,u=s.properties;return u&&(n.properties=u,delete s.properties),o},zo=function(e,t,n,r,i){return c(e)?ts(e,t,n,r,i):Tn(e)?Zo(e,t,n,r,i):null},Zo=function(e,n,r,i,a){n=n||{};var o=e[Lo]||n.type||null,s=jn(o,i),u=!0;s||(u=!1,s=Vn(o,i));var d,l={type:o},c={__metadata:l},f={};if(u&&s&&n.entitySet&&"minimalmetadata"==n.contentTypeOdata){var p=r.substring(0,r.lastIndexOf("$metadata"));for(d=null,s.key||(d=s);d&&!d.key&&d.baseType;)d=jn(d.baseType,i);if(s.key||d&&d.key){var _;if(_=s.key?ns(e,s):ns(e,d)){var h={key:_,entitySet:n.entitySet,functionImport:n.functionImport,containerName:n.containerName};rs(e,h,o,p,s,d)}}}for(var m in e)if(0===m.indexOf("#"))es(m.substring(1),e[m],c,r,i);else if(-1===m.indexOf(".")){l.properties||(l.properties=f);var g=e[m],y=y=Vo(m,s);for(d=s;s&&null===y&&d.baseType;)d=jn(d.baseType,i),y=y=Vo(m,d);var E=ko(m,e,y),S=wo(m,g,e,y,i),R=f[m]=f[m]||{type:S};if(E){var v={};if(n.entitySet!==t){var A=Hn(y,n.entitySet.name,i);v=Yn(A,i)}v.contentTypeOdata=n.contentTypeOdata,v.kind=n.kind,v.type=S,c[m]=zo(g,v,r,i,a)}else c[m]=Wo(g,S,R,r,y,i,a)}return qo(e,c,r,s,i)},es=function(e,t,n,r,i){if(e&&(c(t)||Tn(t))){var a=!1,o=e.lastIndexOf("."),s=e.substring(o+1),u=o>-1?e.substring(0,o):"",d=s===e||-1===u.indexOf(".")?kn(i):Gn(u,i);if(d){var l=qn(d.functionImport,s);l&&l.isSideEffecting&&(a=!Jn(l.isSideEffecting))}var f,p,_=n.__metadata,h=a?"functions":"actions",m=v(e,r),g=c(t)?t:[t];for(f=0,p=g.length;p>f;f++){var y=g[f];if(y){var E=_[h]=_[h]||[],S={metadata:m,title:y.title,target:v(y.target,r)};E.push(S)}}}},ts=function(e,t,n,r,i){var a,o,s,u=c(e)?e:e.value,d=[];for(a=0,o=u.length;o>a;a++)s=Zo(u[a],t,n,r,i),d.push(s);var l={results:d};if(Tn(e)){for(var f in e)0===f.indexOf("#")&&(l.__metadata=l.__metadata||{},es(f.substring(1),e[f],l,n,r));l=qo(e,l,n)}return l},ns=function(e,t){var n,r,i=t.key.propertyRef;if(n="(",1==i.length)r=Fn(t.property,i[0].name).type,n+=ss(e[i[0].name],r);else for(var a=!0,o=0;o<i.length;o++)a?a=!1:n+=",",r=Fn(t.property,i[o].name).type,n+=i[o].name+"="+ss(e[i[o].name],r);return n+=")"},rs=function(e,t,n,r,i,a){var o=e[Fo.id]||e[Fo.read]||e[Fo.edit]||t.entitySet.name+t.key;if(e[Fo.id]=r+o,e[Fo.edit]||(e[Fo.edit]=t.entitySet.name+t.key,t.entitySet.entityType!=n&&(e[Fo.edit]+="/"+n)),e[Fo.read]=e[Fo.read]||e[Fo.edit],!e[Fo.etag]){var s=is(e,i,a);s&&(e[Fo.etag]=s)}ls(e,i,a),os(e,i,a),ds(e,t)},is=function(e,t,n){for(var r,i="",a=0;t.property&&a<t.property.length;a++)r=t.property[a],i=as(e,i,r);if(n)for(a=0;n.property&&a<n.property.length;a++)r=n.property[a],i=as(e,i,r);return i.length>0?i+'"':null},as=function(e,t,n){return"Fixed"==n.concurrencyMode&&(t+=t.length>0?",":'W/"',t+=null!==e[n.name]?ss(e[n.name],n.type):"null"),t},os=function(e,n,r){for(var i,a,o,s="@odata.navigationLinkUrl",u="@odata.associationLinkUrl",d=0;n.navigationProperty&&d<n.navigationProperty.length;d++)i=n.navigationProperty[d].name,a=i+s,e[a]===t&&(e[a]=e[Fo.edit]+"/"+encodeURIComponent(i)),o=i+u,e[o]===t&&(e[o]=e[Fo.edit]+"/$links/"+encodeURIComponent(i));if(r&&r.navigationProperty)for(d=0;d<r.navigationProperty.length;d++)i=r.navigationProperty[d].name,a=i+s,e[a]===t&&(e[a]=e[Fo.edit]+"/"+encodeURIComponent(i)),o=i+u,e[o]===t&&(e[o]=e[Fo.edit]+"/$links/"+encodeURIComponent(i))},ss=function(e,t){switch(e=""+us(e,t),e=encodeURIComponent(e.replace("'","''")),t){case"Edm.Binary":return"X'"+e+"'";
case"Edm.DateTime":return"datetime'"+e+"'";case"Edm.DateTimeOffset":return"datetimeoffset'"+e+"'";case"Edm.Decimal":return e+"M";case"Edm.Guid":return"guid'"+e+"'";case"Edm.Int64":return e+"L";case"Edm.Float":return e+"f";case"Edm.Double":return e+"D";case"Edm.Geography":return"geography'"+e+"'";case"Edm.Geometry":return"geometry'"+e+"'";case"Edm.Time":return"time'"+e+"'";case"Edm.String":return"'"+e+"'";default:return e}},us=function(e,t){switch(t){case"Edm.Binary":return I(e);default:return e}},ds=function(e,n){for(var r=n.functionImport||[],i=0;i<r.length;i++)if(r[i].isBindable&&r[i].parameter[0]&&r[i].parameter[0].type==n.entitySet.entityType){var a="#"+n.containerName+"."+r[i].name;e[a]==t&&(e[a]={title:r[i].name,target:e[Fo.edit]+"/"+r[i].name})}},ls=function(e,t,n){(t.hasStream||n&&n.hasStream)&&(e[Fo.mediaEdit]=e[Fo.mediaEdit]||e[Fo.mediaEdit]+"/$value",e[Fo.mediaRead]=e[Fo.mediaRead]||e[Fo.mediaEdit])},cs=function(e,t,n,r){var i={type:t},a=Wo(e.value,t,i,n,null,null,r);return qo(e,{__metadata:i,value:a},n)},fs=function(e,t,n,r,i){var a={},o=Ko(e.value,t,a,n,r,i);return d(o.__metadata,a),qo(e,o,n)},ps=function(e,t){var n=e.value;if(!c(n))return _s(e,t);var r,i,a=[];for(r=0,i=n.length;i>r;r++)a.push(_s(n[r],t));var o={results:a};return qo(e,o,t)},_s=function(e,t){var n={uri:v(e.url,t)};n=qo(e,n,t);var r=n.__metadata||{},i=r.properties||{};return hs(i.url),h(i,"url","uri"),n},hs=function(e){e&&delete e.type},ms=function(e,t){var n=e.value,r=[],i=qo(e,{collections:r},t),a=i.__metadata||{},o=a.properties||{};hs(o.value),h(o,"value","collections");var s,u;for(s=0,u=n.length;u>s;s++){var d=n[s],l={title:d.name,href:v(d.url,t)};l=qo(d,l,t),a=l.__metadata||{},o=a.properties||{},hs(o.name),hs(o.url),h(o,"name","title"),h(o,"url","href"),r.push(l)}return{workspaces:[i]}},gs=function(e,t){return{kind:e,type:t||null}},ys=function(e,t,n){var r=e[Uo];if(!r||"string"!=typeof r)return null;var i=r.lastIndexOf("#");if(-1===i)return gs(Po);var a=r.indexOf("@Element",i),o=a-1;0>o&&(o=r.indexOf("?",i),-1===o&&(o=r.length));var s=r.substring(i+1,o);if(s.indexOf("/$links/")>0)return gs(No);var u=s.split("/");if(u.length>=0){var d=u[0],l=u[1];if(Go(d))return gs(To,d);if(An(d))return gs(Io,d);var f,p,_,h=l;if(!l){var m=d.lastIndexOf("."),g=d.substring(m+1),y=g===d?kn(t):Gn(d.substring(0,m),t);y&&(f=wn(y.entitySet,g),p=y.functionImport,_=y.name,h=f?f.entityType:null)}var E;if(a>0)return E=gs(vo,h),E.entitySet=f,E.functionImport=p,E.containerName=_,E;if(h)return E=gs(Ao,h),E.entitySet=f,E.functionImport=p,E.containerName=_,E;if(c(e.value)&&!Vn(d,t)){var S=e.value[0];if(!Dn(S)&&(jo(S)||!n))return gs(Ao,null)}return gs(vo,d)}return null},Es=function(e,t,n,r,i){if(!Tn(e))return e;i=i||"minimalmetadata";var o=e[Uo],s=ys(e,t,r);a(s)&&(s.contentTypeOdata=i);var u=null;if(s)switch(delete e[Uo],u=s.type,s.kind){case Ao:return ts(e,s,o,t,n);case Io:return fs(e,u,o,t,n);case To:return cs(e,u,o,n);case Po:return ms(e,o);case No:return ps(e,o)}return Zo(e,s,o,t,n)},Ss=["type","etag","media_src","edit_media","content_type","media_etag"],Rs=function(e,t){var n=/\/\$links\//,r={},i=e.__metadata,a=t&&n.test(t.request.requestUri);return As(e,i&&i.properties,r,a),r},vs=function(e,t){if(e){var n,r;for(n=0,r=Ss.length;r>n;n++){var i=Ss[n],a=bo+(xo[i]||i);Us(a,null,e[i],t)}}},As=function(e,t,n,r){for(var i in e){var a=e[i];"__metadata"===i?vs(a,n):-1===i.indexOf(".")?r&&"uri"===i?Is(a,n):Ts(i,a,t,n,r):n[i]=a}},Ts=function(e,n,r,i){var a=r&&r[e]||{properties:t,type:t},o=vt(n,a);return Dn(n)||!n?(Us(Lo,e,o,i),void(i[e]=n)):On(n,o)||Nn(n)?void Os(e,n,i):!o&&Pn(n)?void Ps(e,n,i):vn(n,o)?(yn(o)&&Us(Lo,e,o,i),void Ns(e,n,i)):(i[e]={},Us(Lo,null,o,i[e]),void As(n,a.properties,i[e]))},Is=function(e,t){t.url=e},Ps=function(e,t,n){Us(Do,e,t.__deferred.uri,n)},Ns=function(e,t,n){n[e]=[];var r=c(t)?t:t.results;As(r,null,n[e])},Os=function(e,t,n){if(On(t)){n[e]=[];var r,i,a=c(t)?t:t.results;for(r=0,i=a.length;i>r;r++)bs(e,a[r],!0,n)}else bs(e,t,!1,n)},bs=function(e,t,n,r){var i=t.__metadata&&t.__metadata.uri;if(i)return void Cs(e,i,n,r);var a=Rs(t);return n?void r[e].push(a):void(r[e]=a)},Cs=function(e,t,n,r){var i=e+Co;return n?(r[i]=r[i]||[],void r[i].push(t)):void(r[i]=t)},Us=function(e,n,r,i){r!==t&&(n?i[n+"@"+e]=r:i[e]=r)},Ds="application/json",Ls=Er(Ds),xs=function(e){var t=[];for(var n in e){var r,i;for(r=0,i=e[n].length;i>r;r++)t.push(d({metadata:n},e[n][r]))}return t},Fs=function(e,t,n,r){if(e&&"object"==typeof e){var i,a=e.__metadata;a&&(a.actions&&(a.actions=xs(a.actions)),a.functions&&(a.functions=xs(a.functions)),i=a&&a.type);var o,s=jn(i,t)||Vn(i,t);if(s){var u=s.property;if(u){var d,l;for(d=0,l=u.length;l>d;d++){var c=u[d],f=c.name;if(o=e[f],"Edm.DateTime"===c.type||"Edm.DateTimeOffset"===c.type){if(o){if(o=n(o),!o)throw{message:"Invalid date/time value"};e[f]=o}}else"Edm.Time"===c.type&&(e[f]=rr(o))}}}else if(r)for(var p in e)o=e[p],"string"==typeof o&&(e[p]=n(o)||o)}return e},Ms=function(e){if(e){var t=e.properties.odata;return"nometadata"===t||"minimalmetadata"===t||"fullmetadata"===t}return!1},ws=function(e,t){var n,r,i={collections:[]};for(n=0,r=e.EntitySets.length;r>n;n++){var a=e.EntitySets[n],o={title:a,href:v(a,t)};i.collections.push(o)}return{workspaces:[i]}},Vs=/^\/Date\((-?\d+)(\+|-)?(\d+)?\)\/$/,js=function(e){var t;0>e?(t="-",e=-e):t="+";var n=Math.floor(e/60);return e-=60*n,t+mn(n,2)+":"+mn(e,2)},ks=function(e){var t=e&&Vs.exec(e);if(t){var n=new Date(_(t[1]));if(t[2]){var r=_(t[3]);"-"===t[2]&&(r=-r);var i=n.getUTCMinutes();n.setUTCMinutes(i-r),n.__edmType="Edm.DateTimeOffset",n.__offset=js(r)}if(!isNaN(n.valueOf()))return n}},Gs=function(t,n,r){var i=s(r.recognizeDates,t.recognizeDates),a=s(r.inferJsonLightFeedAsObject,t.inferJsonLightFeedAsObject),o=r.metadata,u=r.dataServiceVersion,d=ks,l="string"==typeof n?e.JSON.parse(n):n;if(Wn("3.0",u)===u){if(Ms(r.contentType))return Es(l,o,i,a,r.contentType.properties.odata);d=er}return l=sr(l.d,function(e,t){return Fs(t,o,d,i)}),l=Bs(l,r.dataServiceVersion),Ys(l,r.response.requestUri)},qs=function(t){var n,r=Date.prototype.toJSON;try{Date.prototype.toJSON=function(){return _n(this)},n=e.JSON.stringify(t,Hs)}finally{Date.prototype.toJSON=r}return n},Qs=function(e,n,r){var i=r.dataServiceVersion||"1.0",a=s(r.useJsonLight,e.useJsonLight),o=r.contentType=r.contentType||Ls;if(o&&o.mediaType===Ls.mediaType){var u=n;return a||Ms(o)?(r.dataServiceVersion=Wn(i,"3.0"),u=Rs(n,r),qs(u)):(Wn("3.0",i)===i&&(o.properties.odata="verbose",r.contentType=o),qs(u))}return t},Hs=function(e,t){return t&&"Edm.Time"===t.__edmType?hn(t):t},Ys=function(e,t){var n=Tn(e)&&!e.__metadata&&c(e.EntitySets);return n?ws(e,t):e},Bs=function(e,t){return t&&t.lastIndexOf(";")===t.length-1&&(t=t.substr(0,t.length-1)),t&&"1.0"!==t||c(e)&&(e={results:e}),e},$s=Ur(Gs,Qs,Ds,yr);$s.recognizeDates=!1,$s.useJsonLight=!1,$s.inferJsonLightFeedAsObject=!1,r.jsonHandler=$s;var Ws="multipart/mixed",Xs=/^HTTP\/1\.\d (\d{3}) (.*)$/i,Ks=/^([^()<>@,;:\\"\/[\]?={} \t]+)\s?:\s?(.*)/,Js=function(){return Math.floor(65536*(1+Math.random())).toString(16).substr(1)},zs=function(e){return e+Js()+"-"+Js()+"-"+Js()},Zs=function(e){return e.handler.partHandler},eu=function(e){var t=e.boundaries;return t[t.length-1]},tu=function(e,t,n){var r=n.contentType.properties.boundary;return{__batchResponses:ru(t,{boundaries:[r],handlerContext:n})}},nu=function(e,t,n){var r=n.contentType=n.contentType||Er(Ws);return r.mediaType===Ws?uu(t,n):void 0},ru=function(e,t){var n="--"+eu(t);su(e,t,n),ou(e,t);for(var r,i=[];"--"!==r&&t.position<e.length;){var a,o=iu(e,t),s=Er(o["Content-Type"]);if(s&&s.mediaType===Ws){t.boundaries.push(s.properties.boundary);try{a=ru(e,t)}catch(u){u.response=au(e,t,n),a=[u]}i.push({__changeResponses:a}),t.boundaries.pop(),su(e,t,"--"+eu(t))}else{if(!s||"application/http"!==s.mediaType)throw{message:"invalid MIME part type "};ou(e,t);var d=au(e,t,n);try{d.statusCode>=200&&d.statusCode<=299?Zs(t.handlerContext).read(d,t.handlerContext):d={message:"HTTP request failed",response:d}}catch(u){d=u}i.push(d)}r=e.substr(t.position,2),ou(e,t)}return i},iu=function(e,t){var n,r,i,a={};do i=t.position,r=ou(e,t),n=Ks.exec(r),null!==n?a[n[1]]=n[2]:t.position=i;while(r&&n);return Kn(a),a},au=function(e,t,n){var r,i,a,o=t.position,s=Xs.exec(ou(e,t));return s?(r=s[1],i=s[2],a=iu(e,t),ou(e,t)):t.position=o,{statusCode:r,statusText:i,headers:a,body:su(e,t,"\r\n"+n)}},ou=function(e,t){return su(e,t,"\r\n")},su=function(e,t,n){var r=t.position||0,i=e.length;if(n){if(i=e.indexOf(n,r),-1===i)return null;t.position=i+n.length}else t.position=i;return e.substring(r,i)},uu=function(e,t){if(!Sn(e))throw{message:"Data is not a batch object."};var n,r,i=zs("batch_"),a=e.__batchRequests,o="";for(n=0,r=a.length;r>n;n++)o+=du(i,!1)+lu(a[n],t);o+=du(i,!0);var s=t.contentType.properties;return s.boundary=i,o},du=function(e,t){var n="\r\n--"+e;return t&&(n+="--"),n+"\r\n"},lu=function(e,t,n){var r,i=e.__changeRequests;if(c(i)){if(n)throw{message:"Not Supported: change set nested in other change set"};var a=zs("changeset_");r="Content-Type: "+Ws+"; boundary="+a+"\r\n";var o,s;for(o=0,s=i.length;s>o;o++)r+=du(a,!1)+lu(i[o],t,!0);r+=du(a,!0)}else{r="Content-Type: application/http\r\nContent-Transfer-Encoding: binary\r\n\r\n";var u=d({},t);u.handler=Ur,u.request=e,u.contentType=null,ar(e,Zs(t),u),r+=cu(e)}return r},cu=function(e){var t=(e.method?e.method:"GET")+" "+e.requestUri+" HTTP/1.1\r\n";for(var n in e.headers)e.headers[n]&&(t=t+n+": "+e.headers[n]+"\r\n");return t+="\r\n",e.body&&(t+=e.body),t};r.batchHandler=Ur(tu,nu,Ws,yr);var fu=[r.jsonHandler,r.atomHandler,r.xmlHandler,r.textHandler],pu=function(e,t,n){var r,i;for(r=0,i=fu.length;i>r&&!fu[r][e](t,n);r++);if(r===i)throw{message:"no handler for data"}};r.defaultSuccess=function(t){e.alert(e.JSON.stringify(t))},r.defaultError=m,r.defaultHandler={read:function(e,t){e&&a(e.body)&&e.headers["Content-Type"]&&pu("read",e,t)},write:function(e,t){pu("write",e,t)},maxDataServiceVersion:yr,accept:"application/atomsvc+xml;q=0.8, application/json;odata=fullmetadata;q=0.7, application/json;q=0.5, */*;q=0.1"},r.defaultMetadata=[],r.read=function(e,t,n,i,a,o){var s;return s=e instanceof String||"string"==typeof e?{requestUri:e}:e,r.request(s,t,n,i,a,o)},r.request=function(e,t,n,i,a,o){t=t||r.defaultSuccess,n=n||r.defaultError,i=i||r.defaultHandler,a=a||r.defaultHttpClient,o=o||r.defaultMetadata,e.recognizeDates=s(e.recognizeDates,r.jsonHandler.recognizeDates),e.callbackParameterName=s(e.callbackParameterName,r.defaultHttpClient.callbackParameterName),e.formatQueryString=s(e.formatQueryString,r.defaultHttpClient.formatQueryString),e.enableJsonpCallback=s(e.enableJsonpCallback,r.defaultHttpClient.enableJsonpCallback),e.useJsonLight=s(e.useJsonLight,r.jsonHandler.enableJsonpCallback),e.inferJsonLightFeedAsObject=s(e.inferJsonLightFeedAsObject,r.jsonHandler.inferJsonLightFeedAsObject);var u={metadata:o,recognizeDates:e.recognizeDates,callbackParameterName:e.callbackParameterName,formatQueryString:e.formatQueryString,enableJsonpCallback:e.enableJsonpCallback,useJsonLight:e.useJsonLight,inferJsonLightFeedAsObject:e.inferJsonLightFeedAsObject};try{return ar(e,i,u),En(e,t,n,i,a,u)}catch(d){n(d)}},r.parseMetadata=function(e){return Ro(null,e)},r.batchHandler.partHandler=r.defaultHandler}(this),n("oDataService",function(e){return function(){var t,n;return n=function(){return this.OData},t=n.apply(e,arguments)}}(this)),n("transportInterface",[],function(){var e={defaults:{successHandler:null,errorHandler:null,fields:null,filters:null,orderBy:null,orderDesc:!1,getCount:!1,orderAscending:null,limitFrom:null,limitCount:null,parseDate:null},create:function(){console.log("transportInterface:create :: stub method, have to be implemented")},find:function(){console.log("transportInterface:find :: stub method, have to be implemented")},findOne:function(){console.log("transportInterface:findOne :: stub method, have to be implemented")},update:function(){console.log("transportInterface:update :: stub method, have to be implemented")},remove:function(){console.log("transportInterface:remove :: stub method, have to be implemented")}};return e}),n("filtersParser",["underscorenc","helpers","config","errorManager"],function(e,t,n,r){var i=function(t,n){return-1!==t.indexOf("date")?"datetime'"+n+"'":e.isString(n)?"'"+n+"'":e.isNull(n)?"null":n},a={$equal:"="},o={$and:"&"},s={$gte:"ge",$gt:"gt",$lte:"le",$lt:"lt",$equal:"eq",$ne:"ne",$not:"not",$in:function(t,n){var r=e.map(n,function(e){var n={};return n[t]=e,n});return f.parseFilter({$or:r})},$like:function(e,n){return"'"===n[0]&&"'"===n[n.length-1]&&(n=n.slice(1,-1)),"substringof('"+t.encodeUrlString(n)+"', "+e+")"},$extend:function(t){if(!e.isObject(t))return"";var n=e.first(e.keys(t)),r=t[n],i=f.setKeyPrefix(n).parseFilter(r);return f.setKeyPrefix(""),i},$any:function(t){if(!e.isObject(t))return"";var n,r=e.first(e.keys(t)),i=t[r],a="";return n=f.setKeyPrefix(r).parseFilter(i),f.setKeyPrefix(""),a=r+"/any("+r+": "+n+")"},$sub:function(t){if(!e.isObject(t))return"";var n=e.first(e.keys(t)),r=t[n],i="";return i=f.setKeyPrefix(n).parseFilter(r),f.setKeyPrefix(""),i}},u={$or:"or",$and:"and"},d=e.keys(u),l=e.keys(s),c=e.union(d,l),f={comparators:s,operators:u,opsNames:d,compareOperations:l,acceptableKeys:c,keyPrefix:"",setKeyPrefix:function(e){return this.keyPrefix=e,this},createKey:function(e){return this.keyPrefix&&-1===e.indexOf(this.keyPrefix+"/")?this.keyPrefix+"/"+e:e},isWrap:!0,setWrap:function(e){return this.isWrap=!!e,this},wrap:function(e){return this.isWrap?"("+e+")":e},useAlternativeRules:function(){return this.comparators=a,this.operators=o,this.opsNames=e.keys(this.operators),this.compareOperations=e.keys(this.comparators),this.acceptableKeys=e.union(this.opsNames,this.compareOperations),this},restoreRules:function(){return this.comparators=s,this.operators=u,this.opsNames=d,this.compareOperations=l,this.acceptableKeys=c,this},validate:function(t){if(!e.isNumber(t)&&!e.isFunction(t)&&!e.contains(this.acceptableKeys,t)){var n=e.some(this.acceptableKeys,function(e){return e==="$"+t});n&&r.throwError("API_ERR_TRANSPORT_2",[t,c]),"$"===e.first(t)&&r.throwError("API_ERR_TRANSPORT_2",[t,c])}},isComplex:function(t){var n=this;return e.some(t,function(t,r){var i=e.some(n.acceptableKeys,function(e){return e===r});return i?!0:e.isObject(t)?n.isComplex(t):!1})},getFields:function(t){var n=this;return e.compact(e.uniq(e.flatten(e.map(t,function(t,r){return"$extend"!==r&&"$any"!==r&&"$sub"!==r?(e.isObject(t)||e.contains(n.acceptableKeys,r))&&(e.contains(n.acceptableKeys,r)||e.isNumber(r))?n.getFields(t):r:void 0}))))},mapFilters:function(n){if(!e.isUndefined(n.$visibility)){if(e.isArray(n.$visibility)){var i=e.some(n.$visibility,function(t){return!e.isString(t)});i&&r.throwError("API_ERR_QUERY_API_3",[this.entityName,e.keys(this._filtersObj),"","string","of incorrect type"])}else e.isString(n.$visibility)||r.throwError("API_ERR_QUERY_API_3",[this.entityName,e.keys(this._filtersObj),"","string",t.toType(n.$visibility)]);delete n.$visibility}e.isUndefined(n.$client)||(e.isString(n.$client)||r.throwError("API_ERR_QUERY_API_3",[this.entityName,e.keys(this._filtersObj),"","string",t.toType(n.$client)]),delete n.$client)},buildComparator:function(t,n){if(e.isArray(t))return this.comparators.$in(n,t);if(e.isObject(t)){var a=e.first(e.keys(t));this.validate(a),operation=this.comparators[a],value=t[a]}else operation=this.comparators.$equal,value=t;return e.isUndefined(operation)&&r.throwError("API_ERR_TRANSPORT_3",[a,this.compareOperations]),value=i(n,value),n=this.createKey(n),string=e.isFunction(operation)?operation(n,value):[n,value].join(" "+operation+" "),this.wrap(string)},createFilterString:function(e){if(!e)return"";this.mapFilters(e);var t=this.parseFilter(e);return this.restoreRules(),this.isWrap=!0,this.keyPrefix="",t},parseFilter:function(t,n){var r=this,i=this.operators[n||"$and"];if(e.isArray(t)){var a=e.map(t,function(e){return r.parseFilter(e,n)}).join(" "+i+" ");return this.wrap(a)}return e.map(t,function(t,n){if(r.validate(n),"$extend"===n||"$any"===n||"$sub"===n)return r.comparators[n](t);var i=e.some(r.opsNames,function(e){return e===n});return i?r.parseFilter(t,n):r.buildComparator(t,n)}).join(" "+i+" ")},getCustomQueryOptions:function(e){return this.setWrap(!1).useAlternativeRules().createFilterString(e)}};return f}),n("oDataQueryBuilder",["underscorenc","config","filtersParser","helpers"],function(e,t,n,r){function i(e,t){var n="";return e.orderByExpanded?n=""===t?o(e.orderByExpanded,"orderby",e.expandedFor):","+o(e.orderByExpanded,"",e.expandedFor).substring(3):n}function a(e){var t="";return e.expandedFor&&(t="$expand="+e.expandedFor),t}var o=function(t,n,r){var i,a="";if(e.isString(t)&&(t=[t]),t&&t.length>0)if(r)for(a="$"+n+"=",i=0;i<t.length;i++)a+=r+"/"+t[i],i<t.length-1&&(a+=",");else a="$"+n+"="+t.join(",");return a},s=function(t,n){var r="",i="";return e.isNullUndef(t)||(r="$skip="+t),e.isNullUndef(n)||(i="$top="+n),e.compact([r,i]).join("&")},u={filtersParser:n};return u.getExpandedTail=function(t){if(t.count)return this.getCountTail(t);var n="",d="",l="",c="",f="",p="",_="",h="";if(n=u.getFilterStringSimple(t),d=o(t.fields,"select",t.expandedFor),t.expandedForFields&&t.expandedForFields.length){var m=t.expandedForFields.join(",");d=e.compact([d,m]).join(",")}return l=o(t.orderBy,"orderby"),c=i(t,l),t.orderDesc&&l&&!c&&(l+=" desc "),t.orderDesc&&c&&(c+=" desc "),t.inlineCount&&(inlineCountString="$inlinecount=allpages"),h=u.addQueryParams(t),f=s(t.limitFrom,t.limitCount),p=a(t),_=r.concatenateStrings("?",[h,p,n,d,l,c,f],"&")},u.getTail=function(e){if(e.data.count)return this.getCountTail(e);var t="",n="",i="",a="",d="",l="",c="",f="";return t=u.getFilterStringSimple(e.data),n=o(e.data.fields,"select"),i=o(e.data.orderBy,"orderby"),e.data.orderDesc&&i&&(i+=" desc "),e.data.inlineCount&&(c="$inlinecount=allpages"),l=u.addQueryParams(e.head.queryParams),f=u.expandFor(e.data.expandFor),a=s(e.data.limitFrom,e.data.limitCount),d=r.concatenateStrings("?",[l,t,n,i,a,c,f],"&")},u.getCountTail=function(e){var t,n,i="",o="";return t=u.getFilterStringSimple(e.data),i=u.addQueryParams(e.head.queryParams),o=a(e.data),n="/$count"+r.concatenateStrings("?",[i,o,t],"&")},u.getFilterStringSimple=function(t){var i=t.customFunctionString?t.customFunctionString+"&":"";t.filters=t.filters||{},t.expandedFor&&t.expandedForFilters&&(t.filters.$extend={},t.filters.$extend[t.expandedFor]=t.expandedForFilters);var a=n.createFilterString(t.filters);return i+r.concatenateStrings("$filter=",e.compact([a,t.customFilterString])," and ")},u.addQueryParams=function(t){var n="";return t&&e.isObject(t)&&(n+=e.map(t,function(e,t){return""+t+"="+e}).join("&")),n},u.expandFor=function(n){return n&&e.isArray(n)&&n.length?t.EXPAND+n.join(","):""},u.fieldsToString=o,u.limitToString=s,u}),n("oDataTransport",["oDataService","transportInterface","helpers","underscorenc","config","oDataQueryBuilder","errorManager"],function(e,t,n,r,i,a,o){function s(e,t){return function(a,o){if(r.isUndefined(a)&&!r.isUndefined(o.body)&&r.isString(o.body)&&o.body.length&&(a=JSON.parse(o.body)),e.successHandler){var s=[];if(t.head.operation===i.CRUD.find)s.push(t.data.count?a:a.results),s.push(a.__next);else if(t.head.operation===i.CRUD.remove)t.head.customOperation===i.CUSTOM_ENDPOINTS.REMOVE_IMAGE&&s.push(a);else if(t.head.operation===i.CRUD.update){var u=n.getResponseAdditionalData(o),d={__metadata:{}};if(!r.isUndefined(u)&&!r.isUndefined(u.headers)){var l=n.getPropertyValueCaseInsensitive(u.headers,"etag");r.isUndefined(l)||(d.__metadata.etag=l)}s.push(t.head.isCustomHead&&t.head.customOperation===i.CUSTOM_ENDPOINTS.UPDATE_IMAGE?a:d)}else s.push(a);s.push(n.getResponseAdditionalData(o)),e.successHandler.apply(e,s)}else n.defSuccessCb(a)}}function u(e){return function(t){e.errorHandler?e.errorHandler(t.message,n.getResponseAdditionalData(t.response)):n.defErrorCb({message:t.message})}}function d(e){return function(t,a){var o=E(t),s=!(r.isUndefined(t.__batchResponses)||t.__batchResponses.length>0&&t.__batchResponses[0].__changeResponses);if(!s){var u=n.getResponseAdditionalData(a);if(u.sub=o.responseAdditionalData,y(t))return e.errorHandler?e.errorHandler(o.error,u):n.defErrorCb({error:o.error,details:u});if(!r.isUndefined(u.sub)&&!r.isUndefined(u.sub.length>0)){var d=0;o.data||(o.data=[]),r.each(u.sub,function(t){if(e.sub[d].head.operation===i.CRUD.update){var a={__metadata:{}},s=n.getPropertyValueCaseInsensitive(t.headers,"etag");r.isUndefined(s)||(a.__metadata.etag=s),o.data[d]=a}d++})}}e.successHandler?s?e.successHandler(o):e.successHandler(o.data,u):n.defSuccessCb(t)}}function l(e,t){var a={};if(t||(a.timeoutMS=i.REQUEST_TIMEOUT),e.head.operation!==i.CRUD.find||r.isNullUndef(e.data.id)||(e.head.operation=i.CRUD.findOne),!r.isFunction(g[e.head.operation]))throw"Unrecognised operation: "+e.head.operation;return r.extend(a,g[e.head.operation](e,t)),e.head.customOperation===i.CUSTOM_ENDPOINTS.FIND_IMAGE&&(a.headers=n.getHeader({"X-Requested-With":"XMLHttpRequest"})),a}function c(e){var t=[],a=[],o={__batchRequests:t};r.each(e.sub,function(e){var n=l(e,!0);n.method===i.REQ_TYPE_GET?t.push(n):a.push(n)}),a.length>0&&t.push({__changeRequests:a});var s={};return s.requestUri=n.getRequestURL("$batch"),s.method=n.getHTTPMethod(i.REQ_TYPE_POST),s.headers=n.getHeader(i.REQ_TYPE_POST),s.timeoutMS=i.REQUEST_TIMEOUT,s.data=o,s}function f(e){var t,r,a={},o="\r\n",s={svg:"image/svg+html",json:"application/json",png:"image/png"},u=e.data.fileName.split(".").pop();return t="----data-persistence-boundary-"+Math.floor(Math.random()*(new Date).getMilliseconds()),r="--"+t+o,r+='Content-Disposition: form-data; name="annotation"'+o,r+="content-type: application/json"+o+o,r+=JSON.stringify(e.data.fieldsValues)+o,r+="--"+t+o,r+='Content-Disposition: form-data; name="uploadfile"; filename="'+e.data.fileName+'"'+o,r+="Content-Transfer-Encoding: base64"+o,r+="Content-Type: "+s[u]+o+o,r+=e.data.base64Image+o+"--"+t+"--"+o,a.body=r,e.head.customOperation===i.CUSTOM_ENDPOINTS.CREATE_IMAGE?a.requestUri=n.getRequestURL(i.ACTION_STORAGE_UPLOAD_URL,!0):e.head.customOperation===i.CUSTOM_ENDPOINTS.UPDATE_IMAGE&&(a.requestUri=n.getRequestURL(e.head.baseURL(e.data),!0)),a.method=n.getHTTPMethod(e.head.reqType||i.REQ_TYPE_POST),a.headers=n.getHeader(i.REQ_TYPE_PUT),a.headers["Content-Type"]="multipart/form-data; boundary="+t,a}function p(t){t.test?t.test(l(t.sub[0])):t.sub[0].head.customOperation===i.CUSTOM_ENDPOINTS.FIND_IMAGE||t.sub[0].head.customOperation===i.CUSTOM_ENDPOINTS.REMOVE_IMAGE?e.request(l(t.sub[0],!1),s(t,t.sub[0]),u(t),e.batchHandler):e.request(l(t.sub[0],!1),s(t,t.sub[0]),u(t))}function _(t){t.test?t.test(c(t)):e.request(c(t),d(t),u(t),e.batchHandler)}function h(t){t.test?t.test(f(t.sub[0],!1)):e.request(f(t.sub[0]),s(t,t.sub[0]),u(t),e.batchHandler)}var m={init:function(){var n=r.extend({},t,this);return e.defaultHttpClient.enableJsonpCallback=!1,n}};m.setCors=function(){},m.getFiltersParser=function(){return a.filtersParser};var g={};g[i.CRUD.findOne]=function(e,t){var o={};o.method=t?i.REQ_TYPE_GET:n.getHTTPMethod(i.REQ_TYPE_GET),t||(o.headers=n.getHeader()),o.recognizeDates=r.isNullUndef(e.head.parseDates)?i.DEFAULT_PARSE_DATE:e.head.parseDates;var s=n.concatenateStrings("?",[a.addQueryParams(e.head.queryParams),a.fieldsToString(e.data.fields,"select"),a.expandFor(e.data.expandFor)],"&");return o.requestUri=e.head.baseURL({id:e.data.id,tail:s}),o.requestUri=t?o.requestUri:n.getRequestURL(o.requestUri,e.head.isWebApi),o},g[i.CRUD.find]=function(e,t){var o={};o.method=t?i.REQ_TYPE_GET:n.getHTTPMethod(i.REQ_TYPE_GET),t||(o.headers=n.getHeader()),o.recognizeDates=r.isNullUndef(e.head.parseDates)?i.DEFAULT_PARSE_DATE:e.head.parseDates;var s=a.getTail(e);if(e.data.next){var u=a.addQueryParams(e.head.queryParams);o.requestUri=e.data.next,o.requestUri=u.length>0?o.requestUri+"&"+u:o.requestUri}else o.requestUri=e.head.baseURL({tail:s}),o.requestUri=t?o.requestUri:n.getRequestURL(o.requestUri,e.head.isWebApi);return o},g[i.CRUD.create]=function(e,t){var o={};return o.method=t?i.REQ_TYPE_POST:n.getHTTPMethod(i.REQ_TYPE_POST),o.recognizeDates=r.isNullUndef(e.head.parseDates)?i.DEFAULT_PARSE_DATE:e.head.parseDates,t?e.head.isMain&&(o.headers={"Content-ID":"1"}):o.headers=n.getHeader(i.REQ_TYPE_POST),o.requestUri=t?e.head.baseURL():n.getRequestURL(e.head.baseURL(),e.head.isWebApi),o.data=e.data.fieldsValues,r.isEmpty(e.head.queryParams)||(t?o.requestUri+=n.concatenateStrings("?",[a.addQueryParams(e.head.queryParams)],""):r.extend(o.data,e.head.queryParams)),t&&!r.isNullUndef(e.data.foreignKeyRef)&&(o.data[e.data.foreignKeyRef.navigationProperty]={__metadata:{uri:"$1"}}),o},g[i.CRUD.update]=function(e,t){var o={};if(o.method=t?i.REQ_TYPE_MERGE:n.getHTTPMethod(e.head.reqType||i.REQ_TYPE_MERGE),r.isUndefined(e.head.etags))t||(o.headers=n.getHeader(i.REQ_TYPE_MERGE));else{if(!r.isString(e.head.etags))throw"Etag should be string but is "+typeof e.head.etags+".";o.headers=t?{"if-match":e.head.etags}:n.getHeader(i.REQ_TYPE_MERGE,{"if-match":e.head.etags})}return o.requestUri=t?e.head.baseURL({id:e.data.id}):n.getRequestURL(e.head.baseURL({id:e.data.id}),e.head.isWebApi),o.data=e.data.fieldsValues,r.isEmpty(e.head.queryParams)||(t?o.requestUri+=n.concatenateStrings("?",[a.addQueryParams(e.head.queryParams)],""):r.extend(o.data,e.head.queryParams)),o},g[i.CRUD.remove]=function(e,t){var o={};if(o.method=t?i.REQ_TYPE_DELETE:n.getHTTPMethod(i.REQ_TYPE_DELETE),r.isUndefined(e.head.etags))t||(o.headers=n.getHeader(i.REQ_TYPE_DELETE));else{if(!r.isString(e.head.etags))throw"Etag should be string but is "+typeof e.head.etags+".";o.headers=t?{"if-match":e.head.etags}:n.getHeader(i.REQ_TYPE_DELETE,{"if-match":e.head.etags})}return o.requestUri=(t?e.head.baseURL({id:e.data.id}):n.getRequestURL(e.head.baseURL({id:e.data.id}),e.head.isWebApi))+n.concatenateStrings("?",[a.addQueryParams(e.head.queryParams)],""),o};var y=function(e){var t,n,r=!1;for(t=0;t<e.__batchResponses.length;t++){var i=e.__batchResponses[t];if(i.__changeResponses)for(n=0;n<i.__changeResponses.length;n++){var a=i.__changeResponses[n];a.message&&(r=!0)}else if(i.message)return r=!0}return r},E=function(e){var t;if(e.__batchResponses&&e.__batchResponses.length){if(e.__batchResponses&&e.__batchResponses.length&&!e.__batchResponses[0].__changeResponses)return t=[],r.each(e.__batchResponses,function(e,i){var a;a=e.data&&e.data.results?e.data.results:r.isString(e.data)?isNaN(parseInt(e.data))?e.data:parseInt(e.data):e.data,t.push({result:a,next:e.data?e.data.__next:void 0,additionalData:n.getResponseAdditionalData(e.message?e.response:e),responseIndex:i,error:e.message})}),t;var i=e.__batchResponses[0];t={},t.data=r.pluck(i.__changeResponses,"data");var a=i.__changeResponses?i.__changeResponses:e.__batchResponses;return t.responseAdditionalData=r.map(a,function(e){var t;return t=n.getResponseAdditionalData(r.isUndefined(e.response)?e:e.response)}),t.error=r.unique(r.map(i.__changeResponses,function(e){var t=e.message,n=e.response&&e.response.body?e.response.body:"[]";return e.message?"Message: "+t+"; Details: "+n+";":""})).join(". "),t}};return m.run=function(e){if(!e||!r.isObject(e))throw"oDataTransport: run: request is not an object";if(!e.sub&&!r.isArray(e.sub)&&e.sub.length<1&&r.every(e.sub,function(e){return e.head&&e.data}))throw"odata.js: Invalid request, object doesn't have required properties.";e.sub.length>i.SETTINGS.AppSettings.MaxChangesetCount&&o.throwError("API_ERR_TRANSPORT_1",[i.SETTINGS.AppSettings.MaxChangesetCount]),1===e.sub.length?e.sub[0].head.isCustomHead?h(e):p(e):_(e)},m.init()}),n("ajaxTransport",["underscorenc","transportInterface","helpers","config","oDataService"],function(e,t,n,r,i){var a={init:function(){return e.extend({},t,this)}};return a.read=function(e,t,a){var o;if(!e)throw new Error("Ajax.read: request object must be defined");if(e.headers?o=e.headers:(o=n.getHeader(n.getHTTPMethod(e.type||r.REQ_TYPE_POST)),o["Content-Type"]="application/json"),!e.url)throw new Error("Ajax.read: request.url is required");var s;s="application/json"===o["Content-Type"]?JSON.stringify(e.data):e.data,i.defaultHttpClient.request({method:n.getHTTPMethod(e.type||r.REQ_TYPE_POST),requestUri:e.url,body:s,headers:o,timeoutMS:e.timeoutMS},function(e){var r,i=/(application\/json)/i;t?e?(r=n.getAjaxResponseAdditionalData(e),i.test(e.headers["Content-Type"])?t(JSON.parse(e.body),r):t(e.body,r)):n.consoleLog("No data received!"):n.consoleLog("success")},function(e,t){if(a){var r=n.getAjaxResponseAdditionalData(e.response);a(e.message,r)}else n.consoleLog("testStatus: "+t+". error: "+e.message)})},a.find=function(e){var t=n.getRequestURL(e.baseURL({}),"");e.operation===r.CRUD.custom?a.read(t,e.fieldsValues,r.REQ_TYPE_GET,e.successHandler,e.errorHandler):a.read(e.baseURL,e.fieldsValues,r.REQ_TYPE_POST,e.successHandler,e.errorHandler)},a.run=function(t){if(!t||!e.isObject(t))throw"ajax: run: request is not an object";if(!t.operation||!t.baseURL)throw"ajax: run: specify baseUrl and operation";if(e.isUndefined(r.CRUD[t.operation]))throw"ajax: run: undefined operation "+r.CRUD[t.operation];t.customOperation?a[t.customOperation.base](t):a[t.operation](t)},a.custom=function(e){a[e.customOperation.base](e)},a.init()}),n("transportManager",["underscorenc","oDataTransport","ajaxTransport","config"],function(e,t,n,r){var i={},a=!1,o={activeTransport:null,init:function(){return a?this:(i[r.TRANSPORT_NAMES.AJAX]=n,i[r.TRANSPORT_NAMES.ODATA]=t,a=!0,this)},use:function(t){if(!i[t])throw"transportManager - trying to use bad transport "+t;return e.isEqual(this.activeTransport,i[t])?this.activeTransport:(this.activeTransport=i[t],this.activeTransport.name=t,this.activeTransport)}};return o.init()}),n("requestManager",["underscorenc","config"],function(e,t){function n(){S={successHandler:null,errorHandler:null,sub:[]}}function r(){return!e.contains(e.values(t.CRUD))}function i(e){if(!r(e))throw"RequestManager: Invalid Operation: "+e+"."}function a(e,t,n){i(t);var r=[];return!n&&R[E.GLOBALS][e]&&r.push(E.GLOBALS),R[E.HEAD][e]&&r.push(E.HEAD),R[E.DATA][t][e]&&r.push(E.DATA),r}function o(e,t){return a(e,t).length>0}function s(e,t){if(!o(e,t))throw"RequestManager: Operation "+t+" doesn't support property "+e+"."}function u(e,t){var n,r=a(e,t);return r.length>0&&(n=r[0]===E.DATA?R[E.DATA][t][e]:R[r[0]][e]),n}function d(t,n){var r=R.globals[t];if(!r)throw"ReqMan.setGlobalProperty: operation "+p(idx,y.OPERATION)+" doesn't support "+t+".";if(!r.type(n))throw"ReqMan.setGlobalProperty: value "+n+" for key "+t+" doesn't meet type requirements.";if(r.defIn){var i;if((e.isString(n)||e.isNumber(n))&&(i=[n]),e.isObject(n)&&(i=e.keys(n)),!e.every(i,function(t){return e.contains(r.defIn,t)}))throw"ReqMan.setGlobalProperty: value "+i+" for key "+t+" aren't any of the allowed values: "+r.defIn+"."}n=e.isObjectNotArray(S[t])?e.defaults(S[t],n):n,n=e.isArray(S[t])?e.union(S[t],n):n,S[t]=n}function l(e,t,n){for(var r=c(e),i=0,a=r.length;a>i;i++)h(r[i],t,n)}function c(t){for(var n=[],r=0,i=S.sub.length;i>r;r++)(e.isNull(t)||f(t,r))&&n.push(r);return n}function f(t,n){return e.every(t,function(t,r){var i=p(n,r);if(!e.isNullUndef(i)){var a=!0;if(e.isString(i)){if(!e.isString(t)&&!e.isArrayOfStrings(t))throw"ReqMan.isSubMatchingFilter: Type mismatch between value in surequest and value in the filter for key: "+r+".";var o=e.isString(t)?[t]:t;a&=e.contains(o,i)}else if(e.isBoolean(i)){if(!e.isBoolean(t))throw"ReqMan.isSubMatchingFilter: Type mismatch between value in surequest and value in the filter for key: "+r+".";a&=i===t}else{if(!e.isObject(i))throw"ReqMan.isSubMatchingFilter: Only properties that are strings or booleans are currently supported.";if(!e.isArray(t)&&!e.isObject(t))throw"ReqMan.isSubMatchingFilter: Type mismatch between value in surequest and value in the filter for key: "+r+".";e.isArray(t)?a&=e.every(t,function(){return!e.isUndefined(i[t])}):e.isObject(t)&&(a&=e.isEqual(t,i))}return a}return!1})}function p(e,t){if(!S.sub[e])throw"ReqMan.getSubProperty: there is no subrequest with index "+e+".";
return S.sub[e][E.HEAD][t]||S.sub[e][E.DATA][t]}function _(t){if(!e.contains(e.keys(R[E.GLOBALS]),t))throw"ReqMan.getGlobalProperty: unsupported property "+t+".";return S[t]}function h(t,n,r){if(!S.sub[t])throw"ReqMan.setSubProperty: there is no subrequest with index "+t+".";var i=p(t,y.OPERATION);if(i||n!==y.OPERATION||(i=r),!i)throw"ReqMan.setSubProperty: subrequest with index "+t+" doesn't have operation set.";s(n,i);var o=a(n,i,!0)[0],d=u(n,i),l=p(t,n,r);if(d.createOnly&&!e.isUndefined(l))throw"ReqMan.setSubProperty: key "+n+" can't be set again for "+y.OPERATION+".";if(!d.type(r))throw"ReqMan.setSubProperty: value "+r+" for key "+n+" doesn't meet type requirements.";if(d.defIn){var c;if((e.isString(r)||e.isNumber(r))&&(c=[r]),e.isObjectNotArray(r)&&(c=e.keys(r)),!e.every(c,function(t){return e.contains(d.defIn,t)}))throw"ReqMan.setSubProperty: value "+c+" for key "+n+" aren't any of the allowed values: "+d.defIn+"."}if(e.isObjectNotArray(l)&&!e.isObjectNotArray(r))throw"ReqMan.setSubProperty: if property "+n+" is object then the value should also be object but is: "+typeof r+".";r=e.isObjectNotArray(l)?e.defaults(l,r):r,e.isArray(l)&&!e.isArray(r)&&(r=[r]),r=e.isArray(l)?e.union(l,r):r,S.sub[t][o][n]=r}function m(){return e.getFirstIndex(S.sub,function(e){return e.head.isMain})}function g(){return S.sub.filter(function(e){return e.head.isMain}).length}var y={SUCCESS_HANDLER:"successHandler",ERROR_HANDLER:"errorHandler",TEST:"test",OPERATION:"operation",CUSTOM_OPERATION:"customOperation",REQ_TYPE:"reqType",ENTITY:"entity",IS_MAIN:"isMain",BASE_URL:"baseURL",IS_WEBAPI:"isWebApi",IS_CUSTOM_HEAD:"isCustomHead",CONFLICTING_METHOD:"conflictingMethod",QUERY_PARAMS:"queryParams",ETAGS:"etags",PARSE_DATES:"parseDates",ID:"id",FIELDS:"fields",FIELDS_VALUES:"fieldsValues",FILTERS:"filters",COUNT:"count",INLINE_COUNT:"inlineCount",LIMIT_FROM:"limitFrom",LIMIT_COUNT:"limitCount",ORDER_BY:"orderBy",ORDER_DESC:"orderDesc",CUSTOM_FILTER_STRING:"customFilterString",NEXT:"next",FOREIGN_KEY_REF:"foreignKeyRef",EXPANDED_FOR:"expandedFor",EXPAND_FOR:"expandFor",BASE_64_IMAGE:"base64Image",FILE_NAME:"fileName"},E={GLOBALS:"globals",HEAD:"head",DATA:"data"},S={successHandler:null,errorHandler:null,sub:[]},R={};R[E.GLOBALS]={successHandler:{createOnly:!0,required:!0,type:e.isFunction},errorHandler:{createOnly:!0,required:!0,type:e.isFunction},queryParams:{type:e.isObjectNotArray,defIn:e.values(t.QUERY_PARAMS)},test:{type:e.isFunction}},R[E.HEAD]={operation:{createOnly:!0,required:!0,type:e.isString,defIn:e.values(t.CRUD)},customOperation:{type:e.isString},entity:{required:!0,type:e.isString,defIn:e.union(e.map(t.COLLECTIONS,function(e){return e.nameUppercase}),["custom"])},isMain:{required:!0,type:e.isBoolean},baseURL:{required:!0,type:e.isFunction},isWebApi:{type:e.isBoolean},isCustomHead:{type:e.isBoolean},conflictingMethod:{type:e.isString},reqType:{type:e.isString},queryParams:{type:e.isObjectNotArray,defIn:e.values(t.QUERY_PARAMS)},etags:{type:e.isString},parseDates:{type:e.isBoolean}},R[E.DATA]={},R[E.DATA][t.CRUD.find]={fields:{type:e.isArrayOfStrings},filters:{type:e.isObjectNotArray},count:{type:e.isBoolean},inlineCount:{type:e.isBoolean},limitFrom:{type:e.isNumber},limitCount:{type:e.isNumber},orderBy:{type:e.isArrayOfStrings},orderDesc:{type:e.isBoolean},customFilterString:{type:e.isString},customFunctionString:{type:e.isString},next:{type:e.isString},expandedForFilters:{type:e.isObject},expandedForFields:{type:e.isArrayOfStrings},expandedFor:{type:e.isArrayOfStrings},expandFor:{type:e.isArrayOfStrings}},R[E.DATA][t.CRUD.findOne]={id:{required:!0,type:e.isNumber},fields:{type:e.isArrayOfStrings},customFilterString:{type:e.isString},customFunctionString:{type:e.isString},expandedForFilters:{type:e.isObject},expandedForFields:{type:e.isArrayOfStrings},expandedFor:{type:e.isArrayOfStrings},expandFor:{type:e.isArrayOfStrings}},R[E.DATA][t.CRUD.remove]={id:{required:!0,type:e.isNumber}},R[E.DATA][t.CRUD.create]={fieldsValues:{required:!0,type:e.isObjectNotArray},foreignKeyRef:{type:e.isObjectNotArray},base64Image:{type:e.isString},fileName:{type:e.isString}},R[E.DATA][t.CRUD.update]={id:{required:!0,type:e.isNumber},fieldsValues:{required:!0,type:e.isObjectNotArray},base64Image:{type:e.isString},fileName:{type:e.isString}};var v={PROPS:y,exportRequest:function(t){var n=e.deepClone(S);if(t&&e.isArray(t)&&n.sub.length>=t.length){if(0===t.length)throw"passed orderArray param is empty, orderArray must have items in order to reorder the subrequests";n.sub=e.reorderArray(t,n.sub)}return n},_reset:function(){n()},getLen:function(){return S.sub.length},getLastIdx:function(){var e=this.getLen()-1;return 0>e?null:e},createSub:function(e,t,n){var r=S.sub.push({head:{},data:{}});return r--,h(r,y.OPERATION,e),h(r,y.IS_MAIN,t),h(r,y.ENTITY,n),r},setProp:function(t,n,r){e.isNumber(t)?h(t,n,r):(r=n,n=t,d(n,r))},getProp:function(t,n){return e.isNumber(t)?p(t,n):_(t)},updateSubs:function(t,n,r){e.isUndefined(r)?l(null,t,n):l(t,n,r)},getSubIndexesMatchingFilter:function(e){return c(e)},isFind:function(e){var n=p(e,y.OPERATION);return n===t.CRUD.find},isFindOne:function(e){var n=p(e,y.OPERATION);return n===t.CRUD.findOne},isFindFamily:function(e){var n=p(e,y.OPERATION);return n===t.CRUD.find||n===t.CRUD.findOne},isUpdate:function(e){return p(e,y.OPERATION)===t.CRUD.update},isCreate:function(e){return p(e,y.OPERATION)===t.CRUD.create},isDelete:function(e){return p(e,y.OPERATION)===t.CRUD.remove},areSubsOfTypes:function(n,r){if(n=e.isString(n)?[n]:n,!e.every(n,function(n){return e.contains(e.values(t.CRUD),n)}))throw"ReqMan.areSubsOfType: One of the types "+n+" are not included in config.CRUD definition.";return e.isNullUndef(r)?e.reduce(e.range(this.getLen()),function(t,r){return t&&e.contains(n,p(r,y.OPERATION))},!0):e.contains(n,p(r,y.OPERATION))},isMainSet:function(){return m()},getCountOfMainRequests:function(){return g()}};return v}),n("queryApiValidators",["underscorenc","config","errorManager","helpers","requestManager"],function(e,t,n,r,i){var a={};a.validateRequest=function(n){t.SUPPRESS_VALIDATION||n&&n.sub&&n.sub.length>0&&e.each(n.sub,function(e){e.head&&e.head.operation&&(e.head.operation===t.CRUD.create?a.validateCreate(e):e.head.operation===t.CRUD.update&&a.validateUpdate(e))})};var o=function(i,a,o){o.data.foreignKeyRef&&(a=e.reject(a,function(e){return e===o.data.foreignKeyRef.field}));var s=e.intersection(a,i);o.head.operation===t.CRUD.update&&o.head.isMain===!1&&(s=e.without(s,t.SETTINGS.Metadata[r.tempAndUglyGetEntityName(o.head.entity)].keyField)),s&&s.length>0&&n.throwError("API_ERR_QUERY_API_11",[o.head.entity,s,o.head.operation])},s=function(t,r,i){var a=e.intersection(r,t);a&&a.length>0&&n.throwError("API_ERR_QUERY_API_11",[i.head.entity,a,i.head.operation])};return a.validateCreate=function(r){var i;if(t.SETTINGS.ReadOnlyFields&&t.SETTINGS.ReadOnlyFields[r.head.entity]){i=t.SETTINGS.ReadOnlyFields[r.head.entity];var a=e.keys(r.data.fieldsValues);o(a,i,r)}this.checkInputData(r),this.checkAnnotationTypeIds(r);var s=t.SETTINGS.RequiredFields[r.head.entity];if(r.data.foreignKeyRef&&(s=e.reject(s,function(e){return e===r.data.foreignKeyRef.field})),s){var u=e.difference(s,e.keys(r.data.fieldsValues));u.length>0&&n.throwError("API_ERR_QUERY_API_17",[u,r.head.entity])}},a.validateUpdate=function(r){if((e.isUndefined(r)||e.isUndefined(r.data)||(e.isUndefined(r.data.fieldsValues)||e.isEmpty(r.data.fieldsValues))&&r.head.customOperation!==t.CUSTOM_ENDPOINTS.UPDATE_IMAGE)&&n.throwError("API_ERR_QUERY_API_4",[r.head.entity,r.head.operation,"fieldsValues{Object} or forVisibility (with visibilityInclude, or visibilityExclude or both)"]),t.SETTINGS.ReadOnlyFields&&t.SETTINGS.ReadOnlyFields[r.head.entity]){var i=t.SETTINGS.ReadOnlyFields[r.head.entity],a=t.SETTINGS.FieldsSettableOnCreationOnly[r.head.entity],u=e.keys(r.data.fieldsValues);o(u,i,r),s(u,a,r)}this.checkInputData(r)},a.checkInputData=function(t){var i={"function":e.isFunction,number:e.isNumber,array:e.isArray,object:e.isObject,string:e.isString,"boolean":e.isBoolean,undefined:e.isUndefined,"null":e.isNull},a=r.getMetadataByEntityName(t.head.entity).fields;e.isUndefined(t)&&n.throwError("API_ERR_QUERY_API_3",[t.head.entity,"",t.head.operation,"object","undefined"]),t.data.foreignKeyRef&&(a=e.reject(a,function(e){return e.name===t.data.foreignKeyRef.field})),a&&t.data.fieldsValues&&e.each(a,function(a){e.each(t.data.fieldsValues,function(o,s){e.isUndefined(o)&&n.throwError("API_ERR_QUERY_API_3",[t.head.entity,s,t.head.operation,"of proper type","undefined"]),s===a.name&&("false"===a.nullable&&e.isNull(o)&&n.throwError("API_ERR_QUERY_API_3",[t.head.entity,a.name,t.head.operation,a.type,"null"]),e.isNull(o)||i[a.type.toLowerCase()](o)||n.throwError("API_ERR_QUERY_API_3",[t.head.entity,a.name,t.head.operation,a.type,r.toType(o)]),a.maxLength&&!e.isNull(o)&&o.length>a.maxLength&&n.throwError("API_ERR_QUERY_API_12",[a.name,o.length,a.maxLength]))})})},a.checkAnnotationTypeIds=function(r){var i;e.isUndefined(r.head)||e.isUndefined(r.head.entity)||r.head.entity!==t.COLLECTIONS.annotations.nameUppercase||(i=e.pluck(t.SETTINGS.AnnotationTypes,"id"),(!e.isUndefined(r.data.fieldsValues.type_id)&&!e.isNull(r.data.fieldsValues.type_id)||0===r.data.fieldsValues.type_id)&&(e.contains(i,r.data.fieldsValues.type_id)||n.throwError("API_ERR_QUERY_API_3",[r.head.entity,"type_id",r.head.operation,i,r.data.fieldsValues.type_id])))},a.doEtagCheck=function(r){!e.isNull(r)&&(r.length>t.SETTINGS.AppSettings.ETagMaxLengthInChars||0===r.length)&&n.throwError("API_ERR_QUERY_API_19",[r,r.length,t.SETTINGS.AppSettings.ETagMaxLengthInChars])},a.doInitCheck=function(){t.API_INITIALIZED||t.SUPPRESS_VALIDATION||n.throwError("API_ERR_QUERY_API_13",null)},a.validateFieldsNames=function(r,i,a){if(!t.SUPPRESS_VALIDATION&&"Any"!==a){var o=e.difference(r,i);o.length&&n.throwError("API_ERR_QUERY_API_9",[o])}},a.validateMutuallyExclusiveMethods=function(r,a,o){var s,u;for(s=i.getLastIdx(),u=0;s>=u;u++)e.indexOf(t.CONFLICTED_METHODS[o][a].methods,i.getProp(u,i.PROPS.CONFLICTING_METHOD))>-1&&n.throwError("API_ERR_QUERY_API_20",[r,a,t.CONFLICTED_METHODS[o][a].methods])},a.validateLimitParam=function(t,i,a,o){(e.isObject(t)||e.isBoolean(t)||isNaN(t)||t%1!==0)&&n.throwError("API_ERR_QUERY_API_3",[a,"",i,"number, null or undefined",r.toType(t)],o)},a.validateBatchGetItemsNumber=function(t,r){var a=e.isArray(t)?t.length:1;a!==i.getLen()&&n.throwError("API_ERR_QUERY_API_21",[r])},a.validateOrderFieldValues=function(t,i){e.isString(t)||e.isArrayOfStrings(t)||n.throwError("API_ERR_QUERY_API_3",[i,"","order","string or array of strings representing fields names",r.toType(t)])},a}),n("queryAPI",["underscorenc","config","helpers","filtersParser","errorManager","queryApiValidators","requestManager","resetManager"],function(e,t,n,r,i,a,o,s){var u,d,l,c,f={entityName:"queryAPI",_defaultTransport:void 0,_transports:{},_additionalActions:{},_filtersObj:{},_urls:{},acceptableFields:[],keyField:void 0,desiredOrder:{},init:function(){return this},_isMainRequestCreated:function(){return null!==o.isMainSet()},_validateMainRequestCreated:function(e){this._isMainRequestCreated()||i.throwError("API_ERR_QUERY_API_15",[e])},_validateRequestCreated:function(e){o.getLen()>0||i.throwError("API_ERR_QUERY_API_15",[e])},_validateNoRequestsCreated:function(e){0!==o.getLen()&&i.throwError("API_ERR_QUERY_API_8",[e])},_validateFindFamily:function(t,n){e.isNumber(n)||(n=o.getLastIdx()),o.isFindFamily(n)||i.throwError("API_ERR_QUERY_API_5",[this.entityName,t,"find"])},_validateFindOne:function(e){o.isFindOne(o.getLastIdx())||i.throwError("API_ERR_QUERY_API_5",[e,"findOne"])},_validateFind:function(e){o.isFind(o.getLastIdx())||i.throwError("API_ERR_QUERY_API_5",[this.entityName,e,"find"])},_getTransport:function(){var e=o.getProp(o.getLastIdx(),o.PROPS.OPERATION),t=this._transports[e]||this._defaultTransport;if(!t)throw'run: transport for operation "'+e+'" is not set!';return t},_getBaseURL:function(e){var t=this._urls[e].service||void 0;if(!t)throw'baseURL for operation "{0}" is not set!';return t},_isComplexFilters:function(e){var t=this._getTransport().getFiltersParser();return t.isComplex(e)},_setComplexFilters:function(e,t){var n=this._getTransport().getFiltersParser();this._mapFilters(e),a.validateFieldsNames(n.getFields(e),this.acceptableFields,this.entityName);var r=n.createFilterString(e);return this._customFilterString(r,t),this},_mapFields:function(e){return e},_mapFilters:function(e){return e},done:function(t){return d=t,this._validateRequestCreated("done"),e.isUndefined(t)||e.isNull(t)?this:(e.isFunction(t)||i.throwError("API_ERR_QUERY_API_10",["done","successHandler"]),this)},fail:function(t){return l=t,this._validateRequestCreated("fail"),e.isUndefined(t)||e.isNull(t)?this:(e.isFunction(t)||i.throwError("API_ERR_QUERY_API_10",["fail","errorHandler"]),this)},parseDates:function(){return a.doInitCheck(),n.isFunSwitchEnabled(arguments)&&o.updateSubs(o.PROPS.PARSE_DATES,!0),this},outputFields:function(r){var s=this,u="outputFields";a.doInitCheck(),this._validateMainRequestCreated();var d=function(u,d){s._validateFindFamily("outputFields",d),u&&(e.isArray(u)||i.throwError("API_ERR_QUERY_API_3",[s.entityName,"outputFields","provided","array",n.toType(u)],d),a.validateFieldsNames(u,s.acceptableFields,s.entityName),e.isNumber(d)?o.setProp(d,o.PROPS.FIELDS,u):o.updateSubs({operation:[t.CRUD.find,t.CRUD.findOne]},o.PROPS.FIELDS,r))};return e.isArrayOf(r,e.isArray,e.isNull)?(a.validateBatchGetItemsNumber(r,u),e.each(r,function(e,t){d(e,t)})):d(r),this},fields:function(e){return this.outputFields(e)},_validateFieldsValues:function(t){return e.isUndefined(t)||(this._mapFields(t),a.validateFieldsNames(e.keys(t),this.acceptableFields,this.entityName)),this},commonFields:function(n){if(a.doInitCheck(),this._validateRequestCreated("commonFields"),!o.isCreate(o.getLastIdx())&&!o.isUpdate(o.getLastIdx()))throw"commonFields is only supported for Create and Update operations.";return this._mapFields(n),a.validateFieldsNames(e.keys(n),this.acceptableFields,this.entityName),o.updateSubs({operation:[t.CRUD.update,t.CRUD.create]},o.PROPS.FIELDS_VALUES,n),this},_processFilters:function(n){var r=this;return e.isArray(n)?(e.each(n,function(n,i){r._isComplexFilters(n)?r._setComplexFilters(n,i):(r._mapFilters(n),e.isEmpty(n)||a.validateFieldsNames(e.keys(n),r.acceptableFields,r.entityName),e.isString(n)?(t.NEXT_LINK_DOMAIN_STRIPPING&&(n=n.replace(/^.*\/\/[^\/]+/,"")),o.setProp(i,o.PROPS.NEXT,n)):e.isEmpty(n)||o.setProp(i,o.PROPS.FILTERS,n))}),this):this._isComplexFilters(n)?this._setComplexFilters(n):(this._mapFilters(n),e.isEmpty(n)||(a.validateFieldsNames(e.keys(n),this.acceptableFields,this.entityName),o.setProp(o.getLastIdx(),o.PROPS.FILTERS,n)),this)},count:function(e){return a.doInitCheck(),this._validateMainRequestCreated(),this._validateFind("count"),this._request.count=e,o.updateSubs({operation:[t.CRUD.find,t.CRUD.findOne]},o.PROPS.COUNT,n.isFunSwitchEnabled(arguments)),this},inlineCount:function(){return a.doInitCheck(),this._validateMainRequestCreated("inlineCount"),this._validateFind("inlineCount"),o.updateSubs({operation:[t.CRUD.find,t.CRUD.findOne]},o.PROPS.INLINE_COUNT,n.isFunSwitchEnabled(arguments)),this},limit:function(t,n){if(arguments&&arguments[0]&&e.isArray(arguments[0]))e.each(arguments[0],function(e,t){o.setProp(t,o.PROPS.LIMIT_FROM,e[0]),o.setProp(t,o.PROPS.LIMIT_COUNT,e[1])});else{if(e.isArray(t)&&e.isArray(t)&&t.length!==n.length&&i.throwError("API_ERR_QUERY_API_18",["offset","amount"]),!t&&!n)return this;this.limitFrom(t),this.limitCount(n)}return a.doInitCheck(),this._validateMainRequestCreated("limit"),this._validateFind("limit"),this},limitFrom:function(n){var r="limitFrom",i=this;return a.doInitCheck(),this._validateMainRequestCreated(r),this._validateFind(r),!n||e.isArray(n)&&0===n.length?this:(e.isArray(n)?(a.validateBatchGetItemsNumber(n,r),e.each(n,function(e,t){a.validateLimitParam(e,r,i.entityName,t),e=Number(e),o.setProp(t,o.PROPS.LIMIT_FROM,e)})):(a.validateLimitParam(n,r,this.entityName),n=Number(n),o.getLen()>1?o.updateSubs({operation:[t.CRUD.find]},o.PROPS.LIMIT_FROM,n):o.setProp(o.getLastIdx(),o.PROPS.LIMIT_FROM,n)),this)},limitCount:function(n){var r="limitCount",i=this;return a.doInitCheck(),this._validateMainRequestCreated("limitCount"),this._validateFind("limitCount"),!n||e.isArray(n)&&0===n.length?this:(e.isArray(n)?(a.validateBatchGetItemsNumber(n,r),e.each(n,function(e,t){a.validateLimitParam(e,r,i.entityName,t),e=Number(e),o.setProp(t,o.PROPS.LIMIT_COUNT,e)})):(a.validateLimitParam(n,r,this.entityName),n=Number(n),o.getLen()>1?o.updateSubs({operation:[t.CRUD.find]},o.PROPS.LIMIT_COUNT,n):o.setProp(o.getLastIdx(),o.PROPS.LIMIT_COUNT,n)),this)},order:function(n,r){var i=function(t){return e.isString(t)?[t]:t},s=function(t){var n=!1;return e.isString(t)&&(n="desc"===t.toLowerCase()),e.isNumber(t)&&(n=0>t),n},u=this,d="order";return a.doInitCheck(),this._validateMainRequestCreated("order"),this._validateFind("order"),e.isNullUndef(n)||e.isArray(n)&&0===n.length?this:(e.isArrayOf(n,e.isArray,e.isNull)?(a.validateBatchGetItemsNumber(n,d),e.each(n,function(t,n){e.each(t,function(e){a.validateOrderFieldValues(e,u.entityName),o.setProp(n,o.PROPS.ORDER_BY,i(e))})})):(a.validateOrderFieldValues(n,this.entityName),o.getLen()>1?o.updateSubs({operation:[t.CRUD.find]},o.PROPS.ORDER_BY,i(n)):o.setProp(o.getLastIdx(),o.PROPS.ORDER_BY,i(n))),e.isArrayOf(r,e.isString,e.isNumber)?(a.validateBatchGetItemsNumber(r,d),e.each(r,function(e,t){e=s(e),o.setProp(t,o.PROPS.ORDER_DESC,e)})):(r=s(r),o.getLen()>1?o.updateSubs({operation:[t.CRUD.find]},o.PROPS.ORDER_DESC,r):o.setProp(o.getLastIdx(),o.PROPS.ORDER_DESC,r)),this)},_customFilterString:function(t,n){return a.doInitCheck(),this._validateMainRequestCreated("run"),e.isString(t)?(n=n||o.getLastIdx(),o.setProp(n,o.PROPS.CUSTOM_FILTER_STRING,t),this):this},next:function(n){var r=this;a.doInitCheck(),this._validateMainRequestCreated("next"),this._validateFindFamily("next");var i=function(n,i){if(e.isString(n))if(t.NEXT_LINK_DOMAIN_STRIPPING&&(n=n.replace(/^.*\/\/[^\/]+/,"")),e.isNumber(i)){var a=o.getLastIdx();i>a&&(o.createSub(t.CRUD.find,!0,r.entityName),o.setProp(i,o.PROPS.BASE_URL,r._getBaseURL(t.CRUD.find))),o.setProp(i,o.PROPS.NEXT,n)}else o.setProp(o.getLastIdx(),o.PROPS.NEXT,n)};return e.isArray(n)?e.each(n,function(e,t){i(e,t)}):i(n),this},run:function(){var n=this,r=function(t){e.isUndefined(o.getProp(t,o.PROPS.NEXT))?(n._additionalActions.find&&n._additionalActions.find(n._filtersObj),n._processFilters(n._filtersObj)):u&&n.forUser(u)};a.doInitCheck(),this._validateRequestCreated("run");var i=o.getLen(),f=this._getTransport(),p=o.getLastIdx();if(i>1){var _=o.getSubIndexesMatchingFilter({operation:[t.CRUD.find]});e.each(_,function(e){r(e)})}else o.isFind(p)&&r(p);if(this.entityName===t.COLLECTIONS.annotations.nameUppercase&&o.isFindFamily(p)&&e.isUndefined(o.getProp(p,o.PROPS.CUSTOM_OPERATION))&&e.isUndefined(o.getProp(p,o.PROPS.NEXT))){var h={};h[t.QUERY_PARAMS.option]=t.ANNO2_WITH_NO_SHARED,o.updateSubs({operation:[t.CRUD.find,t.CRUD.findOne]},o.PROPS.QUERY_PARAMS,h)}e.isUndefined(o.getProp(p,o.PROPS.FIELDS))||e.isUndefined(o.getProp(p,o.PROPS.EXPAND_FOR))||o.setProp(p,o.PROPS.FIELDS,o.getProp(p,o.PROPS.EXPAND_FOR)),l&&o.setProp(o.PROPS.ERROR_HANDLER,l),d&&o.setProp(o.PROPS.SUCCESS_HANDLER,d),c&&o.setProp(o.PROPS.TEST,c),d=l=c=u=void 0,this._entityLevelCheck&&this._entityLevelCheck(),this._entityRunActions&&this._entityRunActions();var m=this.desiredOrder.orderArgs||null,g=o.exportRequest(m);a.validateRequest(g),s.resetLib(),f.run(g)},create:function(r){a.doInitCheck();var s=this;if(e.isNullUndef(r)&&i.throwError("API_ERR_QUERY_API_3",[this.entityName,"fieldValues","create","array or object","empty"]),e.isObject(r)||e.isArray(r)||i.throwError("API_ERR_QUERY_API_3",[this.entityName,"fieldValues","create","array or object",n.toType(r)]),e.isArray(r)&&0===r.length&&i.throwError("API_ERR_QUERY_API_3",[this.entityName,"fieldValues","create","array or object","empty array"]),!t.SUPPRESS_VALIDATION&&(e.isObject(r)&&r[this.keyField]||e.isArray(r)&&e.some(r,function(t){return e.has(t,s.keyField)}))&&i.throwError("API_ERR_QUERY_API_11",[this.entityName,this.keyField,"create"]),this._additionalActions[t.CRUD.create]&&this._additionalActions[t.CRUD.create](r),e.isArray(r))e.each(r,this._validateFieldsValues,this),e.each(r,function(e){var n=o.createSub(t.CRUD.create,!1,s.entityName);o.setProp(n,o.PROPS.FIELDS_VALUES,e),o.setProp(n,o.PROPS.BASE_URL,this._getBaseURL(t.CRUD.create))},this);else{this._validateFieldsValues(r),this._validateNoRequestsCreated("create");var u=o.createSub(t.CRUD.create,!0,this.entityName);o.setProp(u,o.PROPS.BASE_URL,this._getBaseURL(t.CRUD.create)),o.setProp(u,o.PROPS.FIELDS_VALUES,r)}return this},remove:function(r){a.doInitCheck();var s=this;if(e.isNumber(r)||e.isArray(r)&&r.length||i.throwError("API_ERR_QUERY_API_3",[this.entityName,"id","remove","number or array",n.toType(r)]),this._additionalActions[t.CRUD.remove]&&this._additionalActions[t.CRUD.remove](r),e.isArray(r))e.each(r,function(n){e.isNumber(n)||(n=n[s.keyField]);var r=o.createSub(t.CRUD.remove,!1,s.entityName);o.setProp(r,o.PROPS.ID,n),o.setProp(r,o.PROPS.BASE_URL,s._getBaseURL(t.CRUD.remove))});else{this._validateNoRequestsCreated("remove");var u=o.createSub(t.CRUD.remove,!0,this.entityName);o.setProp(u,o.PROPS.ID,r),o.setProp(u,o.PROPS.BASE_URL,this._getBaseURL(t.CRUD.remove))}return this},update:function(r,s){a.doInitCheck();var u=this;if((!e.isArray(r)&&!e.isNumber(r)||e.isArray(r)&&!e.every(r,function(t){return e.isNumber(t)||e.isObject(t)}))&&i.throwError("API_ERR_QUERY_API_3",[this.entityName,"","update","nubmer or array of ids",n.toType(r)]),!e.isNumber(r)||e.isObject(s)||e.isUndefined(s)||i.throwError("API_ERR_QUERY_API_3",[this.entityName,"","update","object",n.toType(s)]),this._additionalActions[t.CRUD.update]&&this._additionalActions[t.CRUD.update](r,s),e.isArray(r))e.each(r,function(n){var r=o.createSub(t.CRUD.update,!1,u.entityName);e.isNumber(n)?o.setProp(r,o.PROPS.ID,n):(a.validateFieldsNames(e.keys(n),u.acceptableFields,this.entityName),o.setProp(r,o.PROPS.ID,n[u.keyField]),delete n[u.keyField],o.setProp(r,o.PROPS.FIELDS_VALUES,n)),o.setProp(r,o.PROPS.BASE_URL,this._getBaseURL(t.CRUD.update))},this);else{s=s||{},this._validateFieldsValues(s),this._validateNoRequestsCreated("update");var d=o.createSub(t.CRUD.update,!0,this.entityName);o.setProp(d,o.PROPS.ID,r),o.setProp(d,o.PROPS.FIELDS_VALUES,s),o.setProp(d,o.PROPS.BASE_URL,this._getBaseURL(t.CRUD.update))}return this},find:function(n){a.doInitCheck(),this._validateNoRequestsCreated("find");var r=this;if(e.isArray(n))e.each(n,function(n){var i=o.createSub(t.CRUD.find,!0,r.entityName);e.isString(n)?(t.NEXT_LINK_DOMAIN_STRIPPING&&(n=n.replace(/^.*\/\/[^\/]+/,"")),o.setProp(i,o.PROPS.NEXT,n)):o.setProp(i,o.PROPS.BASE_URL,r._getBaseURL(t.CRUD.find))});else{var i=o.createSub(t.CRUD.find,!0,this.entityName);if(o.setProp(i,o.PROPS.BASE_URL,this._getBaseURL(t.CRUD.find)),e.isString(n))return this.next(n)}return this._filtersObj={},this.filters(n),this},filters:function(t){var r=this;if(a.doInitCheck(),t=t||{},e.isArray(r._filtersObj))e.isArray(t)?e.each(t,function(t,a){e.isObjectNotArray(t)||i.throwError("API_ERR_QUERY_API_3",[r.entityName,"","find","object",n.toType(t)],a),r._filtersObj.push(t)}):(e.isObjectNotArray(t)||i.throwError("API_ERR_QUERY_API_3",[r.entityName,"","find","object",n.toType(t)]),r._filtersObj.push(t));else if(e.isEmpty(r._filtersObj)){if(e.isArrayOf(t,e.isObjectNotArray)||e.isObjectNotArray(t)||i.throwError("API_ERR_QUERY_API_3",[r.entityName,"","find","object",n.toType(t)]),o.getCountOfMainRequests()>1)for(var s=0;s<o.getCountOfMainRequests();s++)e.isArray(t)?e.each(t,function(e,t){o.setProp(t,o.PROPS.FILTERS,e)}):o.setProp(s,o.PROPS.FILTERS,t);r._filtersObj=t}else e.extend(r._filtersObj,t);return this},filter:function(e){return this.filters(e),this},findOne:function(r){a.doInitCheck(),this._validateNoRequestsCreated("findOne");var s=o.createSub(t.CRUD.findOne,!0,this.entityName);return e.isNumber(r)||i.throwError("API_ERR_QUERY_API_3",[this.entityName,"id","findOne","number",n.toType(r)]),this._additionalActions.findOne&&this._additionalActions.findOne(r),o.setProp(s,o.PROPS.ID,r),o.setProp(s,o.PROPS.BASE_URL,this._getBaseURL(t.CRUD.findOne)),this},etags:function(r){if(a.doInitCheck(),o.areSubsOfTypes([t.CRUD.update,t.CRUD.remove])||i.throwError("API_ERR_QUERY_API_5",[this.entityName,"etags()","find"]),(e.isArray(r)||e.isString(r)||e.isNull(r))&&(e.isString(r)&&e.isNull(r)||!e.isArray(r)||!e.some(r,function(t){return!(e.isNull(t)||e.isString(t))}))||i.throwError("API_ERR_QUERY_API_3",[this.entityName,"etags","etags","string, null or an array",n.toType(r)]),e.isArray(r)&&r.length!==o.getLen()&&i.throwError("API_ERR_QUERY_API_18",["remove and update","etags"]),e.isArray(r))e.each(r,function(t,n){a.doEtagCheck(t,this),e.isNull(t)||o.setProp(n,o.PROPS.ETAGS,t)});else{if(e.isNull(r))return this;a.doEtagCheck(r,this),o.setProp(o.getLastIdx(),o.PROPS.ETAGS,r)}return this},forUser:function(r){a.doInitCheck();var s=this;if(_forUserLogic=function(a,d){e.isString(d)||e.isNull(r)||i.throwError("API_ERR_QUERY_API_3",[s.entityName,"userId","forUser","string or null",n.toType(d)]);var l=o.areSubsOfTypes([t.CRUD.findOne,t.CRUD.find,t.CRUD.create,t.CRUD.update],a);l||i.throwError("API_ERR_QUERY_API_5",[s.entityName,"forUser",["find","update","create"].join(", ")],a);var c={};c[t.QUERY_PARAMS.userId]=d,u=d,e.isNumber(a)?(o.isFindFamily(a)||o.isUpdate(a))&&o.setProp(a,o.PROPS.QUERY_PARAMS,c):o.updateSubs({operation:[t.CRUD.findOne,t.CRUD.find,t.CRUD.create,t.CRUD.update]},o.PROPS.QUERY_PARAMS,c)},e.isArray(r))a.validateBatchGetItemsNumber(r,"forUser"),e.each(r,function(t,n){e.isNull(t)||_forUserLogic(n,t)});else{if(e.isNull(r))return this;_forUserLogic(void 0,r)}return this},test:function(t){return this._validateRequestCreated("test"),e.isNullUndef(t)&&(t=function(e){n.consoleLog(e)}),c=t,this},_customOperation:function(n,r,i,s,u){var d=this;a.doInitCheck(),u||this._validateNoRequestsCreated(r);var l=function(){var e=o.createSub(i,!0,s||d.entityName);o.setProp(e,o.PROPS.BASE_URL,d._getBaseURL(r)),o.setProp(e,o.PROPS.CUSTOM_OPERATION,r)};return e.isArray(n)?e.each(n,function(){l()}):l(),i===t.CRUD.find&&this.filter(n),o.getLastIdx()},shareTo:function(r){if(a.doInitCheck(),!n.isFunSwitchEnabled(arguments))return this;o.isCreate(o.getLastIdx())||i.throwError("API_ERR_QUERY_API_5",[this.entityName,"shareTo","create"]),o.getProp(o.getLastIdx(),o.PROPS.ENTITY)!==t.COLLECTIONS.annotations.nameUppercase&&i.throwError("API_ERR_QUERY_API_14",["shareTo",t.COLLECTIONS.annotations.nameUppercase]),e.isString(r)||e.isArrayOfStrings(r)||i.throwError("API_ERR_QUERY_API_3",[this.entityName,"userIds","shareTo","string or array of strings",n.toType(r)]),0!==o.getSubIndexesMatchingFilter({queryParams:[t.QUERY_PARAMS.userIds]}).length&&i.throwError("API_ERR_QUERY_API_16",["shareTo"]),e.isString(r)&&-1!==r.indexOf(";")&&(r=r.split(";")),e.isArrayOfStrings(r)&&(r=e.uniq(r),r=r.join(";"));var s={};return s[t.QUERY_PARAMS.userIds]=r,o.updateSubs({operation:t.CRUD.create,entity:t.COLLECTIONS.annotations.nameUppercase},o.PROPS.QUERY_PARAMS,s),this},forceOrder:function(t){if(!e.isUndefined(this.desiredOrder.forceSubReqToTheFirstPosition))throw"It is not allowed to force first position multiple times!";this.desiredOrder.forceSubReqToTheFirstPosition=t,this.desiredOrder.orderArgs=[],this.desiredOrder.orderArgs.push(t)}};return f._reset=function(){f._filtersObj={},f.desiredOrder={}},f.init()}),n("info",["config","helpers","underscorenc"],function(e,t,n){var r=[];r.push("keyField: name of ID field, unique. Forbidden for create operation, mandatory for [update, remove] operations"),r.push("fields: array of acceptable fields. [outputFields, fields, commonFields, filters] methods of entities check arguments to match these fields"),r.push("Allowed operations: ["+n.values(e.CRUD)+"]");var i={description:r},a={infoData:void 0,acceptableFields:[],keyField:void 0};return a.setInfo=function(e){if(this.infoData=n.extend({},i,e,this.entityInfo),this.infoData.fields){var t=25,r=n.getStringOfLen(t," "),a=n.getStringOfLen(t,"="),o="\n",s=[{name:"Field Name:",type:"Data Type:",maxLength:"Max Length:"}],u=[{name:a,type:a,maxLength:a}],d=n.union(s,u,this.infoData.fields);n.each(d,function(e){o+=e.name+r.substring(0,t-e.name.length)+" | "+e.type+r.substring(0,t-e.type.length)+" | "+(e.maxLength?e.maxLength:"")+"\n"}),this.infoData.getFieldsTable=function(){return o}}e.fields&&(this.acceptableFields=n.pluck(e.fields,["name"])),e.keyField&&(this.keyField=e.keyField)},a.info=function(){return this.infoData},a}),n("tags",["underscorenc","config","helpers","transportManager","client","queryAPI","info","errorManager","requestManager"],function(e,t,n,r,i,a,o,s,u){var d={remove:{service:n.templatify("tags(<%= id %>)")},create:{service:n.templatify("tags")},update:{service:n.templatify("tags(<%= id %>)")},find:{service:n.templatify("tags/<%= tail %>")},findOne:{service:n.templatify("tags(<%= id %>)<%= tail %>")},getDistinctTags:{service:n.templatify("Tag/DistinctTags<%= tail %>")}},l={entityName:"Tags",_defaultTransport:r.use(t.TRANSPORT_NAMES.ODATA),_transports:{},_request:{},_additionalActions:{},_urls:d,init:function(){return e.defaults(this,a),e.extend(this,o),this},_getRequest:function(){return this._request},getInfo:function(){var n=this.info();return e.isUndefined(t.SETTINGS.FieldsSettableOnCreationOnly[this.entityName])||(n.FieldsSettableOnCreationOnly=t.SETTINGS.FieldsSettableOnCreationOnly[this.entityName]),e.isUndefined(t.SETTINGS.ReadOnlyFields[this.entityName])||(n.ReadOnlyFields=t.SETTINGS.ReadOnlyFields[this.entityName]),e.isUndefined(t.SETTINGS.RequiredFields[this.entityName])||(n.REQUIRED_FIELDS=t.SETTINGS.RequiredFields[this.entityName]),n.SETTINGS_SOURCE=t.FORCE_DEFAULT_SERVICE_SETTINGS?"client_defaults":"service",n},tagNamesToValues:function(t){return e.isArray(t)?t=e.map(t,function(t){return e.isString(t)?{value:t}:t}):e.isString(t)&&(t={value:t}),t},getDistinctTags:function(e){e=e||{},e.client_id=e.client_id||i.getID();var n=this._customOperation({},t.CUSTOM_ENDPOINTS.DISTINCT_TAGS,t.CRUD.find,this.entityName);return u.setProp(n,u.PROPS.QUERY_PARAMS,e),u.setProp(n,u.PROPS.IS_WEBAPI,!0),this}};return l._reset=function(){l._filtersObj={},l.desiredOrder={}},l.init()}),n("annotations",["underscorenc","config","helpers","transportManager","client","queryAPI","info","tags","errorManager","requestManager","queryApiValidators"],function(e,t,n,r,i,a,o,s,u,d,l){var c={remove:{service:n.templatify("annotations(<%= id %>)")},create:{service:n.templatify("annotations")},update:{service:n.templatify("annotations(<%= id %>)")},find:{service:n.templatify("annotations2<%= tail %>")},findOne:{service:n.templatify("annotations2(<%= id %>)<%= tail %>")},findComments:{service:n.templatify("GetComments<%= tail %>")},findAllAnnotationsByText:{service:n.templatify("AllAnnotations<%= tail %>")},findCommentedAnnotations:{service:n.templatify("CommentedAnnotations<%= tail %>")},createImage:{service:n.templatify(t.ACTION_STORAGE_UPLOAD_URL)},findImage:{service:n.templatify(t.ACTION_DOWNLOAD_GET_URL+"<%= tail %><%= id %>")},updateImage:{service:n.templatify(t.ACTION_UPDATE_URL+"<%= id %>")},removeImage:{service:n.templatify(t.ACTION_DELETE_URL+"<%= id %>")},MXGetAnnotationsByStudent:{service:n.templatify("GetAnnotationsByStudent<%= tail %>")},MXGetTeacherCommentsAsStudent:{service:n.templatify("Annotation/Comments<%= tail %>")},MXMarkInteractiveNoteAsRead:{service:n.templatify("Annotation/InteractiveNoteMarkAsRead<%= tail %>")},MXMarkTeacherCommentAsRead:{service:n.templatify("annotation/TeacherCommentMarkAsRead<%= tail %>")}},f={entityName:"Annotations",_defaultTransport:r.use(t.TRANSPORT_NAMES.ODATA),_transports:{},_additionalActions:{create:function(t){if(i.isSet())if(e.isArray(t)){var n=i.getID();
e.each(t,function(t){e.isUndefined(t)||(t.created_by_tool_id=n)})}else t.created_by_tool_id=i.getID()}},entityInfo:{AnnotationTypes:t.DEFAULTS.AnnotationTypes},_entityRunActions:function(){this._processVisibilityUpdate()},_request:{},_urls:c,_supportedUploadFileTypes:["svg","png","json"],_annotationVisibility:void 0,init:function(){return e.defaults(this,a),e.extend(this,o),this},_mapFields:function(e){e.$visibility&&(e.visibility_id=i.convertNamesToID(e.$visibility),delete e.$visibility),!e.currentVisibilityId&&0!==e.currentVisibilityId||!e.visibilityInclude&&!e.visibilityExclude||(e.visibility_id=i.updateVisibilityIdByNames({currentVisibilityId:e.currentVisibilityId,includeClients:e.visibilityInclude,excludeClients:e.visibilityExclude}),delete e.currentVisibilityId,delete e.visibilityInclude,delete e.visibilityExclude)},_mapFilters:function(r){if(!e.isUndefined(r.$visibility)){if(e.isArray(r.$visibility)){var a=e.some(r.$visibility,function(t){return!e.isString(t)});a&&u.throwError("API_ERR_QUERY_API_3",[this.entityName,e.keys(this._filtersObj),"","string","of incorrect type"])}else e.isString(r.$visibility)||u.throwError("API_ERR_QUERY_API_3",[this.entityName,e.keys(this._filtersObj),"","string",n.toType(r.$visibility)]);var o={},s=d.getLastIdx();o[t.QUERY_PARAMS.visibility_id]=i.convertNamesToVisibilityIdsForGet(r.$visibility);for(var l=0;s>=l;l++)d.setProp(l,d.PROPS.QUERY_PARAMS,o);delete r.$visibility}if(!e.isUndefined(r.$client)){for(e.isString(r.$client)||u.throwError("API_ERR_QUERY_API_3",[this.entityName,e.keys(this._filtersObj),"","string",n.toType(r.$client)]),o={},s=d.getLastIdx(),o.created_by_tool_id=i.convertNamesToID(r.$client),l=0;s>=l;l++)d.setProp(l,d.PROPS.FILTERS,o);delete r.$client}},_parseTypeIds:function(n){if(n){var r=e.findWhere(t.SETTINGS.serviceSettingsStatuses,{name:"AnnotationTypes"});if(r.received=!0,n.length&&e.isArray(n)){r.correctFormat=!0;var i=[];e.each(n,function(t){e.isUndefined(t.description)||e.isUndefined(t.annotation_type_id)||i.push({id:t.annotation_type_id,name:t.description})}),e.size(i)>0&&(e.isEqual(i,t.DEFAULTS.AnnotationTypes)&&(r.upToDate=!0),t.SETTINGS.AnnotationTypes=i)}else t.SETTINGS.AnnotationTypes=t.DEFAULTS.AnnotationTypes}},tags:function(r){var i=this,a="tags()";return e.isNullUndef(r)?this:(e.isObjectNotArray(r)||e.isString(r)||e.isArrayOf(r,e.isObjectNotArray,e.isString)||u.throwError("API_ERR_QUERY_API_3",[i.entityName,"",a,"string or array of strings representing tag names or object or array of objects representing tag objects",n.toType(r)]),d.getProp(0,d.PROPS.IS_MAIN)!==!0&&u.throwError("API_ERR_QUERY_API_6",[i.entityName,a,"annotations"]),d.isCreate(0)||u.throwError("API_ERR_QUERY_API_5",[i.entityName,a,"create"]),r=s.tagNamesToValues(r),s._additionalActions.create&&this._additionalActions.create(r),r=e.isObjectNotArray(r)?[r]:r,e.each(r,function(n){e.isUndefined(n)||e.isUndefined(n[t.SETTINGS.Metadata.Tag.navigationProperties.Tag_annotation_Source.field])||u.throwError("API_ERR_QUERY_API_7",["Tags",t.SETTINGS.Metadata.Tag.navigationProperties.Tag_annotation_Source.field,n[t.SETTINGS.Metadata.Tag.navigationProperties.Tag_annotation_Source.field],a]);var o=d.getProp(0,d.PROPS.FIELDS_VALUES).content_id;e.each(r,function(e){e.content_id=o}),s._validateFieldsValues(n);var c=d.createSub(t.CRUD.create,!1,t.COLLECTIONS.tags.nameUppercase);d.setProp(c,d.PROPS.FIELDS_VALUES,n),d.setProp(c,d.PROPS.FOREIGN_KEY_REF,t.SETTINGS.Metadata.Tag.navigationProperties.Tag_annotation_Source),d.setProp(c,d.PROPS.BASE_URL,s._getBaseURL(t.CRUD.create)),l.validateMutuallyExclusiveMethods(i.entityName,t.CONFLICTED_METHODS.create.tags.name,t.CRUD.create),d.setProp(c,d.PROPS.CONFLICTING_METHOD,t.CONFLICTED_METHODS.create.tags.name)}),this)},forVisibility:function(t){return d.isUpdate(d.getLastIdx())||u.throwError("API_ERR_QUERY_API_5",[this.entityName,"forVisibility","update"]),e.isNumber(t)||u.throwError("API_ERR_QUERY_API_3",[this.entityName,"current_visibility_id","forVisibility","number",n.toType(t)]),e.isNullUndef(this._annotationVisibility)&&(this._annotationVisibility={}),this._annotationVisibility.currentVisibilityId=t,this},visibilityInclude:function(t){return d.isUpdate(d.getLastIdx())||u.throwError("API_ERR_QUERY_API_5",[this.entityName,"visibilityInclude","update"]),e.isUndefined(this._annotationVisibility)&&(this._annotationVisibility={}),this._annotationVisibility.includeClients=t,this},visibilityExclude:function(t){return d.isUpdate(d.getLastIdx())||u.throwError("API_ERR_QUERY_API_5",[this.entityName,"visibilityExclude","update"]),e.isUndefined(this._annotationVisibility)&&(this._annotationVisibility={}),this._annotationVisibility.excludeClients=t,this},_processVisibilityUpdate:function(){e.isNullUndef(this._annotationVisibility)||(d.getLen()>1&&(this._annotationVisibility=void 0,u.throwError("API_ERR_QUERY_API_6",[this.entityName,"'Visibility change","visibilities"])),(e.isUndefined(this._annotationVisibility.currentVisibilityId)||e.isUndefined(this._annotationVisibility.includeClients)&&e.isUndefined(this._annotationVisibility.excludeClients))&&(this._annotationVisibility=null,u.throwError("API_ERR_QUERY_API_4",[this.entityName,"forVisibility","visibilityInclude, visibilityExclude or both"])),d.setProp(d.getLastIdx(),d.PROPS.FIELDS_VALUES,{visibility_id:n.updateVisibilityIdByNames(this._annotationVisibility,this.entityName)}),this._annotationVisibility=null)},withTags:function(){var r,i="withTags()";return d.getLen()>0&&!d.isFindFamily(0)&&u.throwError("API_ERR_QUERY_API_5",[this.entityName,i,"find"]),r=d.getLastIdx(),n.isFunSwitchEnabled(arguments)&&e.isUndefined(d.getProp(r,d.PROPS.NEXT))&&d.updateSubs(d.PROPS.EXPAND_FOR,[t.COLLECTIONS.tags.expandName]),l.validateMutuallyExclusiveMethods(this.entityName,t.CONFLICTED_METHODS.find.withTags.name,t.CRUD.find),d.setProp(r,d.PROPS.CONFLICTING_METHOD,t.CONFLICTED_METHODS.find.withTags.name),this},withSharedOnly:function(){var r;if(d.getLen()>0&&!d.isFindFamily(0)&&u.throwError("API_ERR_QUERY_API_5",[this.entityName,t.EXPANDING_METHODS.withSharedOnly,"find"]),r=d.getLastIdx(),l.validateMutuallyExclusiveMethods(this.entityName,t.CONFLICTED_METHODS.find.withSharedOnly.name,t.CRUD.find),d.setProp(r,d.PROPS.CONFLICTING_METHOD,t.CONFLICTED_METHODS.find.withSharedOnly.name),n.isFunSwitchEnabled(arguments)&&e.isUndefined(d.getProp(r,d.PROPS.NEXT))){var i={};i[t.QUERY_PARAMS.option]=t.ANNO2_WITH_SHARED_ONLY,d.updateSubs(d.PROPS.EXPAND_FOR,[t.COLLECTIONS.annotationSharedWith.expandName]),d.updateSubs(d.PROPS.QUERY_PARAMS,i)}return this},withShared:function(){var r;if(d.getLen()>0&&!d.isFindFamily(0)&&u.throwError("API_ERR_QUERY_API_5",[this.entityName,t.EXPANDING_METHODS.withShared,"find"]),r=d.getLastIdx(),l.validateMutuallyExclusiveMethods(this.entityName,t.CONFLICTED_METHODS.find.withShared.name,t.CRUD.find),d.setProp(r,d.PROPS.CONFLICTING_METHOD,t.CONFLICTED_METHODS.find.withShared.name),n.isFunSwitchEnabled(arguments)&&e.isUndefined(d.getProp(r,d.PROPS.NEXT))){var i={};i[t.QUERY_PARAMS.option]=t.ANNO2_WITH_SHARED,d.updateSubs(d.PROPS.EXPAND_FOR,[t.COLLECTIONS.annotationSharedWith.expandName]),d.updateSubs(d.PROPS.QUERY_PARAMS,i)}return this},myNotSharedToOthers:function(){var r;if(d.getLen()>0&&!d.isFindFamily(0)&&u.throwError("API_ERR_QUERY_API_5",[this.entityName,t.EXPANDING_METHODS.myNotSharedToOthers,"find"]),r=d.getLastIdx(),l.validateMutuallyExclusiveMethods(this.entityName,t.CONFLICTED_METHODS.find.myNotSharedToOthers.name,t.CRUD.find),d.setProp(r,d.PROPS.CONFLICTING_METHOD,t.CONFLICTED_METHODS.find.myNotSharedToOthers.name),n.isFunSwitchEnabled(arguments)&&e.isUndefined(d.getProp(r,d.PROPS.NEXT))){var i={};i[t.QUERY_PARAMS.option]=t.ANNO2_MY_NOT_SHARED_TO_OTHERS,d.updateSubs(d.PROPS.QUERY_PARAMS,i)}return this},mySharedToOthers:function(){var r;if(d.getLen()>0&&!d.isFind(0)&&u.throwError("API_ERR_QUERY_API_5",[this.entityName,t.EXPANDING_METHODS.mySharedToOthers,"find"]),r=d.getLastIdx(),l.validateMutuallyExclusiveMethods(this.entityName,t.CONFLICTED_METHODS.find.mySharedToOthers.name,t.CRUD.find),d.setProp(r,d.PROPS.CONFLICTING_METHOD,t.CONFLICTED_METHODS.find.mySharedToOthers.name),n.isFunSwitchEnabled(arguments)&&e.isUndefined(d.getProp(r,d.PROPS.NEXT))){var i={};i[t.QUERY_PARAMS.option]=t.ANNO2_WITH_NO_SHARED,d.updateSubs(d.PROPS.EXPAND_FOR,[t.COLLECTIONS.annotationSharedWith.expandName]),d.updateSubs(d.PROPS.QUERY_PARAMS,i),e.extend(this._filtersObj,{$any:{shared_with:{id:{$gt:0}}}})}return this},withSharedAnnotations:function(){return d.getLen()>0&&!d.isFindFamily(0)&&u.throwError("API_ERR_QUERY_API_5",[this.entityName,t.EXPANDING_METHODS.withSharedAnnotations,"find"]),n.isFunSwitchEnabled(arguments)&&e.isUndefined(d.getProp(d.getLastIdx(),d.PROPS.NEXT))&&d.updateSubs(d.PROPS.EXPAND_FOR,[t.COLLECTIONS.annotationSharedWith.expandName]),this},findAllAnnotationsByText:function(r,i){var a=this,o=function(r,i){e.isString(r)||u.throwError("API_ERR_QUERY_API_3",[a.entityName,"text","findAllAnnotationsByText","string",n.toType(r)],i);var o=e.isNumber(i);a._customOperation(null,t.CUSTOM_ENDPOINTS.FIND_ALL_ANNOTATIONS_BY_TEXT,t.CRUD.find,null,o),r=e.wrapInto(r,"'");var s={};s[t.QUERY_PARAMS.text]=r,o?d.setProp(i,d.PROPS.QUERY_PARAMS,s):d.updateSubs(d.PROPS.QUERY_PARAMS,s)};return e.isArray(r)?e.each(r,function(e,t){o(e,t)}):o(r),this.filters(i),this},getInfo:function(){var n=this.info();return e.isUndefined(t.SETTINGS.FieldsSettableOnCreationOnly[this.entityName])||(n.FieldsSettableOnCreationOnly=t.SETTINGS.FieldsSettableOnCreationOnly[this.entityName]),e.isUndefined(t.SETTINGS.ReadOnlyFields[this.entityName])||(n.ReadOnlyFields=t.SETTINGS.ReadOnlyFields[this.entityName]),e.isUndefined(t.SETTINGS.RequiredFields[this.entityName])||(n.REQUIRED_FIELDS=t.SETTINGS.RequiredFields[this.entityName]),e.isUndefined(t.SETTINGS.AnnotationTypes)||(n.AnnotationTypes=t.SETTINGS.AnnotationTypes),n.SETTINGS_SOURCE=t.FORCE_DEFAULT_SERVICE_SETTINGS?"client_defaults":"service",n},childAnnotations:function(r){var i=this,a="childAnnotations()";return e.isNullUndef(r)?this:(e.isObjectNotArray(r)||e.isArrayOf(r,e.isObjectNotArray)||u.throwError("API_ERR_QUERY_API_3",[i.entityName,"",a,"object or array of objects",n.toType(r)]),d.getProp(0,d.PROPS.IS_MAIN)!==!0&&u.throwError("API_ERR_QUERY_API_6",[this.entityName,a,"annotations"]),d.isCreate(0)||u.throwError("API_ERR_QUERY_API_5",[i.entityName,a,"create"]),this._additionalActions.create&&this._additionalActions.create(r),r=e.isObjectNotArray(r)?[r]:r,e.each(r,function(n){e.isUndefined(n)||e.isUndefined(n[t.SETTINGS.Metadata.Annotation.navigationProperties.Annotation_parent_Source.field])||u.throwError("API_ERR_QUERY_API_7",[i.entityName,t.SETTINGS.Metadata.Annotation.navigationProperties.Annotation_parent_Source.field,n[t.SETTINGS.Metadata.Annotation.navigationProperties.Annotation_parent_Source.field],a]),i._validateFieldsValues(n);var r=d.createSub(t.CRUD.create,!1,t.COLLECTIONS.annotations.nameUppercase);l.validateMutuallyExclusiveMethods(i.entityName,t.CONFLICTED_METHODS.create.childAnnotations.name,t.CRUD.create),d.setProp(r,d.PROPS.CONFLICTING_METHOD,t.CONFLICTED_METHODS.create.childAnnotations.name),d.setProp(r,d.PROPS.FIELDS_VALUES,n),d.setProp(r,d.PROPS.FOREIGN_KEY_REF,t.SETTINGS.Metadata.Annotation.navigationProperties.Annotation_parent_Source),d.setProp(r,d.PROPS.BASE_URL,i._getBaseURL(t.CRUD.create))}),this)},findComments:function(r){return e.isObjectNotArray(r)||e.isUndefined(r)||e.isArrayOf(r,e.isObject)||u.throwError("API_ERR_QUERY_API_3",[this.entityName,"","findComments","object, array of objects or undefined",n.toType(r)]),this._customOperation(r,t.CUSTOM_ENDPOINTS.FIND_COMMENTS,t.CRUD.find),this},forTags:function(t){var r=this,i="forTags",a=function(i,a){e.isString(i)||e.isArrayOfStrings(i)||u.throwError("API_ERR_QUERY_API_3",["Annotations","tags","forTags","string or array of strings",n.toType(i)],a),r._validateFind("forTags"),e.isNumber(a)?d.setProp(a,d.PROPS.FILTERS,{$any:{tags:{value:t}}}):d.updateSubs(d.PROPS.FILTERS,{$any:{tags:{value:t}}})};return e.isArrayOf(t,e.isArray,e.isNull)?(l.validateBatchGetItemsNumber(t,i),e.each(t,function(e,t){a(e,t)})):a(t),this.withTags()},getCountForContainers:function(r){var i=this;return e.isNumber(r)||e.isArrayOf(r,e.isNumber)||u.throwError("API_ERR_QUERY_API_3",["Annotations","containerIds","getCountForContainers","number or array of numbers",n.toType(r)]),r=e.isNumber(r)?[r]:r,e.each(r,function(e){var r={};r[t.COLLECTIONS.containers.expandName+"/parent_id"]=e;var a={$or:[{container_id:e},r]},o=d.createSub(t.CRUD.find,!0,t.COLLECTIONS.annotations.nameUppercase);d.setProp(o,d.PROPS.EXPAND_FOR,[t.COLLECTIONS.containers.expandName]),d.setProp(o,d.PROPS.BASE_URL,i._getBaseURL(t.CRUD.find)),d.setProp(o,d.PROPS.FILTERS,a),d.setProp(d.getLastIdx(),d.PROPS.LIMIT_COUNT,0),d.setProp(o,d.PROPS.INLINE_COUNT,n.isFunSwitchEnabled(arguments))}),this},forContainer:function(r){var i=this,a="forContainer",o=t.COLLECTIONS.containers.expandName,s=function(t,a){e.isNumber(t)||u.throwError("API_ERR_QUERY_API_3",[i.entityName,"id","forContainer","number",n.toType(r)],a),i._validateFind("forContainer"),e.isNumber(a)?(i._filtersObj[a].$sub||(i._filtersObj[a].$sub={}),i._filtersObj[a].$sub[o]={id:t}):(i._filtersObj.$sub||(i._filtersObj.$sub={}),i._filtersObj.$sub[o]={id:r})};return e.isArray(r)?e.each(r,function(t,n){l.validateBatchGetItemsNumber(r,a),e.isNull(t)||s(t,n)}):s(r),this},withChildContainers:function(){if(!n.isFunSwitchEnabled(arguments))return this;var e=t.COLLECTIONS.containers.expandName;this._filtersObj&&this._filtersObj.$sub&&this._filtersObj.$sub[e]&&this._filtersObj.$sub[e].id||u.throwError("API_ERR_QUERY_API_14",["withChildContainers","forContainer"]);var r=this._filtersObj.$sub[e].id;return this._filtersObj.$sub[e]={$or:[{id:r},{parent_id:r}]},this},findCommentedAnnotations:function(r,i){if(e.isString(i)||e.isUndefined(i)||u.throwError("API_ERR_QUERY_API_3",[this.entityName,"findText","findCommentedAnnotations","string",n.toType(i)]),e.isObjectNotArray(r)||e.isUndefined(r)||u.throwError("API_ERR_QUERY_API_3",[this.entityName,"","findCommentedAnnotations","object or undefined",n.toType(r)]),this._customOperation(r,t.CUSTOM_ENDPOINTS.FIND_COMMENTED_ANNOTATIONS,t.CRUD.find),e.isString(i)&&""!==i.trim()){i=e.wrapInto(i,"'");var a={};a[t.QUERY_PARAMS.text]=i,d.setProp(0,d.PROPS.QUERY_PARAMS,a)}return this},createImage:function(r,i){if(!n.isFunSwitchEnabled(arguments))return this;l.doInitCheck();var a=this,o="createImage()",s=/data:image\/png;base64,/;e.isNullUndef(r)&&u.throwError("API_ERR_QUERY_API_3",[this.entityName,"fieldValues",o,"object","empty"]),e.isObjectNotArray(r)||u.throwError("API_ERR_QUERY_API_3",[this.entityName,"fieldValues",o,"object",n.toType(r)]),e.isNullUndef(i)&&u.throwError("API_ERR_QUERY_API_3",[this.entityName,"base64image",o,"base64 encoded image","empty"]),s.test(i)||u.throwError("API_ERR_QUERY_API_3",[this.entityName,"base64image",o,"base64 encoded image",n.toType(i)]),a._additionalActions.create&&a._additionalActions.create(r),a._validateFieldsValues(r),a._validateNoRequestsCreated("create"),a._customOperation(r,t.CUSTOM_ENDPOINTS.CREATE_IMAGE,t.CRUD.create);var c=d.getLastIdx();return l.validateMutuallyExclusiveMethods(a.entityName,t.CONFLICTED_METHODS.create.createImage.name,t.CRUD.create),d.setProp(c,d.PROPS.CONFLICTING_METHOD,t.CONFLICTED_METHODS.create.createImage.name),d.setProp(c,d.PROPS.IS_WEBAPI,!0),d.setProp(c,d.PROPS.IS_CUSTOM_HEAD,!0),d.setProp(c,d.PROPS.BASE_URL,a._getBaseURL(t.CUSTOM_ENDPOINTS.CREATE_IMAGE,!0)),d.setProp(c,d.PROPS.FIELDS_VALUES,r),d.setProp(c,d.PROPS.BASE_64_IMAGE,i),d.setProp(c,d.PROPS.FILE_NAME,"canvas_image.png"),a},createWithFile:function(r,i,a){var o=i.split(".").pop();l.doInitCheck();var s=this,c="createWithFile()",f=/data:image\/png;base64,/;if(e.isNullUndef(r)&&u.throwError("API_ERR_QUERY_API_3",[this.entityName,"fieldValues",c,"object","empty"]),e.isObjectNotArray(r)||u.throwError("API_ERR_QUERY_API_3",[this.entityName,"fieldValues",c,"object",n.toType(r)]),e.isNullUndef(a)&&u.throwError("API_ERR_QUERY_API_3",[this.entityName,"base64image",c,"base64 encoded image","empty"]),this._supportedUploadFileTypes.indexOf(o)<0)throw new Error(o+" is not supported");"png"!==o||f.test(a)||u.throwError("API_ERR_QUERY_API_3",[this.entityName,"base64image",c,"base64 encoded image",n.toType(base64image)]),s._additionalActions.create&&s._additionalActions.create(r),s._validateFieldsValues(r),s._validateNoRequestsCreated("create"),s._customOperation(r,t.CUSTOM_ENDPOINTS.CREATE_IMAGE,t.CRUD.create);var p=d.getLastIdx();return l.validateMutuallyExclusiveMethods(s.entityName,t.CONFLICTED_METHODS.create.createWithFile.name,t.CRUD.create),d.setProp(p,d.PROPS.CONFLICTING_METHOD,t.CONFLICTED_METHODS.create.createWithFile.name),d.setProp(p,d.PROPS.IS_WEBAPI,!0),d.setProp(p,d.PROPS.IS_CUSTOM_HEAD,!0),d.setProp(p,d.PROPS.BASE_URL,s._getBaseURL(t.CUSTOM_ENDPOINTS.CREATE_IMAGE,!0)),d.setProp(p,d.PROPS.FIELDS_VALUES,r),d.setProp(p,d.PROPS.BASE_64_IMAGE,a),d.setProp(p,d.PROPS.FILE_NAME,i),s},getFileUrl:function(r){var i="getFileUrl()";e.isNullUndef(r)&&u.throwError("API_ERR_QUERY_API_3",[this.entityName,"annotation_id",i,"number","empty"]),e.isNumber(r)||u.throwError("API_ERR_QUERY_API_3",[this.entityName,"annotation_id",i,"number",n.toType(r)]),this._customOperation(r,t.CUSTOM_ENDPOINTS.FIND_IMAGE,t.CRUD.findOne),l.validateMutuallyExclusiveMethods(this.entityName,t.CONFLICTED_METHODS.find.getFileUrl.name,t.CRUD.find);var a=d.getLastIdx();return d.setProp(a,d.PROPS.CONFLICTING_METHOD,t.CONFLICTED_METHODS.find.getFileUrl.name),d.setProp(a,d.PROPS.IS_WEBAPI,!0),d.setProp(a,d.PROPS.ID,r),this},updateWithFile:function(r,i,a,o){var s=a.split(".").pop(),l=this,c="updateWithFile()",f=/data:image\/png;base64,/;if(e.isNullUndef(o)&&u.throwError("API_ERR_QUERY_API_3",[this.entityName,"base64image",c,"base64 encoded image","empty"]),"png"!==s||f.test(o)||u.throwError("API_ERR_QUERY_API_3",[this.entityName,"base64image",c,"base64 encoded image",n.toType(o)]),this._supportedUploadFileTypes.indexOf(s)<0)throw new Error(s+" is not supported");l._additionalActions.update&&l._additionalActions.update(i),l._validateNoRequestsCreated("update"),l._customOperation(r,t.CUSTOM_ENDPOINTS.UPDATE_IMAGE,t.CRUD.update);var p=d.getLastIdx();return d.setProp(p,d.PROPS.IS_WEBAPI,!0),d.setProp(p,d.PROPS.REQ_TYPE,t.REQ_TYPE_PUT),d.setProp(p,d.PROPS.IS_CUSTOM_HEAD,!0),d.setProp(p,d.PROPS.FIELDS_VALUES,i),d.setProp(p,d.PROPS.BASE_URL,l._getBaseURL(t.CUSTOM_ENDPOINTS.UPDATE_IMAGE)),d.setProp(p,d.PROPS.ID,r),d.setProp(p,d.PROPS.BASE_64_IMAGE,o),d.setProp(p,d.PROPS.FILE_NAME,a),l},removeWithFile:function(r){var i="removeWithFile()";e.isNullUndef(r)&&u.throwError("API_ERR_QUERY_API_3",[this.entityName,"annotation_id",i,"number","empty"]),e.isNumber(r)||u.throwError("API_ERR_QUERY_API_3",[this.entityName,"annotation_id",i,"number",n.toType(r)]),this._customOperation(r,t.CUSTOM_ENDPOINTS.REMOVE_IMAGE,t.CRUD.remove);var a=d.getLastIdx();return d.setProp(a,d.PROPS.IS_WEBAPI,!0),d.setProp(a,d.PROPS.ID,r),this},findImage:function(r){var i="findImage()";e.isNullUndef(r)&&u.throwError("API_ERR_QUERY_API_3",[this.entityName,"annotation_id",i,"number","empty"]),e.isNumber(r)||u.throwError("API_ERR_QUERY_API_3",[this.entityName,"annotation_id",i,"number",n.toType(r)]),this._customOperation(r,t.CUSTOM_ENDPOINTS.FIND_IMAGE,t.CRUD.findOne),l.validateMutuallyExclusiveMethods(this.entityName,t.CONFLICTED_METHODS.find.findImage.name,t.CRUD.find);var a=d.getLastIdx();return d.setProp(a,d.PROPS.CONFLICTING_METHOD,t.CONFLICTED_METHODS.find.findImage.name),d.setProp(a,d.PROPS.IS_WEBAPI,!0),d.setProp(a,d.PROPS.ID,r),this},updateImage:function(r,i,a){var o=this,s="updateImage()",l=/data:image\/png;base64,/;e.isNullUndef(a)&&u.throwError("API_ERR_QUERY_API_3",[this.entityName,"base64image",s,"base64 encoded image","empty"]),l.test(a)||u.throwError("API_ERR_QUERY_API_3",[this.entityName,"base64image",s,"base64 encoded image",n.toType(a)]),o._additionalActions.update&&o._additionalActions.update(i),o._validateNoRequestsCreated("update"),o._customOperation(r,t.CUSTOM_ENDPOINTS.UPDATE_IMAGE,t.CRUD.update);var c=d.getLastIdx();return d.setProp(c,d.PROPS.IS_WEBAPI,!0),d.setProp(c,d.PROPS.REQ_TYPE,t.REQ_TYPE_PUT),d.setProp(c,d.PROPS.IS_CUSTOM_HEAD,!0),d.setProp(c,d.PROPS.FIELDS_VALUES,i),d.setProp(c,d.PROPS.BASE_URL,o._getBaseURL(t.CUSTOM_ENDPOINTS.UPDATE_IMAGE)),d.setProp(c,d.PROPS.ID,r),d.setProp(c,d.PROPS.BASE_64_IMAGE,a),d.setProp(c,d.PROPS.FILE_NAME,"canvas_image.png"),o},removeImage:function(r){var i="removeImage()";e.isNullUndef(r)&&u.throwError("API_ERR_QUERY_API_3",[this.entityName,"annotation_id",i,"number","empty"]),e.isNumber(r)||u.throwError("API_ERR_QUERY_API_3",[this.entityName,"annotation_id",i,"number",n.toType(r)]),this._customOperation(r,t.CUSTOM_ENDPOINTS.REMOVE_IMAGE,t.CRUD.remove);var a=d.getLastIdx();return d.setProp(a,d.PROPS.IS_WEBAPI,!0),d.setProp(a,d.PROPS.ID,r),this}};return f._reset=function(){f._filtersObj={},f.desiredOrder={},f._annotationVisibility=null},f.init()}),n("containers",["underscorenc","config","helpers","transportManager","client","queryAPI","info","annotations","errorManager","requestManager"],function(e,t,n,r,i,a,o,s,u,d){var l={remove:{service:n.templatify("containers(<%= id %>)")},create:{service:n.templatify("containers")},update:{service:n.templatify("containers(<%= id %>)")},find:{service:n.templatify("containers<%= tail %>")},findOne:{service:n.templatify("containers(<%= id %>)<%= tail %>")},getSubmitted:{service:n.templatify("SubmittedFolders<%= tail %>")}},c={entityName:"Containers",_defaultTransport:r.use(t.TRANSPORT_NAMES.ODATA),_transports:{},_request:{},_additionalActions:{},_urls:l,init:function(){return e.defaults(this,a),e.extend(this,o),this},childContainers:function(r){var i=this,a="childContainers()";return e.isNullUndef(r)?this:(e.isObjectNotArray(r)||e.isArrayOf(r,e.isObjectNotArray)||u.throwError("API_ERR_QUERY_API_3",[i.entityName,"",a,"object or array of objects",n.toType(r)]),d.getProp(0,d.PROPS.IS_MAIN)!==!0&&u.throwError("API_ERR_QUERY_API_6",[this.entityName,a,"annotations"]),d.isCreate(0)||u.throwError("API_ERR_QUERY_API_5",[i.entityName,a,"create"]),this._additionalActions.create&&this._additionalActions.create(r),r=e.isObjectNotArray(r)?[r]:r,e.each(r,function(n){e.isUndefined(n)||e.isUndefined(n[t.SETTINGS.Metadata.Container.navigationProperties.Container_parent_Source.field])||u.throwError("API_ERR_QUERY_API_7",[i.entityName,t.SETTINGS.Metadata.Container.navigationProperties.Container_parent_Source.field,n[t.SETTINGS.Metadata.Container.navigationProperties.Container_parent_Source.field],a]),i._validateFieldsValues(n);var r=d.createSub(t.CRUD.create,!1,t.COLLECTIONS.containers.nameUppercase);d.setProp(r,d.PROPS.FIELDS_VALUES,n),d.setProp(r,d.PROPS.FOREIGN_KEY_REF,t.SETTINGS.Metadata.Container.navigationProperties.Container_parent_Source),d.setProp(r,d.PROPS.BASE_URL,i._getBaseURL(t.CRUD.create))}),this)},submitTo:function(r){if(!n.isFunSwitchEnabled(arguments))return this;e.isString(r)||e.isNull(r)||u.throwError("API_ERR_QUERY_API_3",[this.entityName,"userId","submitTo","string",n.toType(r)]),d.isUpdate(d.getLastIdx())||u.throwError("API_ERR_QUERY_API_5",[this.entityName,"submitTo","update"]),0!==d.getSubIndexesMatchingFilter({queryParams:[t.QUERY_PARAMS.submittedForUserId]}).length&&u.throwError("API_ERR_QUERY_API_16",["submitTo"]);var i={};return i[t.QUERY_PARAMS.submittedForUserId]=r,d.setProp(0,d.PROPS.QUERY_PARAMS,i),this},getSubmitted:function(r){var i=this,a=function(r,a){e.isString(r)||u.throwError("API_ERR_QUERY_API_3",[i.entityName,"classId","getSubmitted","string",n.toType(r),a]);var o=e.isNumber(a),s=i._customOperation({},t.CUSTOM_ENDPOINTS.GET_SUBMITTED,t.CRUD.find,null,o),l={};l[t.QUERY_PARAMS.classId]=r,o?(d.setProp(s,d.PROPS.QUERY_PARAMS,l),d.setProp(s,d.PROPS.IS_WEBAPI,!0)):(d.updateSubs(d.PROPS.QUERY_PARAMS,l),d.updateSubs(d.PROPS.IS_WEBAPI,!0))};return e.isNonEmptyArray(r)?e.each(r,function(e,t){a(e,t)}):a(r),this},createAnnotation:function(r){if(!n.isFunSwitchEnabled(arguments))return this;var i=this,a="createAnnotation()";d.getProp(0,d.PROPS.IS_MAIN)!==!0&&u.throwError("API_ERR_QUERY_API_6",[i.entityName,a,t.COLLECTIONS.containers.name]),d.isUpdate(0)||u.throwError("API_ERR_QUERY_API_5",[i.entityName,a,"update"]),e.isObjectNotArray(r)||u.throwError("API_ERR_QUERY_API_3",[i.entityName,"",a,"object",n.toType(r)]),s._additionalActions.create&&s._additionalActions.create(r),e.isUndefined(r)||e.isUndefined(r.container_id)||u.throwError("API_ERR_QUERY_API_7",[s.entityName,t.QUERY_PARAMS.containerId,r.container_id,a]),r.container_id=d.getProp(0,d.PROPS.ID),s._validateFieldsValues(r);var o=d.createSub(t.CRUD.create,!1,t.COLLECTIONS.annotations.nameUppercase);return d.setProp(o,d.PROPS.FIELDS_VALUES,r),d.setProp(o,d.PROPS.BASE_URL,s._getBaseURL(t.CRUD.create)),this.forceOrder(o),this},updateAnnotation:function(r,i){if(!n.isFunSwitchEnabled(arguments))return this;var a=this,o="updateAnnotation()";e.isUndefined()&&e.isNumber(r)||u.throwError("API_ERR_QUERY_API_3",[a.entityName,"id",o,"number",n.toType(r)]),d.getProp(0,d.PROPS.IS_MAIN)!==!0&&u.throwError("API_ERR_QUERY_API_6",[a.entityName,o,t.COLLECTIONS.containers.name]),d.isUpdate(0)||u.throwError("API_ERR_QUERY_API_5",[a.entityName,o,"update"]),e.isObjectNotArray(i)||u.throwError("API_ERR_QUERY_API_3",[a.entityName,"",o,"object",n.toType(i)]);var l=d.createSub(t.CRUD.update,!1,t.COLLECTIONS.annotations.nameUppercase);return d.setProp(l,d.PROPS.ID,r),d.setProp(l,d.PROPS.FIELDS_VALUES,i),d.setProp(l,d.PROPS.BASE_URL,s._getBaseURL(t.CRUD.update)),this.forceOrder(l),this},getInfo:function(){var n=this.info();return e.isUndefined(t.SETTINGS.FieldsSettableOnCreationOnly[this.entityName])||(n.FieldsSettableOnCreationOnly=t.SETTINGS.FieldsSettableOnCreationOnly[this.entityName]),e.isUndefined(t.SETTINGS.ReadOnlyFields[this.entityName])||(n.ReadOnlyFields=t.SETTINGS.ReadOnlyFields[this.entityName]),e.isUndefined(t.SETTINGS.RequiredFields[this.entityName])||(n.REQUIRED_FIELDS=t.SETTINGS.RequiredFields[this.entityName]),n.SETTINGS_SOURCE=t.FORCE_DEFAULT_SERVICE_SETTINGS?"client_defaults":"service",n}};return c._reset=function(){c._filtersObj={},c.desiredOrder={}},c.init()}),n("any",["underscorenc","config","helpers","transportManager","client","queryAPI","info","errorManager"],function(e,t,n,r,i,a,o,s){var u="",d={remove:{service:function(e){return u+"("+e.id+")"}},create:{service:function(){return u}},update:{service:function(e){return u+"("+e.id+")"}},find:{service:function(e){return u+"/"+e.tail}},findOne:{service:function(e){return u+"("+e.id+")/"+e.tail}}},l={entityName:"Any",_defaultTransport:r.use(t.TRANSPORT_NAMES.ODATA),_transports:{},_request:{},_additionalActions:{},_urls:d,init:function(){return e.defaults(this,a),e.extend(this,o),this.collection(""),this},collection:function(e){return u=e||"",this},run:function(){a.run.apply(this),u=""},_entityLevelCheck:function(){""===u&&s.throwError("API_ERR_ANY_1",null)}};return l.init()}),n("annotationSharedWith",["underscorenc","config","helpers","transportManager","client","queryAPI","info","errorManager","requestManager"],function(e,t,n,r,i,a,o,s,u){var d={remove:{service:n.templatify("annotation_shared_with(<%= id %>)")},create:{service:n.templatify("annotation_shared_with")},find:{service:n.templatify("annotation_shared_with<%= tail %>")},findOne:{service:n.templatify("tags(<%= id %>)<%= tail %>")},addUsersToAnnotation:{service:n.templatify("annotation_shared_with")}},l={entityName:"AnnotationSharedWith",_defaultTransport:r.use(t.TRANSPORT_NAMES.ODATA),_transports:{},_request:{},_additionalActions:{},_urls:d,init:function(){return e.defaults(this,a),e.extend(this,o),this},_getRequest:function(){return this._request},getInfo:function(){var n=this.info();return n&&n.description&&n.description[2]&&(n.description[2]="Allowed operations: [create,remove,find,findOne]"),e.isUndefined(t.SETTINGS.FieldsSettableOnCreationOnly[this.entityName])||(n.FieldsSettableOnCreationOnly=t.SETTINGS.FieldsSettableOnCreationOnly[this.entityName]),e.isUndefined(t.SETTINGS.ReadOnlyFields[this.entityName])||(n.ReadOnlyFields=t.SETTINGS.ReadOnlyFields[this.entityName]),e.isUndefined(t.SETTINGS.RequiredFields[this.entityName])||(n.REQUIRED_FIELDS=t.SETTINGS.RequiredFields[this.entityName]),n.SETTINGS_SOURCE=t.FORCE_DEFAULT_SERVICE_SETTINGS?"client_defaults":"service",n},addUsersToAnnotation:function(t,r){e.isNumber(t)||s.throwError("API_ERR_QUERY_API_3",[this.entityName,"annotationId","addUsersToAnnotation","number",n.toType(t)]),e.isString(r)||e.isArrayOfStrings(r)||s.throwError("API_ERR_QUERY_API_3",[this.entityName,"userIds","addUsersToAnnotation","string or array of strings",n.toType(r)]),r=e.isString(r)?[r]:r;var i=[];e.each(r,function(){i.push({annotation_id:t})});var a=this.create(i);return e.each(r,function(e,t){u.setProp(t,u.PROPS.QUERY_PARAMS,{user_ids:e})}),a}};return l._reset=function(){l._filtersObj={},l.desiredOrder={}},l.init()}),n("tinyPromise",[],function(){function e(){this._thens=[]}return e.prototype={then:function(e,t){this._thens.push({resolve:e,reject:t})},resolve:function(e){this._complete("resolve",e)},reject:function(e){this._complete("reject",e)},_complete:function(e,t){this.then="resolve"===e?function(e){e&&e(t)}:function(e,n){n&&n(t)},this.resolve=this.reject=function(){throw new Error("Promise already completed.")};for(var n,r=0;n=this._thens[r++];)n[e]&&n[e](t);delete this._thens}},e}),n("basicAPI",["underscorenc","config","helpers","client","transportManager","annotations","tags","containers","any","errorManager","resetManager","annotationSharedWith","tinyPromise"],function(e,t,n,r,i,a,o,s,u,d,l,c,f){var p={};p.reset=function(){try{l.resetLib()}catch(e){return"Reset failed."+e}return"Reset OK."},p.getCORS=function(){return t.CORS},p.setCORS=function(e){t.CORS=!!e,i.use(t.TRANSPORT_NAMES.ODATA).setCors()},p.getServerURL=function(){return t.SERVER_URL},p.setServerURL=function(e){t.SERVER_URL=e},p.getPostTunneling=function(){return t.USE_POST_TUNNELING},p.setPostTunneling=function(e){t.USE_POST_TUNNELING=e},p.getToken=function(){return t.TOKEN_AUTHN},p.setToken=function(r){e.isNullUndef(r)||e.isString(r)&&r.length?t.TOKEN_AUTHN=r:d.throwError("API_ERR_GENERAL_1",["","setToken","string",n.toType(r)])},p.getNextLinkDomainStripping=function(){return t.NEXT_LINK_DOMAIN_STRIPPING},p.setNextLinkDomainStripping=function(e){t.NEXT_LINK_DOMAIN_STRIPPING=e},p.getParseDates=function(){return t.DEFAULT_PARSE_DATE},p.setParseDates=function(e){t.DEFAULT_PARSE_DATE=e},p.setODataVersion=function(n){e.isString(n)&&(n=parseInt(n)),e.isNumber(n)&&!e.isNaN(n)&&(n=n.toFixed(1).toString()),!e.isNaN(n)||e.isBoolean(n)||e.isUndefined(n)||e.isNull(n)||e.isString(n)?t.FORCE_ODATA_VERSION=n?"2.0":void 0:d.throwError("API_ERR_GENERAL_1",["","setODataVersion",["true","numeric string","int number"].join(","),n])},p.getODataVersion=function(){return t.FORCE_ODATA_VERSION},p.setUseCasV2=function(e){t.USE_CAS_V2=e},p.getUseCasV2=function(){return t.USE_CAS_V2},p.getClientId=r.getID,p.setClientId=r.setID,p.getVersion=function(){return t.API_VERSION},p.getSuppressValidation=function(){return t.SUPPRESS_VALIDATION},p.setSuppressValidation=function(r){e.isBoolean(r)||d.throwError("API_ERR_GENERAL_1",["","setSuppressValidation","boolean",n.toType(r)]),t.SUPPRESS_VALIDATION=r},p.getContainerStatuses=function(){return t.SETTINGS.ContainerStatus},p.convertClientIdToClientNames=r.convertIDToNames,p.convertClientNamesToClientId=r.convertNamesToID,p.updateVisibilityIdByClientNames=r.updateVisibilityIdByNames,p.convertClientNamesToVisibilityIds=r.convertNamesToVisibilityIds;var _=!1;p.startKeepalive=function(e,n){!e&&d.throwError("API_ERR_AJAX_2",["requestURL","startKeepalive"]),_&&d.throwError("API_ERR_AJAX_3",["Keepalive","stopKeepalive"]),_=setInterval(function(){i.use(t.TRANSPORT_NAMES.AJAX).read({url:e,data:{},type:t.REQ_TYPE_GET},function(){},function(){})},n||t.PLATFORM_KEEPALIVE_DEFAULT_DELAY)
},p.stopKeepalive=function(){_&&(clearInterval(_),_=!1)},p.getSettingsStatus=function(){if(e.isEmpty(t.SETTINGS.serviceSettingsStatuses))throw"Error - Status not available";return t.SETTINGS.serviceSettingsStatuses};var h,m=function(u){function l(n,r){n=e.findWhere(t.SETTINGS.serviceSettingsStatuses,{name:n}),n[r]=!0}function p(){for(var n in t.DEFAULTS)t.DEFAULTS.hasOwnProperty(n)&&(t.SETTINGS[n]=t.DEFAULTS[n],t.SETTINGS.Source===t.SETTINGS_SOURCES.CLIENT_DEFAULTS?l(n,"unknown"):(t.FORCE_DEFAULT_SERVICE_SETTINGS=!0,l(n,"forced")));t.SETTINGS.serviceSettingsStatuses=e.indexBy(t.SETTINGS.serviceSettingsStatuses,function(e){return e.name}),a.setInfo(t.SETTINGS.Metadata.Annotation),o.setInfo(t.SETTINGS.Metadata.Tag),s.setInfo(t.SETTINGS.Metadata.Container),c.setInfo(t.SETTINGS.Metadata.AnnotationSharedWith)}t.SETTINGS.serviceSettingsStatuses=[],e.each(t.DEFAULTS,function(e,r){t.SETTINGS.serviceSettingsStatuses.push(new n.ServiceSettingsStatus(r))});var _=new f;e.isBoolean(u)||d.throwError("API_ERR_QUERY_API_3",["","forceDefaultServiceSettings","","boolean",n.toType(u)]);var h,m;return u&&u===!0?m=function(){p(),n.consoleLog("* Default service settings are forced in the init!")}:(m=function(i){if(i){var u=e.deepClone(i),d=function(e){t.SETTINGS.SETTINGS_SOURCE=t.SETTINGS_SOURCES.SERVICE_WITH_CLIENT_DEFAULTS,t.SETTINGS[e]=t.DEFAULTS[e]};i.Version&&e.isString(i.Version)&&(t.API_VERSION.service=i.Version),u=e.omit(u,e.union(t.SETTINGS.ExcludeNonServiceSettingsProperties,t.SETTINGS.ExcludeFromServiceSettingsParsing)),e.each(t.DEFAULTS,function(r,i){e.isUndefined(u[i])?d(i):(l(i,"received"),"AppSettings"===i&&(u[i]=u[i][0]),n.toType(u[i])===n.toType(t.DEFAULTS[i])?(l(i,"correctFormat"),e.isEqual(u[i],t.DEFAULTS[i])&&l(i,"upToDate"),t.SETTINGS[i]=u[i],t.SETTINGS.SETTINGS_SOURCE=t.SETTINGS_SOURCES.SERVICE):d(i)),t.SETTINGS.serviceSettingsStatuses=e.indexBy(t.SETTINGS.serviceSettingsStatuses,function(e){return e.name})}),r._parseClientIds(i.ClientTools),a._parseTypeIds(i.AnnotationTypes),t.SETTINGS.Metadata=n.parseMetadata(i.Metadata),e.each(t.SETTINGS.serviceSettingsStatuses,function(e,t){var r=e.received&&e.correctFormat&&e.upToDate?"+":"-";n.consoleLog(r+t+": ",e)})}else n.consoleLog("* Problem receiving service data. Using defaults!"),t.SETTINGS.SETTINGS_SOURCE=t.SETTINGS_SOURCES.CLIENT_DEFAULTS,p();a.setInfo(t.SETTINGS.Metadata.Annotation),o.setInfo(t.SETTINGS.Metadata.Tag),s.setInfo(t.SETTINGS.Metadata.Container),c.setInfo(t.SETTINGS.Metadata.AnnotationSharedWith)},h=function(e,t){return n.consoleLog("Error receiving service data: ",e),n.consoleLog("Error receiving service data (error additional data): ",t),n.consoleLog("* Problem receiving service data. Using defaults!"),p(),[e,t]}),u&&u===!0?_.resolve(m()):i.use(t.TRANSPORT_NAMES.AJAX).read({url:n.getRequestURL(t.SERVICE_APP_SETTINGS,!0),data:void 0,type:t.REQ_TYPE_GET,timeoutMS:t.REQUEST_TIMEOUT},function(e){_.resolve(m(e))},function(e,t){_.reject(h(e,t))}),_};return p.init=function(i,a,o){function s(){void 0!==h&&null!==h&&r.setID(h),p.setApiInitialized(!0)}this.restoreDefaults(),this.setServerURL(i.serverUrl||i.serverURL||t.INTERNAL_DEFAULTS.SERVER_URL),this.setPostTunneling(e.isUndefined(i.usePostTunneling)?t.INTERNAL_DEFAULTS.USE_POST_TUNNELING:i.usePostTunneling),this.setToken(i.token||t.INTERNAL_DEFAULTS.TOKEN_AUTHN),this.setODataVersion(i.forceODataVersion||t.INTERNAL_DEFAULTS.TOKEN_AUTHN),this.setCORS(e.isUndefined(i.cors)?t.INTERNAL_DEFAULTS.CORS:i.cors),this.setSuppressValidation(e.isUndefined(i.suppressValidation)?t.INTERNAL_DEFAULTS.SUPPRESS_VALIDATION:i.suppressValidation),this.setTimeout(e.isUndefined(i.requestTimeout)?t.INTERNAL_DEFAULTS.REQUEST_TIMEOUT:i.requestTimeout),this.setNextLinkDomainStripping(e.isUndefined(i.nextLinkDomainStripping)?t.INTERNAL_DEFAULTS.NEXT_LINK_DOMAIN_STRIPPING:i.nextLinkDomainStripping),this.setParseDates(e.isUndefined(i.parseDates)?t.INTERNAL_DEFAULTS.DEFAULT_PARSE_DATE:i.parseDates),this.setUseCasV2(i.casV2===!0),t.PLATFORM_KEEPALIVE_DEFAULT_DELAY=t.INTERNAL_DEFAULTS.PLATFORM_KEEPALIVE_DEFAULT_DELAY,h=i.clientId,a=a||i.successHandler,o=o||i.errorHandler;var u=m(i.forceDefaultServiceSettings||!1);u.then(function(){n.consoleLog("* Finished all init tasks."),s(),a&&a()},function(e){n.consoleLog("* Error * Some init tasks failed. Library uses defaults."),s(),o&&o(e[0],e[1])})},p.getApiInitialized=function(){return t.API_INITIALIZED},p.setApiInitialized=function(e){t.API_INITIALIZED=e},p.getTimeout=function(){return t.REQUEST_TIMEOUT},p.setTimeout=function(r){!r||e.isObject(r)||e.isNull(r)||e.isBoolean(r)||isNaN(r)||r%1!==0?d.throwError("API_ERR_GENERAL_1",["requestTimeout","setTimeout","numeric",n.toType(r)]):t.REQUEST_TIMEOUT=e.isString(r)?parseInt(r):r},p.getInfo=function(){var e={};return e.APP_SETTINGS=t.SETTINGS.AppSettings,e.CLIENT_IDS_LIST=t.SETTINGS.ClientTools,e.SETTINGS_SOURCE=t.SETTINGS.SETTINGS_SOURCE,e},p.restoreDefaults=function(){this.setCORS(t.INTERNAL_DEFAULTS.CORS),this.setServerURL(t.INTERNAL_DEFAULTS.SERVER_URL),this.setODataVersion(t.INTERNAL_DEFAULTS.FORCE_ODATA_VERSION),this.setSuppressValidation(t.INTERNAL_DEFAULTS.SUPPRESS_VALIDATION),this.setNextLinkDomainStripping(t.INTERNAL_DEFAULTS.NEXT_LINK_DOMAIN_STRIPPING),this.setPostTunneling(t.INTERNAL_DEFAULTS.USE_POST_TUNNELING),this.setTimeout(t.INTERNAL_DEFAULTS.REQUEST_TIMEOUT),this.setToken(t.INTERNAL_DEFAULTS.TOKEN_AUTHN),this.setClientId(t.INTERNAL_DEFAULTS.CLIENT_ID),this.setUseCasV2(t.INTERNAL_DEFAULTS.USE_CAS_V2)},p.getListOfConflictingMethods=function(n){e.isUndefined(n)&&d.throwError("API_ERR_QUERY_API_3",["","methodName","getListOfConflictingMethods","string","undefined"]);var r="unknownMethod";return e.each(e.keys(t.CONFLICTED_METHODS),function(i){e.has(t.CONFLICTED_METHODS[i],n)&&(r=t.CONFLICTED_METHODS[i][n].methods)}),r},p}),n("parser",["underscorenc"],function(e){function t(e){var t=e.len,n=i[e.com]||i.$equal;return function(e){return n(e.length,t)}}function n(t){var n=e.isArray(t.sp)?t.sp:[t.sp],r=i[t.com]||i.$in;return function(e){return r(e,n)}}var r={"function":e.isFunction,number:e.isNumber,array:e.isArray,object:e.isObject,string:e.isString,"boolean":e.isBoolean,undefined:e.isUndefined,"null":e.isNull},i={$gte:function(e,t){return e>=t},$gt:function(e,t){return e>t},$lte:function(e,t){return t>=e},$lt:function(e,t){return t>e},$equal:function(e,t){return e===t},$ne:function(e,t){return!(e===t)},$in:function(t,n){return e.isObject(t)?e.every(n,function(e){return!!(e in t)}):!1},$nin:function(t,n){return e.isObject(t)?e.every(n,function(e){return!(e in t)}):!1}},a={getConditionFunction:function(i){return e.isObject(i)?e.isUndefined(i.sp)?t(i):n(i):r[i]},getValue:function(t,n,r){return r=r||0,e.isObject(t)?n:n[r]}};return a}),n("annotationMaps",["underscorenc","config"],function(e,t){var n={};return n.deleteAnnotation=[t.NAMED_MAPS.error(),[t.NAMED_MAPS.success(),t.NAMED_MAPS.object()],{argIndex:0,p:"id",c:["number"]}],n.deleteAnnotations=[t.NAMED_MAPS.error(),[t.NAMED_MAPS.success(),t.NAMED_MAPS.object()],{argIndex:0,p:"annotationIdsList",c:["array"]}],n.updateAnnotation=[{argIndex:3,p:"errorHandler",c:[{len:4},"function"]},[{argIndex:2,p:"successHandler",c:["function"]},{argIndex:2,c:["object"]}],[{argIndex:1,p:"fieldsValues",c:["object"]},{argIndex:1,p:"fieldsValues",c:["null"],force:{}}],{argIndex:0,p:"id",c:["number"]}],n.createAnnotation=[{argIndex:2,p:"errorHandler",c:[{len:3},"function"]},[{argIndex:1,p:"successHandler",c:["function"]},{argIndex:1,c:["object"]}],{argIndex:0,p:"fieldsValues",c:["object"]}],n.getAnnotationsByTextString=[{argIndex:1,c:["object"]},{argIndex:0,p:"text",c:["string"]}],n.getAnnotationByID=[{argIndex:3,p:"errorHandler",c:[{len:4},"function"]},{argIndex:2,p:"successHandler",c:[{len:4},"function"]},[{argIndex:1,p:"fields",c:["array"]},{argIndex:1,c:["object"]}],{argIndex:0,p:"id",c:["number"]}],n.getAnnotations=[{argIndex:6,p:"errorHandler",c:[{len:7,com:"$gte"},"function"]},{argIndex:5,p:"successHandler",c:[{len:6,com:"$gte"},"function"]},{argIndex:4,p:"limitCount",c:[{len:5,com:"$gte"},"number"]},{argIndex:3,p:"limitFrom",c:[{len:4,com:"$gte"},"number"]},{argIndex:2,p:"orderBy",c:[{len:3,com:"$gte"},"array"]},{argIndex:1,p:"fields",c:[{len:2,com:"$gte"},"array"]},[{argIndex:0,p:"filters",c:[{len:1,com:"$gt"},"object"]},{argIndex:0,c:["object"]}]],n.getAnnotationsCount=[{argIndex:2,p:"errorHandler",c:[{len:3,com:"$gte"},"function"]},{argIndex:1,p:"successHandler",c:[{len:2,com:"$gte"},"function"]},[{argIndex:0,p:"filters",c:[{len:1,com:"$gt"},"object"]},{argIndex:0,c:["object"]}]],n}),n("tagsMaps",[],function(){var e={};return e.createTagsForAnnotationId=[{argIndex:4,p:"errorHandler",c:[{len:5},"function"]},[{argIndex:3,p:"successHandler",c:[{len:4,com:"$gte"},"function"]},{argIndex:3,c:[{len:4,com:"$gte"},"object"]}],{argIndex:0,p:"annotationId",c:["number"]},{argIndex:1,p:"contentId",c:[]},{argIndex:2,p:"tagsList",c:["array"]}],e.getTagsByAnnotationId=[{argIndex:5,p:"errorHandler",c:[{len:6,com:"$gte"},"function"]},{argIndex:4,p:"successHandler",c:[{len:5,com:"$gte"},"function"]},{argIndex:3,p:"limitCount",c:[{len:4,com:"$gte"},"number"]},{argIndex:2,p:"limitFrom",c:[{len:3,com:"$gte"},"number"]},[{argIndex:1,p:"orderBy",c:[{len:2,com:"$gte"},"array"]},{argIndex:1,c:["object"]}],{argIndex:0,p:"annotationId",c:["number"]}],e.createAnnotationAndTags=[{argIndex:3,p:"errorHandler",c:[{len:4},"function"]},[{argIndex:2,p:"successHandler",c:[{len:3,com:"$gte"},"function"]},{argIndex:2,c:[{len:3,com:"$gte"},"object"]}],{argIndex:0,p:"annotationFieldsValues",c:["object"]},{argIndex:1,p:"tagsList",c:["array"]}],e.deleteTags=[{argIndex:2,p:"errorHandler",c:[{len:3},"function"]},[{argIndex:1,p:"successHandler",c:[{len:1,com:"$gte"},"function"]},{argIndex:1,c:[{len:1,com:"$gte"},"object"]}],{argIndex:0,p:"tagIdsList",c:["array"]}],e.getAnnotationsByTag=[{argIndex:1,c:["object"]},{argIndex:0,p:"tag",c:["string"]}],e.getTagsByContentId=[{argIndex:5,p:["errorHandler"],c:["function"]},{argIndex:4,p:["successHandler"],c:["function"]},{argIndex:3,p:["limitCount"],c:["number"]},{argIndex:2,p:["limitFrom"],c:["number"]},{argIndex:1,p:["orderBy"],c:["string"]},{argIndex:0,p:["contentId"],c:[]}],e}),n("argumentsMapper",["underscorenc","helpers","config","parser","annotationMaps","tagsMaps","errorManager"],function(e,t,n,r,i,a,o){var s=e.extend({},i,a),u=function(t,n,i){var a={passed:!1,message:""};if(a.passed=e.every(t.c,function(i){var a=r.getConditionFunction(i);if(!e.isFunction(a))return o.throwError("API_ERR_ARGUMENTS_MAPPER_1",[i]),!1;var s=r.getValue(i,n,t.argIndex);return a(s)}),!a.passed)return!1;var s=t.p||!1;if(s){var u={};u[s]=n[t.argIndex],!e.isNull(t.force)&&e.isNull(n[t.argIndex])&&(u[s]=t.force),e.extend(i,u)}else e.extend(i,n[t.argIndex]);return!0},d={run:function(n,r){s[r]||o.throwError("API_ERR_ARGUMENTS_MAPPER_2",[r]),e.isArray(s[r])||o.throwError("API_ERR_ARGUMENTS_MAPPER_3",[r]),s[r].length||o.throwError("API_ERR_ARGUMENTS_MAPPER_4",[r]);for(var i={},a=t.getArrayLengthIE8(s[r]),d=0;a>d;d++)e.isArray(s[r][d])||e.isObject(s[r][d])||o.throwError("API_ERR_ARGUMENTS_MAPPER_5",[r,d]),e.isArray(s[r][d])||(s[r][d]=[s[r][d]]),e.some(s[r][d],function(e){return u(e,n,i)});return i},setRules:function(e,t){s[t]=e}};return d}),n("annotationValidators",["underscorenc","config"],function(e,t){var n={};return n.deleteAnnotation={},n.deleteAnnotation.prevalidators=[{c:[{len:1,com:"$gte"}],em:"annotation_id {Number} is required"}],n.deleteAnnotation.validators=[t.NAMED_VALIDATORS.handlers,{p:["id"],c:["number"]}],n.deleteAnnotations={},n.deleteAnnotations.prevalidators=[{c:[{len:1,com:"$gte"}],em:"annotationIdsList {Array} is required"}],n.deleteAnnotations.validators=[t.NAMED_VALIDATORS.handlers,{p:["annotationIdsList"],c:["array"]}],n.updateAnnotation={},n.updateAnnotation.prevalidators=[{c:[{len:2,com:"$gte"}],em:"annotation_id {Number} and fieldsValues {object} are required arguments."}],n.updateAnnotation.validators=[t.NAMED_VALIDATORS.handlers,{p:["id","currentVisibilityId"],c:["number"]},{p:["fieldsValues"],c:["object"]},{p:["fieldsValues"],c:[{sp:["annotation_id"],com:"$nin"}],em:'"annotation_id" should not be passed in fieldsValues.'},{p:["visibility","visibilityInclude","visibilityExclude"],c:["string","array"]}],n.createAnnotation={},n.createAnnotation.prevalidators=[{c:[{len:1,com:"$gte"}],em:"fieldsValues {object} is required"}],n.createAnnotation.validators=[t.NAMED_VALIDATORS.handlers,{p:["fieldsValues"],c:["object"]},{p:["fieldsValues"],c:[{sp:["annotation_id","annotator_id"],com:"$nin"}],em:'"annotation_id" and "annotator_id" should not be passed in fieldsValues.'},{p:["visibility"],c:["string","array"]}],n.getAnnotationsByTextString={},n.getAnnotationsByTextString.prevalidators=[{c:[{len:1,com:"$gte"}],em:"text {String} is required"}],n.getAnnotationsByTextString.validators=[t.NAMED_VALIDATORS.handlers,{p:["text"],c:["string"]},{p:["fields"],c:["array"]},{p:["filters"],c:["object"]},{p:["limitFrom","limitCount"],c:["number"]},{p:["orderDesc","getCount","parseDate"],c:["boolean"]},{p:["visibility","orderBy"],c:["string","array"]}],n.getAnnotationByID={},n.getAnnotationByID.prevalidators=[{c:[{len:1,com:"$gte"}],em:"id {object} is required"}],n.getAnnotationByID.validators=[t.NAMED_VALIDATORS.handlers,{p:["id"],c:["number"]},{p:["fields"],c:["array"]},{p:["parseDate"],c:["boolean"]}],n.getAnnotations={},n.getAnnotations.prevalidators=[],n.getAnnotations.validators=[t.NAMED_VALIDATORS.handlers,{p:["fields"],c:["array"]},{p:["filters"],c:["object"]},{p:["next"],c:["string"]},{p:["limitFrom","limitCount"],c:["number"]},{p:["orderDesc","getCount","parseDate"],c:["boolean"]},{p:["parseDate"],c:["boolean"]},{p:["visibility","orderBy"],c:["string","array"]}],n.getAnnotationsCount={},n.getAnnotationsCount.prevalidators=[],n.getAnnotationsCount.validators=[t.NAMED_VALIDATORS.handlers,{p:["filters"],c:["object"]},{p:["visibility"],c:["string","array"]}],n}),n("tagsValidators",["underscorenc","config"],function(e,t){var n={};return n.createTagsForAnnotationId={},n.createTagsForAnnotationId.prevalidators=[{c:[{len:3,com:"$gte"}],em:"annotationId, contentId, tagsList are required"}],n.createTagsForAnnotationId.validators=[t.NAMED_VALIDATORS.handlers,{p:["annotationId"],c:["number"]},{p:["contentId"],c:["string"]},{p:["tagsList"],c:["array"]}],n.getTagsByAnnotationId={},n.getTagsByAnnotationId.prevalidators=[{c:[{len:1,com:"$gte"}],em:"annotationId {Number} is required"}],n.getTagsByAnnotationId.validators=[t.NAMED_VALIDATORS.handlers,{p:["filters"],c:["object"]},{p:["annotationId","limitFrom","limitCount"],c:["number"]},{p:["orderDesc","getCount"],c:["boolean"]},{p:["orderBy"],c:["string","array"]}],n.createAnnotationAndTags={},n.createAnnotationAndTags.prevalidators=[{c:[{len:2,com:"$gte"}],em:"annotationFieldsValues {object} and tagsList {string[]} are required"}],n.createAnnotationAndTags.validators=[t.NAMED_VALIDATORS.handlers,{p:["annotationFieldsValues"],c:["object"]},{p:["annotationFieldsValues"],c:[{sp:["annotation_id","annotator_id"],com:"$nin"}],em:"annotation_id and annotator_id should not be passed in annotationFieldsValues."},{p:["tagsList"],c:["array"]},{p:["visibility"],c:["string","array"]}],n.deleteTags={},n.deleteTags.prevalidators=[{c:[{len:1,com:"$gte"}],em:"tagIdsList is required"}],n.deleteTags.validators=[t.NAMED_VALIDATORS.handlers,{p:["tagIdsList"],c:["array"]}],n.getAnnotationsByTag={},n.getAnnotationsByTag.prevalidators=[{c:[{len:1,com:"$gte"}],em:"tag String is required"}],n.getAnnotationsByTag.validators=[t.NAMED_VALIDATORS.handlers,{p:["fields"],c:["array"]},{p:["tag"],c:["string"]},{p:["filters"],c:["object"]},{p:["limitFrom","limitCount"],c:["number"]},{p:["orderDesc","parseDate"],c:["boolean"]},{p:["visibility","orderByTag","orderByAnnotation"],c:["string","array"]}],n.getTagsByContentId={},n.getTagsByContentId.prevalidators=[{c:[{len:6}],em:"accept 6 params"}],n.getTagsByContentId.validators=[],n}),n("argumentsValidator",["underscorenc","config","parser","annotationValidators","tagsValidators","errorManager"],function(e,t,n,r,i,a){var o=["prevalidators","validators"],s=e.extend({},r,i),u=function(t,r){var i={passed:!1,message:"",err:""};return i.passed=e.every(t.p,function(a){var o=r[a],s=!1;return e.isUndefined(o)||e.isNull(o)?!0:(s=e.some(t.c,function(t){var r=n.getConditionFunction(t);return e.isFunction(r)?r(o):(i.err='ArgumentsValidator: type "'+t+'" is not defined in validatorsMap',!1)}))?!0:(i.message='ArgumentsValidator: "'+a+'" = '+o+" is not "+t.c+"!",!1)}),i.passed||(i.message=i.err||t.em||i.message||""),i},d=function(t,r){var i={passed:!1,message:""};return i.passed=e.every(t.c,function(a){var o=n.getConditionFunction(a);if(!e.isFunction(o))return i.message="argumentsValidator: prevalidation condition is not a function",!1;var s=n.getValue(a,r,t.argIndex);return o(s)}),i.passed||(i.message=i.message||t.em||""),i},l={prevalidators:d,validators:u},c=function(t,n,r){s[t]||a.throwError("API_ERR_ARGUMENTS_VALIDATOR_2",[t]),s[t][n]||a.throwError("API_ERR_ARGUMENTS_VALIDATOR_3",[n,t]);var i={passed:!1,message:""};e.each(s[t][n],function(e){if(i=l[n](e,r),!i.passed)throw i.message})},f={pre:function(e,t){c(t,"prevalidators",e)},run:function(e,t){c(t,"validators",e)},setRules:function(e,t,n){s[n]||(s[n]={}),s[n][t]=e},getRulesTypes:function(){return o}};return f}),n("argumentsProcessor",["underscorenc","config","helpers","argumentsMapper","argumentsValidator"],function(e,t,n,r,i){function a(){u="",d=void 0,l={},c=!1,f=!1,p=null}function o(){if(!f)throw"argumentsProcessor: [prevalidate, map, validate] called before function name is set"}function s(t,n){e.isObject(t)&&e.isString(n)&&(t.maps&&r.setRules(t.maps,n),e.each(i.getRulesTypes(),function(e){t[e]&&i.setRules(t[e],e,n)}))}var u="",d=void 0,l={},c=!1,f=!1,p=null,_={defaults:n.getEmptyParams()},h={init:function(){return this},start:function(){return a(),this},run:function(){return l},set:function(t,n){return n=n||null,c=e.isArguments(t),c?d=t||[]:l=t||{},p=n,this},against:function(t){return u=t,f=!0,e.isNull(p)||s(p,u),this},prevalidate:function(){return c?(o(),i.pre(d,u),this):this},map:function(){if(!c)return this;o();var t=r.run(d,u);return e.extend(l,t),this},validate:function(){return o(),i.run(l,u),this},useDefaults:function(){return l=e.extend({},_.defaults,l),this},runFullStack:function(e,t,n){return n=n||[],this.start().set(t,n).against(e).prevalidate().useDefaults().map().validate().run()}};return h.init()}),n("annotationAPI",["helpers","underscorenc","config","client","annotations","transportManager","argumentsProcessor","queryApiValidators"],function(e,t,n,r,i,a,o,s){var u={};return u.deleteAnnotation=function(){s.doInitCheck();var t,n="deleteAnnotation";e.isServiceReady()&&(t=o.runFullStack(n,arguments),i.remove(t.id).done(t.successHandler).fail(t.errorHandler).run())},u.deleteAnnotations=function(){s.doInitCheck();var n,r="deleteAnnotations";e.isServiceReady()&&(n=o.runFullStack(r,arguments),t.isFunction(n.successHandler)||(n.successHandler=function(){e.consoleLog("Delete ok")}),i.remove(n.annotationIdsList).done(n.successHandler).fail(n.errorHandler).run())},u.updateAnnotation=function(){s.doInitCheck();var t,n="updateAnnotation";e.isServiceReady()&&(t=o.runFullStack(n,arguments),t.visibility&&(t.fieldsValues.visibility=t.visibility),t.currentVisibilityId&&(t.visibilityInclude||t.visibilityExclude)&&(t.fieldsValues.currentVisibilityId=t.currentVisibilityId,t.fieldsValues.visibilityInclude=t.visibilityInclude,t.fieldsValues.visibilityExclude=t.visibilityExclude),i.update(t.id,t.fieldsValues).done(t.successHandler).fail(t.errorHandler).run())},u.createAnnotation=function(){s.doInitCheck();var t,n="createAnnotation";e.isServiceReady()&&(t=o.runFullStack(n,arguments),t.visibility&&(t.fieldsValues.$visibility=t.visibility),i.create(t.fieldsValues).done(t.successHandler).fail(t.errorHandler).run())},u.getAnnotationsByTextString=function(){s.doInitCheck();var n,r="getAnnotationsByTextString";e.isServiceReady()&&(n=o.runFullStack(r,arguments),n.visibility&&(n.filters=t.extend({},n.filters,{$visibility:n.visibility})),n.filters.$or=[{body_text:{$like:n.text}},{title:{$like:n.text}}],i.find(n.filters).outputFields(n.fields).limit(n.limitFrom,n.limitCount).order(n.orderBy,n.orderDesc).done(n.successHandler).fail(n.errorHandler).parseDates(n.parseDate).count(n.getCount).run())},u.getAnnotationByID=function(){s.doInitCheck();var t,n="getAnnotationByID";e.isServiceReady()&&(t=o.runFullStack(n,arguments),i.findOne(t.id).outputFields(t.fields).done(t.successHandler).fail(t.errorHandler).parseDates(t.parseDate).run())},u.getAnnotations=function(){s.doInitCheck();var n,r="getAnnotations";if(e.isServiceReady()){n=o.runFullStack(r,arguments),n.visibility&&(n.filters=t.extend({},n.filters,{$visibility:n.visibility}));var a=i.find(n.filters).outputFields(n.fields).limit(n.limitFrom,n.limitCount).done(n.successHandler).fail(n.errorHandler).parseDates(n.parseDate).count(n.getCount).next(n.next);n.orderBy&&a.order(n.orderBy,n.orderDesc),a.run()}},u.getAnnotationsCount=function(){s.doInitCheck();var n,r="getAnnotationsCount";e.isServiceReady()&&(n=o.runFullStack(r,arguments),n.visibility&&(n.filters=t.extend({},n.filters,{$visibility:n.visibility})),i.find(n.filters).done(n.successHandler).fail(n.errorHandler).count().run())},u.Annotations=i,u}),n("tagsAPI",["helpers","underscorenc","config","client","annotations","tags","transportManager","argumentsProcessor","errorManager","queryApiValidators"],function(e,t,n,r,i,a,o,s,u,d){var l={};return l.createAnnotationAndTags=function(e,n,r){d.doInitCheck();var a,o;t.isFunction(r)?(a=r,o=arguments[3]):(a=r.successHandler,o=r.errorHandler),t.isNullUndef(r.visibility)||(e.$visibility=r.visibility);var s=t.map(n,function(t){return{value:t,content_id:e.content_id}});i.create(e).tags(s).done(function(e){a(e[0],t.rest(e))}).fail(o).run()},l.createTagsForAnnotationId=function(r,i,o){d.doInitCheck();var l,c="createTagsForAnnotationId";if(e.isServiceReady()){l=s.runFullStack(c,arguments),o.length>n.SETTINGS.AppSettings.MaxChangesetCount&&u.throwError("API_ERR_TRANSPORT_1",[n.SETTINGS.AppSettings.MaxChangesetCount]);var f=t.map(t.uniq(o),function(e){return{value:e}});a.create(f).commonFields({annotation_id:l.annotationId,content_id:l.contentId}).done(function(n){t.isObjectNotArray(n)&&(n=[n]),l.successHandler?l.successHandler(n):e.consoleLog("Create tags OK")}).fail(l.errorHandler).run()}},l.getTagsByAnnotationId=function(){d.doInitCheck();var t,n="getTagsByAnnotationId";if(e.isServiceReady()){t=s.runFullStack(n,arguments);var r={annotation_id:t.annotationId};a.find(r).limit(t.limitFrom,t.limitCount).order(t.orderBy,t.orderDesc).count(t.getCount).fail(t.errorHandler).done(t.successHandler).run()}},l.getTagsByContentId=function(){d.doInitCheck();var t,n="getTagsByContentId";if(e.isServiceReady()){t=s.runFullStack(n,arguments);var r={content_id:t.contentId};a.find(r).limit(t.limitFrom,t.limitCount).order(t.orderBy).fail(t.errorHandler).done(t.successHandler).run()}},l.deleteTags=function(){d.doInitCheck();var t,n="deleteTags";e.isServiceReady()&&(t=s.runFullStack(n,arguments),a.remove(t.tagIdsList).done(t.successHandler).fail(t.errorHandler).run())},l.getAnnotationsByTag=function(){throw"Not implemented."},l.getDistinctTags=function(t){var n="getDistinctTags";if(e.isServiceReady()){t=t||e.getEmptyParams(),e.areArgsValidType([{o:[t.successHandler,t.errorHandler],t:["function"]},{o:[t.contentId,t.forUser],t:["string"]},{o:[t.visibilityId],t:["number"]},{o:[t.visibility],t:["array","string"]}],n);var i=t.visibilityId;(null===i||void 0===i)&&(i=t.visibility?r.convertNamesToID(t.visibility):r.getID()),this.getDistinctTagsByVisibilityIdAndContentId(i,t.contentId?t.contentId:"",t.successHandler,t.errorHandler,t.forUser?t.forUser:"")}},l.getDistinctTagsByVisibilityIdAndContentId=function(n,r,i,o,s){if(e.isServiceReady()){var u={};!t.isNullUndef(r)&&t.isNonEmptyString(r)&&(u.content_id=r),t.isNullUndef(n)||(u.client_id=n),a.getDistinctTags(u).forUser(s?s:null).done(i).fail(o).run()}},l.Tags=a,l}),n("customODataAPI",["helpers","underscorenc","config","client","oDataService","transportManager","argumentsProcessor","requestManager"],function(e,t,n,r,i,a,o,s){var u={};return u.testHeartbeat=function(i){var u="testHeartbeat",d={validators:[{p:["successHandler","errorHandler"],c:["function"]}]};i=i||{},o.start().set(i,d).against(u).validate().run();var l=s.createSub(n.CRUD.find,!0,n.COLLECTIONS.entityless.nameUppercase);s.setProp(l,s.PROPS.BASE_URL,e.templatify("client_tools/<%= tail %>")),s.setProp(l,s.PROPS.FILTERS,r.isSet()?{client_tool_id:r.getID()}:{}),s.setProp(l,s.PROPS.COUNT,!0),t.isFunction(i.successHandler)&&s.setProp(s.PROPS.SUCCESS_HANDLER,i.successHandler),t.isFunction(i.errorHandler)&&s.setProp(s.PROPS.ERROR_HANDLER,i.errorHandler);var c=s.exportRequest();s._reset(),a.use(n.TRANSPORT_NAMES.ODATA).run(c)},u.getAnnotationsByUser=function(i,o,u,d,l,c,f,p,_){if(e.isServiceReady()){var h={user_guid:t.wrapInto(i,"'"),content_id:t.wrapInto(o.content_id,"'"),object_id:t.wrapInto(o.object_id,"'"),type_id:o.type_id};delete o.content_id,delete o.object_id,delete o.type_id,_&&(o.visibility_id=r.convertNamesToVisibilityIds(_));var m=s.createSub(n.CRUD.find,!0,n.COLLECTIONS.entityless.nameUppercase);s.setProp(m,s.PROPS.BASE_URL,e.templatify("GetAnnotationsByStudent/<%= tail %>")),o&&s.setProp(m,s.PROPS.FILTERS,o),u&&s.setProp(m,s.PROPS.FIELDS,u),d&&s.setProp(m,s.PROPS.ORDER_BY,d),l&&s.setProp(m,s.PROPS.LIMIT_FROM,l),c&&s.setProp(m,s.PROPS.LIMIT_COUNT,c),f&&s.setProp(s.PROPS.SUCCESS_HANDLER,f),p&&s.setProp(s.PROPS.ERROR_HANDLER,p),s.setProp(m,s.PROPS.QUERY_PARAMS,h);var g=s.exportRequest();s._reset(),a.use(n.TRANSPORT_NAMES.ODATA).run(g)}},u.getTeacherCommentsAsStudent=function(t,r,i,o,u,d,l,c){if(e.isServiceReady()){var f="Annotation/Comments?annotation_id=",p=f+t;e.consoleLog("READ request: "+p);var _=s.createSub(n.CRUD.find,!0,n.COLLECTIONS.entityless.nameUppercase);s.setProp(_,s.PROPS.BASE_URL,e.templatify(p)),r&&s.setProp(_,s.PROPS.FILTERS,r),i&&s.setProp(_,s.PROPS.FIELDS,i),o&&s.setProp(_,s.PROPS.ORDER_BY,o),u&&s.setProp(_,s.PROPS.LIMIT_FROM,u),d&&s.setProp(_,s.PROPS.LIMIT_COUNT,d),l&&s.setProp(s.PROPS.SUCCESS_HANDLER,l),c&&s.setProp(s.PROPS.ERROR_HANDLER,c),s.setProp(_,s.PROPS.IS_WEBAPI,!0);var h=s.exportRequest();s._reset(),a.use(n.TRANSPORT_NAMES.ODATA).run(h)}},u.markInteractiveNoteAsRead=function(t,r,i){if(e.isServiceReady()){var o="Annotation/InteractiveNoteMarkAsRead?annotation_id=",u=o+t;e.consoleLog("READ request: "+u);var d=s.createSub(n.CRUD.create,!0,n.COLLECTIONS.entityless.nameUppercase);s.setProp(d,s.PROPS.BASE_URL,e.templatify(u)),r&&s.setProp(s.PROPS.SUCCESS_HANDLER,r),i&&s.setProp(s.PROPS.ERROR_HANDLER,i),s.setProp(d,s.PROPS.IS_WEBAPI,!0);var l=s.exportRequest();s._reset(),a.use(n.TRANSPORT_NAMES.ODATA).run(l)}},u.markTeacherCommentAsRead=function(t,r,i){if(e.isServiceReady()){var o="annotation/TeacherCommentMarkAsRead/?annotation_id=",u=o+t;e.consoleLog("READ request: "+u);var d=s.createSub(n.CRUD.create,!0,n.COLLECTIONS.entityless.nameUppercase);s.setProp(d,s.PROPS.BASE_URL,e.templatify(u)),r&&s.setProp(s.PROPS.SUCCESS_HANDLER,r),i&&s.setProp(s.PROPS.ERROR_HANDLER,i),s.setProp(d,s.PROPS.IS_WEBAPI,!0);var l=s.exportRequest();s._reset(),a.use(n.TRANSPORT_NAMES.ODATA).run(l)}},u}),n("aggregationAPI",["helpers","underscorenc","config","transportManager","errorManager"],function(e,t,n,r,i){var a={};return a.getInteractiveNotesCountsForStudents=function(t,a,o,s,u){if(e.isServiceReady()){n.USE_CAS_V2===!0&&i.throwError("API_ERR_GENERAL_4",["getInteractiveNotesCountsForStudents"]);var d={};d.ContentId=t,d.ObjectId=a,d.AnnotationType=4,d.Ids=o,d.QueryType="studentlist";var l="action/Count/StudentNotesCount",c=e.getRequestURL(l,!0);r.use(n.TRANSPORT_NAMES.AJAX).read({url:c,data:d,type:n.REQ_TYPE_POST},s,u)}},a.getInteractiveNotesCountsForPages=function(t,a,o,s,u){if(e.isServiceReady()){n.USE_CAS_V2===!0&&i.throwError("API_ERR_GENERAL_4",["getInteractiveNotesCountsForPages"]);var d={};d.ContentId=t,d.UserId=a,d.AnnotationType=4,d.Ids=o,d.QueryType="pagelist";var l="action/Count/PageNotesCount",c=e.getRequestURL(l,!0);r.use(n.TRANSPORT_NAMES.AJAX).read({url:c,data:d,type:n.REQ_TYPE_POST},s,u)}},a.getInteractiveNotesCountsForStudentsPages=function(t,a,o,s,u){if(e.isServiceReady()){n.USE_CAS_V2===!0&&i.throwError("API_ERR_GENERAL_4",["getInteractiveNotesCountsForStudentsPages"]);var d={};d.ContentId=t,d.AnnotationType=4,d.Ids=o,d.StudentIds=a,d.QueryType="pagelist";var l="action/Count/TurnedInCountForPages",c=e.getRequestURL(l,!0);r.use(n.TRANSPORT_NAMES.AJAX).read({url:c,data:d,type:n.REQ_TYPE_POST},s,u)}},a.getCountsAsStudentForPages=function(t,i,a,o){if(e.isServiceReady()){var s={};s.ContentId=t,s.AnnotationType=4,s.Ids=i,s.QueryType="pagelist";var u="action/Count/AllNotesCountByPage",d=e.getRequestURL(u,!0);r.use(n.TRANSPORT_NAMES.AJAX).read({url:d,data:s,type:n.REQ_TYPE_POST},a,o)}},a.getCountsAsStudentForLessons=function(t,i,a,o){if(e.isServiceReady()){var s={};s.ContentId=t,s.AnnotationType=4,s.Ids=i,s.QueryType="pagelist";var u="action/Count/AllNotesCountByLesson",d=e.getRequestURL(u,!0);r.use(n.TRANSPORT_NAMES.AJAX).read({url:d,data:s,type:n.REQ_TYPE_POST},a,o)}},a.getCountsAsStudentForLessonsForUnit=function(t,i,a,o,s){if(e.isServiceReady()){var u={};u.ContentId=t,u.UnitId=i,u.AnnotationType=4,u.Ids=a,u.QueryType="pagelist";var d="action/Count/AllNotesCountByLesson",l=e.getRequestURL(d,!0);r.use(n.TRANSPORT_NAMES.AJAX).read({url:l,data:u,type:n.REQ_TYPE_POST},o,s)}},a.getCountsAsStudentForUnit=function(t,a,o,s){var u="getCountsAsStudentForUnit";if(e.isServiceReady()){arguments.length<=3&&i.throwError("API_ERR_AJAX_1",[u,4,""]),e.areArgsValidType([{o:[a],t:["string"]},{o:[t],t:["array"]},{o:[o,s],t:["function"]}],u);var d={};d.ids=t,d.contentId=a,d.annotationType=4;var l="action/count/AllNotesCountByUnit",c=e.getRequestURL(l,!0);r.use(n.TRANSPORT_NAMES.AJAX).read({url:c,data:d,type:n.REQ_TYPE_POST},o,s)}},a}),n("userAPI",["helpers"],function(e){var t={};return t.createInteractiveNoteWithImage=function(t,n,r,i){annService.Annotations.createImage(t,n).done(function(t,n){r?r(t.annotation,n):(e.consoleLog("success"),e.consoleLog(e.debugParseResults(t)))}).fail(function(t,n){i?i(t,n):e.consoleLog("error: "+t+". responseAdditionalData: "+n)}).run()},t.updateInteractiveNoteWithImage=function(t,n,r,i,a){annService.Annotations.updateImage(t,n,r).done(function(t,n){i?i(t.annotation,n):(e.consoleLog("success"),e.consoleLog(e.debugParseResults(t)))}).fail(function(t,n){a?a(t,n):e.consoleLog("testStatus: "+testStatus+". error: "+t)}).run()},t.getInteractiveNoteImageUrl=function(t,n,r){annService.Annotations.findImage(t).done(function(t,r){n?n(t.signed_url,r):(e.consoleLog("success"),e.consoleLog(t.signed_url))}).fail(function(t,n){r?r(t,n):e.consoleLog("error: "+t+". responseAdditionalData: "+n)}).run()},t.deleteInteractiveNoteWithImage=function(t,n,r){annService.Annotations.removeImage(t).done(function(t,r){n?n(t.annotation_id,r):(e.consoleLog("success"),e.consoleLog(t))}).fail(function(t,n){r?r(t,n):e.consoleLog("error: "+t+". responseAdditionalData: "+n)}).run()},t}),n("containersAPI",["underscorenc","helpers","config","client","annotations","containers","transportManager","argumentsProcessor","errorManager","queryApiValidators"],function(e,t,n,r,i,a,o,s,u,d){var l={},c=function(n){function r(){d.doInitCheck(),(e.isNull(n)||e.isUndefined(n))&&u.throwError("API_ERR_QUERY_API_2",[s.entityName,s.keyField,"forContainer","addAnnotations"])}d.doInitCheck();var a={},o=!1,s=this;return e.isNumber(n)||e.isNull(n)||e.isUndefined(n)||u.throwError("API_ERR_QUERY_API_1",[s.entityName,"forContainer","container_id","number"]),a.withChildContainers=function(t){return d.doInitCheck(),o=e.isUndefined(t)||e.isNull(t)?!0:!!t,this},a.addAnnotations=function(t){return d.doInitCheck(),r("addAnnotations"),t=e.isNumber(t)?[t]:t,i.update(t).commonFields({container_id:n})},a.deleteAnnotations=function(n){return d.doInitCheck(),e.isArray(n)||e.isNumber(n)||u.throwError("API_ERR_QUERY_API_3",[s.entityName,"annotation_ids","deleteAnnotations","number or array",t.toType(n)]),(e.isNull(n)||e.isUndefined(n)||e.isArray(n)&&0===n.length)&&u.throwError("API_ERR_QUERY_API_4",[s.entityName,"deleteAnnotations","annotation_id(s)"]),e.isArray(n)||(n=[n]),i.update(n).commonFields({container_id:null})
},a.findAnnotations=function(t){return d.doInitCheck(),r("findAnnotations"),t||(t={}),e.isNumber(n)&&(t.$sub=o?{container:{$or:[{id:n},{parent_id:n}]}}:{container:{id:n}}),i.find(t)},a.findAnnotationsByText=function(r,a){d.doInitCheck(),e.isString(r)||e.isArray(r)||u.throwError("API_ERR_QUERY_API_3",[s.entityName,"text","findAnnotationsByText","string or array",t.toType(r)]);var l={},c={};e.isNumber(n)&&(l.$sub=o?{container:{$or:[{id:n},{parent_id:n}]}}:{container:{id:n}});var f;return e.isArray(r)?(f=[],e.each(r,function(n){e.isString(n)||u.throwError("API_ERR_QUERY_API_3",[s.entityName,"text","findAnnotationsByText","string or array",t.toType(n)]),f.push({$like:n})})):f={$like:r},l.$or=[{title:f},{body_text:f}],e.isObject(a)&&e.extend(c,a),e.extend(c,{$and:l}),i.find(c)},a.findAllAnnotationsByText=function(t,r){d.doInitCheck();var a={};return e.isNumber(n)&&(a.$sub=o?{container:{$or:[{id:n},{parent_id:n}]}}:{container:{id:n}}),e.isObject(r)&&e.extend(a,r),i.findAllAnnotationsByText(t,a)},a.findAnnotationsByTags=function(t,r){d.doInitCheck();var a,s={};return e.isArray(t)||(t=[t]),e.isObject(r)&&e.extend(s,r),e.isNumber(n)&&(a=o?{$sub:{container:{$or:[{id:n},{parent_id:n}]}}}:{$sub:{container:{id:n}}}),e.isArray(t)&&e.extend(s,{$any:{tags:{value:t}}}),e.extend(s,a),i.find(s)},a},f=function(t){return d.doInitCheck(),e.isArray(t)||(t=[t]),i.update(t).commonFields({container_id:null})};return e.extend(a,{forContainer:c,removeAnnotations:f}),l.Containers=a,l}),n("experimentalAPI",["helpers","oDataService","underscorenc","config","client","transportManager","annotations"],function(e,t,n,r,i,a,o){var s={};return s.createAnnotationsBatch=function(t,r,i){e.isServiceReady()&&o.create(t).done(function(t){var i=n.pluck(t,"annotation_id");r?r(i):e.consoleLog(i)}).fail(i).run()},s.createAnnotationTagsAndFlags=function(){throw"Not implemented."},s.getAnnotationsAndTags=function(){throw"Not implemented."},s}),n("annotationSharedWithAPI",["underscorenc","helpers","config","client","annotationSharedWith"],function(e,t,n,r,i){var a={};return a.AnnotationSharedWith=i,a}),n("custom",["underscorenc","config","helpers","transportManager","client","queryAPI","info","errorManager","requestManager"],function(e,t,n,r,i,a,o,s,u){var d={getUsersForAnnotationId:{service:n.templatify("SharedWithAnnotators<%= tail %>")}},l={entityName:"custom",_defaultTransport:r.use(t.TRANSPORT_NAMES.ODATA),_transports:{},_request:{},_additionalActions:{},_urls:d,init:function(){return e.defaults(this,a),e.extend(this,o),this},_getRequest:function(){return this._request},getUsersForAnnotationId:function(r){(e.isUndefined(r)||e.isObject(r)&&e.isUndefined(r.annotation_id))&&s.throwError("API_ERR_QUERY_API_3",[this.entityName,"annotation_id","getUsersForAnnotationId","object","undefined"]),(e.isObject(r)&&!e.isNumber(r.annotation_id)||!e.isNumber(r))&&s.throwError("API_ERR_QUERY_API_3",[this.entityName,"annotation_id","getUsersForAnnotationId","object",n.toType(r)]);var i={};i[t.QUERY_PARAMS.annotationId]=r;var a=this._customOperation({},t.CUSTOM_ENDPOINTS.GET_USERS_FOR_ANNOTATION_ID,t.CRUD.find,this.entityName);return u.setProp(a,u.PROPS.QUERY_PARAMS,i),u.setProp(a,u.PROPS.IS_WEBAPI,!0),this}};return l.init()}),n("customAPI",["underscorenc","helpers","config","custom"],function(e,t,n,r){var i={};return i.custom=r,i}),n("annService",["underscorenc","config","basicAPI","annotationAPI","tagsAPI","customODataAPI","aggregationAPI","userAPI","containersAPI","experimentalAPI","annotationSharedWithAPI","customAPI","requestManager","resetManager","annotations","containers","tags","annotationSharedWith","oDataService","queryAPI"],function(e,t,n,r,i,a,o,s,u,d,l,c,f,p,_,h,m,g,y,E){var S={publicInterface:{},prepare:function(){return e.extend(this.publicInterface,n),e.extend(this.publicInterface,r),e.extend(this.publicInterface,i),e.extend(this.publicInterface,a),e.extend(this.publicInterface,o),e.extend(this.publicInterface,s),e.extend(this.publicInterface,u),e.extend(this.publicInterface,d),e.extend(this.publicInterface,l),e.extend(this.publicInterface,c),e.extend(this.publicInterface,{reqMan:f}),e.extend(this.publicInterface,{odata:y}),p.subscribe(_._reset),p.subscribe(m._reset),p.subscribe(h._reset),p.subscribe(g._reset),p.subscribe(E._reset),p.subscribe(f._reset),this.publicInterface}};return S.prepare()}),t("annService")});