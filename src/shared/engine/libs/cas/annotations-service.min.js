!function(a,b){function c(a,b){if(a instanceof Array)for(var d=0;d<a.length;d++)b.push(),c(a[d],b[d]);if(a instanceof Object)for(var e in a){if(null==a[e]||"object"!=typeof a[e])b[e]=a[e];else if(a[e]instanceof Array)b[e]=[],c(a[e],b[e]);else if(a[e]instanceof Object){b[e]={};for(var f in a[e])c(a[e],b[e])}}}if("function"==typeof define&&define.amd)define(b);else{var d={},e={},f=!1;if(window.OData&&window.datajs&&(f=!0,c(window.OData,d),c(window.datajs,e)),a.annService=b(),f)window.OData=d,window.datajs=e;else{if(window.OData){window.OData=void 0;try{delete window.OData}catch(g){}}if(window.datajs){window.datajs=void 0;try{delete window.datajs}catch(g){}}}}}(this,function(){function a(){this._thens=[]}var b,c,d;return function(a){function e(a,b){return u.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m=b&&b.split("/"),n=s.map,o=n&&n["*"]||{};if(a&&"."===a.charAt(0))if(b){for(m=m.slice(0,m.length-1),a=m.concat(a.split("/")),j=0;j<a.length;j+=1)if(l=a[j],"."===l)a.splice(j,1),j-=1;else if(".."===l){if(1===j&&(".."===a[2]||".."===a[0]))break;j>0&&(a.splice(j-1,2),j-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((m||o)&&n){for(c=a.split("/"),j=c.length;j>0;j-=1){if(d=c.slice(0,j).join("/"),m)for(k=m.length;k>0;k-=1)if(e=n[m.slice(0,k).join("/")],e&&(e=e[d])){f=e,g=j;break}if(f)break;!h&&o&&o[d]&&(h=o[d],i=j)}!f&&h&&(f=h,g=i),f&&(c.splice(0,g,f),a=c.join("/"))}return a}function g(b,c){return function(){return n.apply(a,v.call(arguments,0).concat([b,c]))}}function h(a){return function(b){return f(b,a)}}function i(a){return function(b){q[a]=b}}function j(b){if(e(r,b)){var c=r[b];delete r[b],t[b]=!0,m.apply(a,c)}if(!e(q,b)&&!e(t,b))throw new Error("No "+b);return q[b]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return function(){return s&&s.config&&s.config[a]||{}}}var m,n,o,p,q={},r={},s={},t={},u=Object.prototype.hasOwnProperty,v=[].slice;o=function(a,b){var c,d=k(a),e=d[0];return a=d[1],e&&(e=f(e,b),c=j(e)),e?a=c&&c.normalize?c.normalize(a,h(b)):f(a,b):(a=f(a,b),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},p={require:function(a){return g(a)},exports:function(a){var b=q[a];return"undefined"!=typeof b?b:q[a]={}},module:function(a){return{id:a,uri:"",exports:q[a],config:l(a)}}},m=function(b,c,d,f){var h,k,l,m,n,s,u=[];if(f=f||b,"function"==typeof d){for(c=!c.length&&d.length?["require","exports","module"]:c,n=0;n<c.length;n+=1)if(m=o(c[n],f),k=m.f,"require"===k)u[n]=p.require(b);else if("exports"===k)u[n]=p.exports(b),s=!0;else if("module"===k)h=u[n]=p.module(b);else if(e(q,k)||e(r,k)||e(t,k))u[n]=j(k);else{if(!m.p)throw new Error(b+" missing "+k);m.p.load(m.n,g(f,!0),i(k),{}),u[n]=q[k]}l=d.apply(q[b],u),b&&(h&&h.exports!==a&&h.exports!==q[b]?q[b]=h.exports:l===a&&s||(q[b]=l))}else b&&(q[b]=d)},b=c=n=function(b,c,d,e,f){return"string"==typeof b?p[b]?p[b](c):j(o(b,c).f):(b.splice||(s=b,c.splice?(b=c,c=d,d=null):b=a),c=c||function(){},"function"==typeof d&&(d=e,e=f),e?m(a,b,c,d):setTimeout(function(){m(a,b,c,d)},4),n)},n.config=function(a){return s=a,s.deps&&n(s.deps,s.callback),n},d=function(a,b,c){b.splice||(c=b,b=[]),e(q,a)||e(r,a)||(r[a]=[a,b,c])},d.amd={jQuery:!0}}(),d("almond",function(){}),function(){var a=this,b=a._,c={},e=Array.prototype,f=Object.prototype,g=Function.prototype,h=e.push,i=e.slice,j=e.concat,k=f.toString,l=f.hasOwnProperty,m=e.forEach,n=e.map,o=e.reduce,p=e.reduceRight,q=e.filter,r=e.every,s=e.some,t=e.indexOf,u=e.lastIndexOf,v=Array.isArray,w=Object.keys,x=g.bind,y=function(a){return a instanceof y?a:this instanceof y?void(this._wrapped=a):new y(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=y),exports._=y):a._=y,y.VERSION="1.6.0";var z=y.each=y.forEach=function(a,b,d){if(null==a)return a;if(m&&a.forEach===m)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;e<f;e++)if(b.call(d,a[e],e,a)===c)return}else for(var g=y.keys(a),e=0,f=g.length;e<f;e++)if(b.call(d,a[g[e]],g[e],a)===c)return;return a};y.map=y.collect=function(a,b,c){var d=[];return null==a?d:n&&a.map===n?a.map(b,c):(z(a,function(a,e,f){d.push(b.call(c,a,e,f))}),d)};var A="Reduce of empty array with no initial value";y.reduce=y.foldl=y.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),o&&a.reduce===o)return d&&(b=y.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(z(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(A);return c},y.reduceRight=y.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),p&&a.reduceRight===p)return d&&(b=y.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=y.keys(a);f=g.length}if(z(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(A);return c},y.find=y.detect=function(a,b,c){var d;return B(a,function(a,e,f){if(b.call(c,a,e,f))return d=a,!0}),d},y.filter=y.select=function(a,b,c){var d=[];return null==a?d:q&&a.filter===q?a.filter(b,c):(z(a,function(a,e,f){b.call(c,a,e,f)&&d.push(a)}),d)},y.reject=function(a,b,c){return y.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},y.every=y.all=function(a,b,d){b||(b=y.identity);var e=!0;return null==a?e:r&&a.every===r?a.every(b,d):(z(a,function(a,f,g){if(!(e=e&&b.call(d,a,f,g)))return c}),!!e)};var B=y.some=y.any=function(a,b,d){b||(b=y.identity);var e=!1;return null==a?e:s&&a.some===s?a.some(b,d):(z(a,function(a,f,g){if(e||(e=b.call(d,a,f,g)))return c}),!!e)};y.contains=y.include=function(a,b){return null!=a&&(t&&a.indexOf===t?a.indexOf(b)!=-1:B(a,function(a){return a===b}))},y.invoke=function(a,b){var c=i.call(arguments,2),d=y.isFunction(b);return y.map(a,function(a){return(d?b:a[b]).apply(a,c)})},y.pluck=function(a,b){return y.map(a,y.property(b))},y.where=function(a,b){return y.filter(a,y.matches(b))},y.findWhere=function(a,b){return y.find(a,y.matches(b))},y.max=function(a,b,c){if(!b&&y.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);var d=-(1/0),e=-(1/0);return z(a,function(a,f,g){var h=b?b.call(c,a,f,g):a;h>e&&(d=a,e=h)}),d},y.min=function(a,b,c){if(!b&&y.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);var d=1/0,e=1/0;return z(a,function(a,f,g){var h=b?b.call(c,a,f,g):a;h<e&&(d=a,e=h)}),d},y.shuffle=function(a){var b,c=0,d=[];return z(a,function(a){b=y.random(c++),d[c-1]=d[b],d[b]=a}),d},y.sample=function(a,b,c){return null==b||c?(a.length!==+a.length&&(a=y.values(a)),a[y.random(a.length-1)]):y.shuffle(a).slice(0,Math.max(0,b))};var C=function(a){return null==a?y.identity:y.isFunction(a)?a:y.property(a)};y.sortBy=function(a,b,c){return b=C(b),y.pluck(y.map(a,function(a,d,e){return{value:a,index:d,criteria:b.call(c,a,d,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(c<d||void 0===d)return-1}return a.index-b.index}),"value")};var D=function(a){return function(b,c,d){var e={};return c=C(c),z(b,function(f,g){var h=c.call(d,f,g,b);a(e,h,f)}),e}};y.groupBy=D(function(a,b,c){y.has(a,b)?a[b].push(c):a[b]=[c]}),y.indexBy=D(function(a,b,c){a[b]=c}),y.countBy=D(function(a,b){y.has(a,b)?a[b]++:a[b]=1}),y.sortedIndex=function(a,b,c,d){c=C(c);for(var e=c.call(d,b),f=0,g=a.length;f<g;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},y.toArray=function(a){return a?y.isArray(a)?i.call(a):a.length===+a.length?y.map(a,y.identity):y.values(a):[]},y.size=function(a){return null==a?0:a.length===+a.length?a.length:y.keys(a).length},y.first=y.head=y.take=function(a,b,c){if(null!=a)return null==b||c?a[0]:b<0?[]:i.call(a,0,b)},y.initial=function(a,b,c){return i.call(a,0,a.length-(null==b||c?1:b))},y.last=function(a,b,c){if(null!=a)return null==b||c?a[a.length-1]:i.call(a,Math.max(a.length-b,0))},y.rest=y.tail=y.drop=function(a,b,c){return i.call(a,null==b||c?1:b)},y.compact=function(a){return y.filter(a,y.identity)};var E=function(a,b,c,d){if(b&&y.every(a,y.isArray))return j.apply(d,a);for(var e=0,f=a.length;e<f;e++){var g=a[e];y.isArray(g)||y.isArguments(g)?b?h.apply(d,g):E(g,b,c,d):c||d.push(g)}return d};y.flatten=function(a,b){return E(a,b,!1,[])},y.without=function(a){return y.difference(a,i.call(arguments,1))},y.partition=function(a,b,c){b=C(b);var d=[],e=[];return z(a,function(a){(b.call(c,a)?d:e).push(a)}),[d,e]},y.uniq=y.unique=function(a,b,c,d){if(null==a)return[];y.isFunction(b)&&(d=c,c=b,b=!1);for(var e=[],f=[],g=0,h=a.length;g<h;g++){var i=a[g];c&&(i=c.call(d,i,g,a)),(b?g&&f===i:y.contains(f,i))||(b?f=i:f.push(i),e.push(a[g]))}return e},y.union=function(){return y.uniq(E(arguments,!0,!0,[]))},y.intersection=function(a){var b=i.call(arguments,1);return y.filter(y.uniq(a),function(a){return y.every(b,function(b){return y.contains(b,a)})})},y.difference=function(a){var b=E(i.call(arguments,1),!0,!0,[]);return y.filter(a,function(a){return!y.contains(b,a)})},y.zip=function(){for(var a=y.max(y.pluck(arguments,"length").concat(0)),b=new Array(a),c=0;c<a;c++)b[c]=y.pluck(arguments,""+c);return b},y.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;d<e;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},y.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=y.sortedIndex(a,b),a[d]===b?d:-1;d=c<0?Math.max(0,e+c):c}if(t&&a.indexOf===t)return a.indexOf(b,c);for(;d<e;d++)if(a[d]===b)return d;return-1},y.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(u&&a.lastIndexOf===u)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},y.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);e<d;)f[e++]=a,a+=c;return f};var F=function(){};y.bind=function(a,b){var c,d;if(x&&a.bind===x)return x.apply(a,i.call(arguments,1));if(!y.isFunction(a))throw new TypeError;return c=i.call(arguments,2),d=function(){if(!(this instanceof d))return a.apply(b,c.concat(i.call(arguments)));F.prototype=a.prototype;var e=new F;F.prototype=null;var f=a.apply(e,c.concat(i.call(arguments)));return Object(f)===f?f:e}},y.partial=function(a){var b=i.call(arguments,1);return function(){for(var c=0,d=b.slice(),e=0,f=d.length;e<f;e++)d[e]===y&&(d[e]=arguments[c++]);for(;c<arguments.length;)d.push(arguments[c++]);return a.apply(this,d)}},y.bindAll=function(a){var b=i.call(arguments,1);if(0===b.length)throw new Error("bindAll must be passed function names");return z(b,function(b){a[b]=y.bind(a[b],a)}),a},y.memoize=function(a,b){var c={};return b||(b=y.identity),function(){var d=b.apply(this,arguments);return y.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},y.delay=function(a,b){var c=i.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},y.defer=function(a){return y.delay.apply(y,[a,1].concat(i.call(arguments,1)))},y.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:y.now(),g=null,f=a.apply(d,e),d=e=null};return function(){var j=y.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,k<=0?(clearTimeout(g),g=null,h=j,f=a.apply(d,e),d=e=null):g||c.trailing===!1||(g=setTimeout(i,k)),f}},y.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=y.now()-g;j<b?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),f=e=null))};return function(){f=this,e=arguments,g=y.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},y.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},y.wrap=function(a,b){return y.partial(b,a)},y.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},y.after=function(a,b){return function(){if(--a<1)return b.apply(this,arguments)}},y.keys=function(a){if(!y.isObject(a))return[];if(w)return w(a);var b=[];for(var c in a)y.has(a,c)&&b.push(c);return b},y.values=function(a){for(var b=y.keys(a),c=b.length,d=new Array(c),e=0;e<c;e++)d[e]=a[b[e]];return d},y.pairs=function(a){for(var b=y.keys(a),c=b.length,d=new Array(c),e=0;e<c;e++)d[e]=[b[e],a[b[e]]];return d},y.invert=function(a){for(var b={},c=y.keys(a),d=0,e=c.length;d<e;d++)b[a[c[d]]]=c[d];return b},y.functions=y.methods=function(a){var b=[];for(var c in a)y.isFunction(a[c])&&b.push(c);return b.sort()},y.extend=function(a){return z(i.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},y.pick=function(a){var b={},c=j.apply(e,i.call(arguments,1));return z(c,function(c){c in a&&(b[c]=a[c])}),b},y.omit=function(a){var b={},c=j.apply(e,i.call(arguments,1));for(var d in a)y.contains(c,d)||(b[d]=a[d]);return b},y.defaults=function(a){return z(i.call(arguments,1),function(b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])}),a},y.clone=function(a){return y.isObject(a)?y.isArray(a)?a.slice():y.extend({},a):a},y.tap=function(a,b){return b(a),a};var G=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof y&&(a=a._wrapped),b instanceof y&&(b=b._wrapped);var e=k.call(a);if(e!=k.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;var g=a.constructor,h=b.constructor;if(g!==h&&!(y.isFunction(g)&&g instanceof g&&y.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1;c.push(a),d.push(b);var i=0,j=!0;if("[object Array]"==e){if(i=a.length,j=i==b.length)for(;i--&&(j=G(a[i],b[i],c,d)););}else{for(var l in a)if(y.has(a,l)&&(i++,!(j=y.has(b,l)&&G(a[l],b[l],c,d))))break;if(j){for(l in b)if(y.has(b,l)&&!i--)break;j=!i}}return c.pop(),d.pop(),j};y.isEqual=function(a,b){return G(a,b,[],[])},y.isEmpty=function(a){if(null==a)return!0;if(y.isArray(a)||y.isString(a))return 0===a.length;for(var b in a)if(y.has(a,b))return!1;return!0},y.isElement=function(a){return!(!a||1!==a.nodeType)},y.isArray=v||function(a){return"[object Array]"==k.call(a)},y.isObject=function(a){return a===Object(a)},z(["Arguments","Function","String","Number","Date","RegExp"],function(a){y["is"+a]=function(b){return k.call(b)=="[object "+a+"]"}}),y.isArguments(arguments)||(y.isArguments=function(a){return!(!a||!y.has(a,"callee"))}),"function"!=typeof/./&&(y.isFunction=function(a){return"function"==typeof a}),y.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},y.isNaN=function(a){return y.isNumber(a)&&a!=+a},y.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==k.call(a)},y.isNull=function(a){return null===a},y.isUndefined=function(a){return void 0===a},y.has=function(a,b){return l.call(a,b)},y.noConflict=function(){return a._=b,this},y.identity=function(a){return a},y.constant=function(a){return function(){return a}},y.property=function(a){return function(b){return b[a]}},y.matches=function(a){return function(b){if(b===a)return!0;for(var c in a)if(a[c]!==b[c])return!1;return!0}},y.times=function(a,b,c){for(var d=Array(Math.max(0,a)),e=0;e<a;e++)d[e]=b.call(c,e);return d},y.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},y.now=Date.now||function(){return(new Date).getTime()};var H={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};H.unescape=y.invert(H.escape);var I={escape:new RegExp("["+y.keys(H.escape).join("")+"]","g"),unescape:new RegExp("("+y.keys(H.unescape).join("|")+")","g")};y.each(["escape","unescape"],function(a){y[a]=function(b){return null==b?"":(""+b).replace(I[a],function(b){return H[a][b]})}}),y.result=function(a,b){if(null!=a){var c=a[b];return y.isFunction(c)?c.call(a):c}},y.mixin=function(a){z(y.functions(a),function(b){var c=y[b]=a[b];y.prototype[b]=function(){var a=[this._wrapped];return h.apply(a,arguments),K.call(this,c.apply(y,a))}})};var J=0;y.uniqueId=function(a){var b=++J+"";return a?a+b:b},y.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};y.chain=function(a){return y(a).chain()};var K=function(a){return this._chain?y(a).chain():a};y.mixin(y),z(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=e[a];y.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],K.call(this,c)}}),z(["concat","join","slice"],function(a){var b=e[a];y.prototype[a]=function(){return K.call(this,b.apply(this._wrapped,arguments))}}),y.extend(y.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof d&&d.amd&&d("underscore",[],function(){return y})}.call(this),d("underscorenc",["underscore"],function(a){return a.mixin({deepExtend:function(b){return a.each(Array.prototype.slice.call(arguments,1),function(c){var d,e;for(var f in c)d=c[f],!a.isObject(d)||d.constructor!==Object&&d.constructor!==Array?c.hasOwnProperty(f)&&(b[f]=d):(e=b[f]=b[f]||new d.constructor,a.deepExtend(e,d))}),b},deepClone:function(b){return a.deepExtend({},b)},isArrayOf:function(b,c){var d=Array.prototype.slice.call(arguments,1);if(0===d.length||!a.every(d,function(b){return a.isFunction(b)}))throw"This method takes an array and one or more validation functions.";return a.isArray(b)&&b.length>0&&a.every(b,function(b){return a.some(d,function(a){return a(b)})})},isArrayOfStrings:function(b){return a.isArrayOf(b,a.isString)},isObjectNotArray:function(b){return a.isObject(b)&&!a.isArray(b)},isNullUndef:function(b){return a.isNull(b)||a.isUndefined(b)},isFalsy:function(b){return a.isNullUndef(b)||b===!1||0===b||a.isEmpty(b)},getFirstIndex:function(b,c){if(!a.isArray(b))return null;if(!a.isFunction(c))throw"Callback with predicate is required, i.e. function(item) {return item.isMain;}";var d=null;return a.some(b,function(a,b){return!!c(a)&&(d=b,!0)}),d},wrapInto:function(b,c){if(a.isNullUndef(b)||a.isNullUndef(c))throw"string and char are required";return c.toString()+b.toString()+c.toString()},isNonEmptyString:function(b){return a.isString(b)&&b.length>0},isNonEmptyArray:function(b){return a.isArray(b)&&!a.isEmpty(b)},reorderArray:function(a,b){var c,d=[];for(c=0;c<a.length;c++)d[c]=b[a[c]];for(c=0;c<b.length;c++)a.indexOf(c)===-1&&d.push(b[c]);return d},getStringOfLen:function(b,c){return a.map(a.range(b),function(){return c||" "}).join("")}}),a.noConflict()}),d("namedMaps",["underscorenc"],function(a){var b={object:function(a){return a=a||1,{argIndex:a,c:["object"]}},error:function(a,b){return a=a||2,{argIndex:a,p:"errorHandler",c:[{len:3},"function"]}},success:function(a){return a=a||1,{argIndex:a,p:"successHandler",c:["function"]}}};return b}),d("namedValidators",["underscorenc"],function(a){var b={handlers:{p:["successHandler","errorHandler"],c:["function"]}};return b}),d("metadata",[],function(){return{Annotation:{navigationProperties:{Annotation_parent_Source:{navigationProperty:"parent",field:"parent_id"},Annotation_createdByTool_Source:{navigationProperty:"createdByTool",field:"created_by_tool_id"},Annotation_container_Source:{navigationProperty:"container",field:"container_id"},Tag_annotation_Target:{navigationProperty:"tags"},AnnotationSharedWith_annotation_Target:{navigationProperty:"shared_with"}},fields:[{name:"annotation_id",type:"Number",nullable:"false"},{name:"annotator_id",type:"Number",nullable:"false"},{name:"content_id",maxLength:"60",type:"String",nullable:"false"},{name:"object_id",maxLength:"32",type:"String"},{name:"type_id",type:"Number",nullable:"false"},{name:"l0",maxLength:"10",type:"String"},{name:"l1",maxLength:"10",type:"String"},{name:"l2",maxLength:"10",type:"String"},{name:"l3",maxLength:"10",type:"String"},{name:"l4",maxLength:"10",type:"String"},{name:"l5",maxLength:"10",type:"String"},{name:"l6",maxLength:"10",type:"String"},{name:"title",maxLength:"300",type:"String"},{name:"body_text",maxLength:"10000",type:"String"},{name:"body_url",maxLength:"500",type:"String"},{name:"start_pos",type:"Number",nullable:"false"},{name:"end_pos",type:"Number",nullable:"false"},{name:"coord_x",type:"Number",nullable:"false"},{name:"coord_y",type:"Number",nullable:"false"},{name:"style",maxLength:"500",type:"String"},{name:"color",maxLength:"10",type:"String"},{name:"parent_id",type:"Number"},{name:"visibility_id",type:"Number",nullable:"false"},{name:"created_by_tool_id",type:"Number",nullable:"false"},{name:"container_id",type:"Number"},{name:"path",maxLength:"500",type:"String"},{name:"flag_id",type:"Number",nullable:"false"},{name:"data",maxLength:"10000",type:"String"},{name:"created_date",type:"Date"},{name:"updated_date",type:"Date"},{name:"deleted_date",type:"Date"},{name:"Version",maxLength:"8",type:"Edm.Binary",nullable:"false"},{name:"hmh_id",maxLength:"32",type:"String"}],keyField:"annotation_id"},Tag:{navigationProperties:{Tag_annotation_Source:{navigationProperty:"annotation",field:"annotation_id"}},fields:[{name:"tag_id",type:"Number",nullable:"false"},{name:"annotation_id",type:"Number",nullable:"false"},{name:"annotator_id",type:"Number",nullable:"false"},{name:"content_id",maxLength:"60",type:"String"},{name:"value",maxLength:"60",type:"String",nullable:"false"},{name:"Version",maxLength:"8",type:"Edm.Binary",nullable:"false"}],keyField:"tag_id"},Container:{navigationProperties:{Container_parent_Source:{navigationProperty:"parent",field:"parent_id"}},fields:[{name:"id",type:"Number",nullable:"false"},{name:"annotator_id",type:"Number",nullable:"false"},{name:"parent_id",type:"Number"},{name:"created_date",type:"Date",nullable:"false"},{name:"title",maxLength:"50",type:"String"},{name:"summary_text",maxLength:"50",type:"String"},{name:"order_number",type:"Number"},{name:"Version",maxLength:"8",type:"Edm.Binary",nullable:"false"},{name:"submitted_for_annotator_id",type:"Number"},{name:"submitted_status",type:"Number",nullable:"false"},{name:"submitted_date",type:"Date"}],keyField:"id"},AnnotationSharedWith:{navigationProperties:{AnnotationSharedWith_annotation_Source:{navigationProperty:"annotation",field:"annotation_id"}},fields:[{name:"id",type:"Number",nullable:"false"},{name:"annotation_id",type:"Number",nullable:"false"},{name:"annotator_id",type:"Number",nullable:"false"},{name:"annotation_annotator_id",type:"Number",nullable:"false"},{name:"created_date",type:"Date"},{name:"Version",maxLength:"8",type:"Edm.Binary",nullable:"false"}],keyField:"id"}}}),d("defaults",["metadata"],function(a){return{AnnotationTypes:[{id:1,name:"Bookmark"},{id:2,name:"Highlight"},{id:3,name:"Static Note"},{id:4,name:"Interactive Note"},{id:5,name:"HighlightMX"},{id:6,name:"StaticNoteMX"},{id:7,name:"TeacherComment"},{id:8,name:"Automatic Bookmark"},{id:9,name:"eBook Answer"},{id:10,name:"Student Cover Note"},{id:11,name:"Teacher Cover Note"},{id:12,name:"Graphic Organizer"},{id:13,name:"Maps Wizard"}],AppSettings:{AWSMaxLenghtUploadedFileKB:"20481",AWSMaxObjectsClonable:"50",ETagMaxLengthInChars:"23",MaxChangesetCount:"50",MaxCountOnInsert:"50",MaxExpandCount:"3",MaxExpandDepth:"3",MaxResults:"50",UrlExpirySeconds:"1800"},ClientTools:{Undefined:0,eBook:1,Notebook:2,MX:4,Portfolio:8,DLO:16},FieldsSettableOnCreationOnly:{Annotations:["type_id","created_by_tool_id"]},Metadata:a,ReadOnlyFields:{Annotations:["annotation_id","annotator_id","created_date","updated_date"],Containers:["id","annotator_id","created_date"],Tags:["tag_id","annotator_id"]},RequiredFields:{Annotations:["type_id","content_id"],Tags:["value","annotation_id"]},containerStatus:{NotSubmitted:0,Submitted:1,Returned:2}}}),d("config",["namedMaps","namedValidators","defaults"],function(a,b,c){var d=-1,e={userId:"user_id",userIds:"user_ids",userGuid:"user_guid",submittedForUserId:"submitted_for_user_id",contentId:"content_id",objectId:"object_id",typeId:"type_id",clientId:"client_id",containerId:"container_id",recursive:"recursive",submitTo:"submitTo",option:"option",classId:"class_id",text:"text",annotationId:"annotation_id",visibility_id:"visibility_id"};return{API_VERSION:{client:"2.4.0",service:"Service version is not available."},UNDEF_NUM:d,DEBUG_MODE_ON:!0,SERVER_URL:"/",SERVICE_PREFIX:"api/data/",SERVICE_DPS:"services/",SERVICE_APP_SETTINGS:"api/data/AppSettings",ACTION_STORAGE_UPLOAD_URL:"action/storage/upload",ACTION_DOWNLOAD_GET_URL:"action/download/geturl/?annotation_id=",ACTION_UPDATE_URL:"action/update/UpdateObjectAndAnnotationByAnnotationId/?annotation_id=",ACTION_DELETE_URL:"action/delete/RemoveObjectAndAnnotationByAnnotationId/?annotation_id=",INTERNAL_DEFAULTS:{SERVER_URL:"/",USE_POST_TUNNELING:!0,TOKEN_AUTHN:null,FORCE_ODATA_VERSION:void 0,CORS:!1,SUPPRESS_VALIDATION:!1,REQUEST_TIMEOUT:2e4,NEXT_LINK_DOMAIN_STRIPPING:!0,CLIENT_ID:d,DEFAULT_PARSE_DATE:!1,PLATFORM_KEEPALIVE_DEFAULT_DELAY:84e4},REQ_TYPE_GET:"GET",REQ_TYPE_POST:"POST",REQ_TYPE_PUT:"PUT",REQ_TYPE_MERGE:"MERGE",REQ_TYPE_DELETE:"DELETE",ANNO2_WITH_NO_SHARED:0,ANNO2_WITH_SHARED_ONLY:1,ANNO2_WITH_SHARED:2,ANNO2_MY_NOT_SHARED_TO_OTHERS:3,TRANSPORT_NAMES:{ODATA:"oData",AJAX:"ajax"},NAMED_MAPS:a,NAMED_VALIDATORS:b,CRUD:{create:"create",update:"update",remove:"remove",find:"find",findOne:"findOne"},CUSTOM_ENDPOINTS:{FIND_COMMENTS:"findComments",DISTINCT_TAGS:"getDistinctTags",FIND_ALL_ANNOTATIONS_BY_TEXT:"findAllAnnotationsByText",GET_SUBMITTED:"getSubmitted",GET_USERS_FOR_ANNOTATION_ID:"getUsersForAnnotationId",FIND_COMMENTED_ANNOTATIONS:"findCommentedAnnotations",CREATE_IMAGE:"createImage",FIND_IMAGE:"findImage",UPDATE_IMAGE:"updateImage",REMOVE_IMAGE:"removeImage"},COLLECTIONS:{annotations:{name:"annotations",entity:"Annotation",nameUppercase:"Annotations",expandName:"annotation"},tags:{name:"tags",entity:"Tag",nameUppercase:"Tags",expandName:"tags"},containers:{name:"containers",entity:"Container",nameUppercase:"Containers",expandName:"container"},clientIDs:{name:"client_tools",entity:"ClientTool",nameUppercase:"ClientTools"},annotationSharedWith:{name:"annotationSharedWith",entity:"AnnotationSharedWith",nameUppercase:"AnnotationSharedWith",expandName:"shared_with"},entityless:{name:"entityless",entity:"entityless",nameUppercase:"entityless"}},QUERY_PARAMS:e,QUERY_PARAMS_ASSIGNMENTS:{getDistinctTags:[e.content_id,e.client_id,e.container_id,e.recursive]},FORCE_ODATA_VERSION:void 0,FORCE_DEFAULT_SERVICE_SETTINGS:!1,ERROR_DOCUMENTATION_URL:"http://dubconf.hmhpub.com:8080/display/DP2/Error+handling",ERROR_DOCUMENTATION_ANCHOR:"#Errorhandling-",EXPAND:"$expand=",EXPANDING_METHODS:{mySharedToOthers:"mySharedToOthers",withTags:"withTags",withShared:"withShared",withSharedOnly:"withSharedOnly",withSharedAnnotations:"withSharedAnnotations"},CONFLICTED_METHODS:{find:{myNotSharedToOthers:{name:"myNotSharedToOthers",methods:["findImage","mySharedToOthers","withShared","withSharedOnly"]},mySharedToOthers:{name:"mySharedToOthers",methods:["findImage","myNotSharedToOthers","withShared","withSharedOnly"]},withShared:{name:"withShared",methods:["findImage","myNotSharedToOthers","mySharedToOthers","withSharedOnly"]},withSharedOnly:{name:"withSharedOnly",methods:["findImage","myNotSharedToOthers","withShared","mySharedToOthers"]},findImage:{name:"findImage",methods:["withTags","myNotSharedToOthers","mySharedToOthers","withShared","withSharedOnly"]},withTags:{name:"withTags",methods:["findImage"]}},create:{createImage:{name:"createImage",methods:["tags","childAnnotations"]},tags:{name:"tags",methods:["createImage"]},childAnnotations:{name:"childAnnotations",methods:["createImage"]}}},SETTINGS:{AnnotationTypes:[],AppSettings:{},ClientTools:{},FieldsSettableOnCreationOnly:{},Metadata:{},ReadOnlyFields:{},RequiredFields:{},containerStatus:{},ExcludeNonServiceSettingsProperties:["Version"],ExcludeFromServiceSettingsParsing:["AnnotationTypes","ClientTools","Metadata"],Source:"",serviceSettingsStatuses:[]},SETTINGS_SOURCES:{CLIENT_DEFAULTS:"client_defaults",SERVICE_WITH_CLIENT_DEFAULTS:"service_with_client_defaults",SERVICE:"service",FORCED_CLIENT_DEFAULTS:"forced_client_defaults"},DEFAULTS:c,API_INITIALIZED:!1}}),d("errorList",[],function(){return[{code:"API_ERR_AJAX_1",error:"method {0} expects {1} parameters {2}"},{code:"API_ERR_AJAX_2",error:"{0} is required to use {1}"},{code:"API_ERR_AJAX_3",error:"{0} is already running, stop it with {1} first!"},{code:"API_ERR_GENERAL_1",error:"param {0} for method {1} must be {2}, but it is {3} instead"},{code:"API_ERR_GENERAL_2",error:'The {0} provided: "{1}" is not supported by data persistence!'},{code:"API_ERR_GENERAL_3",error:"Missing required parameter {0} when calling {1}."},{code:"API_ERR_QUERY_API_1",error:"{0}: method {1} must be called empty or with {2} (type {3})"},{code:"API_ERR_QUERY_API_2",error:"{0}: param {1} is required when method {2} is used with {3}"},{code:"API_ERR_QUERY_API_3",error:"{0}: param {1} for method {2} must be {3}, but it is {4} instead"},{code:"API_ERR_QUERY_API_4",error:"{0}: method {1} expects {2}"},{code:"API_ERR_QUERY_API_5",error:"{0}: {1} method can be used only with {2} operation(s)"},{code:"API_ERR_QUERY_API_6",error:"{0}: {1} method cannot be used with multiple {2} passed"},{code:"API_ERR_QUERY_API_7",error:"{0}: {1} field is populated automatically, so {1} : {2} is invalid and it cannot be used in {3} method"},{code:"API_ERR_QUERY_API_8",error:"queryAPI: {0}: operation already set, check if you mixed CRUD operations in single query"},{code:"API_ERR_QUERY_API_9",error:"fields [{0}] are not allowed"},{code:"API_ERR_QUERY_API_10",error:"{0}: {1} is not a function"},{code:"API_ERR_QUERY_API_11",error:"{0}: {1} field is not allowed in {2} operation"},{code:"API_ERR_QUERY_API_12",error:"Length of field {0} exceeds maximum allowed length (length: {1}, allowed: {2})"},{code:"API_ERR_QUERY_API_13",error:"Annotation service API isn't initialized or annService.init method hasn't finished"},{code:"API_ERR_QUERY_API_14",error:"method {0} can be used only with {1}"},{code:"API_ERR_QUERY_API_15",error:"Operation must be set in order to call {0} function"},{code:"API_ERR_QUERY_API_16",error:"method {0} can be only called once"},{code:"API_ERR_QUERY_API_17",error:"fields {0} for object {1} are required"},{code:"API_ERR_QUERY_API_18",error:"In batch operations, number of items in {0} and number of {1} has to be the same"},{code:"API_ERR_QUERY_API_19",error:"etags: etag with value {0} and length {1} is not the right length (expected less than {2} and greater than 0)"},{code:"API_ERR_QUERY_API_20",error:"{0}: {1} method cannot be used with any of the following methods: {2}"},{code:"API_ERR_QUERY_API_21",error:"In batch operations, number of items in {0} method has to match a numer of subrequests"},{code:"API_ERR_TRANSPORT_1",error:"oDataTransport: number of batch request items have exceeded the server side imposed limit of {0}"},{code:"API_ERR_TRANSPORT_2",error:'filtersParser: validate: key "{0}" is not one of valid operators: {1}'},{code:"API_ERR_TRANSPORT_3",error:'filtersParser: buildComparator: could not find compare operation for key "{0}". Valid keys: {1}'}]}),d("resetManager",["underscorenc","config","helpers"],function(a,b,c){function d(){a.each(f,function(a){a()})}function e(b){if(!a.isFunction(b))throw"ResetManager:addSubscriber: Metdhod accepts only functions.";f.push(b)}var f=[],g={resetLib:d,subscribe:e};return g}),d("errorManager",["underscorenc","errorList","config","resetManager"],function(a,b,c,d){var e={},f=function(a,b){var c=a+"",d=new RegExp("{-?[0-9]+}","g");return c.replace(d,function(a){var c,d=parseInt(a.substring(1,a.length-1));return c=d>=0?b[d]:d===-1?"{":d===-2?"}":""})};return e.throwError=function(e,g,h){if(!c.SUPPRESS_VALIDATION){var i=a.find(b,function(a){return a.code===e});d.resetLib();var j="Code: {0} Message: {1}, Help page: {2}";if(a.isNumber(h)&&(j="Code: {0} Message: (for sub-query index "+h+") {1}, Help page: {2}"),a.isUndefined(i))throw"Code not found in error messages";var k=f(i.error,g);throw f(j,[i.code,k,c.ERROR_DOCUMENTATION_URL+c.ERROR_DOCUMENTATION_ANCHOR+i.code]);
}},e}),d("helpers",["underscorenc","config","errorManager"],function(a,b,c){function d(a){return encodeURIComponent(a.replace(/'/g,"%27"))}function e(a,c){if(b.DEBUG_MODE_ON)throw new Error("Error in '"+c+"': "+a)}function f(b){var c,d="";if(a.isObject(b))for(c in b)d+="["+c+': "'+b[c]+'"]';else d+=b;return d}var g={};g.encodeUrlString=d,g.isUserTokenSet=function(){return void 0!=b.TOKEN_AUTHN},g.isServiceReady=function(){return b.API_INITIALIZED||b.SUPPRESS_VALIDATION||this.throwQueryError("API_ERR_QUERY_API_13",null),!0},g.debugContainsAnnotationsId=function(a,c,d,e){if(b.DEBUG_MODE_ON){e=e||"";var f=!1;return f=void 0!==c[a],f&&alert(a+" found in fieldsValues for "+d+". "+e),f}},g.debugParseResults=function(a){var b,c="";if(a.hasOwnProperty("results"))for(b=0;b<a.results.length;b++)c+=f(a.results[b]);else c+=f(a);return c},g.getEmptyParams=function(){return{successHandler:null,errorHandler:null,visibility:null,visibilityId:null,contentId:null,fields:null,filters:null,orderBy:null,orderDesc:!1,getCount:!1,orderAscending:null,limitFrom:null,limitCount:null,parseDate:null}},g.getHeader=function(c,d){a.isString(c)||(d=c);var e={};return e.Accept="application/json;odata=fullmetadata;q=0.8, application/atom+xml;q=0.7, application/json;q=0.5, */*;q=0.1",a.extend(e,d),g.isUserTokenSet()&&(e.Authorization=b.TOKEN_AUTHN),!b.USE_POST_TUNNELING&&void 0!=[].indexOf||c!==b.REQ_TYPE_MERGE||(e["X-HTTP-Method"]=c),a.isUndefined(b.FORCE_ODATA_VERSION)||(e.DataServiceVersion=b.FORCE_ODATA_VERSION,e.MaxDataServiceVersion=b.FORCE_ODATA_VERSION),e},g.getHTTPMethod=function(a){return!b.USE_POST_TUNNELING&&void 0!=[].indexOf||a!==b.REQ_TYPE_MERGE?a:b.REQ_TYPE_POST};var h={"function":a.isFunction,number:a.isNumber,array:a.isArray,object:a.isObject,string:a.isString,"boolean":a.isBoolean};g.areArgsValidType=function(a,b){var d,e,f,g;for(d=0;d<a.length;d++)for(e=0;e<a[d].o.length&&(void 0!==a[d].o[e]&&null!==a[d].o[e]);e++){for(g=!1,f=0;f<a[d].t.length;f++){if(!h[a[d].t[f]])throw a[d].t[f]+" is not defined in typeMap.";if(g=h[a[d].t[f]](a[d].o[e]))break}g||c.throwError("API_ERR_GENERAL_1",["","",a[d].t,a[d].o[e]])}},g.setParams=function(a,b,d,e){var f;for(a=a||{},b=b||[],e=e||"(unknown)",f=0;f<b.length;f++)a[b[f]]=void 0==a[b[f]]?null:a[b[f]],a[b[f]]||c.throwError("API_ERR_GENERAL_3",[b[f],e]);if(d)for(f=0;f<d.length;f++)a[d[f]]=void 0==a[d[f]]?null:a[d[f]];return a},g.consoleLog=function(){b.DEBUG_MODE_ON&&window.console&&console.log&&(console.log.apply?console.log.apply(console,arguments):Array.prototype.slice.call(arguments))},g.defSuccessCb=function(a){g.consoleLog("---------* Results: *---------\n",a,"\n------------------------------")},g.defErrorCb=function(a){g.consoleLog("----------! ERROR !-----------\n",a,"\n------------------------------")},g.getRequestURL=function(a,c){return b.SERVER_URL+b.SERVICE_PREFIX+(c?"":b.SERVICE_DPS)+a},g.checkLength=function(a){var b=a.len;a.com;return function(a){return!(a.length!==b)}},g.throwError=e;var i=function(c,d){var e={navigationProperties:{}},f={"Edm.DateTime":"Date","Edm.Int32":"Number","Edm.String":"String"},h=a.findWhere(b.SETTINGS.serviceSettingsStatuses,{name:"Metadata"}),i=d&&d["edmx:Edmx"]&&d["edmx:Edmx"]["edmx:DataServices"]&&d["edmx:Edmx"]["edmx:DataServices"].Schema&&d["edmx:Edmx"]["edmx:DataServices"].Schema.EntityType,j=d&&d["edmx:Edmx"]&&d["edmx:Edmx"]["edmx:DataServices"]&&d["edmx:Edmx"]["edmx:DataServices"].Schema&&d["edmx:Edmx"]["edmx:DataServices"].Schema.Association;if(!i||!a.isArray(i)||!a.contains(a.pluck(i,"@Name"),c))return g.consoleLog("* Can't parse metadata for entity: "+c+". Using the default value."),b.DEFAULTS.Metadata[c];if(h.received=!0,h.correctFormat=!0,!j||!a.isArray(j))return g.consoleLog("* Can't navigation properties for entity: "+c+". Using the default value."),b.DEFAULTS.Metadata[c].navigationProperties;var k=a.find(i,function(b){if(!a.isUndefined(b.Property)&&a.isArray(b.Property)&&!a.isUndefined(b.NavigationProperty)&&(a.isArray(b.NavigationProperty)||a.isObject(b.NavigationProperty)))return!(!b||b["@Name"]!=c)});return a.isUndefined(k)?b.DEFAULTS.Metadata[c]:(e.fields=a.map(k.Property,function(b){return b=a.object(a.map(b,function(a,b){return[b.charAt(1).toLowerCase()+b.slice(2),a]})),b.type=f[b.type]||b.type,a.pick(b,["name","maxLength","type","nullable"])}),a.isArray(k.NavigationProperty)||(k.NavigationProperty=[k.NavigationProperty]),a.each(k.NavigationProperty,function(b){e.navigationProperties[b["@FromRole"]]={},e.navigationProperties[b["@FromRole"]].navigationProperty=a.first(a.values(a.pick(b,"@Name"))),a.each(j,function(c){a.contains(c.ReferentialConstraint.Dependent,b["@FromRole"])&&(e.navigationProperties[b["@FromRole"]].field=c.ReferentialConstraint.Dependent.PropertyRef["@Name"])})}),e.keyField=k.Key&&k.Key.PropertyRef&&k.Key.PropertyRef["@Name"],e)};return g.parseMetadata=function(c){var d={},e=a.findWhere(b.SETTINGS.serviceSettingsStatuses,{name:"Metadata"});return d[b.COLLECTIONS.annotations.entity]=i(b.COLLECTIONS.annotations.entity,c),d[b.COLLECTIONS.tags.entity]=i(b.COLLECTIONS.tags.entity,c),d[b.COLLECTIONS.containers.entity]=i(b.COLLECTIONS.containers.entity,c),d[b.COLLECTIONS.annotationSharedWith.entity]=i(b.COLLECTIONS.annotationSharedWith.entity,c),a.isEqual(d,b.DEFAULTS.Metadata)&&(e.upToDate=!0),d},g.getArrayLengthIE8=function(a){for(var b=a.length;!a.hasOwnProperty(--b););return++b,b},g.templatify=function(a){return function(b){for(var c,d=/<%= (.+?) %>/g,e=a;c=d.exec(a);)e=e.replace(c[0],b[c[1]]);return e}},g.getResponseAdditionalData=function(b){var c={},d=a.keys(b.headers);return c.headers={},a.each(d,function(a){c.headers[a]=b.headers[a]}),c.statusCode=b.statusCode,c.statusText=b.statusText,b&&b.data&&b.data.__count&&(c.totalCount=b.data.__count),c},g.getAjaxResponseAdditionalData=function(a){var b={};return a&&a.getAllResponseHeaders?b.headers=g.parseAjaxResponseHeaders(a.getAllResponseHeaders()):b.headers=a.headers,"function"!=typeof a.statusCode?b.statusCode=a.statusCode:b.statusCode=a.status,"function"!=typeof a.statusText?b.statusText=a.statusText:b.statusText=a.status,b},g.parseAjaxResponseHeaders=function(a){var b={};if(!a)return b;for(var c=a.split("\r\n"),d=0;d<c.length;d++){var e=c[d],f=e.indexOf(": ");if(f>0){var g=e.substring(0,f),h=e.substring(f+2);b[g]=h}}return b},g.getPropertyValueCaseInsensitive=function(b,c){var d;return c=(c+"").toLowerCase(),!a.isUndefined(b)&&a.isObject(b)&&(d=b[a.find(a.keys(b),function(a){return a.toLowerCase()===c})]),d},g.updateVisibilityIdByNames=function(a,b){var d="updateVisibilityIdByClientNames";g.areArgsValidType([{o:[a.previousVisibility_id],t:["number"]},{o:[a.includeClients,a.excludeClients],t:["array","string"]}],d),(void 0===a.currentVisibilityId||void 0===a.includeClients&&void 0===a.excludeClients)&&c.throwError("API_ERR_CLIENT_2",[d]);var e=a.currentVisibilityId,f=a.includeClients?g.convertNamesToID(a.includeClients):null,h=a.excludeClients?g.convertNamesToID(a.excludeClients):null;return f&&(e|=f),h&&(e&=~h),e},g.convertNamesToID=function(d){var e,f=0;for(d=a.isString(d)?[d]:d,e=0;e<d.length;e++)void 0===b.SETTINGS.ClientTools[d[e]]?c.throwError("API_ERR_GENERAL_2",["client_id",d[e]]):f|=b.SETTINGS.ClientTools[d[e]];return f},g.concatenateStrings=function(b,c,d){if(!a.isArray(c))throw"concatenateStrings: stringCollection must be an array";var e=this;return c=a.reject(c,function(b){return a.isNull(b)||a.isUndefined(b)||a.isString(b)&&""===e.trim(b)}),b=c.length>0&&a.isString(b)?b:"",d=a.isString(d)?d:"",b+c.join(d)},g.isFunSwitchEnabled=function(a){return 0===a.length||!!a[0]},g.tempAndUglyGetEntityName=function(c){var d;return a.some(b.COLLECTIONS,function(a){return a.nameUppercase===c&&(d=a.entity,!0)}),d},g.trim=function(a){return"function"!=typeof String.prototype.trim?a.replace(/^\s+|\s+$/g,""):a.trim()},g.makeFirstLetterLowercase=function(b){if(a.isString(b))return b.substr(0,1).toLowerCase()+b.substr(1)},g.getMetadataByEntityName=function(c){if(a.isString(c)){var d=a.find(b.COLLECTIONS,function(a){return c.toLowerCase()===a.name.toLowerCase()});if(d)return b.SETTINGS.Metadata[d.entity]}},g.toType=function(b){return a.isNull(b)?"null":a.isUndefined(b)?"undefined":{}.toString.call(b).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},g.ServiceSettingsStatus=function(a){this.name=a,this.received=!1,this.correctFormat=!1,this.upToDate=!1,this.unknown=!1,this.forced=!1},g}),d("client",["underscorenc","config","helpers","errorManager"],function(a,b,c,d){var e={init:function(){return this}},f=b.UNDEF_NUM;return e.getID=function(){return f},e._parseClientIds=function(c){if(c){var d=a.findWhere(b.SETTINGS.serviceSettingsStatuses,{name:"ClientTools"});if(d.received=!0,c.length&&a.isArray(c)){d.correctFormat=!0;var e={};if(a.each(c,function(b){a.isUndefined(b.client_tool_description)||a.isUndefined(b.client_tool_id)||(e[b.client_tool_description]=b.client_tool_id)}),a.size(e)>0)return a.isEqual(e,b.DEFAULTS.ClientTools)&&(d.upToDate=!0),void(b.SETTINGS.ClientTools=e)}else b.SETTINGS.ClientTools=b.DEFAULTS.ClientTools}},e.convertNamesToID=function(c){var e,f=0;for(c=a.isString(c)?[c]:c,e=0;e<c.length;e++)void 0===b.SETTINGS.ClientTools[c[e]]?d.throwError("API_ERR_GENERAL_2",["client_id",c[e]]):f|=b.SETTINGS.ClientTools[c[e]];return f},e.convertIDToNames=function(a){var c,d=[];for(c in b.SETTINGS.ClientTools)b.SETTINGS.ClientTools[c]&a&&d.push(c);return d},e.setID=function(a){f=e.convertNamesToID(a)||b.UNDEF_NUM},e.isSet=function(){return f!==b.UNDEF_NUM},e.updateVisibilityIdByNames=function(a){var b="updateVisibilityIdByClientNames";c.areArgsValidType([{o:[a.previousVisibility_id],t:["number"]},{o:[a.includeClients,a.excludeClients],t:["array","string"]}],b),(void 0===a.currentVisibilityId||void 0===a.includeClients&&void 0===a.excludeClients)&&d.throwError("API_ERR_QUERY_API_4",[b,"currentVisibilityId and includeClients or excludeClients"]);var f=a.currentVisibilityId,g=a.includeClients?e.convertNamesToID(a.includeClients):null,h=a.excludeClients?e.convertNamesToID(a.excludeClients):null;return g&&(f|=g),h&&(f&=~h),f},e.convertNamesToVisibilityIds=function(c,f){for(var g=a.keys(b.SETTINGS.ClientTools).length-1,h=[],i=[],j=0;j<Math.pow(g,2);j++)i.push(j);if(c=a.isString(c)?[c]:c,c&&c.length>0)if(f&&0===f.length&&(f="or"),"and"===f)h.push(e.convertNamesToID(c));else for(j=0;j<i.length;j++)for(var k=0;k<c.length;k++)a.each(c,function(e){void 0===b.SETTINGS.ClientTools[c[k]]&&d.throwError("API_ERR_GENERAL_2",["client_id",c[j]]),b.SETTINGS.ClientTools[c[k]]&i[j]&&a.indexOf(i[j],h)===-1&&h.push(i[j])});return h},e.convertNamesToVisibilityIdsForGet=function(c){var e=[];return a.isString(c)&&(c=[c]),a.each(c,function(a){b.SETTINGS.ClientTools[a]?e.push(b.SETTINGS.ClientTools[a]):d.throwError("API_ERR_GENERAL_2",["client_id",a])}),e},e.init()}),function(a,b){var c=a.datajs||{},d=a.OData||{};a.datajs=c,a.OData=d,c.version={major:1,minor:1,build:1};var e=function(b){return a.ActiveXObject?new a.ActiveXObject(b):null},f=function(a){return null!==a&&a!==b},g=function(a,b){var c,d;for(c=0,d=a.length;c<d;c++)if(a[c]===b)return!0;return!1},h=function(a,c){return a!==b?a:c},i=function(b){if(1===arguments.length)return void a.setTimeout(b,0);var c=Array.prototype.slice.call(arguments,1);a.setTimeout(function(){b.apply(this,c)},0)},j=function(a,b){for(var c in b)a[c]=b[c];return a},k=function(a,b){if(a){var c,d;for(c=0,d=a.length;c<d;c++)if(b(a[c]))return a[c]}return null},l=function(a){return"[object Array]"===Object.prototype.toString.call(a)},m=function(a){return"[object Date]"===Object.prototype.toString.call(a)},n=function(a){return"object"==typeof a},o=function(a){return parseInt(a,10)},p=function(a,b,c){a.hasOwnProperty(b)&&(a[c]=a[b],delete a[b])},q=function(a){throw a},r=function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},s=function(a,c){return a!==b?a:c},t=/^([^:\/?#]+:)?(\/\/[^\/?#]*)?([^?#:]+)?(\?[^#]*)?(#.*)?/,u=["scheme","authority","path","query","fragment"],v=function(a){var b={isAbsolute:!1};if(a){var c=t.exec(a);if(c){var d,e;for(d=0,e=u.length;d<e;d++)c[d+1]&&(b[u[d]]=c[d+1])}b.scheme&&(b.isAbsolute=!0)}return b},w=function(a){return"".concat(a.scheme||"",a.authority||"",a.path||"",a.query||"",a.fragment||"")},x=/^\/{0,2}(?:([^@]*)@)?([^:]+)(?::{1}(\d+))?/,y=/%[0-9A-F]{2}/gi,z=function(a){var b=v(a),c=b.scheme,d=b.authority;if(c&&(b.scheme=c.toLowerCase(),d)){var e=x.exec(d);e&&(b.authority="//"+(e[1]?e[1]+"@":"")+e[2].toLowerCase()+(e[3]?":"+e[3]:""))}return a=w(b),a.replace(y,function(a){return a.toLowerCase()})},A=function(a,b){if(!b)return a;var c=v(a);if(c.isAbsolute)return a;var d,e=v(b),f={};return c.authority?(f.authority=c.authority,d=c.path,f.query=c.query):(c.path?(d="/"===c.path.charAt(0)?c.path:B(c.path,e.path),f.query=c.query):(d=e.path,f.query=c.query||e.query),f.authority=e.authority),f.path=C(d),f.scheme=e.scheme,f.fragment=c.fragment,w(f)},B=function(a,b){var c,d="/";return b&&(c=b.lastIndexOf("/"),d=b.substring(0,c),"/"!==d.charAt(d.length-1)&&(d+="/")),d+a},C=function(a){for(var b,c="",d="";a;)0===a.indexOf("..")||0===a.indexOf(".")?a=a.replace(/^\.\.?\/?/g,""):0===a.indexOf("/..")?(a=a.replace(/^\/\..\/?/g,"/"),b=c.lastIndexOf("/"),c=b===-1?"":c.substring(0,b)):0===a.indexOf("/.")?a=a.replace(/^\/\.\/?/g,"/"):(d=a,b=a.indexOf("/",1),b!==-1&&(d=a.substring(0,b)),c+=d,a=a.replace(d,""));return c},D=function(c){var d=[];if(a.atob===b)d=E(c);else for(var e=a.atob(c),f=0;f<e.length;f++)d.push(e.charCodeAt(f));for(var g="",h="0123456789ABCDEF",i=0;i<d.length;i++){var j=d[i];g+=h[j>>4],g+=h[15&j]}return g},E=function(a){for(var b="",c=0;c<a.length;c++){var d=F(a[c]),e="";null!==d&&(e=d.toString(2),b+=G(e))}var f=[],g=parseInt(b.length/8,10);for(c=0;c<g;c++){var h=parseInt(b.substring(8*c,8*(c+1)),2);f.push(h)}return f},F=function(a){var b=a.charCodeAt(0),c=65,d=6;return b>=65&&b<=90?b-c:b>=97&&b<=122?b-c-d:b>=48&&b<=57?b+4:"+"==a?62:"/"==a?63:null},G=function(a){for(;a.length<6;)a="0"+a;return a},H="http://",I=H+"www.w3.org/",J=I+"1999/xhtml",K=I+"2000/xmlns/",L=I+"XML/1998/namespace",M=H+"www.mozilla.org/newlayout/xml/parsererror.xml",N=function(a){var b=/(^\s)|(\s$)/;return b.test(a)},O=function(a){var b=/^\s*$/;return null===a||b.test(a)},P=function(a){for(;null!==a&&1===a.nodeType;){var b=$(a,"space",L);if("preserve"===b)return!0;if("default"===b)break;a=a.parentNode}return!1},Q=function(a){var b=a.nodeName;return"xmlns"==b||0===b.indexOf("xmlns:")},R=function(a,b,c){try{a.setProperty(b,c)}catch(d){}},S=function(){var a=e("Msxml2.DOMDocument.3.0");return a&&(R(a,"ProhibitDTD",!0),R(a,"MaxElementDepth",256),R(a,"AllowDocumentFunction",!1),R(a,"AllowXsltScript",!1)),a},T=function(){try{var a=e("Msxml2.DOMDocument.6.0");return a&&(a.async=!0),a}catch(b){return S()}},U=function(a){var b=T();if(!b)return null;b.loadXML(a);var c=b.parseError;return 0!==c.errorCode&&V(c.reason,c.srcText,a),b},V=function(a,b,c){throw"string"==typeof a&&(a={message:a}),j(a,{srcText:b||"",errorXmlText:c||""})},W=function(b){var c,d=a.DOMParser&&new a.DOMParser;if(!d)return c=U(b),c||V("XML DOM parser not supported"),c;try{c=d.parseFromString(b,"text/xml")}catch(e){V(e,"",b)}var f=c.documentElement,g=f.namespaceURI,h=ia(f);if("parsererror"===h&&g===M){var i=ea(f,M,"sourcetext"),j=i?ka(i):"";V(ha(f)||"",j,b)}if("h3"===h&&g===J||fa(f,J,"h3")){for(var k="",l=[],m=f.firstChild;m;)1===m.nodeType&&(k+=ha(m)||""),l.push(m.nextSibling),m=m.firstChild||l.shift();k+=ha(f)||"",V(k,"",b)}return c},X=function(a,b){return a?a+":"+b:b},Y=function(a,b){if(N(b.data)){var c=_(a,L,"space");c||(c=qa(a.ownerDocument,L,X("xml","space")),pa(a,c)),c.value="preserve"}return a.appendChild(b),a},Z=function(a,b){var c,d,e=a.attributes;for(c=0,d=e.length;c<d;c++)b(e.item(c))},$=function(a,b,c){var d=_(a,b,c);return d?ka(d):null},_=function(a,b,c){var d=a.attributes;return d.getNamedItemNS?d.getNamedItemNS(c||null,b):d.getQualifiedItem(b,c)||null},aa=function(a,b){var c=_(a,"base",L);return(c?A(c.value,b):b)||null},ba=function(a,b){la(a,!1,function(a){return 1===a.nodeType&&b(a),!0})},ca=function(a,b,c){var d,e,f=c.split("/");for(d=0,e=f.length;d<e;d++)a=a&&ea(a,b,f[d]);return a||null},da=function(a,b,c){var d=c.lastIndexOf("/"),e=c.substring(d+1),f=c.substring(0,d),g=f?ca(a,b,f):a;return g?"@"===e.charAt(0)?_(g,e.substring(1),b):ea(g,b,e):null},ea=function(a,b,c){return ga(a,b,c,!1)},fa=function(a,b,c){if(a.getElementsByTagNameNS){var d=a.getElementsByTagNameNS(b,c);return d.length>0?d[0]:null}return ga(a,b,c,!0)},ga=function(a,b,c,d){var e=null;return la(a,d,function(a){if(1===a.nodeType){var d=!b||ja(a)===b,f=!c||ia(a)===c;d&&f&&(e=a)}return null===e}),e},ha=function(a){var c,d=null,e=9===a.nodeType&&a.documentElement?a.documentElement:a,f=e.ownerDocument.preserveWhiteSpace===!1;return la(e,!1,function(a){if(3===a.nodeType||4===a.nodeType){var g=ka(a),h=f||!O(g);h||(c===b&&(c=P(e)),h=c),h&&(d?d+=g:d=g)}return!0}),d},ia=function(a){return a.localName||a.baseName},ja=function(a){return a.namespaceURI||null},ka=function(a){return 1===a.nodeType?ha(a):a.nodeValue},la=function(a,b,c){for(var d=[],e=a.firstChild,f=!0;e&&f;)f=c(e),f&&(b&&e.firstChild&&d.push(e.firstChild),e=e.nextSibling||d.shift())},ma=function(a,b,c){for(var d=a.nextSibling;d;){if(1===d.nodeType){var e=!b||ja(d)===b,f=!c||ia(d)===c;if(e&&f)return d}d=d.nextSibling}return null},na=function(){var b=a.document.implementation;return b&&b.createDocument?b.createDocument(null,null,null):T()},oa=function(a,b){if(!l(b))return pa(a,b);var c,d;for(c=0,d=b.length;c<d;c++)b[c]&&pa(a,b[c]);return a},pa=function(a,b){if(b){if("string"==typeof b)return Y(a,ua(a.ownerDocument,b));2===b.nodeType?a.setAttributeNodeNS?a.setAttributeNodeNS(b):a.setAttributeNode(b):a.appendChild(b)}return a},qa=function(a,c,d,e){var f=a.createAttributeNS&&a.createAttributeNS(c,d)||a.createNode(2,d,c||b);return f.value=e||"",f},ra=function(a,c,d,e){var f=a.createElementNS&&a.createElementNS(c,d)||a.createNode(1,d,c||b);return oa(f,e||[])},sa=function(a,b,c){return qa(a,K,X("xmlns",c),b)},ta=function(a,b){for(var c="<c>"+b+"</c>",d=W(c),e=d.documentElement,f=("importNode"in a?a.importNode(e,!0):e),g=a.createDocumentFragment(),h=f.firstChild;h;)g.appendChild(h),h=h.nextSibling;return g},ua=function(a,b){return a.createTextNode(b)},va=function(a,b,c,d,e){var f,g,h="",i=e.split("/"),j=ea,k=ra,l=b;for(f=0,g=i.length;f<g;f++){h=i[f],"@"===h.charAt(0)&&(h=h.substring(1),j=_,k=qa);var m=j(l,c,h);m||(m=k(a,c,X(d,h)),pa(l,m)),l=m}return l},wa=function(b){var c=a.XMLSerializer;if(c){var d=new c;return d.serializeToString(b)}if(b.xml)return b.xml;throw{message:"XML serialization unsupported"}},xa=function(a){var b,c=a.childNodes,d=c.length;if(0===d)return"";var e=a.ownerDocument,f=e.createDocumentFragment(),g=e.createElement("c");for(f.appendChild(g),b=0;b<d;b++)g.appendChild(c[b]);var h=wa(f);for(h=h.substr(3,h.length-7),b=0;b<d;b++)a.appendChild(g.childNodes[b]);return h},ya=function(a,b,c){return function(){return a[b].apply(a,arguments),c}},za=function(){this._arguments=b,this._done=b,this._fail=b,this._resolved=!1,this._rejected=!1};za.prototype={then:function(a,b){return a&&(this._done?this._done.push(a):this._done=[a]),b&&(this._fail?this._fail.push(b):this._fail=[b]),this._resolved?this.resolve.apply(this,this._arguments):this._rejected&&this.reject.apply(this,this._arguments),this},resolve:function(){if(this._done){var a,c;for(a=0,c=this._done.length;a<c;a++)this._done[a].apply(null,arguments);this._done=b,this._resolved=!1,this._arguments=b}else this._resolved=!0,this._arguments=arguments},reject:function(){if(this._fail){var a,c;for(a=0,c=this._fail.length;a<c;a++)this._fail[a].apply(null,arguments);this._fail=b,this._rejected=!1,this._arguments=b}else this._rejected=!0,this._arguments=arguments},promise:function(){var a={};return a.then=ya(this,"then",a),a}};var Aa=function(){return a.jQuery&&a.jQuery.Deferred?new a.jQuery.Deferred:new za},Ba=function(a,b){var c=(a&&a.__metadata||{}).type;return c||(b?b.type:null)},Ca="Edm.",Da=Ca+"Binary",Ea=Ca+"Boolean",Fa=Ca+"Byte",Ga=Ca+"DateTime",Ha=Ca+"DateTimeOffset",Ia=Ca+"Decimal",Ja=Ca+"Double",Ka=Ca+"Guid",La=Ca+"Int16",Ma=Ca+"Int32",Na=Ca+"Int64",Oa=Ca+"SByte",Pa=Ca+"Single",Qa=Ca+"String",Ra=Ca+"Time",Sa=Ca+"Geography",Ta=Sa+"Point",Ua=Sa+"LineString",Va=Sa+"Polygon",Wa=Sa+"Collection",Xa=Sa+"MultiPolygon",Ya=Sa+"MultiLineString",Za=Sa+"MultiPoint",$a=Ca+"Geometry",_a=$a+"Point",ab=$a+"LineString",bb=$a+"Polygon",cb=$a+"Collection",db=$a+"MultiPolygon",eb=$a+"MultiLineString",fb=$a+"MultiPoint",gb="Point",hb="LineString",ib="Polygon",jb="MultiPoint",kb="MultiLineString",lb="MultiPolygon",mb="GeometryCollection",nb=[Qa,Ma,Na,Ea,Ja,Pa,Ga,Ha,Ra,Ia,Ka,Fa,La,Oa,Da],ob=[$a,_a,ab,bb,cb,db,eb,fb],pb=[Sa,Ta,Ua,Va,Wa,Xa,Ya,Za],qb=function(a,b){if(!a)return null;if(l(a)){var c,d,e;for(c=0,d=a.length;c<d;c++)if(e=qb(a[c],b))return e;return null}return a.dataServices?qb(a.dataServices.schema,b):b(a)},rb=function(a,b){return a=0===a?"":"."+ub(a.toString(),3),b>0&&(""===a&&(a=".000"),a+=ub(b.toString(),4)),a},sb=function(a){if("string"==typeof a)return a;var b=Db(a),c=vb(a.__offset);if(b&&"Z"!==c){a=new Date(a.valueOf());var d=ic(c),e=a.getUTCHours()+d.d*d.h,f=a.getUTCMinutes()+d.d*d.m;a.setUTCHours(e,f)}else b||(c="");var g=a.getUTCFullYear(),h=a.getUTCMonth()+1,i="";g<=0&&(g=-(g-1),i="-");var j=rb(a.getUTCMilliseconds(),a.__ns);return i+ub(g,4)+"-"+ub(h,2)+"-"+ub(a.getUTCDate(),2)+"T"+ub(a.getUTCHours(),2)+":"+ub(a.getUTCMinutes(),2)+":"+ub(a.getUTCSeconds(),2)+j+c},tb=function(a){var b=a.ms,c="";b<0&&(c="-",b=-b);var d=Math.floor(b/864e5);b-=864e5*d;var e=Math.floor(b/36e5);b-=36e5*e;var f=Math.floor(b/6e4);b-=6e4*f;var g=Math.floor(b/1e3);return b-=1e3*g,c+"P"+ub(d,2)+"DT"+ub(e,2)+"H"+ub(f,2)+"M"+ub(g,2)+rb(b,a.ns)+"S"},ub=function(a,b,c){for(var d=a.toString(10);d.length<b;)c?d+="0":d="0"+d;return d},vb=function(a){return a&&"Z"!==a&&"+00:00"!==a&&"-00:00"!==a?a:"Z"},wb=function(a){if("string"==typeof a){var b=a.indexOf(")",10);if(0===a.indexOf("Collection(")&&b>0)return a.substring(11,b)}return null},xb=function(a,c,d,e,f,g){return f.request(a,function(f){try{f.headers&&ac(f.headers),f.data===b&&204!==f.statusCode&&e.read(f,g)}catch(h){return h.request===b&&(h.request=a),h.response===b&&(h.response=f),void d(h)}c(f.data,f)},d)},yb=function(a){return Cb(a)&&l(a.__batchRequests)},zb=/Collection\((.*)\)/,Ab=function(a,b){var c=a&&a.results||a;return!!c&&Bb(b)||!b&&l(c)&&!Cb(c[0])},Bb=function(a){return zb.test(a)},Cb=function(a){return!!a&&n(a)&&!l(a)&&!m(a)},Db=function(a){return"Edm.DateTimeOffset"===a.__edmType||!a.__edmType&&a.__offset},Eb=function(a){if(!a&&!Cb(a))return!1;var b=a.__metadata||{},c=a.__deferred||{};return!b.type&&!!c.uri},Fb=function(a){return Cb(a)&&a.__metadata&&"uri"in a.__metadata},Gb=function(a,b){var c=a&&a.results||a;return l(c)&&!Bb(b)&&Cb(c[0])},Hb=function(a){return g(pb,a)},Ib=function(a){return g(ob,a)},Jb=function(a){if(!a&&!Cb(a))return!1;var b=a.__metadata,c=a.__mediaresource;return!b&&!!c&&!!c.media_src},Kb=function(a){return m(a)||"string"==typeof a||"number"==typeof a||"boolean"==typeof a},Lb=function(a){return g(nb,a)},Mb=function(a,c){return Eb(a)?"deferred":Fb(a)?"entry":Gb(a)?"feed":c&&c.relationship?null!==a&&a!==b&&Gb(a)?"feed":"entry":null},Nb=function(a,b){return k(a,function(a){return a.name===b})},Ob=function(a,b,c){return a?qb(b,function(b){return Zb(a,b,c)}):null},Pb=function(a,b){return k(a,function(a){return a.name===b})},Qb=function(a,b){return Ob(a,b,"complexType")},Rb=function(a,b){return Ob(a,b,"entityType")},Sb=function(a){return qb(a,function(a){return k(a.entityContainer,function(a){return bc(a.isDefaultEntityContainer)})})},Tb=function(a,b){return Ob(a,b,"entityContainer")},Ub=function(a,b){return k(a,function(a){return a.name===b})},Vb=function(a,b){var c=null;if(a){var d=a.relationship,e=qb(b,function(a){var b=Yb(a.namespace,d),c=a.association;if(b&&c){var e,f;for(e=0,f=c.length;e<f;e++)if(c[e].name===b)return c[e]}return null});if(e){var f=e.end[0];f.role!==a.toRole&&(f=e.end[1]),c=f.type}}return c},Wb=function(a,b,c){if(a){var d=a.relationship,e=qb(c,function(a){for(var b=a.entityContainer,c=0;c<b.length;c++){var e=b[c].associationSet;if(e)for(var f=0;f<e.length;f++)if(e[f].association==d)return e[f]}return null});if(e&&e.end[0]&&e.end[1])return e.end[0].entitySet==b?e.end[1].entitySet:e.end[0].entitySet}return null},Xb=function(a,b){var c=qb(b,function(b){for(var c=b.entityContainer,d=0;d<c.length;d++){var e=c[d].entitySet;if(e)for(var f=0;f<e.length;f++)if(e[f].name==a)return{entitySet:e[f],containerName:c[d].name,functionImport:c[d].functionImport}}return null});return c},Yb=function(a,b){return 0===b.indexOf(a)&&"."===b.charAt(a.length)?b.substr(a.length+1):null},Zb=function(a,b,c){if(a&&b){var d=Yb(b.namespace,a);if(d)return k(b[c],function(a){return a.name===d})}return null},$b=function(a,b){if(a===b)return a;for(var c=a.split("."),d=b.split("."),e=c.length>=d.length?c.length:d.length,f=0;f<e;f++){var g=c[f]&&o(c[f]),h=d[f]&&o(d[f]);if(g>h)return a;if(g<h)return b}},_b={accept:"Accept","content-type":"Content-Type",dataserviceversion:"DataServiceVersion",maxdataserviceversion:"MaxDataServiceVersion"},ac=function(a){for(var b in a){var c=b.toLowerCase(),d=_b[c];if(d&&b!==d){var e=a[b];delete a[b],a[d]=e}}},bc=function(a){return"boolean"==typeof a?a:"string"==typeof a&&"true"===a.toLowerCase()},cc=/^(-?\d{4,})-(\d{2})-(\d{2})T(\d{2}):(\d{2})(?::(\d{2}))?(?:\.(\d+))?(.*)$/,dc=function(a,b,c){var d=cc.exec(a),e=d?vb(d[8]):null;if(!d||!b&&"Z"!==e){if(c)return null;throw{message:"Invalid date/time value"}}var f=o(d[1]);f<=0&&f++;var g=d[7],h=0;if(g){if(g.length>7){if(c)return null;throw{message:"Cannot parse date/time value to given precision."}}h=ub(g.substring(3),4,!0),g=ub(g.substring(0,3),3,!0),g=o(g),h=o(h)}else g=0;var i=o(d[4]),j=o(d[5]),k=o(d[6])||0;if("Z"!==e){var l=ic(e),m=-l.d;i+=l.h*m,j+=l.m*m}var n=new Date;if(n.setUTCFullYear(f,o(d[2])-1,o(d[3])),n.setUTCHours(i,j,k,g),isNaN(n.valueOf())){if(c)return null;throw{message:"Invalid date/time value"}}return b&&(n.__edmType="Edm.DateTimeOffset",n.__offset=e),h&&(n.__ns=h),n},ec=function(a,b){return dc(a,!1,b)},fc=function(a,b){return dc(a,!0,b)},gc=/^([+-])?P(?:(\d+)Y)?(?:(\d+)M)?(?:(\d+)D)?(?:T(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)(?:\.(\d+))?S)?)?/,hc=function(a){var b=gc.exec(a);if(null===b)throw{message:"Invalid duration value."};var c=b[2]||"0",d=b[3]||"0",e=o(b[4]||0),f=o(b[5]||0),g=o(b[6]||0),h=parseFloat(b[7]||0);if("0"!==c||"0"!==d)throw{message:"Unsupported duration value."};var i=b[8],j=0;if(i){if(i.length>7)throw{message:"Cannot parse duration value to given precision."};j=ub(i.substring(3),4,!0),i=ub(i.substring(0,3),3,!0),i=o(i),j=o(j)}else i=0;i+=1e3*h+6e4*g+36e5*f+864e5*e,"-"===b[1]&&(i=-i);var k={ms:i,__edmType:"Edm.Time"};return j&&(k.ns=j),k},ic=function(a){var b=a.substring(0,1);b="+"===b?1:-1;var c=o(a.substring(1)),d=o(a.substring(a.indexOf(":")+1));return{d:b,h:c,m:d}},jc=function(a,c,d){a.method||(a.method="GET"),a.headers?ac(a.headers):a.headers={},a.headers.Accept===b&&(a.headers.Accept=c.accept),f(a.data)&&a.body===b&&c.write(a,d),f(a.headers.MaxDataServiceVersion)||(a.headers.MaxDataServiceVersion=c.maxDataServiceVersion||"1.0")},kc=function(a,c,d){if(a&&"object"==typeof a)for(var e in a){var f=a[e],g=kc(f,e,d);g=d(e,g,c),g!==f&&(f===b?delete a[e]:a[e]=g)}return a},lc=function(a,b){return b("",kc(a,"",b))},mc=0,nc=function(a){return!a.method||"GET"===a.method},oc=function(b){var c=a.document.createElement("IFRAME");c.style.display="none";var d=b.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/\</g,"&lt;"),e='<html><head><script type="text/javascript" src="'+d+'"></script></head><body></body></html>',f=a.document.getElementsByTagName("BODY")[0];return f.appendChild(c),vc(c,e),c},pc=function(){if(a.XMLHttpRequest)return new a.XMLHttpRequest;var b;if(a.ActiveXObject)try{return new a.ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(c){try{return new a.ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(d){b=d}}else b={message:"XMLHttpRequest not supported"};throw b},qc=function(a){return 0===a.indexOf("http://")||0===a.indexOf("https://")||0===a.indexOf("file://")},rc=function(b){if(!qc(b))return!0;var c=a.location,d=c.protocol+"//"+c.host+"/";return 0===b.indexOf(d)},sc=function(c,d){try{delete a[c]}catch(e){a[c]=b,d===mc-1&&(mc-=1)}},tc=function(a){return a&&(vc(a,""),a.parentNode.removeChild(a)),null},uc=function(a,c){var d,e,f=a.getAllResponseHeaders().split(/\r?\n/);for(d=0,e=f.length;d<e;d++)if(f[d]){var g=f[d].split(": ");c[g[0]]=g[1]}var h=["Content-Type","DataServiceVersion"];for(d=0;d<h.length;d++)c[h[d]]===b&&a.getResponseHeader(h[d])&&(c[h[d]]=a.getResponseHeader(h[d]))},vc=function(a,b){var c=a.contentWindow?a.contentWindow.document:a.contentDocument.document;c.open(),c.write(b),c.close()};d.defaultHttpClient={callbackParameterName:"$callback",formatQueryString:"$format=json",enableJsonpCallback:!1,request:function(c,d,e){var f,g={},j=null,k=!1;g.abort=function(){f=tc(f),k||(k=!0,j&&(j.abort(),j=null),e({message:"Request aborted"}))};var l,m=function(){f=tc(f),k||(k=!0,j=null,e({message:"Request timed out"}))},n=c.requestUri,o=h(c.enableJsonpCallback,this.enableJsonpCallback),p=h(c.callbackParameterName,this.callbackParameterName),q=h(c.formatQueryString,this.formatQueryString);if(!o||rc(n)){if(j=pc(),j.onreadystatechange=function(){if(!k&&null!==j&&4===j.readyState){var a=j.statusText,b=j.status;1223===b&&(b=204,a="No Content");var f=[];uc(j,f);var g={requestUri:n,statusCode:b,statusText:a,headers:f,body:j.responseText};k=!0,j=null,b>=200&&b<=299?d(g):e({message:"HTTP request failed",request:c,response:g})}},j.open(c.method||"GET",n,!0,c.user,c.password),c.headers)for(l in c.headers)j.setRequestHeader(l,c.headers[l]);c.timeoutMS&&(j.timeout=c.timeoutMS,j.ontimeout=m),j.send(c.body)}else{if(!nc(c))throw{message:"Request is not local and cannot be done through JSONP."};var r=mc;mc+=1;var s,t=r.toString(),u=!1;l="handleJSONP_"+t,a[l]=function(c){if(f=tc(f),!k){u=!0,a.clearTimeout(s),sc(l,r),a.ActiveXObject&&!a.DOMParser&&(c=a.JSON.parse(a.JSON.stringify(c)));var e;e=c.d===b?{"Content-Type":"application/json;odata=minimalmetadata",dataServiceVersion:"3.0"}:{"Content-Type":"application/json"},i(d,{body:c,statusCode:200,headers:e})}};var v=c.timeoutMS?c.timeoutMS:12e4;s=a.setTimeout(m,v);var w=p+"=parent."+l;this.formatQueryString&&(w+="&"+q);var x=n.indexOf("?");x===-1?n=n+"?"+w:x===n.length-1?n+=w:n=n+"&"+w,f=oc(n)}return g}};var wc="3.0",xc=function(a){if(!a)return null;var b,c,d=a.split(";"),e={};for(b=1,c=d.length;b<c;b++){var f=d[b].split("=");e[r(f[0])]=f[1]}return{mediaType:r(d[0]),properties:e}},yc=function(a){if(!a)return b;var c,d=a.mediaType;for(c in a.properties)d+=";"+c+"="+a.properties[c];return d},zc=function(a,b,c,d){var e={};return j(e,c),j(e,{contentType:a,dataServiceVersion:b,handler:d}),e},Ac=function(a,b,c){if(a){var d=a.headers;d[b]||(d[b]=c)}},Bc=function(a,b){if(a){var c=a.headers,d=c.DataServiceVersion;c.DataServiceVersion=d?$b(d,b):b}},Cc=function(a,c){var d=a.headers;return d&&d[c]||b},Dc=function(a){return xc(Cc(a,"Content-Type"))},Ec=/^\s?(\d+\.\d+);?.*$/,Fc=function(a){var b=Cc(a,"DataServiceVersion");if(b){var c=Ec.exec(b);if(c&&c.length)return c[1]}},Gc=function(a,b){return a.accept.indexOf(b.mediaType)>=0},Hc=function(a,c,d,e){if(!d||!d.headers)return!1;var g=Dc(d),h=Fc(d)||"",i=d.body;if(!f(i))return!1;if(Gc(a,g)){var j=zc(g,h,e,a);return j.response=d,d.data=c(a,i,j),d.data!==b}return!1},Ic=function(a,c,d,e){if(!d||!d.headers)return!1;var f=Dc(d),g=Fc(d);if(!f||Gc(a,f)){var h=zc(f,g,e,a);if(h.request=d,d.body=c(a,d.data,h),d.body!==b)return Bc(d,h.dataServiceVersion||"1.0"),Ac(d,"Content-Type",yc(h.contentType)),Ac(d,"MaxDataServiceVersion",a.maxDataServiceVersion),!0}return!1},Jc=function(a,b,c,d){return{accept:c,maxDataServiceVersion:d,read:function(b,c){return Hc(this,a,b,c)},write:function(a,c){return Ic(this,b,a,c)}}},Kc=function(a,b){return b},Lc=function(a,c){return f(c)?c.toString():b};d.textHandler=Jc(Kc,Lc,"text/plain",wc);var Mc=H+"www.opengis.net",Nc=Mc+"/gml",Oc=Mc+"/def/crs/EPSG/0/",Pc="gml",Qc=function(a,b,c){
var d={type:a};return d[b]=c,d},Rc=function(a){if(l(a)&&a.length>=2){var b=a[0];a[0]=a[1],a[1]=b}return a},Sc=function(a,b,c,d,e,f){var g=Tc(a,c,d,e,f);return Qc(b,"coordinates",g)},Tc=function(a,b,c,d,e){var f=[];return ba(a,function(a){if(ja(a)===Nc){var g=ia(a);if(g!==b)g===c&&ba(a,function(a){if(ja(a)===Nc){var b=d(a,e);b&&f.push(b)}});else{var h=ea(a,Nc);if(h){var i=d(h,e);i&&f.push(i)}}}}),f},Uc=function(a,b){var c=Tc(a,"geometryMember","geometryMembers",gd,b);return Qc(mb,"geometries",c)},Vc=function(a,b){return Qc(hb,"coordinates",_c(a,b))},Wc=function(a,b){return Sc(a,kb,"curveMember","curveMembers",_c,b)},Xc=function(a,b){return Sc(a,jb,"pointMember","pointMembers",ad,b)},Yc=function(a,b){return Sc(a,lb,"surfaceMember","surfaceMembers",cd,b)},Zc=function(a,b){return Qc(gb,"coordinates",ad(a,b))},$c=function(a,b){return Qc(ib,"coordinates",cd(a,b))},_c=function(a,b){var c=[];return ba(a,function(a){var d=ja(a);if(d===Nc){var e=ia(a);return"posList"===e?void(c=ed(a,b)):"pointProperty"===e?void c.push(bd(a,b)):"pos"===e?void c.push(fd(a,b)):void 0}}),c},ad=function(a,b){var c=ea(a,Nc,"pos");return c?fd(c,b):[]},bd=function(a,b){var c=ea(a,Nc,"Point");return c?ad(c,b):[]},cd=function(a,b){var c=[],d=!1;return ba(a,function(a){if(ja(a)===Nc){var e=ia(a);return"exterior"===e?(d=!0,void c.unshift(dd(a,b))):"interior"===e?void c.push(dd(a,b)):void 0}}),!d&&c.length>0&&c.unshift([[]]),c},dd=function(a,b){var c=[];return ba(a,function(a){ja(a)===Nc&&"LinearRing"===ia(a)&&(c=_c(a,b))}),c},ed=function(a,b){var c=fd(a,!1),d=c.length;if(d%2!==0)throw{message:"GML posList element has an uneven number of numeric values"};for(var e=[],f=0;f<d;f+=2){var g=c.slice(f,f+2);e.push(b?Rc(g):g)}return e},fd=function(a,b){var c=[],d=" \t\r\n",e=ha(a);if(e)for(var f=e.length,g=0,h=0;h<=f;){if(d.indexOf(e.charAt(h))!==-1){var i=e.substring(g,h);i&&c.push(parseFloat(i)),g=h+1}h++}return b?Rc(c):c},gd=function(a,b){var c,d=ia(a);switch(d){case"Point":c=Zc;break;case"Polygon":c=$c;break;case"LineString":c=Vc;break;case"MultiPoint":c=Xc;break;case"MultiCurve":c=Wc;break;case"MultiSurface":c=Yc;break;case"MultiGeometry":c=Uc;break;default:throw{message:"Unsupported element: "+d,element:a}}var e=c(a,b),f=$(a,"srsName",Nc)||$(a,"srsName");if(f){if(0!==f.indexOf(Oc))throw{message:"Unsupported srs name: "+f,element:a};var g=f.substring(Oc.length);g&&(e.crs={type:"name",properties:{name:"EPSG:"+g}})}return e},hd=function(a,b,c,d){var e;switch(c){case gb:e=pd;break;case hb:e=qd;break;case ib:e=rd;break;case jb:e=td;break;case kb:e=ud;break;case lb:e=vd;break;case mb:e=xd;break;default:return null}var f=e(a,b,d),g=b.crs;if(g&&"name"===g.type){var h=g.properties,i=h&&h.name;if(i&&0===i.indexOf("ESPG:")&&i.length>5){var j=i.substring(5),k=qa(a,null,"srsName",Pc+j);pa(f,k)}}return f},id=function(a,b,c){return ra(a,Nc,X(Pc,b),c)},jd=function(a,b,c){var d=l(b)?b:[];return d=c?Rc(d):d,id(a,"pos",d.join(" "))},kd=function(a,b,c,d){var e=id(a,b);if(l(c)){var f,g;for(f=0,g=c.length;f<g;f++)pa(e,jd(a,c[f],d));0===g&&pa(e,id(a,"posList"))}return e},ld=function(a,b,c){return id(a,"Point",jd(a,b,c))},md=function(a,b,c){return kd(a,"LineString",b,c)},nd=function(a,b,c,d){var e=id(a,b);if(l(c)&&c.length>0){var f=kd(a,"LinearRing",c,d);pa(e,f)}return e},od=function(a,b,c){var d=b&&b.length,e=id(a,"Polygon");if(l(b)&&d>0){pa(e,nd(a,"exterior",b[0],c));var f;for(f=1;f<d;f++)pa(e,nd(a,"interior",b[f],c))}return e},pd=function(a,b,c){return ld(a,b.coordinates,c)},qd=function(a,b,c){return md(a,b.coordinates,c)},rd=function(a,b,c){return od(a,b.coordinates,c)},sd=function(a,b,c,d,e,f){var g=d&&d.length,h=id(a,b);if(l(d)&&g>0){var i,j=id(a,c);for(i=0;i<g;i++)pa(j,e(a,d[i],f));pa(h,j)}return h},td=function(a,b,c){return sd(a,"MultiPoint","pointMembers",b.coordinates,ld,c)},ud=function(a,b,c){return sd(a,"MultiCurve","curveMembers",b.coordinates,md,c)},vd=function(a,b,c){return sd(a,"MultiSurface","surfaceMembers",b.coordinates,od,c)},wd=function(a,b,c){return hd(a,b,b.type,c)},xd=function(a,b,c){return sd(a,"MultiGeometry","geometryMembers",b.geometries,wd,c)},yd="application/xml",zd=H+"schemas.microsoft.com/ado/",Ad=zd+"2007/08/dataservices",Bd=zd+"2007/06/edmx",Cd=zd+"2006/04/edm",Dd=zd+"2007/05/edm",Ed=zd+"2008/01/edm",Fd=zd+"2008/09/edm",Gd=zd+"2009/08/edm",Hd=zd+"2009/11/edm",Id=Ad,Jd=Ad+"/metadata",Kd=Ad+"/related/",Ld=Ad+"/scheme",Md="d",Nd="m",Od=function(a,b){var c={name:ia(a),value:a.value};return c[b?"namespaceURI":"namespace"]=ja(a),c},Pd=function(a,b){var c,d,e=[],f=[],g=a.attributes;for(c=0,d=g.length;c<d;c++){var h=g[c];ja(h)!==K&&e.push(Od(h,b))}for(var i=a.firstChild;null!=i;)1===i.nodeType&&f.push(Pd(i,b)),i=i.nextSibling;var j={name:ia(a),value:ha(a),attributes:e,children:f};return j[b?"namespaceURI":"namespace"]=ja(a),j},Qd=function(a){return ja(a)===Id&&"element"===ia(a)},Rd=function(a,b){return{type:a,extensions:b}},Sd=function(a){if(ea(a,Nc))return $a;var b=ea(a,Id);if(!b)return Qa;if(Qd(b)){var c=ma(b,Id);if(c&&Qd(c))return"Collection()"}return null},Td=function(a){var b=null,c=!1,d=[];return Z(a,function(a){var e=ja(a),f=ia(a),g=ka(a);if(e===Jd){if("null"===f)return void(c="true"===g.toLowerCase());if("type"===f)return void(b=g)}if(e!==L&&e!==K)return void d.push(Od(a,!0))}),{type:!b&&c?Qa:b,isNull:c,extensions:d}},Ud=function(a){if(ja(a)!==Id)return null;var b=ia(a),c=Td(a),d=c.isNull,e=c.type,f=Rd(e,c.extensions),g=d?null:Vd(a,e,f);return{name:b,value:g,metadata:f}},Vd=function(a,b,c){b||(b=Sd(a),c.type=b);var d=Hb(b);return d||Ib(b)?Wd(a,b,d):Lb(b)?Xd(a,b):Bb(b)?Zd(a,b,c):Yd(a,b,c)},Wd=function(a,b,c){var d=ea(a,Nc),e=gd(d,c);return e.__metadata={type:b},e},Xd=function(a,b){var c=ka(a)||"";switch(b){case Ea:return bc(c);case Da:case Ia:case Ka:case Na:case Qa:return c;case Fa:case La:case Ma:case Oa:return o(c);case Ja:case Pa:return parseFloat(c);case Ra:return hc(c);case Ga:return ec(c);case Ha:return fc(c)}return c},Yd=function(a,b,c){var d={__metadata:{type:b}};return ba(a,function(a){var b=Ud(a),e=b.name;c.properties=c.properties||{},c.properties[e]=b.metadata,d[e]=b.value}),d},Zd=function(a,b,c){var d=[],e=c.elements=[],f=wb(b);return ba(a,function(a){if(Qd(a)){var b=Td(a),c=b.extensions,g=b.type||f,h=Rd(g,c),i=Vd(a,g,h);d.push(i),e.push(h)}}),{__metadata:{type:"Collection()"===b?null:b},results:d}},$d=function(a,c){if(ja(a)===Id){c=aa(a,c);var d=ia(a);if("links"===d)return _d(a,c);if("uri"===d)return ae(a,c)}return b},_d=function(a,b){var c=[];return ba(a,function(a){"uri"===ia(a)&&ja(a)===Id&&c.push(ae(a,b))}),{results:c}},ae=function(a,b){var c=ha(a)||"";return{uri:A(c,b)}},be=function(a,b){return b===$a||b===Sa?a&&a.type:b===_a||b===Ta?gb:b===ab||b===Ua?hb:b===bb||b===Va?ib:b===cb||b===Wa?mb:b===db||b===Xa?lb:b===eb||b===Ya?kb:b===fb||b===Za?jb:null},ce=function(a,b,c){return ra(a,Jd,X(Nd,b),c)},de=function(a,b,c){return qa(a,Jd,X(Nd,b),c)},ee=function(a,b,c){return ra(a,Id,X(Md,b),c)},fe=function(a,b){return b===Ga||b===Ha||m(a)?sb(a):b===Ra?tb(a):a.toString()},ge=function(a,b){return{element:a,dsv:b}},he=function(a,b,c,d){var e=c?de(a,"type",c):null,f=ee(a,b,e);return oa(f,d)},ie=function(a,b,c,d){var e=fe(c,d),f=he(a,b,d,e);return ge(f,"1.0")},je=function(a,b,c,d){var e=de(a,"null","true"),f=he(a,b,c,e),g=Qb(c,d)?"2.0":"1.0";return ge(f,g)},ke=function(a,b,c,d,e,f,g){var h=wb(d),i=l(c)?c:c.results,j=d?{type:h}:{};j.properties=e.properties;var k,m,n=he(a,b,h?d:null);for(k=0,m=i.length;k<m;k++){var o=i[k],p=ne(a,"element",o,j,f,g);pa(n,p.element)}return ge(n,"3.0")},le=function(a,b,c,d,e,f,g){var h=he(a,b,d),i=e.properties||{},j=Qb(d,g)||{},k="1.0";for(var l in c)if("__metadata"!==l){var m=c[l],n=Nb(j.property,l),o=i[l]||{},p=ne(a,l,m,o,n,g);k=$b(k,p.dsv),pa(h,p.element)}return ge(h,k)},me=function(a,b,c,d,e){var f=be(c,d),g=hd(a,c,f,e),h=he(a,b,d,g);return ge(h,"3.0")},ne=function(a,b,c,d,e,f){var g=Ba(c,d,e);if(Kb(c))return ie(a,b,c,g||Qa);var h=Hb(g);if(h||Ib(g))return me(a,b,c,g,h);if(Ab(c,g))return ke(a,b,c,g,d,e,f);if(Jb(c))return null;var i=Mb(c,e);return null!==i?null:null===c?je(a,b,g):le(a,b,c,g,d,e,f)},oe=function(a){if(a&&n(a)){var b=na();return pa(b,ee(b,"uri",a.uri))}},pe=function(a,b){if(b){var c=W(b),d=ea(c);if(d)return $d(d)}},qe=function(a,c,d){var e=d.contentType=d.contentType||xc(yd);return e&&e.mediaType===yd?wa(oe(c)):b};d.xmlHandler=Jc(pe,qe,yd,wc);var re="a",se=I+"2005/Atom",te=I+"2007/app",ue=Ad+"/edit-media/",ve=Ad+"/mediaresource/",we=Ad+"/relatedlinks/",xe=["application/atom+xml","application/atomsvc+xml","application/xml"],ye=xe[0],ze=[se,te,L,K],Ae={SyndicationAuthorEmail:"author/email",SyndicationAuthorName:"author/name",SyndicationAuthorUri:"author/uri",SyndicationContributorEmail:"contributor/email",SyndicationContributorName:"contributor/name",SyndicationContributorUri:"contributor/uri",SyndicationPublished:"published",SyndicationRights:"rights",SyndicationSummary:"summary",SyndicationTitle:"title",SyndicationUpdated:"updated"},Be=function(a){return Ae[a]||a},Ce=function(a){return!g(ze,a)},De=function(a,b,c,d,e){e=e||"";var f=a["FC_TargetPath"+e];if(!f)return null;var g=a["FC_SourcePath"+e],h=Be(f),i=d?d+(g?"/"+g:""):g,j=i&&Re(c,b,i),k=a["FC_NsUri"+e]||null,l=a["FC_NsPrefix"+e]||null,m=a["FC_KeepInContent"+e]||"";return f!==h&&(k=se,l=re),{contentKind:a["FC_ContentKind"+e],keepInContent:"true"===m.toLowerCase(),nsPrefix:l,nsURI:k,propertyPath:i,propertyType:j,entryPath:h}},Ee=function(a,b,c){for(var d=[];a;){var e=(a.FC_SourcePath,De(a,a,b));e&&c(e);var f,g,h=a.property||[];for(f=0,g=h.length;f<g;f++)for(var i=h[f],j=0,k="";e=De(i,a,b,i.name,k);)c(e),j++,k="_"+j;a=Rb(a.baseType,b)}return d},Fe=function(a){var b=[];return Z(a,function(a){var c=ja(a);Ce(c)&&b.push(Od(a,!0))}),b},Ge=function(a){return Pd(a,!0)},He=function(a,b,c){var d=ja(a),e=ia(a);if(d===te&&"service"===e)return cf(a,b);if(d===se){if("feed"===e)return Le(a,b,c);if("entry"===e)return Se(a,b,c)}},Ie=function(a,b){var c=[],d={extensions:c};return Z(a,function(e){var f=ia(e),g=ja(e),h=ka(e);if(null===g){if("title"===f||"metadata"===f)return void(d[f]=h);if("target"===f)return void(d.target=A(h,aa(a,b)))}Ce(g)&&c.push(Od(e,!0))}),d},Je=function(a,b,c){var d=c.actions=c.actions||[];d.push(Ie(a,b))},Ke=function(a,b,c){var d=c.functions=c.functions||[];d.push(Ie(a,b))},Le=function(a,b,c){var d=Fe(a),e={feed_extensions:d},f=[],g={__metadata:e,results:f};return b=aa(a,b),ba(a,function(a){var h=ja(a),i=ia(a);if(h===Jd){if("count"===i)return void(g.__count=parseInt(ha(a),10));if("action"===i)return void Je(a,b,e);if("function"===i)return void Ke(a,b,e)}return Ce(h)?void d.push(Pd(a)):"entry"===i?void f.push(Se(a,b,c)):"link"===i?void Me(a,g,b):"id"===i?(e.uri=A(ha(a),b),void(e.uri_extensions=Fe(a))):"title"===i?(e.title=ha(a)||"",void(e.title_extensions=Fe(a))):void 0}),g},Me=function(a,b,c){var d=Ne(a,c),e=d.href,f=d.rel,g=d.extensions,h=b.__metadata;return"next"===f?(b.__next=e,void(h.next_extensions=g)):"self"===f?(h.self=e,void(h.self_extensions=g)):void 0},Ne=function(a,b){b=aa(a,b);var c=[],d={extensions:c,baseURI:b};if(Z(a,function(a){var e=ja(a),f=ia(a),g=a.value;return"href"===f?void(d.href=A(g,b)):"type"===f||"rel"===f?void(d[f]=g):void(Ce(e)&&c.push(Od(a,!0)))}),!d.href)throw{error:"href attribute missing on link element",element:a};return d},Oe=function(a,c){if(a.indexOf("/")===-1)return c[a];var d,e,f=a.split("/");for(d=0,e=f.length;d<e;d++){if(null===c)return b;if(c=c[f[d]],c===b)return c}return c},Pe=function(a,c,d,e){var f;if(a.indexOf("/")===-1)c[a]=d,f=a;else{var g,h,i=a.split("/");for(g=0,h=i.length-1;g<h;g++){var j=c[i[g]];if(j===b)j={},c[i[g]]=j;else if(null===j)return;c=j}f=i[g],c[f]=d}if(e){var k=c.__metadata=c.__metadata||{},l=k.properties=k.properties||{},m=l[f]=l[f]||{};m.type=e}},Qe=function(a,b,c){var d=a.propertyPath;if(!a.keepInContent&&null!==Oe(d,c)){var e=da(b,a.nsURI,a.entryPath);if(e){var f,g=a.propertyType;f="xhtml"===a.contentKind?xa(e):Xd(e,g||"Edm.String"),Pe(d,c,f,g)}}},Re=function(a,b,c){for(var d,e,f=c.split("/");b;){var g=b;for(d=0,e=f.length;d<e;d++){var h=g.property;if(!h)break;var i=Nb(h,f[d]);if(!i)break;var j=i.type;if(!j||Lb(j))return j||null;if(g=Qb(j,a),!g)return null}b=Rb(b.baseType,a)}return null},Se=function(a,b,c){var d={},e={__metadata:d},f=$(a,"etag",Jd);f&&(d.etag=f),b=aa(a,b),ba(a,function(a){var f=ja(a),g=ia(a);if(f!==se){if(f===Jd){if("properties"===g)return void bf(a,e,d);if("action"===g)return void Je(a,b,d);if("function"===g)return void Ke(a,b,d)}}else{if("id"===g)return void Te(a,d,b);if("category"===g)return void Ue(a,d);if("content"===g)return void Ve(a,e,d,b);if("link"===g)return void We(a,e,d,b,c)}});var g=Rb(d.type,c);return Ee(g,c,function(b){Qe(b,a,e)}),e},Te=function(a,b,c){b.uri=A(ha(a),aa(a,c)),b.uri_extensions=Fe(a)},Ue=function(a,b){if($(a,"scheme")===Ld){if(b.type)throw{message:"Invalid AtomPub document: multiple category elements defining the entry type were encounterd withing an entry",element:a};var c=[];Z(a,function(a){var b=ja(a),d=ia(a);return b?void(Ce(b)&&c.push(Od(a,!0))):void("scheme"!==d&&"term"!==d&&c.push(Od(a,!0)))}),b.type=$(a,"term"),b.type_extensions=c}},Ve=function(a,b,c,d){var e=$(a,"src"),f=$(a,"type");if(e){if(!f)throw{message:"Invalid AtomPub document: content element must specify the type attribute if the src attribute is also specified",element:a};c.media_src=A(e,aa(a,d)),c.content_type=f}ba(a,function(d){if(e)throw{message:"Invalid AtomPub document: content element must not have child elements if the src attribute is specified",element:a};ja(d)===Jd&&"properties"===ia(d)&&bf(d,b,c)})},We=function(a,b,c,d,e){var f=Ne(a,d),g=f.rel,h=f.href,i=f.extensions;return"self"===g?(c.self=h,void(c.self_link_extensions=i)):"edit"===g?(c.edit=h,void(c.edit_link_extensions=i)):"edit-media"===g?(c.edit_media=f.href,c.edit_media_extensions=i,void af(f,c)):0===g.indexOf(ue)?void Ze(f,b,c):0===g.indexOf(ve)?void $e(f,b,c):0===g.indexOf(Kd)?void Ye(a,f,b,c,e):0===g.indexOf(we)?void Xe(f,c):void 0},Xe=function(a,b){var c=a.rel.substring(we.length);b.properties=b.properties||{};var d=b.properties[c]=b.properties[c]||{};d.associationuri=a.href,d.associationuri_extensions=a.extensions},Ye=function(a,b,c,d,e){var f,g=ea(a,Jd,"inline");if(g){var h=ea(g),i=aa(g,b.baseURI);f=h?He(h,i,e):null}else f={__deferred:{uri:b.href}};var j=b.rel.substring(Kd.length);c[j]=f,d.properties=d.properties||{};var k=d.properties[j]=d.properties[j]||{};k.extensions=b.extensions},Ze=function(a,b,c){var d=a.rel.substring(ue.length),e=_e(d,b,c),f=e.value,g=e.metadata,h=a.href;f.edit_media=h,f.content_type=a.type,g.edit_media_extensions=a.extensions,f.media_src=f.media_src||h,g.media_src_extensions=g.media_src_extensions||[],af(a,f)},$e=function(a,b,c){var d=a.rel.substring(ve.length),e=_e(d,b,c),f=e.value,g=e.metadata;f.media_src=a.href,g.media_src_extensions=a.extensions,f.content_type=a.type},_e=function(a,b,c){c.properties=c.properties||{};var d=c.properties[a],e=b[a]&&b[a].__mediaresource;return e||(e={},b[a]={__mediaresource:e},c.properties[a]=d={}),{value:e,metadata:d}},af=function(a,b){var c,d,e=a.extensions;for(c=0,d=e.length;c<d;c++)if(e[c].namespaceURI===Jd&&"etag"===e[c].name)return b.media_etag=e[c].value,void e.splice(c,1)},bf=function(a,b,c){ba(a,function(a){var d=Ud(a);if(d){var e=d.name,f=c.properties=c.properties||{};f[e]=d.metadata,b[e]=d.value}})},cf=function(a,b){var c=[],d=[];if(b=aa(a,b),ba(a,function(a){return ja(a)===te&&"workspace"===ia(a)?void c.push(df(a,b)):void d.push(Pd(a))}),0===c.length)throw{message:"Invalid AtomPub service document: No workspace element found.",element:a};return{workspaces:c,extensions:d}},df=function(a,c){var d,e=[],f=[];return c=aa(a,c),ba(a,function(a){var g=ja(a),h=ia(a);if(g===se&&"title"===h){if(d!==b)throw{message:"Invalid AtomPub service document: workspace has more than one child title element",element:a};return void(d=ha(a))}return g===te?void("collection"===h&&e.push(ef(a,c))):void f.push(Ge(a))}),{title:d||"",collections:e,extensions:f}},ef=function(a,c){var d=$(a,"href");if(!d)throw{message:"Invalid AtomPub service document: collection has no href attribute",element:a};c=aa(a,c),d=A(d,aa(a,c));var e,f=[];if(ba(a,function(c){var d=ja(c),g=ia(c);if(d!==se)d!==te&&f.push(Ge(a));else if("title"===g){if(e!==b)throw{message:"Invalid AtomPub service document: collection has more than one child title element",element:c};e=ha(c)}}),!e)throw{message:"Invalid AtomPub service document: collection has no title element",element:a};return{title:e,href:d,extensions:f}},ff=function(a,b,c){return ra(a,se,X(re,b),c)},gf=function(a,b,c){return qa(a,null,b,c)},hf=function(a){if(a.childNodes.length>0)return!1;var b,c,d=!0,e=a.attributes;for(b=0,c=e.length;b<c&&d;b++){var f=e[b];d=d&&Q(f)||ja(f)==Jd&&"type"===ia(f)}return d},jf=function(a,b,c,d,e){var f=null,g=null,h=null,i="";"deferred"!==c?(f=gf(a,"type","application/atom+xml;type="+c),g=ce(a,"inline"),d&&(i=d.__metadata&&d.__metadata.uri||"",h=nf(a,d,e)||mf(a,d,e),pa(g,h.element))):i=d.__deferred.uri;var j=ff(a,"link",[gf(a,"href",i),gf(a,"rel",A(b,Kd)),f,g]);return ge(j,h?h.dsv:"1.0")},kf=function(a,b,c,d,e,f){if(Jb(c))return null;var g=ne(a,b,c,d,e,f);if(!g){var h=Mb(c,e);g=jf(a,b,h,c,f)}return g},lf=function(a,b,c,d){var e,f=ca(c,Id,d.propertyPath),g=f&&_(f,"null",Jd),h="1.0";if(g&&"true"===g.value)return h;if(f&&(e=ha(f)||"",!d.keepInContent)){h="2.0";var i=f.parentNode,j=i;for(i.removeChild(f);j!==c&&hf(j);)i=j.parentNode,i.removeChild(j),j=i}var k=va(a,b,d.nsURI,d.nsPrefix,d.entryPath);if(2===k.nodeType)return k.value=e,h;var l=d.contentKind;return oa(k,[l&&qa(a,null,"type",l),"xhtml"===l?ta(a,e):e]),h},mf=function(a,b,c){var d=b.__metadata||{},e=d.properties||{},f=d.etag,g=d.uri,h=d.type,i=Rb(h,c),j=ce(a,"properties"),k=ff(a,"entry",[ff(a,"author",ff(a,"name")),f&&de(a,"etag",f),g&&ff(a,"id",g),h&&ff(a,"category",[gf(a,"term",h),gf(a,"scheme",Ld)]),ff(a,"content",[gf(a,"type","application/xml"),j])]),l="1.0";for(var m in b)if("__metadata"!==m){var n=e[m]||{},o=i&&(Nb(i.property,m)||Nb(i.navigationProperty,m)),p=kf(a,m,b[m],n,o,c);if(p){var q=p.element,r=ja(q)===se?k:j;pa(r,q),l=$b(l,p.dsv)}}return Ee(i,c,function(b){var c=lf(a,k,j,b);l=$b(l,c)}),ge(k,l)},nf=function(a,b,c){var d=l(b)?b:b.results;if(!d)return null;var e,f,g="1.0",h=ff(a,"feed");for(e=0,f=d.length;e<f;e++){var i=mf(a,d[e],c);pa(h,i.element),g=$b(g,i.dsv)}return ge(h,g)},of=function(a,b){if(a){var c=Gb(a)&&nf||n(a)&&mf;if(c){var d=na(),e=c(d,a,b);if(e){var f=e.element;return oa(f,[sa(d,Jd,Nd),sa(d,Id,Md)]),ge(pa(d,f),e.dsv)}}}return null},pf=function(a,b,c){if(b){var d=W(b),e=ea(d);if(e)return He(e,null,c.metadata)}},qf=function(a,b,c){var d=c.contentType=c.contentType||xc(ye);if(d&&d.mediaType===ye){var e=of(b,c.metadata);if(e)return c.dataServiceVersion=$b(c.dataServiceVersion||"1.0",e.dsv),wa(e.element)}};d.atomHandler=Jc(pf,qf,xe.join(","),wc);var rf=function(a,b,c,d){return{attributes:a,elements:b,text:c||!1,ns:d}},sf={elements:{Annotations:rf(["Target","Qualifier"],["TypeAnnotation*","ValueAnnotation*"]),Association:rf(["Name"],["End*","ReferentialConstraint","TypeAnnotation*","ValueAnnotation*"]),AssociationSet:rf(["Name","Association"],["End*","TypeAnnotation*","ValueAnnotation*"]),Binary:rf(null,null,!0),Bool:rf(null,null,!0),Collection:rf(null,["String*","Int*","Float*","Decimal*","Bool*","DateTime*","DateTimeOffset*","Guid*","Binary*","Time*","Collection*","Record*"]),CollectionType:rf(["ElementType","Nullable","DefaultValue","MaxLength","FixedLength","Precision","Scale","Unicode","Collation","SRID"],["CollectionType","ReferenceType","RowType","TypeRef"]),ComplexType:rf(["Name","BaseType","Abstract"],["Property*","TypeAnnotation*","ValueAnnotation*"]),DateTime:rf(null,null,!0),DateTimeOffset:rf(null,null,!0),Decimal:rf(null,null,!0),DefiningExpression:rf(null,null,!0),Dependent:rf(["Role"],["PropertyRef*"]),Documentation:rf(null,null,!0),End:rf(["Type","Role","Multiplicity","EntitySet"],["OnDelete"]),EntityContainer:rf(["Name","Extends"],["EntitySet*","AssociationSet*","FunctionImport*","TypeAnnotation*","ValueAnnotation*"]),EntitySet:rf(["Name","EntityType"],["TypeAnnotation*","ValueAnnotation*"]),EntityType:rf(["Name","BaseType","Abstract","OpenType"],["Key","Property*","NavigationProperty*","TypeAnnotation*","ValueAnnotation*"]),EnumType:rf(["Name","UnderlyingType","IsFlags"],["Member*"]),Float:rf(null,null,!0),Function:rf(["Name","ReturnType"],["Parameter*","DefiningExpression","ReturnType","TypeAnnotation*","ValueAnnotation*"]),FunctionImport:rf(["Name","ReturnType","EntitySet","IsSideEffecting","IsComposable","IsBindable","EntitySetPath"],["Parameter*","ReturnType","TypeAnnotation*","ValueAnnotation*"]),Guid:rf(null,null,!0),Int:rf(null,null,!0),Key:rf(null,["PropertyRef*"]),LabeledElement:rf(["Name"],["Path","String","Int","Float","Decimal","Bool","DateTime","DateTimeOffset","Guid","Binary","Time","Collection","Record","LabeledElement","Null"]),Member:rf(["Name","Value"]),NavigationProperty:rf(["Name","Relationship","ToRole","FromRole","ContainsTarget"],["TypeAnnotation*","ValueAnnotation*"]),Null:rf(null,null),OnDelete:rf(["Action"]),Path:rf(null,null,!0),Parameter:rf(["Name","Type","Mode","Nullable","DefaultValue","MaxLength","FixedLength","Precision","Scale","Unicode","Collation","ConcurrencyMode","SRID"],["CollectionType","ReferenceType","RowType","TypeRef","TypeAnnotation*","ValueAnnotation*"]),Principal:rf(["Role"],["PropertyRef*"]),Property:rf(["Name","Type","Nullable","DefaultValue","MaxLength","FixedLength","Precision","Scale","Unicode","Collation","ConcurrencyMode","CollectionKind","SRID"],["CollectionType","ReferenceType","RowType","TypeAnnotation*","ValueAnnotation*"]),PropertyRef:rf(["Name"]),PropertyValue:rf(["Property","Path","String","Int","Float","Decimal","Bool","DateTime","DateTimeOffset","Guid","Binary","Time"],["Path","String","Int","Float","Decimal","Bool","DateTime","DateTimeOffset","Guid","Binary","Time","Collection","Record","LabeledElement","Null"]),ReferenceType:rf(["Type"]),ReferentialConstraint:rf(null,["Principal","Dependent"]),ReturnType:rf(["ReturnType","Type","EntitySet"],["CollectionType","ReferenceType","RowType"]),RowType:rf(["Property*"]),String:rf(null,null,!0),Schema:rf(["Namespace","Alias"],["Using*","EntityContainer*","EntityType*","Association*","ComplexType*","Function*","ValueTerm*","Annotations*"]),Time:rf(null,null,!0),TypeAnnotation:rf(["Term","Qualifier"],["PropertyValue*"]),TypeRef:rf(["Type","Nullable","DefaultValue","MaxLength","FixedLength","Precision","Scale","Unicode","Collation","SRID"]),Using:rf(["Namespace","Alias"]),ValueAnnotation:rf(["Term","Qualifier","Path","String","Int","Float","Decimal","Bool","DateTime","DateTimeOffset","Guid","Binary","Time"],["Path","String","Int","Float","Decimal","Bool","DateTime","DateTimeOffset","Guid","Binary","Time","Collection","Record","LabeledElement","Null"]),ValueTerm:rf(["Name","Type"],["TypeAnnotation*","ValueAnnotation*"]),Edmx:rf(["Version"],["DataServices","Reference*","AnnotationsReference*"],!1,Bd),DataServices:rf(null,["Schema*"],!1,Bd)}},tf=["m:FC_ContentKind","m:FC_KeepInContent","m:FC_NsPrefix","m:FC_NsUri","m:FC_SourcePath","m:FC_TargetPath"];sf.elements.Property.attributes=sf.elements.Property.attributes.concat(tf),sf.elements.EntityType.attributes=sf.elements.EntityType.attributes.concat(tf),sf.elements.Edmx={attributes:["Version"],elements:["DataServices"],ns:Bd},sf.elements.DataServices={elements:["Schema*"],ns:Bd},sf.elements.EntityContainer.attributes.push("m:IsDefaultEntityContainer"),sf.elements.Property.attributes.push("m:MimeType"),sf.elements.FunctionImport.attributes.push("m:HttpMethod"),sf.elements.FunctionImport.attributes.push("m:IsAlwaysBindable"),sf.elements.EntityType.attributes.push("m:HasStream"),sf.elements.DataServices.attributes=["m:DataServiceVersion","m:MaxDataServiceVersion"];var uf=function(a){if(!a)return a;if(a.length>1){var b=a.substr(0,2);return b===b.toUpperCase()?a:a.charAt(0).toLowerCase()+a.substr(1)}return a.charAt(0).toLowerCase()},vf=function(a,b){if("Documentation"===b)return{isArray:!0,propertyName:"documentation"};var c=a.elements;if(!c)return null;var d,e;for(d=0,e=c.length;d<e;d++){var f=c[d],g=!1;if("*"===f.charAt(f.length-1)&&(g=!0,f=f.substr(0,f.length-1)),b===f){var h=uf(f);return{isArray:g,propertyName:h}}}return null},wf=/^(m:FC_.*)_[0-9]+$/,xf=function(a){return a===Cd||a===Dd||a===Ed||a===Fd||a===Gd||a===Hd},yf=function(a){var b=ia(a),c=ja(a),d=sf.elements[b];if(!d)return null;if(d.ns){if(c!==d.ns)return null}else if(!xf(c))return null;var e={},f=[],h=d.attributes||[];return Z(a,function(a){var b=ia(a),c=ja(a),d=a.value;if(c!==K){var i=null,j=!1;if(xf(c)||null===c?i="":c===Jd&&(i="m:"),null!==i){i+=b;var k=wf.exec(i);k&&(i=k[1]),g(h,i)&&(j=!0,e[uf(b)]=d)}j||f.push(Od(a))}}),ba(a,function(a){var b=ia(a),c=vf(d,b);if(c)if(c.isArray){var g=e[c.propertyName];g||(g=[],e[c.propertyName]=g),g.push(yf(a))}else e[c.propertyName]=yf(a);else f.push(Pd(a))}),d.text&&(e.text=ha(a)),f.length&&(e.extensions=f),e},zf=function(a,c){var d=W(c),e=ea(d);return yf(e)||b};d.metadataHandler=Jc(zf,null,yd,wc);var Af="o",Bf="f",Cf="p",Df="c",Ef="s",Ff="l",Gf="odata",Hf=Gf+".",If="@"+Hf+"bind",Jf=Hf+"metadata",Kf=Hf+"navigationLinkUrl",Lf=Hf+"type",Mf={readLink:"self",editLink:"edit",nextLink:"__next",mediaReadLink:"media_src",mediaEditLink:"edit_media",mediaContentType:"content_type",mediaETag:"media_etag",count:"__count",media_src:"mediaReadLink",edit_media:"mediaEditLink",content_type:"mediaContentType",media_etag:"mediaETag",url:"uri"},Nf={metadata:"odata.metadata",count:"odata.count",next:"odata.nextLink",id:"odata.id",etag:"odata.etag",read:"odata.readLink",edit:"odata.editLink",mediaRead:"odata.mediaReadLink",mediaEdit:"odata.mediaEditLink",mediaEtag:"odata.mediaETag",mediaContentType:"odata.mediaContentType",actions:"odata.actions",functions:"odata.functions",navigationUrl:"odata.navigationLinkUrl",associationUrl:"odata.associationLinkUrl",type:"odata.type"},Of=function(a){if(a.indexOf(".")>0){var b=a.indexOf("@"),c=b>-1?a.substring(0,b):null,d=a.substring(b+1);return{target:c,name:d,isOData:0===d.indexOf(Hf)}}return null},Pf=function(a,b,c,d,e){return Cb(b)&&b[Lf]||c&&c[a+"@"+Lf]||d&&d.type||Vb(d,e)||null},Qf=function(a,b){return b?Nb(b.property,a)||Nb(b.navigationProperty,a):null},Rf=function(a){return Cb(a)&&Hf+"id"in a},Sf=function(a,b,c){if(b[a+"@"+Kf]||c&&c.relationship)return!0;var d=l(b[a])?b[a][0]:b[a];return Rf(d)},Tf=function(a){return Lb(a)||Hb(a)||Ib(a)},Uf=function(a,b,c,d,e){for(var f in a)if(f.indexOf(".")>0&&"#"!==f.charAt(0)){var g=Of(f);if(g){var h=g.name,i=g.target,j=null,k=null;i&&(j=Qf(i,d),k=Pf(i,a[i],a,j,e)),g.isOData?Vf(h,i,k,a[f],a,b,c):b[f]=a[f]}}return b},Vf=function(a,b,c,d,e,f,g){var h=a.substring(Hf.length);switch(h){case"navigationLinkUrl":return void Zf(h,b,c,d,e,f,g);case"nextLink":case"count":return void Xf(h,b,d,f,g);case"mediaReadLink":case"mediaEditLink":case"mediaContentType":case"mediaETag":return void Yf(h,b,c,d,f,g);default:return void Wf(h,b,d,f,g)}},Wf=function(a,b,c,d,e){var f=d.__metadata=d.__metadata||{},g=Mf[a]||a;if("editLink"===a)return f.uri=A(c,e),void(f[g]=f.uri);if("readLink"!==a&&"associationLinkUrl"!==a||(c=A(c,e)),b){var h=f.properties=f.properties||{},i=h[b]=h[b]||{};return"type"===a?void(i[g]=i[g]||c):void(i[g]=c)}f[g]=c},Xf=function(a,b,c,d,e){var f=Mf[a],g=b?d[b]:d;g[f]="nextLink"===a?A(c,e):c},Yf=function(a,b,c,d,e,f){var g=e.__metadata=e.__metadata||{},h=Mf[a];if("mediaReadLink"!==a&&"mediaEditLink"!==a||(d=A(d,f)),b){var i=g.properties=g.properties||{},j=i[b]=i[b]||{};return j.type=j.type||c,e.__metadata=g,e[b]=e[b]||{__mediaresource:{}},void(e[b].__mediaresource[h]=d)}g[h]=d},Zf=function(a,b,c,d,e,f,g){var h=f.__metadata=f.__metadata||{},i=h.properties=h.properties||{},j=i[b]=i[b]||{},k=A(d,g);return e.hasOwnProperty(b)?void(j.navigationLinkUrl=k):(f[b]={__deferred:{uri:k}},void(j.type=j.type||c))},$f=function(a,b,c,d,e,f,g){if("string"==typeof a)return _f(a,b,g);if(!Tf(b)){if(l(a))return ag(a,b,c,d,f,g);if(Cb(a))return bg(a,b,c,d,f,g)}return a},_f=function(a,b,c){switch(b){case Ra:return hc(a);case Ga:return ec(a,!1);case Ha:return fc(a,!1)}return c?ec(a,!0)||fc(a,!0)||a:a},ag=function(a,b,c,d,e,f){var g,h,i=wb(b),j=[],k=[];for(g=0,h=a.length;g<h;g++){var l=Pf(null,a[g])||i,m={type:l},n=$f(a[g],l,m,d,null,e,f);Tf(l)||Kb(a[g])||j.push(m),k.push(n)}return j.length>0&&(c.elements=j),{__metadata:{type:b},results:k}},bg=function(a,b,c,d,e,f){var g=dg(a,{type:b},d,e,f),h=g.__metadata,i=h.properties;return i&&(c.properties=i,delete h.properties),g},cg=function(a,b,c,d,e){return l(a)?fg(a,b,c,d,e):Cb(a)?dg(a,b,c,d,e):null},dg=function(a,c,d,e,f){c=c||{};var g=a[Lf]||c.type||null,h=Rb(g,e),i=!0;h||(i=!1,h=Qb(g,e));var j,k={type:g},l={__metadata:k},m={};if(i&&h&&c.entitySet&&"minimalmetadata"==c.contentTypeOdata){var n=d.substring(0,d.lastIndexOf("$metadata"));for(j=null,h.key||(j=h);j&&!j.key&&j.baseType;)j=Rb(j.baseType,e);if(h.key||j&&j.key){var o;if(o=h.key?gg(a,h):gg(a,j)){var p={key:o,entitySet:c.entitySet,functionImport:c.functionImport,containerName:c.containerName};hg(a,p,g,n,h,j)}}}for(var q in a)if(0===q.indexOf("#"))eg(q.substring(1),a[q],l,d,e);else if(q.indexOf(".")===-1){k.properties||(k.properties=m);var r=a[q],s=s=Qf(q,h);for(j=h;h&&null===s&&j.baseType;)j=Rb(j.baseType,e),s=s=Qf(q,j);var t=Sf(q,a,s),u=Pf(q,r,a,s,e),v=m[q]=m[q]||{type:u};if(t){var w={};if(c.entitySet!==b){var x=Wb(s,c.entitySet.name,e);w=Xb(x,e)}w.contentTypeOdata=c.contentTypeOdata,w.kind=c.kind,w.type=u,l[q]=cg(r,w,d,e,f)}else l[q]=$f(r,u,v,d,s,e,f)}return Uf(a,l,d,h,e)},eg=function(a,b,c,d,e){if(a&&(l(b)||Cb(b))){var f=!1,g=a.lastIndexOf("."),h=a.substring(g+1),i=g>-1?a.substring(0,g):"",j=h===a||i.indexOf(".")===-1?Sb(e):Tb(i,e);if(j){var k=Ub(j.functionImport,h);k&&k.isSideEffecting&&(f=!bc(k.isSideEffecting))}var m,n,o=c.__metadata,p=f?"functions":"actions",q=A(a,d),r=l(b)?b:[b];for(m=0,n=r.length;m<n;m++){var s=r[m];if(s){var t=o[p]=o[p]||[],u={metadata:q,title:s.title,target:A(s.target,d)};t.push(u)}}}},fg=function(a,b,c,d,e){var f,g,h,i=l(a)?a:a.value,j=[];for(f=0,g=i.length;f<g;f++)h=dg(i[f],b,c,d,e),j.push(h);var k={results:j};if(Cb(a)){for(var m in a)0===m.indexOf("#")&&(k.__metadata=k.__metadata||{},eg(m.substring(1),a[m],k,c,d));k=Uf(a,k,c)}return k},gg=function(a,b){var c,d,e=b.key.propertyRef;if(c="(",1==e.length)d=Nb(b.property,e[0].name).type,c+=lg(a[e[0].name],d);else for(var f=!0,g=0;g<e.length;g++)f?f=!1:c+=",",d=Nb(b.property,e[g].name).type,c+=e[g].name+"="+lg(a[e[g].name],d);return c+=")"},hg=function(a,b,c,d,e,f){var g=a[Nf.id]||a[Nf.read]||a[Nf.edit]||b.entitySet.name+b.key;if(a[Nf.id]=d+g,a[Nf.edit]||(a[Nf.edit]=b.entitySet.name+b.key,b.entitySet.entityType!=c&&(a[Nf.edit]+="/"+c)),a[Nf.read]=a[Nf.read]||a[Nf.edit],!a[Nf.etag]){var h=ig(a,e,f);h&&(a[Nf.etag]=h)}og(a,e,f),kg(a,e,f),ng(a,b)},ig=function(a,b,c){for(var d,e="",f=0;b.property&&f<b.property.length;f++)d=b.property[f],e=jg(a,e,d);if(c)for(f=0;c.property&&f<c.property.length;f++)d=c.property[f],e=jg(a,e,d);return e.length>0?e+'"':null},jg=function(a,b,c){return"Fixed"==c.concurrencyMode&&(b+=b.length>0?",":'W/"',b+=null!==a[c.name]?lg(a[c.name],c.type):"null"),b},kg=function(a,c,d){for(var e,f,g,h="@odata.navigationLinkUrl",i="@odata.associationLinkUrl",j=0;c.navigationProperty&&j<c.navigationProperty.length;j++)e=c.navigationProperty[j].name,f=e+h,a[f]===b&&(a[f]=a[Nf.edit]+"/"+encodeURIComponent(e)),g=e+i,a[g]===b&&(a[g]=a[Nf.edit]+"/$links/"+encodeURIComponent(e));if(d&&d.navigationProperty)for(j=0;j<d.navigationProperty.length;j++)e=d.navigationProperty[j].name,f=e+h,a[f]===b&&(a[f]=a[Nf.edit]+"/"+encodeURIComponent(e)),g=e+i,a[g]===b&&(a[g]=a[Nf.edit]+"/$links/"+encodeURIComponent(e))},lg=function(a,b){switch(a=""+mg(a,b),a=encodeURIComponent(a.replace("'","''")),b){case"Edm.Binary":return"X'"+a+"'";case"Edm.DateTime":return"datetime'"+a+"'";case"Edm.DateTimeOffset":return"datetimeoffset'"+a+"'";case"Edm.Decimal":return a+"M";case"Edm.Guid":return"guid'"+a+"'";case"Edm.Int64":return a+"L";case"Edm.Float":
return a+"f";case"Edm.Double":return a+"D";case"Edm.Geography":return"geography'"+a+"'";case"Edm.Geometry":return"geometry'"+a+"'";case"Edm.Time":return"time'"+a+"'";case"Edm.String":return"'"+a+"'";default:return a}},mg=function(a,b){switch(b){case"Edm.Binary":return D(a);default:return a}},ng=function(a,c){for(var d=c.functionImport||[],e=0;e<d.length;e++)if(d[e].isBindable&&d[e].parameter[0]&&d[e].parameter[0].type==c.entitySet.entityType){var f="#"+c.containerName+"."+d[e].name;a[f]==b&&(a[f]={title:d[e].name,target:a[Nf.edit]+"/"+d[e].name})}},og=function(a,b,c){(b.hasStream||c&&c.hasStream)&&(a[Nf.mediaEdit]=a[Nf.mediaEdit]||a[Nf.mediaEdit]+"/$value",a[Nf.mediaRead]=a[Nf.mediaRead]||a[Nf.mediaEdit])},pg=function(a,b,c,d){var e={type:b},f=$f(a.value,b,e,c,null,null,d);return Uf(a,{__metadata:e,value:f},c)},qg=function(a,b,c,d,e){var f={},g=ag(a.value,b,f,c,d,e);return j(g.__metadata,f),Uf(a,g,c)},rg=function(a,b){var c=a.value;if(!l(c))return sg(a,b);var d,e,f=[];for(d=0,e=c.length;d<e;d++)f.push(sg(c[d],b));var g={results:f};return Uf(a,g,b)},sg=function(a,b){var c={uri:A(a.url,b)};c=Uf(a,c,b);var d=c.__metadata||{},e=d.properties||{};return tg(e.url),p(e,"url","uri"),c},tg=function(a){a&&delete a.type},ug=function(a,b){var c=a.value,d=[],e=Uf(a,{collections:d},b),f=e.__metadata||{},g=f.properties||{};tg(g.value),p(g,"value","collections");var h,i;for(h=0,i=c.length;h<i;h++){var j=c[h],k={title:j.name,href:A(j.url,b)};k=Uf(j,k,b),f=k.__metadata||{},g=f.properties||{},tg(g.name),tg(g.url),p(g,"name","title"),p(g,"url","href"),d.push(k)}return{workspaces:[e]}},vg=function(a,b){return{kind:a,type:b||null}},wg=function(a,b,c){var d=a[Jf];if(!d||"string"!=typeof d)return null;var e=d.lastIndexOf("#");if(e===-1)return vg(Ef);var f=d.indexOf("@Element",e),g=f-1;g<0&&(g=d.indexOf("?",e),g===-1&&(g=d.length));var h=d.substring(e+1,g);if(h.indexOf("/$links/")>0)return vg(Ff);var i=h.split("/");if(i.length>=0){var j=i[0],k=i[1];if(Tf(j))return vg(Cf,j);if(Bb(j))return vg(Df,j);var m,n,o,p=k;if(!k){var q=j.lastIndexOf("."),r=j.substring(q+1),s=r===j?Sb(b):Tb(j.substring(0,q),b);s&&(m=Pb(s.entitySet,r),n=s.functionImport,o=s.name,p=m?m.entityType:null)}var t;if(f>0)return t=vg(Af,p),t.entitySet=m,t.functionImport=n,t.containerName=o,t;if(p)return t=vg(Bf,p),t.entitySet=m,t.functionImport=n,t.containerName=o,t;if(l(a.value)&&!Qb(j,b)){var u=a.value[0];if(!Kb(u)&&(Rf(u)||!c))return vg(Bf,null)}return vg(Af,j)}return null},xg=function(a,b,c,d,e){if(!Cb(a))return a;e=e||"minimalmetadata";var g=a[Jf],h=wg(a,b,d);f(h)&&(h.contentTypeOdata=e);var i=null;if(h)switch(delete a[Jf],i=h.type,h.kind){case Bf:return fg(a,h,g,b,c);case Df:return qg(a,i,g,b,c);case Cf:return pg(a,i,g,c);case Ef:return ug(a,g);case Ff:return rg(a,g)}return dg(a,h,g,b,c)},yg=["type","etag","media_src","edit_media","content_type","media_etag"],zg=function(a,b){var c=/\/\$links\//,d={},e=a.__metadata,f=b&&c.test(b.request.requestUri);return Bg(a,e&&e.properties,d,f),d},Ag=function(a,b){if(a){var c,d;for(c=0,d=yg.length;c<d;c++){var e=yg[c],f=Hf+(Mf[e]||e);Jg(f,null,a[e],b)}}},Bg=function(a,b,c,d){for(var e in a){var f=a[e];"__metadata"===e?Ag(f,c):e.indexOf(".")===-1?d&&"uri"===e?Dg(f,c):Cg(e,f,b,c,d):c[e]=f}},Cg=function(a,c,d,e){var f=d&&d[a]||{properties:b,type:b},g=Ba(c,f);return Kb(c)||!c?(Jg(Lf,a,g,e),void(e[a]=c)):Gb(c,g)||Fb(c)?void Gg(a,c,e):!g&&Eb(c)?void Eg(a,c,e):Ab(c,g)?(wb(g)&&Jg(Lf,a,g,e),void Fg(a,c,e)):(e[a]={},Jg(Lf,null,g,e[a]),void Bg(c,f.properties,e[a]))},Dg=function(a,b){b.url=a},Eg=function(a,b,c){Jg(Kf,a,b.__deferred.uri,c)},Fg=function(a,b,c){c[a]=[];var d=l(b)?b:b.results;Bg(d,null,c[a])},Gg=function(a,b,c){if(Gb(b)){c[a]=[];var d,e,f=l(b)?b:b.results;for(d=0,e=f.length;d<e;d++)Hg(a,f[d],!0,c)}else Hg(a,b,!1,c)},Hg=function(a,b,c,d){var e=b.__metadata&&b.__metadata.uri;if(e)return void Ig(a,e,c,d);var f=zg(b);return c?void d[a].push(f):void(d[a]=f)},Ig=function(a,b,c,d){var e=a+If;return c?(d[e]=d[e]||[],void d[e].push(b)):void(d[e]=b)},Jg=function(a,c,d,e){d!==b&&(c?e[c+"@"+a]=d:e[a]=d)},Kg="application/json",Lg=xc(Kg),Mg=function(a){var b=[];for(var c in a){var d,e;for(d=0,e=a[c].length;d<e;d++)b.push(j({metadata:c},a[c][d]))}return b},Ng=function(a,b,c,d){if(a&&"object"==typeof a){var e,f=a.__metadata;f&&(f.actions&&(f.actions=Mg(f.actions)),f.functions&&(f.functions=Mg(f.functions)),e=f&&f.type);var g,h=Rb(e,b)||Qb(e,b);if(h){var i=h.property;if(i){var j,k;for(j=0,k=i.length;j<k;j++){var l=i[j],m=l.name;if(g=a[m],"Edm.DateTime"===l.type||"Edm.DateTimeOffset"===l.type){if(g){if(g=c(g),!g)throw{message:"Invalid date/time value"};a[m]=g}}else"Edm.Time"===l.type&&(a[m]=hc(g))}}}else if(d)for(var n in a)g=a[n],"string"==typeof g&&(a[n]=c(g)||g)}return a},Og=function(a){if(a){var b=a.properties.odata;return"nometadata"===b||"minimalmetadata"===b||"fullmetadata"===b}return!1},Pg=function(a,b){var c,d,e={collections:[]};for(c=0,d=a.EntitySets.length;c<d;c++){var f=a.EntitySets[c],g={title:f,href:A(f,b)};e.collections.push(g)}return{workspaces:[e]}},Qg=/^\/Date\((-?\d+)(\+|-)?(\d+)?\)\/$/,Rg=function(a){var b;a<0?(b="-",a=-a):b="+";var c=Math.floor(a/60);return a-=60*c,b+ub(c,2)+":"+ub(a,2)},Sg=function(a){var b=a&&Qg.exec(a);if(b){var c=new Date(o(b[1]));if(b[2]){var d=o(b[3]);"-"===b[2]&&(d=-d);var e=c.getUTCMinutes();c.setUTCMinutes(e-d),c.__edmType="Edm.DateTimeOffset",c.__offset=Rg(d)}if(!isNaN(c.valueOf()))return c}},Tg=function(b,c,d){var e=h(d.recognizeDates,b.recognizeDates),f=h(d.inferJsonLightFeedAsObject,b.inferJsonLightFeedAsObject),g=d.metadata,i=d.dataServiceVersion,j=Sg,k="string"==typeof c?a.JSON.parse(c):c;if($b("3.0",i)===i){if(Og(d.contentType))return xg(k,g,e,f,d.contentType.properties.odata);j=ec}return k=lc(k.d,function(a,b){return Ng(b,g,j,e)}),k=Yg(k,d.dataServiceVersion),Xg(k,d.response.requestUri)},Ug=function(b){var c,d=Date.prototype.toJSON;try{Date.prototype.toJSON=function(){return sb(this)},c=a.JSON.stringify(b,Wg)}finally{Date.prototype.toJSON=d}return c},Vg=function(a,c,d){var e=d.dataServiceVersion||"1.0",f=h(d.useJsonLight,a.useJsonLight),g=d.contentType=d.contentType||Lg;if(g&&g.mediaType===Lg.mediaType){var i=c;return f||Og(g)?(d.dataServiceVersion=$b(e,"3.0"),i=zg(c,d),Ug(i)):($b("3.0",e)===e&&(g.properties.odata="verbose",d.contentType=g),Ug(i))}return b},Wg=function(a,b){return b&&"Edm.Time"===b.__edmType?tb(b):b},Xg=function(a,b){var c=Cb(a)&&!a.__metadata&&l(a.EntitySets);return c?Pg(a,b):a},Yg=function(a,b){return b&&b.lastIndexOf(";")===b.length-1&&(b=b.substr(0,b.length-1)),b&&"1.0"!==b||l(a)&&(a={results:a}),a},Zg=Jc(Tg,Vg,Kg,wc);Zg.recognizeDates=!1,Zg.useJsonLight=!1,Zg.inferJsonLightFeedAsObject=!1,d.jsonHandler=Zg;var $g="multipart/mixed",_g=/^HTTP\/1\.\d (\d{3}) (.*)$/i,ah=/^([^()<>@,;:\\"\/[\]?={} \t]+)\s?:\s?(.*)/,bh=function(){return Math.floor(65536*(1+Math.random())).toString(16).substr(1)},ch=function(a){return a+bh()+"-"+bh()+"-"+bh()},dh=function(a){return a.handler.partHandler},eh=function(a){var b=a.boundaries;return b[b.length-1]},fh=function(a,b,c){var d=c.contentType.properties.boundary;return{__batchResponses:hh(b,{boundaries:[d],handlerContext:c})}},gh=function(a,b,c){var d=c.contentType=c.contentType||xc($g);if(d.mediaType===$g)return mh(b,c)},hh=function(a,b){var c="--"+eh(b);lh(a,b,c),kh(a,b);for(var d,e=[];"--"!==d&&b.position<a.length;){var f,g=ih(a,b),h=xc(g["Content-Type"]);if(h&&h.mediaType===$g){b.boundaries.push(h.properties.boundary);try{f=hh(a,b)}catch(i){i.response=jh(a,b,c),f=[i]}e.push({__changeResponses:f}),b.boundaries.pop(),lh(a,b,"--"+eh(b))}else{if(!h||"application/http"!==h.mediaType)throw{message:"invalid MIME part type "};kh(a,b);var j=jh(a,b,c);try{j.statusCode>=200&&j.statusCode<=299?dh(b.handlerContext).read(j,b.handlerContext):j={message:"HTTP request failed",response:j}}catch(i){j=i}e.push(j)}d=a.substr(b.position,2),kh(a,b)}return e},ih=function(a,b){var c,d,e,f={};do e=b.position,d=kh(a,b),c=ah.exec(d),null!==c?f[c[1]]=c[2]:b.position=e;while(d&&c);return ac(f),f},jh=function(a,b,c){var d,e,f,g=b.position,h=_g.exec(kh(a,b));return h?(d=h[1],e=h[2],f=ih(a,b),kh(a,b)):b.position=g,{statusCode:d,statusText:e,headers:f,body:lh(a,b,"\r\n"+c)}},kh=function(a,b){return lh(a,b,"\r\n")},lh=function(a,b,c){var d=b.position||0,e=a.length;if(c){if(e=a.indexOf(c,d),e===-1)return null;b.position=e+c.length}else b.position=e;return a.substring(d,e)},mh=function(a,b){if(!yb(a))throw{message:"Data is not a batch object."};var c,d,e=ch("batch_"),f=a.__batchRequests,g="";for(c=0,d=f.length;c<d;c++)g+=nh(e,!1)+oh(f[c],b);g+=nh(e,!0);var h=b.contentType.properties;return h.boundary=e,g},nh=function(a,b){var c="\r\n--"+a;return b&&(c+="--"),c+"\r\n"},oh=function(a,b,c){var d,e=a.__changeRequests;if(l(e)){if(c)throw{message:"Not Supported: change set nested in other change set"};var f=ch("changeset_");d="Content-Type: "+$g+"; boundary="+f+"\r\n";var g,h;for(g=0,h=e.length;g<h;g++)d+=nh(f,!1)+oh(e[g],b,!0);d+=nh(f,!0)}else{d="Content-Type: application/http\r\nContent-Transfer-Encoding: binary\r\n\r\n";var i=j({},b);i.handler=Jc,i.request=a,i.contentType=null,jc(a,dh(b),i),d+=ph(a)}return d},ph=function(a){var b=(a.method?a.method:"GET")+" "+a.requestUri+" HTTP/1.1\r\n";for(var c in a.headers)a.headers[c]&&(b=b+c+": "+a.headers[c]+"\r\n");return b+="\r\n",a.body&&(b+=a.body),b};d.batchHandler=Jc(fh,gh,$g,wc);var qh=[d.jsonHandler,d.atomHandler,d.xmlHandler,d.textHandler],rh=function(a,b,c){var d,e;for(d=0,e=qh.length;d<e&&!qh[d][a](b,c);d++);if(d===e)throw{message:"no handler for data"}};d.defaultSuccess=function(b){a.alert(a.JSON.stringify(b))},d.defaultError=q,d.defaultHandler={read:function(a,b){a&&f(a.body)&&a.headers["Content-Type"]&&rh("read",a,b)},write:function(a,b){rh("write",a,b)},maxDataServiceVersion:wc,accept:"application/atomsvc+xml;q=0.8, application/json;odata=fullmetadata;q=0.7, application/json;q=0.5, */*;q=0.1"},d.defaultMetadata=[],d.read=function(a,b,c,e,f,g){var h;return h=a instanceof String||"string"==typeof a?{requestUri:a}:a,d.request(h,b,c,e,f,g)},d.request=function(a,b,c,e,f,g){b=b||d.defaultSuccess,c=c||d.defaultError,e=e||d.defaultHandler,f=f||d.defaultHttpClient,g=g||d.defaultMetadata,a.recognizeDates=h(a.recognizeDates,d.jsonHandler.recognizeDates),a.callbackParameterName=h(a.callbackParameterName,d.defaultHttpClient.callbackParameterName),a.formatQueryString=h(a.formatQueryString,d.defaultHttpClient.formatQueryString),a.enableJsonpCallback=h(a.enableJsonpCallback,d.defaultHttpClient.enableJsonpCallback),a.useJsonLight=h(a.useJsonLight,d.jsonHandler.enableJsonpCallback),a.inferJsonLightFeedAsObject=h(a.inferJsonLightFeedAsObject,d.jsonHandler.inferJsonLightFeedAsObject);var i={metadata:g,recognizeDates:a.recognizeDates,callbackParameterName:a.callbackParameterName,formatQueryString:a.formatQueryString,enableJsonpCallback:a.enableJsonpCallback,useJsonLight:a.useJsonLight,inferJsonLightFeedAsObject:a.inferJsonLightFeedAsObject};try{return jc(a,e,i),xb(a,b,c,e,f,i)}catch(j){c(j)}},d.parseMetadata=function(a){return zf(null,a)},d.batchHandler.partHandler=d.defaultHandler;var sh=null,th=function(){var a={v:this.valueOf(),t:"[object Date]"};for(var b in this)a[b]=this[b];return a},uh=function(a,b){if(b&&"[object Date]"===b.t){var c=new Date(b.v);for(var d in b)"t"!==d&&"v"!==d&&(c[d]=b[d]);b=c}return b},vh=function(a,b){return a.name+"#!#"+b},wh=function(a,b){return b.replace(a.name+"#!#","")},xh=function(a){this.name=a};xh.create=function(b){if(xh.isSupported())return sh=sh||a.localStorage,new xh(b);throw{message:"Web Storage not supported by the browser"}},xh.isSupported=function(){return!!a.localStorage},xh.prototype.add=function(a,b,c,d){d=d||this.defaultError;var e=this;this.contains(a,function(f){f?i(d,{message:"key already exists",key:a}):e.addOrUpdate(a,b,c,d)},d)},xh.prototype.addOrUpdate=function(c,d,e,f){if(f=f||this.defaultError,c instanceof Array)f({message:"Array of keys not supported"});else{var g=vh(this,c),h=Date.prototype.toJSON;try{var j=d;j!==b&&(Date.prototype.toJSON=th,j=a.JSON.stringify(d)),sh.setItem(g,j),i(e,c,d)}catch(k){22===k.code||2147942414===k.number?i(f,{name:"QUOTA_EXCEEDED_ERR",error:k}):i(f,k)}finally{Date.prototype.toJSON=h}}},xh.prototype.clear=function(a,b){b=b||this.defaultError;try{for(var c=0,d=sh.length;d>0&&c<d;){var e=sh.key(c),f=wh(this,e);e!==f?(sh.removeItem(e),d=sh.length):c++}i(a)}catch(g){i(b,g)}},xh.prototype.close=function(){},xh.prototype.contains=function(a,b,c){c=c||this.defaultError;try{var d=vh(this,a),e=sh.getItem(d);i(b,null!==e)}catch(f){i(c,f)}},xh.prototype.defaultError=q,xh.prototype.getAllKeys=function(a,b){b=b||this.defaultError;var c,d,e=[];try{for(c=0,d=sh.length;c<d;c++){var f=sh.key(c),g=wh(this,f);f!==g&&e.push(g)}i(a,e)}catch(h){i(b,h)}},xh.prototype.mechanism="dom",xh.prototype.read=function(c,d,e){if(e=e||this.defaultError,c instanceof Array)e({message:"Array of keys not supported"});else try{var f=vh(this,c),g=sh.getItem(f);g=null!==g&&"undefined"!==g?a.JSON.parse(g,uh):b,i(d,c,g)}catch(h){i(e,h)}},xh.prototype.remove=function(a,b,c){if(c=c||this.defaultError,a instanceof Array)c({message:"Batches not supported"});else try{var d=vh(this,a);sh.removeItem(d),i(b)}catch(e){i(c,e)}},xh.prototype.update=function(a,b,c,d){d=d||this.defaultError;var e=this;this.contains(a,function(f){f?e.addOrUpdate(a,b,c,d):i(d,{message:"key not found",key:a})},d)};var yh=a.mozIndexedDB||a.webkitIndexedDB||a.msIndexedDB||a.indexedDB,zh=a.IDBKeyRange||a.webkitIDBKeyRange,Ah=a.IDBTransaction||a.webkitIDBTransaction||{},Bh=Ah.READ_ONLY||"readonly",Ch=Ah.READ_WRITE||"readwrite",Dh=function(a,b){return function(c){var d=a||b;if(d){if("[object IDBDatabaseException]"===Object.prototype.toString.call(c))return 11===c.code?void d({name:"QuotaExceededError",error:c}):void d(c);var e;try{var f=c.target.error||c;e=f.name}catch(g){e="blocked"===c.type?"IndexedDBBlocked":"UnknownError"}d({name:e,error:c})}}},Eh=function(a,b,c){var d=a.name,e="_datajs_"+d,f=yh.open(e);f.onblocked=c,f.onerror=c,f.onupgradeneeded=function(){var a=f.result;a.objectStoreNames.contains(d)||a.createObjectStore(d)},f.onsuccess=function(a){var e=f.result;if(!e.objectStoreNames.contains(d)){if("setVersion"in e){var g=e.setVersion("1.0");return g.onsuccess=function(){var a=g.transaction;a.oncomplete=function(){b(e)},e.createObjectStore(d,null,!1)},g.onerror=c,void(g.onblocked=c)}return a.target.error={name:"DBSchemaMismatch"},void c(a)}e.onversionchange=function(a){a.target.close()},b(e)}},Fh=function(a,b,c,d){var e=a.name,f=a.db,g=Dh(d,a.defaultError);return f?void c(f.transaction(e,b)):void Eh(a,function(d){a.db=d,c(d.transaction(e,b))},g)},Gh=function(a){this.name=a};Gh.create=function(a){if(Gh.isSupported())return new Gh(a);throw{message:"IndexedDB is not supported on this browser"}},Gh.isSupported=function(){return!!yh},Gh.prototype.add=function(a,b,c,d){var e=this.name,f=this.defaultError,g=[],h=[];a instanceof Array?(g=a,h=b):(g=[a],h=[b]),Fh(this,Ch,function(i){i.onabort=Dh(d,f,a,"add"),i.oncomplete=function(){a instanceof Array?c(g,h):c(a,b)};for(var j=0;j<g.length&&j<h.length;j++)i.objectStore(e).add({v:h[j]},g[j])},d)},Gh.prototype.addOrUpdate=function(a,b,c,d){var e=this.name,f=this.defaultError,g=[],h=[];a instanceof Array?(g=a,h=b):(g=[a],h=[b]),Fh(this,Ch,function(i){i.onabort=Dh(d,f),i.oncomplete=function(){a instanceof Array?c(g,h):c(a,b)};for(var j=0;j<g.length&&j<h.length;j++){var k={v:h[j]};i.objectStore(e).put(k,g[j])}},d)},Gh.prototype.clear=function(a,b){var c=this.name,d=this.defaultError;Fh(this,Ch,function(e){e.onerror=Dh(b,d),e.oncomplete=function(){a()},e.objectStore(c).clear()},b)},Gh.prototype.close=function(){this.db&&(this.db.close(),this.db=null)},Gh.prototype.contains=function(a,b,c){var d=this.name,e=this.defaultError;Fh(this,Bh,function(f){var g=f.objectStore(d),h=g.get(a);f.oncomplete=function(){b(!!h.result)},f.onerror=Dh(c,e)},c)},Gh.prototype.defaultError=q,Gh.prototype.getAllKeys=function(a,b){var c=this.name,d=this.defaultError;Fh(this,Ch,function(e){var f=[];e.oncomplete=function(){a(f)};var g=e.objectStore(c).openCursor();g.onerror=Dh(b,d),g.onsuccess=function(a){var b=a.target.result;b&&(f.push(b.key),b["continue"].call(b))}},b)},Gh.prototype.mechanism="indexeddb",Gh.prototype.read=function(a,c,d){var e=this.name,f=this.defaultError,g=a instanceof Array?a:[a];Fh(this,Bh,function(h){var i=[];h.onerror=Dh(d,f,a,"read"),h.oncomplete=function(){a instanceof Array?c(g,i):c(g[0],i[0])};for(var j=0;j<g.length;j++){var k=h.objectStore(e),l=k.get.call(k,g[j]);l.onsuccess=function(a){var c=a.target.result;i.push(c?c.v:b)}}},d)},Gh.prototype.remove=function(a,b,c){var d=this.name,e=this.defaultError,f=a instanceof Array?a:[a];Fh(this,Ch,function(a){a.onerror=Dh(c,e),a.oncomplete=function(){b()};for(var g=0;g<f.length;g++){var h=a.objectStore(d);h["delete"].call(h,f[g])}},c)},Gh.prototype.update=function(a,b,c,d){var e=this.name,f=this.defaultError,g=[],h=[];a instanceof Array?(g=a,h=b):(g=[a],h=[b]),Fh(this,Ch,function(i){i.onabort=Dh(d,f),i.oncomplete=function(){a instanceof Array?c(g,h):c(a,b)};for(var j=0;j<g.length&&j<h.length;j++){var k=i.objectStore(e).openCursor(zh.only(g[j])),l={v:h[j]};k.pair={key:g[j],value:l},k.onsuccess=function(a){var b=a.target.result;b?b.update(a.target.pair.value):i.abort()}}},d)};var Hh=function(a){var c=[],d=[],e={};this.name=a;var f=function(a){return a||this.defaultError},g=function(a,c){var d;return a instanceof Array&&(d="Array of keys not supported"),a!==b&&null!==a||(d="Invalid key"),!d||(i(c,{message:d}),!1)};this.add=function(a,b,c,d){d=f(d),g(a,d)&&(e.hasOwnProperty(a)?d({message:"key already exists",key:a}):this.addOrUpdate(a,b,c,d))},this.addOrUpdate=function(a,h,j,k){if(k=f(k),g(a,k)){var l=e[a];l===b&&(l=c.length>0?c.splice(0,1):d.length),d[l]=h,e[a]=l,i(j,a,h)}},this.clear=function(a){d=[],e={},c=[],i(a)},this.contains=function(a,b){var c=e.hasOwnProperty(a);i(b,c)},this.getAllKeys=function(a){var b=[];for(var c in e)b.push(c);i(a,b)},this.read=function(a,b,c){if(c=f(c),g(a,c)){var h=e[a];i(b,a,d[h])}},this.remove=function(a,h,j){if(j=f(j),g(a,j)){var k=e[a];k!==b&&(k===d.length-1?d.pop():(d[k]=b,c.push(k)),delete e[a],0===d.length&&(c=[])),i(h)}},this.update=function(a,b,c,d){d=f(d),g(a,d)&&(e.hasOwnProperty(a)?this.addOrUpdate(a,b,c,d):d({message:"key not found",key:a}))}};Hh.create=function(a){return new Hh(a)},Hh.isSupported=function(){return!0},Hh.prototype.close=function(){},Hh.prototype.defaultError=q,Hh.prototype.mechanism="memory";var Ih={indexeddb:Gh,dom:xh,memory:Hh};c.defaultStoreMechanism="best",c.createStore=function(a,b){b||(b=c.defaultStoreMechanism),"best"===b&&(b=xh.isSupported()?"dom":"memory");var d=Ih[b];if(d)return d.create(a);throw{message:"Failed to create store",name:a,mechanism:b}};var Jh=function(a,b){var c=a.indexOf("?")>=0?"&":"?";return a+c+b},Kh=function(a,b){var c=a.indexOf("?"),d="";return c>=0&&(d=a.substr(c),a=a.substr(0,c)),"/"!==a[a.length-1]&&(a+="/"),a+b+d},Lh=function(a,b){return{method:"GET",requestUri:a,user:b.user,password:b.password,enableJsonpCallback:b.enableJsonpCallback,callbackParameterName:b.callbackParameterName,formatQueryString:b.formatQueryString}},Mh=function(a,b,c,d){var e=Nh(a,b,[],c,d);return e},Nh=function(a,c,e,f,g){var h=Lh(a,c),i=d.request(h,function(a){var b=a.__next,d=a.results;e=e.concat(d),b?i=Nh(b,c,e,f,g):f(e)},g,b,c.httpClient,c.metadata);return{abort:function(){i.abort()}}},Oh=function(a){var c=this,e=a.source;return c.identifier=z(encodeURI(decodeURI(e))),c.options=a,c.count=function(a,f){var g=c.options;return d.request(Lh(Kh(e,"$count"),g),function(b){var c=o(b.toString());isNaN(c)?f({message:"Count is NaN",count:c}):a(c)},f,b,g.httpClient,g.metadata)},c.read=function(a,b,d,f){var g="$skip="+a+"&$top="+b;return Mh(Jh(e,g),c.options,d,f)},c},Ph=function(a,b){var c=Qh(a,b);if(c){var d=c.i-b.i,e=d+(a.c-a.d.length);a.d=a.d.concat(b.d.slice(d,e))}},Qh=function(a,b){var c,d=a.i+a.c,e=b.i+b.c,f=a.i>b.i?a.i:b.i,g=d<e?d:e;return g>=f&&(c={i:f,c:g-f}),c},Rh=function(a,c){if(a===b||"number"!=typeof a)throw{message:"'"+c+"' must be a number."};if(isNaN(a)||a<0||!isFinite(a))throw{message:"'"+c+"' must be greater than or equal to zero."}},Sh=function(a,c){if(a!==b){if("number"!=typeof a)throw{message:"'"+c+"' must be a number."};if(isNaN(a)||a<=0||!isFinite(a))throw{message:"'"+c+"' must be greater than zero."}}},Th=function(a,c){if(a!==b&&("number"!=typeof a||isNaN(a)||!isFinite(a)))throw{message:"'"+c+"' must be a number."}},Uh=function(a,b){var c,d;for(c=0,d=a.length;c<d;c++)if(a[c]===b)return a.splice(c,1),!0;return!1},Vh=function(a){var b=0,c=typeof a;if("object"===c&&a)for(var d in a)b+=2*d.length+Vh(a[d]);else b="string"===c?2*a.length:8;return b},Wh=function(a,b,c){return a=Math.floor(a/c)*c,b=Math.ceil((b+1)/c)*c,{i:a,c:b-a}},Xh="destroy",Yh="idle",Zh="init",$h="read",_h="prefetch",ai="write",bi="cancel",ci="end",di="error",ei="start",fi="wait",gi="clear",hi="done",ii="local",ji="save",ki="source",li=function(a,b,c,d,e,f,g){var h,i,j=this;j.p=b,j.i=d,j.c=e,j.d=f,j.s=ei,j.canceled=!1,j.pending=g,j.oncomplete=null,j.cancel=function(){if(c){var a=j.s;a!==di&&a!==ci&&a!==bi&&(j.canceled=!0,l(bi,h))}},j.complete=function(){l(ci,h)},j.error=function(a){j.canceled||l(di,a)},j.run=function(a){i=a,j.transition(j.s,h)},j.wait=function(a){l(fi,a)};var k=function(b,c,d){switch(b){case ei:c!==Zh&&a(j,b,c,d);break;case fi:a(j,b,c,d);break;case bi:a(j,b,c,d),j.fireCanceled(),l(ci);break;case di:a(j,b,c,d),j.canceled=!0,j.fireRejected(d),l(ci);break;case ci:j.oncomplete&&j.oncomplete(j),j.canceled||j.fireResolved(),a(j,b,c,d);break;default:a(j,b,c,d)}},l=function(a,b){j.s=a,h=b,k(a,i,b)};return j.transition=l,j};li.prototype.fireResolved=function(){var a=this.p;a&&(this.p=null,a.resolve(this.d))},li.prototype.fireRejected=function(a){var b=this.p;b&&(this.p=null,b.reject(a))},li.prototype.fireCanceled=function(){this.fireRejected({canceled:!0,message:"Operation canceled"})};var mi=function(d){var e,g=Zh,h={counts:0,netReads:0,prefetches:0,cacheReads:0},k=[],l=[],m=[],n=0,p=!1,q=s(d.cacheSize,1048576),r=0,t=0,u=0,v=0===q,w=s(d.pageSize,50),x=s(d.prefetchSize,w),y="1.0",z=0,A=d.source;"string"==typeof A&&(A=new Oh(d)),A.options=d;var B=c.createStore(d.name,d.mechanism),C=this;C.onidle=d.idle,C.stats=h,C.count=function(){if(e)throw e;var a=Aa(),b=!1;if(p)return i(function(){a.resolve(r)}),a.promise();var c=A.count(function(b){c=null,h.counts++,a.resolve(b)},function(d){c=null,a.reject(j(d,{canceled:b}))});return j(a.promise(),{cancel:function(){c&&(b=!0,c.abort(),c=null)}})},C.clear=function(){if(e)throw e;if(0===k.length){var a=Aa(),b=new li(S,a,(!1));return L(b,k),a.promise()}return k[0].p},C.filterForward=function(a,b,c){return I(a,b,c,!1)},C.filterBack=function(a,b,c){return I(a,b,c,!0)},C.readRange=function(a,b){if(Rh(a,"index"),Rh(b,"count"),e)throw e;var c=Aa(),d=new li(U,c,(!0),a,b,[],0);return L(d,l),j(c.promise(),{cancel:function(){d.cancel()}})},C.ToObservable=C.toObservable=function(){if(!a.Rx||!a.Rx.Observable)throw{message:"Rx library not available - include rx.js"};if(e)throw e;return a.Rx.Observable.CreateWithDisposable(function(a){var b=!1,c=0,d=function(c){b||a.OnError(c)},e=function(f){if(!b){var g,h;for(g=0,h=f.length;g<h;g++)a.OnNext(f[g]);f.length<w?a.OnCompleted():(c+=w,C.readRange(c,w).then(e,d))}};return C.readRange(c,w).then(e,d),{Dispose:function(){b=!0}}})};var D=function(a){return function(b){e={message:a,error:b};var c,d;for(c=0,d=l.length;c<d;c++)l[c].fireRejected(e);for(c=0,d=k.length;c<d;c++)k[c].fireRejected(e);l=k=null}},E=function(a){if(a!==g){g=a;var b,c,d=k.concat(l,m);for(b=0,c=d.length;b<c;b++)d[b].run(g)}},F=function(){var a=new za;return B.clear(function(){n=0,p=!1,r=0,t=0,u=0,v=0===q,h={counts:0,netReads:0,prefetches:0,cacheReads:0},C.stats=h,B.close(),a.resolve()},function(b){a.reject(b)}),a},G=function(a){var b=Uh(k,a);b||(b=Uh(l,a),b||Uh(m,a)),z--,E(Yh)},H=function(a){var b=new za,c=!1,d=A.read(a,w,function(c){var d={i:a,c:c.length,d:c};b.resolve(d)},function(a){b.reject(a)});return j(b,{cancel:function(){d&&(d.abort(),c=!0,d=null)}})},I=function(a,b,c,d){if(a=o(a),b=o(b),isNaN(a))throw{message:"'index' must be a valid number.",index:a};if(isNaN(b))throw{message:"'count' must be a valid number.",count:b};if(e)throw e;a=Math.max(a,0);var f=Aa(),g=[],h=!1,i=null,k=function(a,e){h||(b>=0&&g.length>=b?f.resolve(g):i=C.readRange(a,e).then(function(h){for(var i=0,j=h.length;i<j&&(b<0||g.length<b);i++){var l=d?j-i-1:i,m=h[l];if(c(m)){var n={index:a+l,item:m};d?g.unshift(n):g.push(n)}}if(!d&&h.length<e||d&&a<=0)f.resolve(g);else{var o=d?Math.max(a-w,0):a+e;k(o,w)}},function(a){f.reject(a)}))},l=Wh(a,a,w),m=d?l.i:a,n=d?a-l.i+1:l.i+l.c-a;return k(m,n),j(f.promise(),{cancel:function(){i&&i.cancel(),h=!0}})},J=function(){C.onidle&&0===z&&C.onidle()},K=function(a){if(!p&&0!==x&&!v&&(0===m.length||m[0]&&m[0].c!==-1)){var b=new li(T,null,(!0),a,x,null,x);L(b,m)}},L=function(a,b){a.oncomplete=G,b.push(a),z++,a.run(g)},M=function(a){var c=!1,d=j(new za,{cancel:function(){c=!0}}),e=P(d,"Read page from store failure");return B.contains(a,function(f){if(!c)return f?void B.read(a,function(a,e){c||d.resolve(e!==b,e)},e):void d.resolve(!1)},e),d},N=function(a,b){var c=!1,d=j(new za,{cancel:function(){c=!0}}),e=P(d,"Save page to store failure"),f=function(){d.resolve(!0)};if(b.c>0){var g=Vh(b);v=q>=0&&q<n+g,v?f():B.addOrUpdate(a,b,function(){Q(b,g),O(f,e)},e)}else Q(b,0),O(f,e);return d},O=function(a,b){var c={actualCacheSize:n,allDataLocal:p,cacheSize:q,collectionCount:r,highestSavedPage:t,highestSavedPageSize:u,pageSize:w,sourceId:A.identifier,version:y};B.addOrUpdate("__settings",c,a,b)},P=function(a){return function(){a.resolve(!1)}},Q=function(a,b){var c=a.c,d=a.i;0===c?t===d-w&&(r=t+u):(t=Math.max(t,d),t===d&&(u=c),n+=b,c<w&&!r&&(r=d+c)),p||r!==t+u||(p=!0)},R=function(a,b,c,d){var e=a.canceled&&b!==ci;return e&&b===bi&&d&&d.cancel&&d.cancel(),e},S=function(a,b,c){var d=a.transition;if(c!==Xh)return E(Xh),!0;switch(b){case ei:d(gi);break;case ci:J();break;case gi:F().then(function(){a.complete()}),a.wait();break;default:return!1}return!0},T=function(a,b,c,d){if(!R(a,b,c,d)){var e=a.transition;if(c!==_h)return c===Xh?b!==bi&&a.cancel():c===Yh&&E(_h),!0;switch(b){case ei:m[0]===a&&e(ii,a.i);break;case hi:var f=a.pending;f>0&&(f-=Math.min(f,d.c)),p||0===f||d.c<w||v?a.complete():(a.pending=f,e(ii,d.i+w));break;default:return V(a,b,c,d,!0)}}return!0},U=function(a,b,c,d){if(!R(a,b,c,d)){var e=a.transition;if(c!==$h&&b!==ei)return c===Xh?b!==ei&&a.cancel():c!==ai&&E($h),!0;switch(b){case ei:if(c===Yh||c===_h)if(E($h),a.c>0){var f=Wh(a.i,a.c,w);e(ii,f.i)}else e(hi,a);break;case hi:Ph(a,d);var g=a.d.length;a.c===g||d.c<w?(h.cacheReads++,K(d.i+d.c),a.complete()):e(ii,d.i+w);break;default:return V(a,b,c,d,!1)}}return!0},V=function(a,b,c,d,e){var f,g=a.error,i=a.transition,j=a.wait;switch(b){case ci:J();break;case ii:f=M(d).then(function(b,c){a.canceled||(b?i(hi,c):i(ki,d))});break;case ki:f=H(d).then(function(b){a.canceled||(e?h.prefetches++:h.netReads++,i(ji,b))},g);break;case ji:c!==ai&&(E(ai),f=N(d.i,d).then(function(b){a.canceled||(!b&&e&&(a.pending=0),i(hi,d)),E(Yh)}));break;default:return!1}return f&&(a.canceled?f.cancel():a.s===b&&j(f)),!0};return B.read("__settings",function(a,b){if(f(b)){var c=b.version;if(!c||0!==c.indexOf("1."))return void D("Unsupported cache store version "+c)();w!==b.pageSize||A.identifier!==b.sourceId?F().then(function(){E(Yh)},D("Unable to clear store during initialization")):(n=b.actualCacheSize,p=b.allDataLocal,q=b.cacheSize,r=b.collectionCount,t=b.highestSavedPage,u=b.highestSavedPageSize,y=c,E(Yh))}else O(function(){E(Yh)},D("Unable to write settings during initialization."))},D("Unable to read settings from store.")),C};c.createDataCache=function(a){if(Sh(a.pageSize,"pageSize"),Th(a.cacheSize,"cacheSize"),Th(a.prefetchSize,"prefetchSize"),!f(a.name))throw{message:"Undefined or null name",options:a};if(!f(a.source))throw{message:"Undefined source",options:a};return new mi(a)}}(this),d("oDataService",function(a){return function(){var b,c;return c=function(){return this.OData},b=c.apply(a,arguments)}}(this)),d("transportInterface",["underscorenc","helpers"],function(a,b){var c={defaults:{successHandler:null,errorHandler:null,fields:null,filters:null,orderBy:null,orderDesc:!1,getCount:!1,orderAscending:null,limitFrom:null,limitCount:null,parseDate:null},create:function(){console.log("transportInterface:create :: stub method, have to be implemented")},find:function(){console.log("transportInterface:find :: stub method, have to be implemented")},findOne:function(){console.log("transportInterface:findOne :: stub method, have to be implemented")},update:function(){console.log("transportInterface:update :: stub method, have to be implemented")},remove:function(){console.log("transportInterface:remove :: stub method, have to be implemented")}};return c}),d("filtersParser",["underscorenc","helpers","config","errorManager"],function(a,b,c,d){var e=function(b,c){return b.indexOf("date")!==-1?"datetime'"+c+"'":a.isString(c)?"'"+c+"'":a.isNull(c)?"null":c},f={$equal:"="},g={$and:"&"},h={$gte:"ge",$gt:"gt",$lte:"le",$lt:"lt",$equal:"eq",$ne:"ne",$not:"not",$in:function(b,c){var d=a.map(c,function(a){var c={};return c[b]=a,c});return m.parseFilter({$or:d})},$like:function(a,c){return"'"===c[0]&&"'"===c[c.length-1]&&(c=c.slice(1,-1)),"substringof('"+b.encodeUrlString(c)+"', "+a+")"},$extend:function(b){if(!a.isObject(b))return"";var c=a.first(a.keys(b)),d=b[c],e=m.setKeyPrefix(c).parseFilter(d);return m.setKeyPrefix(""),e},$any:function(b){if(!a.isObject(b))return"";var c,d=a.first(a.keys(b)),e=b[d],f="";return c=m.setKeyPrefix(d).parseFilter(e),m.setKeyPrefix(""),f=d+"/any("+d+": "+c+")"},$sub:function(b){if(!a.isObject(b))return"";var c=a.first(a.keys(b)),d=b[c],e="";return e=m.setKeyPrefix(c).parseFilter(d),m.setKeyPrefix(""),e}},i={$or:"or",$and:"and"},j=a.keys(i),k=a.keys(h),l=a.union(j,k),m={comparators:h,operators:i,opsNames:j,compareOperations:k,acceptableKeys:l,keyPrefix:"",setKeyPrefix:function(a){return this.keyPrefix=a,this},createKey:function(a){return this.keyPrefix&&a.indexOf(this.keyPrefix+"/")===-1?this.keyPrefix+"/"+a:a},isWrap:!0,setWrap:function(a){return this.isWrap=!!a,this},wrap:function(a){return this.isWrap?"("+a+")":a},useAlternativeRules:function(){return this.comparators=f,this.operators=g,this.opsNames=a.keys(this.operators),this.compareOperations=a.keys(this.comparators),this.acceptableKeys=a.union(this.opsNames,this.compareOperations),this},restoreRules:function(){return this.comparators=h,this.operators=i,this.opsNames=j,this.compareOperations=k,this.acceptableKeys=l,this},validate:function(b){if(!a.isNumber(b)&&!a.isFunction(b)&&!a.contains(this.acceptableKeys,b)){var c=a.some(this.acceptableKeys,function(a){return a=="$"+b});c&&d.throwError("API_ERR_TRANSPORT_2",[b,l]),"$"===a.first(b)&&d.throwError("API_ERR_TRANSPORT_2",[b,l])}},isComplex:function(b){var c=this;return a.some(b,function(b,d){var e=a.some(c.acceptableKeys,function(a){return a==d});return!!e||!!a.isObject(b)&&c.isComplex(b)})},getFields:function(b){var c=this;return a.compact(a.uniq(a.flatten(a.map(b,function(b,d){if("$extend"!=d&&"$any"!=d&&"$sub"!=d)return(a.isObject(b)||a.contains(c.acceptableKeys,d))&&(a.contains(c.acceptableKeys,d)||a.isNumber(d))?c.getFields(b):d}))))},mapFilters:function(c){a.isUndefined(c.$visibility)||(a.isArray(c.$visibility)?a.some(c.$visibility,function(b){return!a.isString(b)})&&d.throwError("API_ERR_QUERY_API_3",[this.entityName,a.keys(this._filtersObj),"","string","of incorrect type"]):a.isString(c.$visibility)||d.throwError("API_ERR_QUERY_API_3",[this.entityName,a.keys(this._filtersObj),"","string",b.toType(c.$visibility)]),delete c.$visibility),a.isUndefined(c.$client)||(a.isString(c.$client)||d.throwError("API_ERR_QUERY_API_3",[this.entityName,a.keys(this._filtersObj),"","string",b.toType(c.$client)]),delete c.$client)},buildComparator:function(b,c){if(a.isArray(b))return this.comparators.$in(c,b);
if(a.isObject(b)){var f=a.first(a.keys(b));this.validate(f),operation=this.comparators[f],value=b[f]}else operation=this.comparators.$equal,value=b;return a.isUndefined(operation)&&d.throwError("API_ERR_TRANSPORT_3",[f,this.compareOperations]),value=e(c,value),c=this.createKey(c),a.isFunction(operation)?string=operation(c,value):string=[c,value].join(" "+operation+" "),this.wrap(string)},createFilterString:function(a){if(!a)return"";this.mapFilters(a);var b=this.parseFilter(a);return this.restoreRules(),this.isWrap=!0,this.keyPrefix="",b},parseFilter:function(b,c){var d=this,e=this.operators[c||"$and"];if(a.isArray(b)){var f=a.map(b,function(a){return d.parseFilter(a,c)}).join(" "+e+" ");return this.wrap(f)}return a.map(b,function(b,c){if(d.validate(c),"$extend"==c||"$any"==c||"$sub"==c)return d.comparators[c](b);var e=a.some(d.opsNames,function(a){return a==c});return e?d.parseFilter(b,c):d.buildComparator(b,c)}).join(" "+e+" ")},getCustomQueryOptions:function(a){return this.setWrap(!1).useAlternativeRules().createFilterString(a)}};return m}),d("oDataQueryBuilder",["underscorenc","config","filtersParser","helpers"],function(a,b,c,d){function e(a,b){var c="";return a.orderByExpanded?c=""===b?g(a.orderByExpanded,"orderby",a.expandedFor):","+g(a.orderByExpanded,"",a.expandedFor).substring(3):c}function f(a){var b="";return a.expandedFor&&(b="$expand="+a.expandedFor),b}var g=function(b,c,d){var e,f="";if(a.isString(b)&&(b=[b]),b&&b.length>0)if(d)for(f="$"+c+"=",e=0;e<b.length;e++)f+=d+"/"+b[e],e<b.length-1&&(f+=",");else f="$"+c+"="+b.join(",");return f},h=function(b,c){var d="",e="";return a.isNullUndef(b)||(d="$skip="+b),a.isNullUndef(c)||(e="$top="+c),a.compact([d,e]).join("&")},i={filtersParser:c};return i.getExpandedTail=function(b){if(b.count)return this.getCountTail(b);var c="",j="",k="",l="",m="",n="",o="",p="";if(c=i.getFilterStringSimple(b),j=g(b.fields,"select",b.expandedFor),b.expandedForFields&&b.expandedForFields.length){var q=b.expandedForFields.join(",");j=a.compact([j,q]).join(",")}return k=g(b.orderBy,"orderby"),l=e(b,k),b.orderDesc&&k&&!l&&(k+=" desc "),b.orderDesc&&l&&(l+=" desc "),b.inlineCount&&(inlineCountString="$inlinecount=allpages"),p=i.addQueryParams(b),m=h(b.limitFrom,b.limitCount),n=f(b),o=d.concatenateStrings("?",[p,n,c,j,k,l,m],"&")},i.getTail=function(a){if(a.data.count)return this.getCountTail(a);var b="",c="",e="",f="",j="",k="",l="",m="";return b=i.getFilterStringSimple(a.data),c=g(a.data.fields,"select"),e=g(a.data.orderBy,"orderby"),a.data.orderDesc&&e&&(e+=" desc "),a.data.inlineCount&&(l="$inlinecount=allpages"),k=i.addQueryParams(a.head.queryParams),m=i.expandFor(a.data.expandFor),f=h(a.data.limitFrom,a.data.limitCount),j=d.concatenateStrings("?",[k,b,c,e,f,l,m],"&")},i.getCountTail=function(a){var b,c,e="",g="";return b=i.getFilterStringSimple(a.data),e=i.addQueryParams(a.head.queryParams),g=f(a.data),c="/$count"+d.concatenateStrings("?",[e,g,b],"&")},i.getFilterStringSimple=function(b){var e=b.customFunctionString?b.customFunctionString+"&":"";b.filters=b.filters||{},b.expandedFor&&b.expandedForFilters&&(b.filters.$extend={},b.filters.$extend[b.expandedFor]=b.expandedForFilters);var f=c.createFilterString(b.filters);return e+d.concatenateStrings("$filter=",a.compact([f,b.customFilterString])," and ")},i.addQueryParams=function(b){var c="";return b&&a.isObject(b)&&(c+=a.map(b,function(a,b){return""+b+"="+a}).join("&")),c},i.expandFor=function(c){return c&&a.isArray(c)&&c.length?b.EXPAND+c.join(","):""},i.fieldsToString=g,i.limitToString=h,i}),d("oDataTransport",["oDataService","transportInterface","helpers","underscorenc","config","oDataQueryBuilder","errorManager"],function(a,b,c,d,e,f,g){function h(a,b){return function(f,g){if(d.isUndefined(f)&&!d.isUndefined(g.body)&&d.isString(g.body)&&g.body.length&&(f=JSON.parse(g.body)),a.successHandler){var h=[];if(b.head.operation===e.CRUD.find)h.push(b.data.count?f:f.results),h.push(f.__next);else if(b.head.operation===e.CRUD.remove);else if(b.head.operation===e.CRUD.update){var i=c.getResponseAdditionalData(g),j={__metadata:{}};if(!d.isUndefined(i)&&!d.isUndefined(i.headers)){var k=c.getPropertyValueCaseInsensitive(i.headers,"etag");d.isUndefined(k)||(j.__metadata.etag=k)}h.push(j)}else h.push(f);h.push(c.getResponseAdditionalData(g)),a.successHandler.apply(a,h)}else c.defSuccessCb(f)}}function i(a){return function(b){a.errorHandler?a.errorHandler(b.message,c.getResponseAdditionalData(b.response)):c.defErrorCb({message:b.message})}}function j(a){return function(b,f){var g=t(b),h=!(d.isUndefined(b.__batchResponses)||b.__batchResponses.length>0&&b.__batchResponses[0].__changeResponses);if(!h){var i=c.getResponseAdditionalData(f);if(i.sub=g.responseAdditionalData,s(b))return a.errorHandler?a.errorHandler(g.error,i):c.defErrorCb({error:g.error,details:i});if(!d.isUndefined(i.sub)&&!d.isUndefined(i.sub.length>0)){var j=0;g.data||(g.data=[]),d.each(i.sub,function(b){if(a.sub[j].head.operation===e.CRUD.update){var f={__metadata:{}},h=c.getPropertyValueCaseInsensitive(b.headers,"etag");d.isUndefined(h)||(f.__metadata.etag=h),g.data[j]=f}j++})}}a.successHandler?h?a.successHandler(g):a.successHandler(g.data,i):c.defSuccessCb(b)}}function k(a,b){var f={};if(b||(f.timeoutMS=e.REQUEST_TIMEOUT),a.head.operation!==e.CRUD.find||d.isNullUndef(a.data.id)||(a.head.operation=e.CRUD.findOne),!d.isFunction(r[a.head.operation]))throw"Unrecognised operation: "+a.head.operation;return d.extend(f,r[a.head.operation](a,b)),a.head.customOperation===e.CUSTOM_ENDPOINTS.FIND_IMAGE&&(f.headers=c.getHeader({"X-Requested-With":"XMLHttpRequest"})),f}function l(a){var b=[],f=[],g={__batchRequests:b};d.each(a.sub,function(a){var c=k(a,!0);c.method===e.REQ_TYPE_GET?b.push(c):f.push(c)}),f.length>0&&b.push({__changeRequests:f});var h={};return h.requestUri=c.getRequestURL("$batch"),h.method=c.getHTTPMethod(e.REQ_TYPE_POST),h.headers=c.getHeader(e.REQ_TYPE_POST),h.timeoutMS=e.REQUEST_TIMEOUT,h.data=g,h}function m(a){var b,d,f={},g="\r\n";return b="----data-persistence-boundary-"+Math.floor(Math.random()*(new Date).getMilliseconds()),d="--"+b+g,d+='Content-Disposition: form-data; name="annotation"'+g,d+="content-type: application/json"+g+g,d+=JSON.stringify(a.data.fieldsValues)+g,d+="--"+b+g,d+='Content-Disposition: form-data; name="uploadfile"; filename="canvas_image.png"'+g,d+="Content-Transfer-Encoding: base64"+g,d+="Content-Type: image/png"+g+g,d+=a.data.base64Image+g+"--"+b+"--"+g,f.body=d,a.head.customOperation===e.CUSTOM_ENDPOINTS.CREATE_IMAGE?f.requestUri=c.getRequestURL(e.ACTION_STORAGE_UPLOAD_URL,!0):a.head.customOperation===e.CUSTOM_ENDPOINTS.UPDATE_IMAGE&&(f.requestUri=c.getRequestURL(a.head.baseURL(a.data),!0)),f.method=c.getHTTPMethod(a.head.reqType||e.REQ_TYPE_POST),f.headers=c.getHeader(e.REQ_TYPE_PUT),f.headers["Content-Type"]="multipart/form-data; boundary="+b,f}function n(b){b.test?b.test(k(b.sub[0])):b.sub[0].head.customOperation===e.CUSTOM_ENDPOINTS.FIND_IMAGE||b.sub[0].head.customOperation===e.CUSTOM_ENDPOINTS.REMOVE_IMAGE?a.request(k(b.sub[0],!1),h(b,b.sub[0]),i(b),a.batchHandler):a.request(k(b.sub[0],!1),h(b,b.sub[0]),i(b))}function o(b){b.test?b.test(l(b)):a.request(l(b),j(b),i(b),a.batchHandler)}function p(b){b.test?b.test(m(b.sub[0],!1)):a.request(m(b.sub[0]),h(b,b.sub[0]),i(b),a.batchHandler)}var q={init:function(){var c=d.extend({},b,this);return a.defaultHttpClient.enableJsonpCallback=!1,c}};q.setCors=function(){},q.getFiltersParser=function(){return f.filtersParser};var r={};r[e.CRUD.findOne]=function(a,b){var g={};g.method=b?e.REQ_TYPE_GET:c.getHTTPMethod(e.REQ_TYPE_GET),b||(g.headers=c.getHeader()),g.recognizeDates=d.isNullUndef(a.head.parseDates)?e.DEFAULT_PARSE_DATE:a.head.parseDates;var h=c.concatenateStrings("?",[f.addQueryParams(a.head.queryParams),f.fieldsToString(a.data.fields,"select"),f.expandFor(a.data.expandFor)],"&");return g.requestUri=a.head.baseURL({id:a.data.id,tail:h}),g.requestUri=b?g.requestUri:c.getRequestURL(g.requestUri,a.head.isWebApi),g},r[e.CRUD.find]=function(a,b){var g={};g.method=b?e.REQ_TYPE_GET:c.getHTTPMethod(e.REQ_TYPE_GET),b||(g.headers=c.getHeader()),g.recognizeDates=d.isNullUndef(a.head.parseDates)?e.DEFAULT_PARSE_DATE:a.head.parseDates;var h=f.getTail(a);if(a.data.next){var i=f.addQueryParams(a.head.queryParams);g.requestUri=a.data.next,g.requestUri=i.length>0?g.requestUri+"&"+i:g.requestUri}else g.requestUri=a.head.baseURL({tail:h}),g.requestUri=b?g.requestUri:c.getRequestURL(g.requestUri,a.head.isWebApi);return g},r[e.CRUD.create]=function(a,b){var g={};return g.method=b?e.REQ_TYPE_POST:c.getHTTPMethod(e.REQ_TYPE_POST),g.recognizeDates=d.isNullUndef(a.head.parseDates)?e.DEFAULT_PARSE_DATE:a.head.parseDates,b?a.head.isMain&&(g.headers={"Content-ID":"1"}):g.headers=c.getHeader(e.REQ_TYPE_POST),g.requestUri=b?a.head.baseURL():c.getRequestURL(a.head.baseURL(),a.head.isWebApi),g.data=a.data.fieldsValues,d.isEmpty(a.head.queryParams)||(b?g.requestUri+=c.concatenateStrings("?",[f.addQueryParams(a.head.queryParams)],""):d.extend(g.data,a.head.queryParams)),b&&!d.isNullUndef(a.data.foreignKeyRef)&&(g.data[a.data.foreignKeyRef.navigationProperty]={__metadata:{uri:"$1"}}),g},r[e.CRUD.update]=function(a,b){var g={};if(g.method=b?e.REQ_TYPE_MERGE:c.getHTTPMethod(a.head.reqType||e.REQ_TYPE_MERGE),d.isUndefined(a.head.etags))b||(g.headers=c.getHeader(e.REQ_TYPE_MERGE));else{if(!d.isString(a.head.etags))throw"Etag should be string but is "+typeof a.head.etags+".";g.headers=b?{"if-match":a.head.etags}:c.getHeader(e.REQ_TYPE_MERGE,{"if-match":a.head.etags})}return g.requestUri=b?a.head.baseURL({id:a.data.id}):c.getRequestURL(a.head.baseURL({id:a.data.id}),a.head.isWebApi),g.data=a.data.fieldsValues,d.isEmpty(a.head.queryParams)||(b?g.requestUri+=c.concatenateStrings("?",[f.addQueryParams(a.head.queryParams)],""):d.extend(g.data,a.head.queryParams)),g},r[e.CRUD.remove]=function(a,b){var g={};if(g.method=b?e.REQ_TYPE_DELETE:c.getHTTPMethod(e.REQ_TYPE_DELETE),d.isUndefined(a.head.etags))b||(g.headers=c.getHeader(e.REQ_TYPE_DELETE));else{if(!d.isString(a.head.etags))throw"Etag should be string but is "+typeof a.head.etags+".";g.headers=b?{"if-match":a.head.etags}:c.getHeader(e.REQ_TYPE_DELETE,{"if-match":a.head.etags})}return g.requestUri=(b?a.head.baseURL({id:a.data.id}):c.getRequestURL(a.head.baseURL({id:a.data.id}),a.head.isWebApi))+c.concatenateStrings("?",[f.addQueryParams(a.head.queryParams)],""),g};var s=function(a){var b,c,d=!1;for(b=0;b<a.__batchResponses.length;b++){var e=a.__batchResponses[b];if(e.__changeResponses)for(c=0;c<e.__changeResponses.length;c++){var f=e.__changeResponses[c];f.message&&(d=!0)}else if(e.message)return d=!0}return d},t=function(a){var b;if(a.__batchResponses&&a.__batchResponses.length){if(a.__batchResponses&&a.__batchResponses.length&&!a.__batchResponses[0].__changeResponses)return b=[],d.each(a.__batchResponses,function(a,e){var f;f=a.data&&a.data.results?a.data.results:d.isString(a.data)?isNaN(parseInt(a.data))?a.data:parseInt(a.data):a.data,b.push({result:f,next:a.data?a.data.__next:void 0,additionalData:c.getResponseAdditionalData(a.message?a.response:a),responseIndex:e,error:a.message})}),b;var e=a.__batchResponses[0];b={},b.data=d.pluck(e.__changeResponses,"data");var f=e.__changeResponses?e.__changeResponses:a.__batchResponses;return b.responseAdditionalData=d.map(f,function(a){var b;return b=d.isUndefined(a.response)?c.getResponseAdditionalData(a):c.getResponseAdditionalData(a.response)}),b.error=d.unique(d.map(e.__changeResponses,function(a){var b=a.message,c=a.response&&a.response.body?a.response.body:"[]";return a.message?"Message: "+b+"; Details: "+c+";":""})).join(". "),b}};return q.run=function(a){if(!a||!d.isObject(a))throw"oDataTransport: run: request is not an object";if(!a.sub&&!d.isArray(a.sub)&&a.sub.length<1&&d.every(a.sub,function(a){return a.head&&a.data}))throw"odata.js: Invalid request, object doesn't have required properties.";a.sub.length>e.SETTINGS.AppSettings.MaxChangesetCount&&g.throwError("API_ERR_TRANSPORT_1",[e.SETTINGS.AppSettings.MaxChangesetCount]),1===a.sub.length?a.sub[0].head.isCustomHead?p(a):n(a):o(a)},q.init()}),d("ajaxTransport",["underscorenc","transportInterface","helpers","config","oDataService"],function(a,b,c,d,e){var f={init:function(){return a.extend({},b,this)}};return f.read=function(a,b,f){var g;if(!a)throw new Error("Ajax.read: request object must be defined");if(a.headers?g=a.headers:(g=c.getHeader(c.getHTTPMethod(a.type||d.REQ_TYPE_POST)),g["Content-Type"]="application/json"),!a.url)throw new Error("Ajax.read: request.url is required");var h;h="application/json"===g["Content-Type"]?JSON.stringify(a.data):a.data,e.defaultHttpClient.request({method:c.getHTTPMethod(a.type||d.REQ_TYPE_POST),requestUri:a.url,body:h,headers:g},function(a,d,e){var f,g=/(application\/json)/i;b?a?(f=c.getAjaxResponseAdditionalData(a),g.test(a.headers["Content-Type"])?b(JSON.parse(a.body),f):b(a.body,f)):c.consoleLog("No data received!"):c.consoleLog("success")},function(a,b){if(f){var d=c.getAjaxResponseAdditionalData(a.response);f(a.message,d)}else c.consoleLog("testStatus: "+b+". error: "+a.message)})},f.find=function(a){var b=c.getRequestURL(a.baseURL({}),"");a.operation===d.CRUD.custom?f.read(b,a.fieldsValues,d.REQ_TYPE_GET,a.successHandler,a.errorHandler):f.read(a.baseURL,a.fieldsValues,d.REQ_TYPE_POST,a.successHandler,a.errorHandler)},f.run=function(b){if(!b||!a.isObject(b))throw"ajax: run: request is not an object";if(!b.operation||!b.baseURL)throw"ajax: run: specify baseUrl and operation";if(a.isUndefined(d.CRUD[b.operation]))throw"ajax: run: undefined operation "+d.CRUD[b.operation];b.customOperation?f[b.customOperation.base](b):f[b.operation](b)},f.custom=function(a){f[a.customOperation.base](a)},f.init()}),d("transportManager",["underscorenc","oDataTransport","ajaxTransport","config"],function(a,b,c,d){var e={},f=!1,g={activeTransport:null,init:function(){return f?this:(e[d.TRANSPORT_NAMES.AJAX]=c,e[d.TRANSPORT_NAMES.ODATA]=b,f=!0,this)},use:function(b){if(!e[b])throw"transportManager - trying to use bad transport "+b;return a.isEqual(this.activeTransport,e[b])?this.activeTransport:(this.activeTransport=e[b],this.activeTransport.name=b,this.activeTransport)}};return g.init()}),d("requestManager",["underscorenc","config"],function(a,b){function c(){u={successHandler:null,errorHandler:null,sub:[]}}function d(c){return!a.contains(a.values(b.CRUD))}function e(a){if(!d(a))throw"RequestManager: Invalid Operation: "+a+"."}function f(a,b,c){e(b);var d=[];return!c&&v[t.GLOBALS][a]&&d.push(t.GLOBALS),v[t.HEAD][a]&&d.push(t.HEAD),v[t.DATA][b][a]&&d.push(t.DATA),d}function g(a,b){return f(a,b).length>0}function h(a,b){if(!g(a,b))throw"RequestManager: Operation "+b+" doesn't support property "+a+"."}function i(a,b){var c,d=f(a,b);return d.length>0&&(c=d[0]===t.DATA?v[t.DATA][b][a]:v[d[0]][a]),c}function j(b,c){var d=v.globals[b];if(!d)throw"ReqMan.setGlobalProperty: operation "+n(idx,s.OPERATION)+" doesn't support "+b+".";if(!d.type(c))throw"ReqMan.setGlobalProperty: value "+c+" for key "+b+" doesn't meet type requirements.";if(d.defIn){var e;if((a.isString(c)||a.isNumber(c))&&(e=[c]),a.isObject(c)&&(e=a.keys(c)),!a.every(e,function(b){return a.contains(d.defIn,b)}))throw"ReqMan.setGlobalProperty: value "+e+" for key "+b+" aren't any of the allowed values: "+d.defIn+"."}c=a.isObjectNotArray(u[b])?a.defaults(u[b],c):c,c=a.isArray(u[b])?a.union(u[b],c):c,u[b]=c}function k(a,b,c){for(var d=l(a),e=0,f=d.length;e<f;e++)p(d[e],b,c)}function l(b){for(var c=[],d=0,e=u.sub.length;d<e;d++)(a.isNull(b)||m(b,d))&&c.push(d);return c}function m(b,c){return a.every(b,function(b,d){var e=n(c,d);if(!a.isNullUndef(e)){var f=!0;if(a.isString(e)){if(!a.isString(b)&&!a.isArrayOfStrings(b))throw"ReqMan.isSubMatchingFilter: Type mismatch between value in surequest and value in the filter for key: "+d+".";var g=a.isString(b)?[b]:b;f&=a.contains(g,e)}else if(a.isBoolean(e)){if(!a.isBoolean(b))throw"ReqMan.isSubMatchingFilter: Type mismatch between value in surequest and value in the filter for key: "+d+".";f&=e===b}else{if(!a.isObject(e))throw"ReqMan.isSubMatchingFilter: Only properties that are strings or booleans are currently supported.";if(!a.isArray(b)&&!a.isObject(b))throw"ReqMan.isSubMatchingFilter: Type mismatch between value in surequest and value in the filter for key: "+d+".";a.isArray(b)?f&=a.every(b,function(c){return!a.isUndefined(e[b])}):a.isObject(b)&&(f&=a.isEqual(b,e))}return f}return!1})}function n(a,b){if(!u.sub[a])throw"ReqMan.getSubProperty: there is no subrequest with index "+a+".";return u.sub[a][t.HEAD][b]||u.sub[a][t.DATA][b]}function o(b){if(!a.contains(a.keys(v[t.GLOBALS]),b))throw"ReqMan.getGlobalProperty: unsupported property "+b+".";return u[b]}function p(b,c,d){if(!u.sub[b])throw"ReqMan.setSubProperty: there is no subrequest with index "+b+".";var e=n(b,s.OPERATION);if(e||c!==s.OPERATION||(e=d),!e)throw"ReqMan.setSubProperty: subrequest with index "+b+" doesn't have operation set.";h(c,e);var g=f(c,e,!0)[0],j=i(c,e),k=n(b,c,d);if(j.createOnly&&!a.isUndefined(k))throw"ReqMan.setSubProperty: key "+c+" can't be set again for "+s.OPERATION+".";if(!j.type(d))throw"ReqMan.setSubProperty: value "+d+" for key "+c+" doesn't meet type requirements.";if(j.defIn){var l;if((a.isString(d)||a.isNumber(d))&&(l=[d]),a.isObjectNotArray(d)&&(l=a.keys(d)),!a.every(l,function(b){return a.contains(j.defIn,b)}))throw"ReqMan.setSubProperty: value "+l+" for key "+c+" aren't any of the allowed values: "+j.defIn+"."}if(a.isObjectNotArray(k)&&!a.isObjectNotArray(d))throw"ReqMan.setSubProperty: if property "+c+" is object then the value should also be object but is: "+typeof d+".";d=a.isObjectNotArray(k)?a.defaults(k,d):d,a.isArray(k)&&!a.isArray(d)&&(d=[d]),d=a.isArray(k)?a.union(k,d):d,u.sub[b][g][c]=d}function q(){return a.getFirstIndex(u.sub,function(a){return a.head.isMain})}function r(){return u.sub.filter(function(a){return a.head.isMain}).length}var s={SUCCESS_HANDLER:"successHandler",ERROR_HANDLER:"errorHandler",TEST:"test",OPERATION:"operation",CUSTOM_OPERATION:"customOperation",REQ_TYPE:"reqType",ENTITY:"entity",IS_MAIN:"isMain",BASE_URL:"baseURL",IS_WEBAPI:"isWebApi",IS_CUSTOM_HEAD:"isCustomHead",CONFLICTING_METHOD:"conflictingMethod",QUERY_PARAMS:"queryParams",ETAGS:"etags",PARSE_DATES:"parseDates",ID:"id",FIELDS:"fields",FIELDS_VALUES:"fieldsValues",FILTERS:"filters",COUNT:"count",INLINE_COUNT:"inlineCount",LIMIT_FROM:"limitFrom",LIMIT_COUNT:"limitCount",ORDER_BY:"orderBy",ORDER_DESC:"orderDesc",CUSTOM_FILTER_STRING:"customFilterString",NEXT:"next",FOREIGN_KEY_REF:"foreignKeyRef",EXPANDED_FOR:"expandedFor",EXPAND_FOR:"expandFor",BASE_64_IMAGE:"base64Image"},t={GLOBALS:"globals",HEAD:"head",DATA:"data"},u={successHandler:null,errorHandler:null,sub:[]},v={};v[t.GLOBALS]={successHandler:{createOnly:!0,required:!0,type:a.isFunction},errorHandler:{createOnly:!0,required:!0,type:a.isFunction},queryParams:{type:a.isObjectNotArray,defIn:a.values(b.QUERY_PARAMS)},test:{type:a.isFunction}},v[t.HEAD]={operation:{createOnly:!0,required:!0,type:a.isString,defIn:a.values(b.CRUD)},customOperation:{type:a.isString},entity:{required:!0,type:a.isString,defIn:a.union(a.map(b.COLLECTIONS,function(a){return a.nameUppercase}),["custom"])},isMain:{required:!0,type:a.isBoolean},baseURL:{required:!0,type:a.isFunction},isWebApi:{type:a.isBoolean},isCustomHead:{type:a.isBoolean},conflictingMethod:{type:a.isString},reqType:{type:a.isString},queryParams:{type:a.isObjectNotArray,defIn:a.values(b.QUERY_PARAMS)},etags:{type:a.isString},parseDates:{type:a.isBoolean}},v[t.DATA]={},v[t.DATA][b.CRUD.find]={fields:{type:a.isArrayOfStrings},filters:{type:a.isObjectNotArray},count:{type:a.isBoolean},inlineCount:{type:a.isBoolean},limitFrom:{type:a.isNumber},limitCount:{type:a.isNumber},orderBy:{type:a.isArrayOfStrings},orderDesc:{type:a.isBoolean},customFilterString:{type:a.isString},customFunctionString:{type:a.isString},next:{type:a.isString},expandedForFilters:{type:a.isObject},expandedForFields:{type:a.isArrayOfStrings},expandedFor:{type:a.isArrayOfStrings},expandFor:{type:a.isArrayOfStrings}},v[t.DATA][b.CRUD.findOne]={id:{required:!0,type:a.isNumber},fields:{type:a.isArrayOfStrings},customFilterString:{type:a.isString},customFunctionString:{type:a.isString},expandedForFilters:{type:a.isObject},expandedForFields:{type:a.isArrayOfStrings},expandedFor:{type:a.isArrayOfStrings},expandFor:{type:a.isArrayOfStrings}},v[t.DATA][b.CRUD.remove]={id:{required:!0,type:a.isNumber}},v[t.DATA][b.CRUD.create]={fieldsValues:{required:!0,type:a.isObjectNotArray},foreignKeyRef:{type:a.isObjectNotArray},base64Image:{type:a.isString}},v[t.DATA][b.CRUD.update]={id:{required:!0,type:a.isNumber},fieldsValues:{required:!0,type:a.isObjectNotArray},base64Image:{type:a.isString}};var w={PROPS:s,exportRequest:function(b){var c=a.deepClone(u);if(b&&a.isArray(b)&&c.sub.length>=b.length){if(0===b.length)throw"passed orderArray param is empty, orderArray must have items in order to reorder the subrequests";c.sub=a.reorderArray(b,c.sub)}return c},_reset:function(){c()},getLen:function(){return u.sub.length},getLastIdx:function(){var a=this.getLen()-1;return a<0?null:a},createSub:function(a,b,c){var d=u.sub.push({head:{},data:{}});return d--,p(d,s.OPERATION,a),p(d,s.IS_MAIN,b),p(d,s.ENTITY,c),d},setProp:function(b,c,d){a.isNumber(b)?p(b,c,d):(d=c,c=b,j(c,d))},getProp:function(b,c){return a.isNumber(b)?n(b,c):o(b)},updateSubs:function(b,c,d){a.isUndefined(d)?k(null,b,c):k(b,c,d)},getSubIndexesMatchingFilter:function(a){return l(a)},isFind:function(a){var c=n(a,s.OPERATION);return c===b.CRUD.find},isFindOne:function(a){var c=n(a,s.OPERATION);return c===b.CRUD.findOne},isFindFamily:function(a){var c=n(a,s.OPERATION);return c===b.CRUD.find||c===b.CRUD.findOne},isUpdate:function(a){return n(a,s.OPERATION)===b.CRUD.update},isCreate:function(a){return n(a,s.OPERATION)===b.CRUD.create},isDelete:function(a){return n(a,s.OPERATION)===b.CRUD.remove},areSubsOfTypes:function(c,d){if(c=a.isString(c)?[c]:c,!a.every(c,function(c){return a.contains(a.values(b.CRUD),c)}))throw"ReqMan.areSubsOfType: One of the types "+c+" are not included in config.CRUD definition.";return a.isNullUndef(d)?a.reduce(a.range(this.getLen()),function(b,d){return b&&a.contains(c,n(d,s.OPERATION))},!0):a.contains(c,n(d,s.OPERATION))},isMainSet:function(){return q()},getCountOfMainRequests:function(){return r()}};return w}),d("queryApiValidators",["underscorenc","config","errorManager","helpers","requestManager"],function(a,b,c,d,e){var f={};f.validateRequest=function(c){b.SUPPRESS_VALIDATION||c&&c.sub&&c.sub.length>0&&a.each(c.sub,function(a){a.head&&a.head.operation&&(a.head.operation===b.CRUD.create?f.validateCreate(a):a.head.operation===b.CRUD.update&&f.validateUpdate(a))})};var g=function(e,f,g){g.data.foreignKeyRef&&(f=a.reject(f,function(a){return a===g.data.foreignKeyRef.field}));var h=a.intersection(f,e);g.head.operation===b.CRUD.update&&g.head.isMain===!1&&(h=a.without(h,b.SETTINGS.Metadata[d.tempAndUglyGetEntityName(g.head.entity)].keyField)),h&&h.length>0&&c.throwError("API_ERR_QUERY_API_11",[g.head.entity,h,g.head.operation])},h=function(b,d,e){var f=a.intersection(d,b);f&&f.length>0&&c.throwError("API_ERR_QUERY_API_11",[e.head.entity,f,e.head.operation])};return f.validateCreate=function(d){var e;if(b.SETTINGS.ReadOnlyFields&&b.SETTINGS.ReadOnlyFields[d.head.entity]){e=b.SETTINGS.ReadOnlyFields[d.head.entity];var f=a.keys(d.data.fieldsValues);g(f,e,d)}this.checkInputData(d),this.checkAnnotationTypeIds(d);var h=b.SETTINGS.RequiredFields[d.head.entity];if(d.data.foreignKeyRef&&(h=a.reject(h,function(a){return a===d.data.foreignKeyRef.field})),h){var i=a.difference(h,a.keys(d.data.fieldsValues));i.length>0&&c.throwError("API_ERR_QUERY_API_17",[i,d.head.entity])}},f.validateUpdate=function(d){if((a.isUndefined(d)||a.isUndefined(d.data)||(a.isUndefined(d.data.fieldsValues)||a.isEmpty(d.data.fieldsValues))&&d.head.customOperation!=b.CUSTOM_ENDPOINTS.UPDATE_IMAGE)&&c.throwError("API_ERR_QUERY_API_4",[d.head.entity,d.head.operation,"fieldsValues{Object} or forVisibility (with visibilityInclude, or visibilityExclude or both)"]),b.SETTINGS.ReadOnlyFields&&b.SETTINGS.ReadOnlyFields[d.head.entity]){var e=b.SETTINGS.ReadOnlyFields[d.head.entity],f=b.SETTINGS.FieldsSettableOnCreationOnly[d.head.entity],i=a.keys(d.data.fieldsValues);g(i,e,d),h(i,f,d)}this.checkInputData(d)},f.checkInputData=function(b){var e={"function":a.isFunction,number:a.isNumber,array:a.isArray,object:a.isObject,string:a.isString,"boolean":a.isBoolean,undefined:a.isUndefined,"null":a.isNull},f=d.getMetadataByEntityName(b.head.entity).fields;a.isUndefined(b)&&c.throwError("API_ERR_QUERY_API_3",[b.head.entity,"",b.head.operation,"object","undefined"]),b.data.foreignKeyRef&&(f=a.reject(f,function(a){return a.name===b.data.foreignKeyRef.field})),f&&b.data.fieldsValues&&a.each(f,function(f){a.each(b.data.fieldsValues,function(g,h){a.isUndefined(g)&&c.throwError("API_ERR_QUERY_API_3",[b.head.entity,h,b.head.operation,"of proper type","undefined"]),h===f.name&&("false"===f.nullable&&a.isNull(g)&&c.throwError("API_ERR_QUERY_API_3",[b.head.entity,f.name,b.head.operation,f.type,"null"]),a.isNull(g)||e[f.type.toLowerCase()](g)||c.throwError("API_ERR_QUERY_API_3",[b.head.entity,f.name,b.head.operation,f.type,d.toType(g)]),f.maxLength&&!a.isNull(g)&&g.length>f.maxLength&&c.throwError("API_ERR_QUERY_API_12",[f.name,g.length,f.maxLength]))})})},f.checkAnnotationTypeIds=function(d){var e;a.isUndefined(d.head)||a.isUndefined(d.head.entity)||d.head.entity!==b.COLLECTIONS.annotations.nameUppercase||(e=a.pluck(b.SETTINGS.AnnotationTypes,"id"),(a.isUndefined(d.data.fieldsValues.type_id)||a.isNull(d.data.fieldsValues.type_id))&&0!==d.data.fieldsValues.type_id||a.contains(e,d.data.fieldsValues.type_id)||c.throwError("API_ERR_QUERY_API_3",[d.head.entity,"type_id",d.head.operation,e,d.data.fieldsValues.type_id]))},f.doEtagCheck=function(d){!a.isNull(d)&&(d.length>b.SETTINGS.AppSettings.ETagMaxLengthInChars||0===d.length)&&c.throwError("API_ERR_QUERY_API_19",[d,d.length,b.SETTINGS.AppSettings.ETagMaxLengthInChars])},f.doInitCheck=function(){b.API_INITIALIZED||b.SUPPRESS_VALIDATION||c.throwError("API_ERR_QUERY_API_13",null)},f.validateFieldsNames=function(d,e,f){if(!b.SUPPRESS_VALIDATION&&"Any"!==f){var g=a.difference(d,e);g.length&&c.throwError("API_ERR_QUERY_API_9",[g])}},f.validateMutuallyExclusiveMethods=function(d,f,g){var h,i;for(h=e.getLastIdx(),i=0;i<=h;i++)a.indexOf(b.CONFLICTED_METHODS[g][f].methods,e.getProp(i,e.PROPS.CONFLICTING_METHOD))>-1&&c.throwError("API_ERR_QUERY_API_20",[d,f,b.CONFLICTED_METHODS[g][f].methods])},f.validateLimitParam=function(b,e,f,g){(a.isObject(b)||a.isBoolean(b)||isNaN(b)||b%1!==0)&&c.throwError("API_ERR_QUERY_API_3",[f,"",e,"number, null or undefined",d.toType(b)],g)},f.validateBatchGetItemsNumber=function(b,d){var f=a.isArray(b)?b.length:1;f!==e.getLen()&&c.throwError("API_ERR_QUERY_API_21",[d])},f.validateOrderFieldValues=function(b,e){a.isString(b)||a.isArrayOfStrings(b)||c.throwError("API_ERR_QUERY_API_3",[e,"","order","string or array of strings representing fields names",d.toType(b)])},f}),d("queryAPI",["underscorenc","config","helpers","filtersParser","errorManager","queryApiValidators","requestManager","resetManager"],function(a,b,c,d,e,f,g,h){var i,j,k,l,m={entityName:"queryAPI",_defaultTransport:void 0,_transports:{},_additionalActions:{},_filtersObj:{},_urls:{},acceptableFields:[],keyField:void 0,desiredOrder:{},init:function(){return this},_isMainRequestCreated:function(){return null!==g.isMainSet()},_validateMainRequestCreated:function(a){this._isMainRequestCreated()||e.throwError("API_ERR_QUERY_API_15",[a])},_validateRequestCreated:function(a){g.getLen()>0||e.throwError("API_ERR_QUERY_API_15",[a])},_validateNoRequestsCreated:function(a){0!==g.getLen()&&e.throwError("API_ERR_QUERY_API_8",[a])},_validateFindFamily:function(b,c){a.isNumber(c)||(c=g.getLastIdx()),g.isFindFamily(c)||e.throwError("API_ERR_QUERY_API_5",[this.entityName,b,"find"])},_validateFindOne:function(a){g.isFindOne(g.getLastIdx())||e.throwError("API_ERR_QUERY_API_5",[a,"findOne"])},_validateFind:function(a){g.isFind(g.getLastIdx())||e.throwError("API_ERR_QUERY_API_5",[this.entityName,a,"find"])},_getTransport:function(){var a=g.getProp(g.getLastIdx(),g.PROPS.OPERATION),b=this._transports[a]||this._defaultTransport;if(!b)throw'run: transport for operation "'+a+'" is not set!';return b},_getBaseURL:function(a){var b=this._urls[a].service||void 0;if(!b)throw'baseURL for operation "{0}" is not set!';return b},_isComplexFilters:function(a){var b=this._getTransport().getFiltersParser();return b.isComplex(a)},_setComplexFilters:function(a,b){var c=this._getTransport().getFiltersParser();this._mapFilters(a),f.validateFieldsNames(c.getFields(a),this.acceptableFields,this.entityName);var d=c.createFilterString(a);return this._customFilterString(d,b),this},_mapFields:function(a){return a},_mapFilters:function(a){return a},done:function(b){return j=b,this._validateRequestCreated("done"),a.isUndefined(b)||a.isNull(b)?this:(a.isFunction(b)||e.throwError("API_ERR_QUERY_API_10",["done","successHandler"]),this)},fail:function(b){return k=b,this._validateRequestCreated("fail"),a.isUndefined(b)||a.isNull(b)?this:(a.isFunction(b)||e.throwError("API_ERR_QUERY_API_10",["fail","errorHandler"]),this)},parseDates:function(a){return f.doInitCheck(),c.isFunSwitchEnabled(arguments)&&g.updateSubs(g.PROPS.PARSE_DATES,!0),this},outputFields:function(d){var h=this,i="outputFields";f.doInitCheck(),this._validateMainRequestCreated();var j=function(i,j){h._validateFindFamily("outputFields",j),i&&(a.isArray(i)||e.throwError("API_ERR_QUERY_API_3",[h.entityName,"outputFields","provided","array",c.toType(i)],j),f.validateFieldsNames(i,h.acceptableFields,h.entityName),a.isNumber(j)?g.setProp(j,g.PROPS.FIELDS,i):g.updateSubs({operation:[b.CRUD.find,b.CRUD.findOne]},g.PROPS.FIELDS,d))};return a.isArrayOf(d,a.isArray,a.isNull)?(f.validateBatchGetItemsNumber(d,i),a.each(d,function(a,b){j(a,b)})):j(d),this},fields:function(a){return this.outputFields(a)},_validateFieldsValues:function(b){return a.isUndefined(b)||(this._mapFields(b),f.validateFieldsNames(a.keys(b),this.acceptableFields,this.entityName)),this},commonFields:function(c){if(f.doInitCheck(),this._validateRequestCreated("commonFields"),!g.isCreate(g.getLastIdx())&&!g.isUpdate(g.getLastIdx()))throw"commonFields is only supported for Create and Update operations.";return this._mapFields(c),f.validateFieldsNames(a.keys(c),this.acceptableFields,this.entityName),g.updateSubs({operation:[b.CRUD.update,b.CRUD.create]},g.PROPS.FIELDS_VALUES,c),this},_processFilters:function(c){var d=this;return a.isArray(c)?(a.each(c,function(c,e){d._isComplexFilters(c)?d._setComplexFilters(c,e):(d._mapFilters(c),a.isEmpty(c)||f.validateFieldsNames(a.keys(c),d.acceptableFields,d.entityName),a.isString(c)?(b.NEXT_LINK_DOMAIN_STRIPPING&&(c=c.replace(/^.*\/\/[^\/]+/,"")),g.setProp(e,g.PROPS.NEXT,c)):a.isEmpty(c)||g.setProp(e,g.PROPS.FILTERS,c))}),this):this._isComplexFilters(c)?this._setComplexFilters(c):(this._mapFilters(c),a.isEmpty(c)||(f.validateFieldsNames(a.keys(c),this.acceptableFields,this.entityName),g.setProp(g.getLastIdx(),g.PROPS.FILTERS,c)),this)},count:function(a){return f.doInitCheck(),this._validateMainRequestCreated(),this._validateFind("count"),this._request.count=a,g.updateSubs({operation:[b.CRUD.find,b.CRUD.findOne]},g.PROPS.COUNT,c.isFunSwitchEnabled(arguments)),this},inlineCount:function(a){return f.doInitCheck(),this._validateMainRequestCreated("inlineCount"),this._validateFind("inlineCount"),g.updateSubs({operation:[b.CRUD.find,b.CRUD.findOne]},g.PROPS.INLINE_COUNT,c.isFunSwitchEnabled(arguments)),this},limit:function(b,c){if(arguments&&arguments[0]&&a.isArray(arguments[0]))a.each(arguments[0],function(a,b){g.setProp(b,g.PROPS.LIMIT_FROM,a[0]),g.setProp(b,g.PROPS.LIMIT_COUNT,a[1])});else{if(a.isArray(b)&&a.isArray(b)&&b.length!==c.length&&e.throwError("API_ERR_QUERY_API_18",["offset","amount"]),
!b&&!c)return this;this.limitFrom(b),this.limitCount(c)}return f.doInitCheck(),this._validateMainRequestCreated("limit"),this._validateFind("limit"),this},limitFrom:function(c){var d="limitFrom",e=this;return f.doInitCheck(),this._validateMainRequestCreated(d),this._validateFind(d),!c||a.isArray(c)&&0===c.length?this:(a.isArray(c)?(f.validateBatchGetItemsNumber(c,d),a.each(c,function(a,b){f.validateLimitParam(a,d,e.entityName,b),a=Number(a),g.setProp(b,g.PROPS.LIMIT_FROM,a)})):(f.validateLimitParam(c,d,this.entityName),c=Number(c),g.getLen()>1?g.updateSubs({operation:[b.CRUD.find]},g.PROPS.LIMIT_FROM,c):g.setProp(g.getLastIdx(),g.PROPS.LIMIT_FROM,c)),this)},limitCount:function(c){var d="limitCount",e=this;return f.doInitCheck(),this._validateMainRequestCreated("limitCount"),this._validateFind("limitCount"),!c||a.isArray(c)&&0===c.length?this:(a.isArray(c)?(f.validateBatchGetItemsNumber(c,d),a.each(c,function(a,b){f.validateLimitParam(a,d,e.entityName,b),a=Number(a),g.setProp(b,g.PROPS.LIMIT_COUNT,a)})):(f.validateLimitParam(c,d,this.entityName),c=Number(c),g.getLen()>1?g.updateSubs({operation:[b.CRUD.find]},g.PROPS.LIMIT_COUNT,c):g.setProp(g.getLastIdx(),g.PROPS.LIMIT_COUNT,c)),this)},order:function(c,d){var e=function(b){return a.isString(b)?[b]:b},h=function(b){var c=!1;return a.isString(b)&&(c="desc"===b.toLowerCase()),a.isNumber(b)&&(c=b<0),c},i=this,j="order";return f.doInitCheck(),this._validateMainRequestCreated("order"),this._validateFind("order"),a.isNullUndef(c)||a.isArray(c)&&0===c.length?this:(a.isArrayOf(c,a.isArray,a.isNull)?(f.validateBatchGetItemsNumber(c,j),a.each(c,function(b,c){a.each(b,function(a){f.validateOrderFieldValues(a,i.entityName),g.setProp(c,g.PROPS.ORDER_BY,e(a))})})):(f.validateOrderFieldValues(c,this.entityName),g.getLen()>1?g.updateSubs({operation:[b.CRUD.find]},g.PROPS.ORDER_BY,e(c)):g.setProp(g.getLastIdx(),g.PROPS.ORDER_BY,e(c))),a.isArrayOf(d,a.isString,a.isNumber)?(f.validateBatchGetItemsNumber(d,j),a.each(d,function(a,b){a=h(a),g.setProp(b,g.PROPS.ORDER_DESC,a)})):(d=h(d),g.getLen()>1?g.updateSubs({operation:[b.CRUD.find]},g.PROPS.ORDER_DESC,d):g.setProp(g.getLastIdx(),g.PROPS.ORDER_DESC,d)),this)},_customFilterString:function(b,c){return f.doInitCheck(),this._validateMainRequestCreated("run"),a.isString(b)?(c=c||g.getLastIdx(),g.setProp(c,g.PROPS.CUSTOM_FILTER_STRING,b),this):this},next:function(c){var d=this;f.doInitCheck(),this._validateMainRequestCreated("next"),this._validateFindFamily("next");var e=function(c,e){if(a.isString(c))if(b.NEXT_LINK_DOMAIN_STRIPPING&&(c=c.replace(/^.*\/\/[^\/]+/,"")),a.isNumber(e)){var f=g.getLastIdx();f<e&&(g.createSub(b.CRUD.find,!0,d.entityName),g.setProp(e,g.PROPS.BASE_URL,d._getBaseURL(b.CRUD.find))),g.setProp(e,g.PROPS.NEXT,c)}else g.setProp(g.getLastIdx(),g.PROPS.NEXT,c)};return a.isArray(c)?a.each(c,function(a,b){e(a,b)}):e(c),this},run:function(){var c=this,d=function(b){if(a.isUndefined(g.getProp(b,g.PROPS.NEXT)))c._additionalActions.find&&c._additionalActions.find(c._filtersObj),c._processFilters(c._filtersObj);else{g.getProp(b,g.PROPS.NEXT);i&&c.forUser(i)}};f.doInitCheck(),this._validateRequestCreated("run");var e=g.getLen(),m=(g.getProp(g.getLastIdx(),g.PROPS.OPERATION),this._getTransport()),n=g.getLastIdx();if(e>1){var o=g.getSubIndexesMatchingFilter({operation:[b.CRUD.find]});a.each(o,function(a){d(a)})}else g.isFind(n)&&d(n);if(this.entityName===b.COLLECTIONS.annotations.nameUppercase&&g.isFindFamily(n)&&a.isUndefined(g.getProp(n,g.PROPS.CUSTOM_OPERATION))&&a.isUndefined(g.getProp(n,g.PROPS.NEXT))){var p={};p[b.QUERY_PARAMS.option]=b.ANNO2_WITH_NO_SHARED,g.updateSubs({operation:[b.CRUD.find,b.CRUD.findOne]},g.PROPS.QUERY_PARAMS,p)}a.isUndefined(g.getProp(n,g.PROPS.FIELDS))||a.isUndefined(g.getProp(n,g.PROPS.EXPAND_FOR))||g.setProp(n,g.PROPS.FIELDS,g.getProp(n,g.PROPS.EXPAND_FOR)),k&&g.setProp(g.PROPS.ERROR_HANDLER,k),j&&g.setProp(g.PROPS.SUCCESS_HANDLER,j),l&&g.setProp(g.PROPS.TEST,l),j=k=l=i=void 0,this._entityLevelCheck&&this._entityLevelCheck(),this._entityRunActions&&this._entityRunActions();var q=this.desiredOrder.orderArgs||null,r=g.exportRequest(q);f.validateRequest(r),h.resetLib(),m.run(r)},create:function(d){f.doInitCheck();var h=this;if(a.isNullUndef(d)&&e.throwError("API_ERR_QUERY_API_3",[this.entityName,"fieldValues","create","array or object","empty"]),a.isObject(d)||a.isArray(d)||e.throwError("API_ERR_QUERY_API_3",[this.entityName,"fieldValues","create","array or object",c.toType(d)]),a.isArray(d)&&0===d.length&&e.throwError("API_ERR_QUERY_API_3",[this.entityName,"fieldValues","create","array or object","empty array"]),!b.SUPPRESS_VALIDATION&&(a.isObject(d)&&d[this.keyField]||a.isArray(d)&&a.some(d,function(b){return a.has(b,h.keyField)}))&&e.throwError("API_ERR_QUERY_API_11",[this.entityName,this.keyField,"create"]),this._additionalActions[b.CRUD.create]&&this._additionalActions[b.CRUD.create](d),a.isArray(d))a.each(d,this._validateFieldsValues,this),a.each(d,function(a){var c=g.createSub(b.CRUD.create,!1,h.entityName);g.setProp(c,g.PROPS.FIELDS_VALUES,a),g.setProp(c,g.PROPS.BASE_URL,this._getBaseURL(b.CRUD.create))},this);else{this._validateFieldsValues(d),this._validateNoRequestsCreated("create");var i=g.createSub(b.CRUD.create,!0,this.entityName);g.setProp(i,g.PROPS.BASE_URL,this._getBaseURL(b.CRUD.create)),g.setProp(i,g.PROPS.FIELDS_VALUES,d)}return this},remove:function(d){f.doInitCheck();var h=this;if(a.isNumber(d)||a.isArray(d)&&d.length||e.throwError("API_ERR_QUERY_API_3",[this.entityName,"id","remove","number or array",c.toType(d)]),this._additionalActions[b.CRUD.remove]&&this._additionalActions[b.CRUD.remove](d),a.isArray(d))a.each(d,function(c){a.isNumber(c)||(c=c[h.keyField]);var d=g.createSub(b.CRUD.remove,!1,h.entityName);g.setProp(d,g.PROPS.ID,c),g.setProp(d,g.PROPS.BASE_URL,h._getBaseURL(b.CRUD.remove))});else{this._validateNoRequestsCreated("remove");var i=g.createSub(b.CRUD.remove,!0,this.entityName);g.setProp(i,g.PROPS.ID,d),g.setProp(i,g.PROPS.BASE_URL,this._getBaseURL(b.CRUD.remove))}return this},update:function(d,h){f.doInitCheck();var i=this;if((!a.isArray(d)&&!a.isNumber(d)||a.isArray(d)&&!a.every(d,function(b){return a.isNumber(b)||a.isObject(b)}))&&e.throwError("API_ERR_QUERY_API_3",[this.entityName,"","update","nubmer or array of ids",c.toType(d)]),!a.isNumber(d)||a.isObject(h)||a.isUndefined(h)||e.throwError("API_ERR_QUERY_API_3",[this.entityName,"","update","object",c.toType(h)]),this._additionalActions[b.CRUD.update]&&this._additionalActions[b.CRUD.update](d,h),a.isArray(d))a.each(d,function(c){var d=g.createSub(b.CRUD.update,!1,i.entityName);a.isNumber(c)?g.setProp(d,g.PROPS.ID,c):(f.validateFieldsNames(a.keys(c),i.acceptableFields,this.entityName),g.setProp(d,g.PROPS.ID,c[i.keyField]),delete c[i.keyField],g.setProp(d,g.PROPS.FIELDS_VALUES,c)),g.setProp(d,g.PROPS.BASE_URL,this._getBaseURL(b.CRUD.update))},this);else{h=h||{},this._validateFieldsValues(h),this._validateNoRequestsCreated("update");var j=g.createSub(b.CRUD.update,!0,this.entityName);g.setProp(j,g.PROPS.ID,d),g.setProp(j,g.PROPS.FIELDS_VALUES,h),g.setProp(j,g.PROPS.BASE_URL,this._getBaseURL(b.CRUD.update))}return this},find:function(c){f.doInitCheck(),this._validateNoRequestsCreated("find");var d=this;if(a.isArray(c))a.each(c,function(c){var e=g.createSub(b.CRUD.find,!0,d.entityName);a.isString(c)?(b.NEXT_LINK_DOMAIN_STRIPPING&&(c=c.replace(/^.*\/\/[^\/]+/,"")),g.setProp(e,g.PROPS.NEXT,c)):g.setProp(e,g.PROPS.BASE_URL,d._getBaseURL(b.CRUD.find))});else{var e=g.createSub(b.CRUD.find,!0,this.entityName);if(g.setProp(e,g.PROPS.BASE_URL,this._getBaseURL(b.CRUD.find)),a.isString(c))return this.next(c)}return this._filtersObj={},this.filters(c),this},filters:function(b){var d=this;if(f.doInitCheck(),b=b||{},a.isArray(d._filtersObj))a.isArray(b)?a.each(b,function(b,f){a.isObjectNotArray(b)||e.throwError("API_ERR_QUERY_API_3",[d.entityName,"","find","object",c.toType(b)],f),d._filtersObj.push(b)}):(a.isObjectNotArray(b)||e.throwError("API_ERR_QUERY_API_3",[d.entityName,"","find","object",c.toType(b)]),d._filtersObj.push(b));else if(a.isEmpty(d._filtersObj)){if(a.isArrayOf(b,a.isObjectNotArray)||a.isObjectNotArray(b)||e.throwError("API_ERR_QUERY_API_3",[d.entityName,"","find","object",c.toType(b)]),g.getCountOfMainRequests()>1)for(var h=0;h<g.getCountOfMainRequests();h++)a.isArray(b)?a.each(b,function(a,b){g.setProp(b,g.PROPS.FILTERS,a)}):g.setProp(h,g.PROPS.FILTERS,b);d._filtersObj=b}else a.extend(d._filtersObj,b);return this},filter:function(a){return this.filters(a),this},findOne:function(d){f.doInitCheck(),this._validateNoRequestsCreated("findOne");var h=g.createSub(b.CRUD.findOne,!0,this.entityName);return a.isNumber(d)||e.throwError("API_ERR_QUERY_API_3",[this.entityName,"id","findOne","number",c.toType(d)]),this._additionalActions.findOne&&this._additionalActions.findOne(d),g.setProp(h,g.PROPS.ID,d),g.setProp(h,g.PROPS.BASE_URL,this._getBaseURL(b.CRUD.findOne)),this},etags:function(d){if(f.doInitCheck(),g.areSubsOfTypes([b.CRUD.update,b.CRUD.remove])||e.throwError("API_ERR_QUERY_API_5",[this.entityName,"etags()","find"]),(a.isArray(d)||a.isString(d)||a.isNull(d))&&(a.isString(d)&&a.isNull(d)||!a.isArray(d)||!a.some(d,function(b){return!(a.isNull(b)||a.isString(b))}))||e.throwError("API_ERR_QUERY_API_3",[this.entityName,"etags","etags","string, null or an array",c.toType(d)]),a.isArray(d)&&d.length!==g.getLen()&&e.throwError("API_ERR_QUERY_API_18",["remove and update","etags"]),a.isArray(d))a.each(d,function(b,c){f.doEtagCheck(b,this),a.isNull(b)||g.setProp(c,g.PROPS.ETAGS,b)});else{if(a.isNull(d))return this;f.doEtagCheck(d,this),g.setProp(g.getLastIdx(),g.PROPS.ETAGS,d)}return this},forUser:function(d){f.doInitCheck();var h=this;if(_forUserLogic=function(f,j){a.isString(j)||a.isNull(d)||e.throwError("API_ERR_QUERY_API_3",[h.entityName,"userId","forUser","string or null",c.toType(j)]),g.areSubsOfTypes([b.CRUD.findOne,b.CRUD.find,b.CRUD.create,b.CRUD.update],f)||e.throwError("API_ERR_QUERY_API_5",[h.entityName,"forUser",["find","update","create"].join(", ")],f);var k={};k[b.QUERY_PARAMS.userId]=j,i=j,a.isNumber(f)?(g.isFindFamily(f)||g.isUpdate(f))&&g.setProp(f,g.PROPS.QUERY_PARAMS,k):g.updateSubs({operation:[b.CRUD.findOne,b.CRUD.find,b.CRUD.create,b.CRUD.update]},g.PROPS.QUERY_PARAMS,k)},a.isArray(d))f.validateBatchGetItemsNumber(d,"forUser"),a.each(d,function(b,c){a.isNull(b)||_forUserLogic(c,b)});else{if(a.isNull(d))return this;_forUserLogic(void 0,d)}return this},test:function(b){return this._validateRequestCreated("test"),a.isNullUndef(b)&&(b=function(a){c.consoleLog(a)}),l=b,this},_customOperation:function(c,d,e,h,i){var j=this;f.doInitCheck(),i||this._validateNoRequestsCreated(d);var k=function(){var a=g.createSub(e,!0,h||j.entityName);g.setProp(a,g.PROPS.BASE_URL,j._getBaseURL(d)),g.setProp(a,g.PROPS.CUSTOM_OPERATION,d)};return a.isArray(c)?a.each(c,function(a){k()}):k(),e===b.CRUD.find&&this.filter(c),g.getLastIdx()},shareTo:function(d){if(f.doInitCheck(),!c.isFunSwitchEnabled(arguments))return this;g.isCreate(g.getLastIdx())||e.throwError("API_ERR_QUERY_API_5",[this.entityName,"shareTo","create"]),g.getProp(g.getLastIdx(),g.PROPS.ENTITY)!==b.COLLECTIONS.annotations.nameUppercase&&e.throwError("API_ERR_QUERY_API_14",["shareTo",b.COLLECTIONS.annotations.nameUppercase]),a.isString(d)||a.isArrayOfStrings(d)||e.throwError("API_ERR_QUERY_API_3",[this.entityName,"userIds","shareTo","string or array of strings",c.toType(d)]),0!==g.getSubIndexesMatchingFilter({queryParams:[b.QUERY_PARAMS.userIds]}).length&&e.throwError("API_ERR_QUERY_API_16",["shareTo"]),a.isString(d)&&d.indexOf(";")!==-1&&(d=d.split(";")),a.isArrayOfStrings(d)&&(d=a.uniq(d),d=d.join(";"));var h={};return h[b.QUERY_PARAMS.userIds]=d,g.updateSubs({operation:b.CRUD.create,entity:b.COLLECTIONS.annotations.nameUppercase},g.PROPS.QUERY_PARAMS,h),this},forceOrder:function(b){if(!a.isUndefined(this.desiredOrder.forceSubReqToTheFirstPosition))throw"It is not allowed to force first position multiple times!";this.desiredOrder.forceSubReqToTheFirstPosition=b,this.desiredOrder.orderArgs=[],this.desiredOrder.orderArgs.push(b)}};return m._reset=function(){m._filtersObj={},m.desiredOrder={}},m.init()}),d("info",["config","helpers","underscorenc"],function(a,b,c){var d=[];d.push("keyField: name of ID field, unique. Forbidden for create operation, mandatory for [update, remove] operations"),d.push("fields: array of acceptable fields. [outputFields, fields, commonFields, filters] methods of entities check arguments to match these fields"),d.push("Allowed operations: ["+c.values(a.CRUD)+"]");var e={description:d},f={infoData:void 0,acceptableFields:[],keyField:void 0};return f.setInfo=function(a){if(this.infoData=c.extend({},e,a,this.entityInfo),this.infoData.fields){var b=25,d=c.getStringOfLen(b," "),f=c.getStringOfLen(b,"="),g="\n",h=[{name:"Field Name:",type:"Data Type:",maxLength:"Max Length:"}],i=[{name:f,type:f,maxLength:f}],j=c.union(h,i,this.infoData.fields);c.each(j,function(a){g+=a.name+d.substring(0,b-a.name.length)+" | "+a.type+d.substring(0,b-a.type.length)+" | "+(a.maxLength?a.maxLength:"")+"\n"}),this.infoData.getFieldsTable=function(){return g}}a.fields&&(this.acceptableFields=c.pluck(a.fields,["name"])),a.keyField&&(this.keyField=a.keyField)},f.info=function(){return this.infoData},f}),d("tags",["underscorenc","config","helpers","transportManager","client","queryAPI","info","errorManager","requestManager"],function(a,b,c,d,e,f,g,h,i){var j={remove:{service:c.templatify("tags(<%= id %>)")},create:{service:c.templatify("tags")},update:{service:c.templatify("tags(<%= id %>)")},find:{service:c.templatify("tags/<%= tail %>")},findOne:{service:c.templatify("tags(<%= id %>)<%= tail %>")},getDistinctTags:{service:c.templatify("Tag/DistinctTags<%= tail %>")}},k={entityName:"Tags",_defaultTransport:d.use(b.TRANSPORT_NAMES.ODATA),_transports:{},_request:{},_additionalActions:{},_urls:j,init:function(b){return a.defaults(this,f),a.extend(this,g),this},_getRequest:function(){return this._request},getInfo:function(){var c=this.info();return a.isUndefined(b.SETTINGS.FieldsSettableOnCreationOnly[this.entityName])||(c.FieldsSettableOnCreationOnly=b.SETTINGS.FieldsSettableOnCreationOnly[this.entityName]),a.isUndefined(b.SETTINGS.ReadOnlyFields[this.entityName])||(c.ReadOnlyFields=b.SETTINGS.ReadOnlyFields[this.entityName]),a.isUndefined(b.SETTINGS.RequiredFields[this.entityName])||(c.REQUIRED_FIELDS=b.SETTINGS.RequiredFields[this.entityName]),b.FORCE_DEFAULT_SERVICE_SETTINGS?c.SETTINGS_SOURCE="client_defaults":c.SETTINGS_SOURCE="service",c},tagNamesToValues:function(b){return a.isArray(b)?b=a.map(b,function(b){return a.isString(b)?{value:b}:b}):a.isString(b)&&(b={value:b}),b},getDistinctTags:function(a){a=a||{},a.client_id=a.client_id||e.getID();var c=this._customOperation({},b.CUSTOM_ENDPOINTS.DISTINCT_TAGS,b.CRUD.find,this.entityName);return i.setProp(c,i.PROPS.QUERY_PARAMS,a),i.setProp(c,i.PROPS.IS_WEBAPI,!0),this}};k._reset=function(){k._filtersObj={},k.desiredOrder={}};return k.init()}),d("annotations",["underscorenc","config","helpers","transportManager","client","queryAPI","info","tags","errorManager","requestManager","queryApiValidators"],function(a,b,c,d,e,f,g,h,i,j,k){var l={remove:{service:c.templatify("annotations(<%= id %>)")},create:{service:c.templatify("annotations")},update:{service:c.templatify("annotations(<%= id %>)")},find:{service:c.templatify("annotations2<%= tail %>")},findOne:{service:c.templatify("annotations2(<%= id %>)<%= tail %>")},findComments:{service:c.templatify("GetComments<%= tail %>")},findAllAnnotationsByText:{service:c.templatify("AllAnnotations<%= tail %>")},findCommentedAnnotations:{service:c.templatify("CommentedAnnotations<%= tail %>")},createImage:{service:c.templatify(b.ACTION_STORAGE_UPLOAD_URL)},findImage:{service:c.templatify(b.ACTION_DOWNLOAD_GET_URL+"<%= tail %><%= id %>")},updateImage:{service:c.templatify(b.ACTION_UPDATE_URL+"<%= id %>")},removeImage:{service:c.templatify(b.ACTION_DELETE_URL+"<%= id %>")},MXGetAnnotationsByStudent:{service:c.templatify("GetAnnotationsByStudent<%= tail %>")},MXGetTeacherCommentsAsStudent:{service:c.templatify("Annotation/Comments<%= tail %>")},MXMarkInteractiveNoteAsRead:{service:c.templatify("Annotation/InteractiveNoteMarkAsRead<%= tail %>")},MXMarkTeacherCommentAsRead:{service:c.templatify("annotation/TeacherCommentMarkAsRead<%= tail %>")}},m={entityName:"Annotations",_defaultTransport:d.use(b.TRANSPORT_NAMES.ODATA),_transports:{},_additionalActions:{create:function(b){if(e.isSet())if(a.isArray(b)){var c=e.getID();a.each(b,function(b){a.isUndefined(b)||(b.created_by_tool_id=c)})}else b.created_by_tool_id=e.getID()}},entityInfo:{AnnotationTypes:b.DEFAULTS.AnnotationTypes},_entityRunActions:function(){this._processVisibilityUpdate()},_request:{},_urls:l,_annotationVisibility:void 0,init:function(){return a.defaults(this,f),a.extend(this,g),this},_mapFields:function(a){a.$visibility&&(a.visibility_id=e.convertNamesToID(a.$visibility),delete a.$visibility),!a.currentVisibilityId&&0!=a.currentVisibilityId||!a.visibilityInclude&&!a.visibilityExclude||(a.visibility_id=e.updateVisibilityIdByNames({currentVisibilityId:a.currentVisibilityId,includeClients:a.visibilityInclude,excludeClients:a.visibilityExclude}),delete a.currentVisibilityId,delete a.visibilityInclude,delete a.visibilityExclude)},_mapFilters:function(d){if(!a.isUndefined(d.$visibility)){a.isArray(d.$visibility)?a.some(d.$visibility,function(b){return!a.isString(b)})&&i.throwError("API_ERR_QUERY_API_3",[this.entityName,a.keys(this._filtersObj),"","string","of incorrect type"]):a.isString(d.$visibility)||i.throwError("API_ERR_QUERY_API_3",[this.entityName,a.keys(this._filtersObj),"","string",c.toType(d.$visibility)]);var f={},g=j.getLastIdx();f[b.QUERY_PARAMS.visibility_id]=e.convertNamesToVisibilityIdsForGet(d.$visibility);for(var h=0;h<=g;h++)j.setProp(h,j.PROPS.QUERY_PARAMS,f);delete d.$visibility}if(!a.isUndefined(d.$client)){for(a.isString(d.$client)||i.throwError("API_ERR_QUERY_API_3",[this.entityName,a.keys(this._filtersObj),"","string",c.toType(d.$client)]),f={},g=j.getLastIdx(),f.created_by_tool_id=e.convertNamesToID(d.$client),h=0;h<=g;h++)j.setProp(h,j.PROPS.FILTERS,f);delete d.$client}},_parseTypeIds:function(c){if(c){var d=a.findWhere(b.SETTINGS.serviceSettingsStatuses,{name:"AnnotationTypes"});if(d.received=!0,c.length&&a.isArray(c)){d.correctFormat=!0;var e=[];a.each(c,function(b){a.isUndefined(b.description)||a.isUndefined(b.annotation_type_id)||e.push({id:b.annotation_type_id,name:b.description})}),a.size(e)>0&&(a.isEqual(e,b.DEFAULTS.AnnotationTypes)&&(d.upToDate=!0),b.SETTINGS.AnnotationTypes=e)}else b.SETTINGS.AnnotationTypes=b.DEFAULTS.AnnotationTypes}},tags:function(d){var e=this,f="tags()";return a.isNullUndef(d)?this:(a.isObjectNotArray(d)||a.isString(d)||a.isArrayOf(d,a.isObjectNotArray,a.isString)||i.throwError("API_ERR_QUERY_API_3",[e.entityName,"",f,"string or array of strings representing tag names or object or array of objects representing tag objects",c.toType(d)]),j.getProp(0,j.PROPS.IS_MAIN)!==!0&&i.throwError("API_ERR_QUERY_API_6",[e.entityName,f,"annotations"]),j.isCreate(0)||i.throwError("API_ERR_QUERY_API_5",[e.entityName,f,"create"]),d=h.tagNamesToValues(d),h._additionalActions.create&&this._additionalActions.create(d),d=a.isObjectNotArray(d)?[d]:d,a.each(d,function(c){a.isUndefined(c)||a.isUndefined(c[b.SETTINGS.Metadata.Tag.navigationProperties.Tag_annotation_Source.field])||i.throwError("API_ERR_QUERY_API_7",["Tags",b.SETTINGS.Metadata.Tag.navigationProperties.Tag_annotation_Source.field,c[b.SETTINGS.Metadata.Tag.navigationProperties.Tag_annotation_Source.field],f]);var g=j.getProp(0,j.PROPS.FIELDS_VALUES).content_id;a.each(d,function(a){a.content_id=g}),h._validateFieldsValues(c);var l=j.createSub(b.CRUD.create,!1,b.COLLECTIONS.tags.nameUppercase);j.setProp(l,j.PROPS.FIELDS_VALUES,c),j.setProp(l,j.PROPS.FOREIGN_KEY_REF,b.SETTINGS.Metadata.Tag.navigationProperties.Tag_annotation_Source),j.setProp(l,j.PROPS.BASE_URL,h._getBaseURL(b.CRUD.create)),k.validateMutuallyExclusiveMethods(e.entityName,b.CONFLICTED_METHODS.create.tags.name,b.CRUD.create),j.setProp(l,j.PROPS.CONFLICTING_METHOD,b.CONFLICTED_METHODS.create.tags.name)}),this)},forVisibility:function(b){return j.isUpdate(j.getLastIdx())||i.throwError("API_ERR_QUERY_API_5",[this.entityName,"forVisibility","update"]),a.isNumber(b)||i.throwError("API_ERR_QUERY_API_3",[this.entityName,"current_visibility_id","forVisibility","number",c.toType(b)]),a.isNullUndef(this._annotationVisibility)&&(this._annotationVisibility={}),this._annotationVisibility.currentVisibilityId=b,this},visibilityInclude:function(b){return j.isUpdate(j.getLastIdx())||i.throwError("API_ERR_QUERY_API_5",[this.entityName,"visibilityInclude","update"]),a.isUndefined(this._annotationVisibility)&&(this._annotationVisibility={}),this._annotationVisibility.includeClients=b,this},visibilityExclude:function(b){return j.isUpdate(j.getLastIdx())||i.throwError("API_ERR_QUERY_API_5",[this.entityName,"visibilityExclude","update"]),a.isUndefined(this._annotationVisibility)&&(this._annotationVisibility={}),this._annotationVisibility.excludeClients=b,this},_processVisibilityUpdate:function(){a.isNullUndef(this._annotationVisibility)||(j.getLen()>1&&(this._annotationVisibility=void 0,i.throwError("API_ERR_QUERY_API_6",[this.entityName,"'Visibility change","visibilities"])),(a.isUndefined(this._annotationVisibility.currentVisibilityId)||a.isUndefined(this._annotationVisibility.includeClients)&&a.isUndefined(this._annotationVisibility.excludeClients))&&(this._annotationVisibility=null,i.throwError("API_ERR_QUERY_API_4",[this.entityName,"forVisibility","visibilityInclude, visibilityExclude or both"])),j.setProp(j.getLastIdx(),j.PROPS.FIELDS_VALUES,{visibility_id:c.updateVisibilityIdByNames(this._annotationVisibility,this.entityName)}),this._annotationVisibility=null)},withTags:function(){var d,e="withTags()";return j.getLen()>0&&!j.isFindFamily(0)&&i.throwError("API_ERR_QUERY_API_5",[this.entityName,e,"find"]),d=j.getLastIdx(),c.isFunSwitchEnabled(arguments)&&a.isUndefined(j.getProp(d,j.PROPS.NEXT))&&j.updateSubs(j.PROPS.EXPAND_FOR,[b.COLLECTIONS.tags.expandName]),k.validateMutuallyExclusiveMethods(this.entityName,b.CONFLICTED_METHODS.find.withTags.name,b.CRUD.find),j.setProp(d,j.PROPS.CONFLICTING_METHOD,b.CONFLICTED_METHODS.find.withTags.name),this},withSharedOnly:function(){var d;if(j.getLen()>0&&!j.isFindFamily(0)&&i.throwError("API_ERR_QUERY_API_5",[this.entityName,b.EXPANDING_METHODS.withSharedOnly,"find"]),d=j.getLastIdx(),k.validateMutuallyExclusiveMethods(this.entityName,b.CONFLICTED_METHODS.find.withSharedOnly.name,b.CRUD.find),j.setProp(d,j.PROPS.CONFLICTING_METHOD,b.CONFLICTED_METHODS.find.withSharedOnly.name),c.isFunSwitchEnabled(arguments)&&a.isUndefined(j.getProp(d,j.PROPS.NEXT))){var e={};e[b.QUERY_PARAMS.option]=b.ANNO2_WITH_SHARED_ONLY,j.updateSubs(j.PROPS.EXPAND_FOR,[b.COLLECTIONS.annotationSharedWith.expandName]),j.updateSubs(j.PROPS.QUERY_PARAMS,e)}return this},withShared:function(){var d;if(j.getLen()>0&&!j.isFindFamily(0)&&i.throwError("API_ERR_QUERY_API_5",[this.entityName,b.EXPANDING_METHODS.withShared,"find"]),d=j.getLastIdx(),k.validateMutuallyExclusiveMethods(this.entityName,b.CONFLICTED_METHODS.find.withShared.name,b.CRUD.find),j.setProp(d,j.PROPS.CONFLICTING_METHOD,b.CONFLICTED_METHODS.find.withShared.name),c.isFunSwitchEnabled(arguments)&&a.isUndefined(j.getProp(d,j.PROPS.NEXT))){var e={};e[b.QUERY_PARAMS.option]=b.ANNO2_WITH_SHARED,j.updateSubs(j.PROPS.EXPAND_FOR,[b.COLLECTIONS.annotationSharedWith.expandName]),j.updateSubs(j.PROPS.QUERY_PARAMS,e)}return this},myNotSharedToOthers:function(){var d;if(j.getLen()>0&&!j.isFindFamily(0)&&i.throwError("API_ERR_QUERY_API_5",[this.entityName,b.EXPANDING_METHODS.myNotSharedToOthers,"find"]),d=j.getLastIdx(),k.validateMutuallyExclusiveMethods(this.entityName,b.CONFLICTED_METHODS.find.myNotSharedToOthers.name,b.CRUD.find),j.setProp(d,j.PROPS.CONFLICTING_METHOD,b.CONFLICTED_METHODS.find.myNotSharedToOthers.name),c.isFunSwitchEnabled(arguments)&&a.isUndefined(j.getProp(d,j.PROPS.NEXT))){var e={};e[b.QUERY_PARAMS.option]=b.ANNO2_MY_NOT_SHARED_TO_OTHERS,j.updateSubs(j.PROPS.QUERY_PARAMS,e)}return this},mySharedToOthers:function(){var d;if(j.getLen()>0&&!j.isFind(0)&&i.throwError("API_ERR_QUERY_API_5",[this.entityName,b.EXPANDING_METHODS.mySharedToOthers,"find"]),d=j.getLastIdx(),k.validateMutuallyExclusiveMethods(this.entityName,b.CONFLICTED_METHODS.find.mySharedToOthers.name,b.CRUD.find),j.setProp(d,j.PROPS.CONFLICTING_METHOD,b.CONFLICTED_METHODS.find.mySharedToOthers.name),c.isFunSwitchEnabled(arguments)&&a.isUndefined(j.getProp(d,j.PROPS.NEXT))){var e={};e[b.QUERY_PARAMS.option]=b.ANNO2_WITH_NO_SHARED,j.updateSubs(j.PROPS.EXPAND_FOR,[b.COLLECTIONS.annotationSharedWith.expandName]),j.updateSubs(j.PROPS.QUERY_PARAMS,e),a.extend(this._filtersObj,{$any:{shared_with:{id:{$gt:0}}}})}return this},withSharedAnnotations:function(){return j.getLen()>0&&!j.isFindFamily(0)&&i.throwError("API_ERR_QUERY_API_5",[this.entityName,b.EXPANDING_METHODS.withSharedAnnotations,"find"]),c.isFunSwitchEnabled(arguments)&&a.isUndefined(j.getProp(j.getLastIdx(),j.PROPS.NEXT))&&j.updateSubs(j.PROPS.EXPAND_FOR,[b.COLLECTIONS.annotationSharedWith.expandName]),this},findAllAnnotationsByText:function(d,e){var f=this,g=function(d,e){a.isString(d)||i.throwError("API_ERR_QUERY_API_3",[f.entityName,"text","findAllAnnotationsByText","string",c.toType(d)],e);var g=a.isNumber(e);f._customOperation(null,b.CUSTOM_ENDPOINTS.FIND_ALL_ANNOTATIONS_BY_TEXT,b.CRUD.find,null,g),d=a.wrapInto(d,"'");var h={};h[b.QUERY_PARAMS.text]=d,g?j.setProp(e,j.PROPS.QUERY_PARAMS,h):j.updateSubs(j.PROPS.QUERY_PARAMS,h)};return a.isArray(d)?a.each(d,function(a,b){g(a,b)}):g(d),this.filters(e),this},getInfo:function(){var c=this.info();return a.isUndefined(b.SETTINGS.FieldsSettableOnCreationOnly[this.entityName])||(c.FieldsSettableOnCreationOnly=b.SETTINGS.FieldsSettableOnCreationOnly[this.entityName]),a.isUndefined(b.SETTINGS.ReadOnlyFields[this.entityName])||(c.ReadOnlyFields=b.SETTINGS.ReadOnlyFields[this.entityName]),a.isUndefined(b.SETTINGS.RequiredFields[this.entityName])||(c.REQUIRED_FIELDS=b.SETTINGS.RequiredFields[this.entityName]),a.isUndefined(b.SETTINGS.AnnotationTypes)||(c.AnnotationTypes=b.SETTINGS.AnnotationTypes),b.FORCE_DEFAULT_SERVICE_SETTINGS?c.SETTINGS_SOURCE="client_defaults":c.SETTINGS_SOURCE="service",c},childAnnotations:function(d){var e=this,f="childAnnotations()";return a.isNullUndef(d)?this:(a.isObjectNotArray(d)||a.isArrayOf(d,a.isObjectNotArray)||i.throwError("API_ERR_QUERY_API_3",[e.entityName,"",f,"object or array of objects",c.toType(d)]),j.getProp(0,j.PROPS.IS_MAIN)!==!0&&i.throwError("API_ERR_QUERY_API_6",[this.entityName,f,"annotations"]),j.isCreate(0)||i.throwError("API_ERR_QUERY_API_5",[e.entityName,f,"create"]),this._additionalActions.create&&this._additionalActions.create(d),d=a.isObjectNotArray(d)?[d]:d,a.each(d,function(c){a.isUndefined(c)||a.isUndefined(c[b.SETTINGS.Metadata.Annotation.navigationProperties.Annotation_parent_Source.field])||i.throwError("API_ERR_QUERY_API_7",[e.entityName,b.SETTINGS.Metadata.Annotation.navigationProperties.Annotation_parent_Source.field,c[b.SETTINGS.Metadata.Annotation.navigationProperties.Annotation_parent_Source.field],f]),e._validateFieldsValues(c);var d=j.createSub(b.CRUD.create,!1,b.COLLECTIONS.annotations.nameUppercase);k.validateMutuallyExclusiveMethods(e.entityName,b.CONFLICTED_METHODS.create.childAnnotations.name,b.CRUD.create),j.setProp(d,j.PROPS.CONFLICTING_METHOD,b.CONFLICTED_METHODS.create.childAnnotations.name),j.setProp(d,j.PROPS.FIELDS_VALUES,c),j.setProp(d,j.PROPS.FOREIGN_KEY_REF,b.SETTINGS.Metadata.Annotation.navigationProperties.Annotation_parent_Source),j.setProp(d,j.PROPS.BASE_URL,e._getBaseURL(b.CRUD.create))}),this)},findComments:function(d){return a.isObjectNotArray(d)||a.isUndefined(d)||a.isArrayOf(d,a.isObject)||i.throwError("API_ERR_QUERY_API_3",[this.entityName,"","findComments","object, array of objects or undefined",c.toType(d)]),this._customOperation(d,b.CUSTOM_ENDPOINTS.FIND_COMMENTS,b.CRUD.find),this},forTags:function(b){var d=this,e="forTags",f=function(e,f){a.isString(e)||a.isArrayOfStrings(e)||i.throwError("API_ERR_QUERY_API_3",["Annotations","tags","forTags","string or array of strings",c.toType(e)],f),d._validateFind("forTags"),a.isNumber(f)?j.setProp(f,j.PROPS.FILTERS,{$any:{tags:{value:b}}}):j.updateSubs(j.PROPS.FILTERS,{$any:{tags:{value:b}}})};return a.isArrayOf(b,a.isArray,a.isNull)?(k.validateBatchGetItemsNumber(b,e),a.each(b,function(a,b){f(a,b)})):f(b),this.withTags()},getCountForContainers:function(d){var e=this;return a.isNumber(d)||a.isArrayOf(d,a.isNumber)||i.throwError("API_ERR_QUERY_API_3",["Annotations","containerIds","getCountForContainers","number or array of numbers",c.toType(d)]),d=a.isNumber(d)?[d]:d,a.each(d,function(a){var d={};d[b.COLLECTIONS.containers.expandName+"/parent_id"]=a;var f={$or:[{container_id:a},d]},g=j.createSub(b.CRUD.find,!0,b.COLLECTIONS.annotations.nameUppercase);j.setProp(g,j.PROPS.EXPAND_FOR,[b.COLLECTIONS.containers.expandName]),j.setProp(g,j.PROPS.BASE_URL,e._getBaseURL(b.CRUD.find)),j.setProp(g,j.PROPS.FILTERS,f),j.setProp(j.getLastIdx(),j.PROPS.LIMIT_COUNT,0),j.setProp(g,j.PROPS.INLINE_COUNT,c.isFunSwitchEnabled(arguments))}),this},forContainer:function(d){var e=this,f="forContainer",g=b.COLLECTIONS.containers.expandName,h=function(b,f){a.isNumber(b)||i.throwError("API_ERR_QUERY_API_3",[e.entityName,"id","forContainer","number",c.toType(d)],f),e._validateFind("forContainer"),a.isNumber(f)?(e._filtersObj[f].$sub||(e._filtersObj[f].$sub={}),e._filtersObj[f].$sub[g]={id:b}):(e._filtersObj.$sub||(e._filtersObj.$sub={}),e._filtersObj.$sub[g]={id:d})};return a.isArray(d)?a.each(d,function(b,c){k.validateBatchGetItemsNumber(d,f),a.isNull(b)||h(b,c)}):h(d),this},withChildContainers:function(){if(!c.isFunSwitchEnabled(arguments))return this;var a=b.COLLECTIONS.containers.expandName;this._filtersObj&&this._filtersObj.$sub&&this._filtersObj.$sub[a]&&this._filtersObj.$sub[a].id||i.throwError("API_ERR_QUERY_API_14",["withChildContainers","forContainer"]);var d=this._filtersObj.$sub[a].id;return this._filtersObj.$sub[a]={$or:[{id:d},{parent_id:d}]},this},findCommentedAnnotations:function(d,e){if(a.isString(e)||a.isUndefined(e)||i.throwError("API_ERR_QUERY_API_3",[this.entityName,"findText","findCommentedAnnotations","string",c.toType(e)]),a.isObjectNotArray(d)||a.isUndefined(d)||i.throwError("API_ERR_QUERY_API_3",[this.entityName,"","findCommentedAnnotations","object or undefined",c.toType(d)]),this._customOperation(d,b.CUSTOM_ENDPOINTS.FIND_COMMENTED_ANNOTATIONS,b.CRUD.find),a.isString(e)&&""!==e.trim()){e=a.wrapInto(e,"'");var f={};f[b.QUERY_PARAMS.text]=e,j.setProp(0,j.PROPS.QUERY_PARAMS,f)}return this},createImage:function(d,e){if(!c.isFunSwitchEnabled(arguments))return this;k.doInitCheck();var f=this,g="createImage()",h=/data:image\/png;base64,/;a.isNullUndef(d)&&i.throwError("API_ERR_QUERY_API_3",[this.entityName,"fieldValues",g,"object","empty"]),a.isObjectNotArray(d)||i.throwError("API_ERR_QUERY_API_3",[this.entityName,"fieldValues",g,"object",c.toType(d)]),a.isNullUndef(e)&&i.throwError("API_ERR_QUERY_API_3",[this.entityName,"base64image",g,"base64 encoded image","empty"]),h.test(e)||i.throwError("API_ERR_QUERY_API_3",[this.entityName,"base64image",g,"base64 encoded image",c.toType(e)]),f._additionalActions.create&&f._additionalActions.create(d),f._validateFieldsValues(d),f._validateNoRequestsCreated("create"),f._customOperation(d,b.CUSTOM_ENDPOINTS.CREATE_IMAGE,b.CRUD.create);var l=j.getLastIdx();return k.validateMutuallyExclusiveMethods(f.entityName,b.CONFLICTED_METHODS.create.createImage.name,b.CRUD.create),j.setProp(l,j.PROPS.CONFLICTING_METHOD,b.CONFLICTED_METHODS.create.createImage.name),j.setProp(l,j.PROPS.IS_WEBAPI,!0),j.setProp(l,j.PROPS.IS_CUSTOM_HEAD,!0),j.setProp(l,j.PROPS.BASE_URL,f._getBaseURL(b.CUSTOM_ENDPOINTS.CREATE_IMAGE,!0)),
j.setProp(l,j.PROPS.FIELDS_VALUES,d),j.setProp(l,j.PROPS.BASE_64_IMAGE,e),f},findImage:function(d){var e="findImage()";a.isNullUndef(d)&&i.throwError("API_ERR_QUERY_API_3",[this.entityName,"annotation_id",e,"number","empty"]),a.isNumber(d)||i.throwError("API_ERR_QUERY_API_3",[this.entityName,"annotation_id",e,"number",c.toType(d)]),this._customOperation(d,b.CUSTOM_ENDPOINTS.FIND_IMAGE,b.CRUD.findOne),k.validateMutuallyExclusiveMethods(this.entityName,b.CONFLICTED_METHODS.find.findImage.name,b.CRUD.find);var f=j.getLastIdx();return j.setProp(f,j.PROPS.CONFLICTING_METHOD,b.CONFLICTED_METHODS.find.findImage.name),j.setProp(f,j.PROPS.IS_WEBAPI,!0),j.setProp(f,j.PROPS.ID,d),this},updateImage:function(d,e,f){var g=this,h="updateImage()",k=/data:image\/png;base64,/;a.isNullUndef(f)&&i.throwError("API_ERR_QUERY_API_3",[this.entityName,"base64image",h,"base64 encoded image","empty"]),k.test(f)||i.throwError("API_ERR_QUERY_API_3",[this.entityName,"base64image",h,"base64 encoded image",c.toType(f)]),g._additionalActions.update&&g._additionalActions.update(e),g._validateNoRequestsCreated("update"),g._customOperation(d,b.CUSTOM_ENDPOINTS.UPDATE_IMAGE,b.CRUD.update);var l=j.getLastIdx();return j.setProp(l,j.PROPS.IS_WEBAPI,!0),j.setProp(l,j.PROPS.REQ_TYPE,b.REQ_TYPE_PUT),j.setProp(l,j.PROPS.IS_CUSTOM_HEAD,!0),j.setProp(l,j.PROPS.FIELDS_VALUES,e),j.setProp(l,j.PROPS.BASE_URL,g._getBaseURL(b.CUSTOM_ENDPOINTS.UPDATE_IMAGE)),j.setProp(l,j.PROPS.ID,d),j.setProp(l,j.PROPS.BASE_64_IMAGE,f),g},removeImage:function(d){var e="removeImage()";a.isNullUndef(d)&&i.throwError("API_ERR_QUERY_API_3",[this.entityName,"annotation_id",e,"number","empty"]),a.isNumber(d)||i.throwError("API_ERR_QUERY_API_3",[this.entityName,"annotation_id",e,"number",c.toType(d)]),this._customOperation(d,b.CUSTOM_ENDPOINTS.REMOVE_IMAGE,b.CRUD.remove);var f=j.getLastIdx();return j.setProp(f,j.PROPS.IS_WEBAPI,!0),j.setProp(f,j.PROPS.ID,d),this}};return m._reset=function(){m._filtersObj={},m.desiredOrder={},m._annotationVisibility=null},m.init()}),d("containers",["underscorenc","config","helpers","transportManager","client","queryAPI","info","annotations","errorManager","requestManager"],function(a,b,c,d,e,f,g,h,i,j){var k={remove:{service:c.templatify("containers(<%= id %>)")},create:{service:c.templatify("containers")},update:{service:c.templatify("containers(<%= id %>)")},find:{service:c.templatify("containers<%= tail %>")},findOne:{service:c.templatify("containers(<%= id %>)<%= tail %>")},getSubmitted:{service:c.templatify("SubmittedFolders<%= tail %>")}},l={entityName:"Containers",_defaultTransport:d.use(b.TRANSPORT_NAMES.ODATA),_transports:{},_request:{},_additionalActions:{},_urls:k,init:function(b){return a.defaults(this,f),a.extend(this,g),this},childContainers:function(d){var e=this,f="childContainers()";return a.isNullUndef(d)?this:(a.isObjectNotArray(d)||a.isArrayOf(d,a.isObjectNotArray)||i.throwError("API_ERR_QUERY_API_3",[e.entityName,"",f,"object or array of objects",c.toType(d)]),j.getProp(0,j.PROPS.IS_MAIN)!==!0&&i.throwError("API_ERR_QUERY_API_6",[this.entityName,f,"annotations"]),j.isCreate(0)||i.throwError("API_ERR_QUERY_API_5",[e.entityName,f,"create"]),this._additionalActions.create&&this._additionalActions.create(d),d=a.isObjectNotArray(d)?[d]:d,a.each(d,function(c){a.isUndefined(c)||a.isUndefined(c[b.SETTINGS.Metadata.Container.navigationProperties.Container_parent_Source.field])||i.throwError("API_ERR_QUERY_API_7",[e.entityName,b.SETTINGS.Metadata.Container.navigationProperties.Container_parent_Source.field,c[b.SETTINGS.Metadata.Container.navigationProperties.Container_parent_Source.field],f]),e._validateFieldsValues(c);var d=j.createSub(b.CRUD.create,!1,b.COLLECTIONS.containers.nameUppercase);j.setProp(d,j.PROPS.FIELDS_VALUES,c),j.setProp(d,j.PROPS.FOREIGN_KEY_REF,b.SETTINGS.Metadata.Container.navigationProperties.Container_parent_Source),j.setProp(d,j.PROPS.BASE_URL,e._getBaseURL(b.CRUD.create))}),this)},submitTo:function(d){if(!c.isFunSwitchEnabled(arguments))return this;a.isString(d)||a.isNull(d)||i.throwError("API_ERR_QUERY_API_3",[this.entityName,"userId","submitTo","string",c.toType(d)]),j.isUpdate(j.getLastIdx())||i.throwError("API_ERR_QUERY_API_5",[this.entityName,"submitTo","update"]),0!==j.getSubIndexesMatchingFilter({queryParams:[b.QUERY_PARAMS.submittedForUserId]}).length&&i.throwError("API_ERR_QUERY_API_16",["submitTo"]);var e={};return e[b.QUERY_PARAMS.submittedForUserId]=d,j.setProp(0,j.PROPS.QUERY_PARAMS,e),this},getSubmitted:function(d){var e=this,f=function(d,f){a.isString(d)||i.throwError("API_ERR_QUERY_API_3",[e.entityName,"classId","getSubmitted","string",c.toType(d),f]);var g=a.isNumber(f),h=e._customOperation({},b.CUSTOM_ENDPOINTS.GET_SUBMITTED,b.CRUD.find,null,g),k={};k[b.QUERY_PARAMS.classId]=d,g?(j.setProp(h,j.PROPS.QUERY_PARAMS,k),j.setProp(h,j.PROPS.IS_WEBAPI,!0)):(j.updateSubs(j.PROPS.QUERY_PARAMS,k),j.updateSubs(j.PROPS.IS_WEBAPI,!0))};return a.isNonEmptyArray(d)?a.each(d,function(a,b){f(a,b)}):f(d),this},createAnnotation:function(d){if(!c.isFunSwitchEnabled(arguments))return this;var e=this,f="createAnnotation()";j.getProp(0,j.PROPS.IS_MAIN)!==!0&&i.throwError("API_ERR_QUERY_API_6",[e.entityName,f,b.COLLECTIONS.containers.name]),j.isUpdate(0)||i.throwError("API_ERR_QUERY_API_5",[e.entityName,f,"update"]),a.isObjectNotArray(d)||i.throwError("API_ERR_QUERY_API_3",[e.entityName,"",f,"object",c.toType(d)]),h._additionalActions.create&&h._additionalActions.create(d),a.isUndefined(d)||a.isUndefined(d.container_id)||i.throwError("API_ERR_QUERY_API_7",[h.entityName,b.QUERY_PARAMS.containerId,d.container_id,f]),d.container_id=j.getProp(0,j.PROPS.ID),h._validateFieldsValues(d);var g=j.createSub(b.CRUD.create,!1,b.COLLECTIONS.annotations.nameUppercase);return j.setProp(g,j.PROPS.FIELDS_VALUES,d),j.setProp(g,j.PROPS.BASE_URL,h._getBaseURL(b.CRUD.create)),this.forceOrder(g),this},updateAnnotation:function(d,e){if(!c.isFunSwitchEnabled(arguments))return this;var f=this,g="updateAnnotation()";a.isUndefined()&&a.isNumber(d)||i.throwError("API_ERR_QUERY_API_3",[f.entityName,"id",g,"number",c.toType(d)]),j.getProp(0,j.PROPS.IS_MAIN)!==!0&&i.throwError("API_ERR_QUERY_API_6",[f.entityName,g,b.COLLECTIONS.containers.name]),j.isUpdate(0)||i.throwError("API_ERR_QUERY_API_5",[f.entityName,g,"update"]),a.isObjectNotArray(e)||i.throwError("API_ERR_QUERY_API_3",[f.entityName,"",g,"object",c.toType(e)]);var k=j.createSub(b.CRUD.update,!1,b.COLLECTIONS.annotations.nameUppercase);return j.setProp(k,j.PROPS.ID,d),j.setProp(k,j.PROPS.FIELDS_VALUES,e),j.setProp(k,j.PROPS.BASE_URL,h._getBaseURL(b.CRUD.update)),this.forceOrder(k),this},getInfo:function(){var c=this.info();return a.isUndefined(b.SETTINGS.FieldsSettableOnCreationOnly[this.entityName])||(c.FieldsSettableOnCreationOnly=b.SETTINGS.FieldsSettableOnCreationOnly[this.entityName]),a.isUndefined(b.SETTINGS.ReadOnlyFields[this.entityName])||(c.ReadOnlyFields=b.SETTINGS.ReadOnlyFields[this.entityName]),a.isUndefined(b.SETTINGS.RequiredFields[this.entityName])||(c.REQUIRED_FIELDS=b.SETTINGS.RequiredFields[this.entityName]),b.FORCE_DEFAULT_SERVICE_SETTINGS?c.SETTINGS_SOURCE="client_defaults":c.SETTINGS_SOURCE="service",c}};l._reset=function(){l._filtersObj={},l.desiredOrder={}};return l.init()}),d("any",["underscorenc","config","helpers","transportManager","client","queryAPI","info","errorManager"],function(a,b,c,d,e,f,g,h){var i="",j={remove:{service:function(a){return i+"("+a.id+")"}},create:{service:function(a){return i}},update:{service:function(a){return i+"("+a.id+")"}},find:{service:function(a){return i+"/"+a.tail}},findOne:{service:function(a){return i+"("+a.id+")/"+a.tail}}},k={entityName:"Any",_defaultTransport:d.use(b.TRANSPORT_NAMES.ODATA),_transports:{},_request:{},_additionalActions:{},_urls:j,init:function(b){return a.defaults(this,f),a.extend(this,g),this.collection(""),this},collection:function(a){return i=a||"",this},run:function(){f.run.apply(this),i=""},_entityLevelCheck:function(){""===i&&h.throwError("API_ERR_ANY_1",null)}};return k.init()}),d("annotationSharedWith",["underscorenc","config","helpers","transportManager","client","queryAPI","info","errorManager","requestManager"],function(a,b,c,d,e,f,g,h,i){var j={remove:{service:c.templatify("annotation_shared_with(<%= id %>)")},create:{service:c.templatify("annotation_shared_with")},find:{service:c.templatify("annotation_shared_with<%= tail %>")},findOne:{service:c.templatify("tags(<%= id %>)<%= tail %>")},addUsersToAnnotation:{service:c.templatify("annotation_shared_with")}},k={entityName:"AnnotationSharedWith",_defaultTransport:d.use(b.TRANSPORT_NAMES.ODATA),_transports:{},_request:{},_additionalActions:{},_urls:j,init:function(b){return a.defaults(this,f),a.extend(this,g),this},_getRequest:function(){return this._request},getInfo:function(){var c=this.info();return c&&c.description&&c.description[2]&&(c.description[2]="Allowed operations: [create,remove,find,findOne]"),a.isUndefined(b.SETTINGS.FieldsSettableOnCreationOnly[this.entityName])||(c.FieldsSettableOnCreationOnly=b.SETTINGS.FieldsSettableOnCreationOnly[this.entityName]),a.isUndefined(b.SETTINGS.ReadOnlyFields[this.entityName])||(c.ReadOnlyFields=b.SETTINGS.ReadOnlyFields[this.entityName]),a.isUndefined(b.SETTINGS.RequiredFields[this.entityName])||(c.REQUIRED_FIELDS=b.SETTINGS.RequiredFields[this.entityName]),b.FORCE_DEFAULT_SERVICE_SETTINGS?c.SETTINGS_SOURCE="client_defaults":c.SETTINGS_SOURCE="service",c},addUsersToAnnotation:function(b,d){a.isNumber(b)||h.throwError("API_ERR_QUERY_API_3",[this.entityName,"annotationId","addUsersToAnnotation","number",c.toType(b)]),a.isString(d)||a.isArrayOfStrings(d)||h.throwError("API_ERR_QUERY_API_3",[this.entityName,"userIds","addUsersToAnnotation","string or array of strings",c.toType(d)]);d=a.isString(d)?[d]:d;var e=[];a.each(d,function(a){e.push({annotation_id:b})});var f=this.create(e);return a.each(d,function(a,b){i.setProp(b,i.PROPS.QUERY_PARAMS,{user_ids:a})}),f}};return k._reset=function(){k._filtersObj={},k.desiredOrder={}},k.init()}),a.prototype={then:function(a,b){this._thens.push({resolve:a,reject:b})},resolve:function(a){this._complete("resolve",a)},reject:function(a){this._complete("reject",a)},_complete:function(a,b){this.then="resolve"===a?function(a,c){a&&a(b)}:function(a,c){c&&c(b)},this.resolve=this.reject=function(){throw new Error("Promise already completed.")};for(var c,d=0;c=this._thens[d++];)c[a]&&c[a](b);delete this._thens}},d("tinyPromise",function(){}),d("basicAPI",["underscorenc","config","helpers","client","transportManager","annotations","tags","containers","any","errorManager","resetManager","annotationSharedWith","tinyPromise"],function(b,c,d,e,f,g,h,i,j,k,l,m,n){var o={};o.reset=function(){try{l.resetLib()}catch(a){return"Reset failed."+a}return"Reset OK."},o.getCORS=function(){return c.CORS},o.setCORS=function(a){c.CORS=!!a,f.use(c.TRANSPORT_NAMES.ODATA).setCors()},o.getServerURL=function(){return c.SERVER_URL},o.setServerURL=function(a){c.SERVER_URL=a},o.getPostTunneling=function(){return c.USE_POST_TUNNELING},o.setPostTunneling=function(a){c.USE_POST_TUNNELING=a},o.getToken=function(){return c.TOKEN_AUTHN},o.setToken=function(a){b.isNullUndef(a)||b.isString(a)&&a.length?c.TOKEN_AUTHN=a:k.throwError("API_ERR_GENERAL_1",["","setToken","string",d.toType(a)])},o.getNextLinkDomainStripping=function(){return c.NEXT_LINK_DOMAIN_STRIPPING},o.setNextLinkDomainStripping=function(a){c.NEXT_LINK_DOMAIN_STRIPPING=a},o.getParseDates=function(){return c.DEFAULT_PARSE_DATE},o.setParseDates=function(a){c.DEFAULT_PARSE_DATE=a},o.setODataVersion=function(a){b.isString(a)&&(a=parseInt(a)),b.isNumber(a)&&!b.isNaN(a)&&(a=a.toFixed(1).toString()),!b.isNaN(a)||b.isBoolean(a)||b.isUndefined(a)||b.isNull(a)||b.isString(a)?c.FORCE_ODATA_VERSION=a?"2.0":void 0:k.throwError("API_ERR_GENERAL_1",["","setODataVersion",["true","numeric string","int number"].join(","),a])},o.getODataVersion=function(){return c.FORCE_ODATA_VERSION},o.getClientId=e.getID,o.setClientId=e.setID,o.getVersion=function(){return c.API_VERSION},o.getSuppressValidation=function(){return c.SUPPRESS_VALIDATION},o.setSuppressValidation=function(a){b.isBoolean(a)||k.throwError("API_ERR_GENERAL_1",["","setSuppressValidation","boolean",d.toType(a)]),c.SUPPRESS_VALIDATION=a},o.getContainerStatuses=function(){return c.SETTINGS.containerStatus},o.convertClientIdToClientNames=e.convertIDToNames,o.convertClientNamesToClientId=e.convertNamesToID,o.updateVisibilityIdByClientNames=e.updateVisibilityIdByNames,o.convertClientNamesToVisibilityIds=e.convertNamesToVisibilityIds;var p=!1;o.startKeepalive=function(a,b){!a&&k.throwError("API_ERR_AJAX_2",["requestURL","startKeepalive"]),p&&k.throwError("API_ERR_AJAX_3",["Keepalive","stopKeepalive"]),p=window.setInterval(function(){f.use(c.TRANSPORT_NAMES.AJAX).read({url:a,data:{},type:c.REQ_TYPE_GET},function(){},function(){})},b||c.PLATFORM_KEEPALIVE_DEFAULT_DELAY)},o.stopKeepalive=function(){p&&(window.clearInterval(p),p=!1)},o.getSettingsStatus=function(){if(b.isEmpty(c.SETTINGS.serviceSettingsStatuses))throw"Error - Status not available";return c.SETTINGS.serviceSettingsStatuses};var q,r=function(j){function l(a,d){a=b.findWhere(c.SETTINGS.serviceSettingsStatuses,{name:a}),a[d]=!0}function n(){for(var a in c.DEFAULTS)c.SETTINGS[a]=c.DEFAULTS[a],c.SETTINGS.Source===c.SETTINGS_SOURCES.CLIENT_DEFAULTS?l(a,"unknown"):(c.FORCE_DEFAULT_SERVICE_SETTINGS=!0,l(a,"forced"));c.SETTINGS.serviceSettingsStatuses=b.indexBy(c.SETTINGS.serviceSettingsStatuses,function(a){return a.name}),g.setInfo(c.SETTINGS.Metadata.Annotation),h.setInfo(c.SETTINGS.Metadata.Tag),i.setInfo(c.SETTINGS.Metadata.Container),m.setInfo(c.SETTINGS.Metadata.AnnotationSharedWith)}c.SETTINGS.serviceSettingsStatuses=[],b.each(c.DEFAULTS,function(a,b){c.SETTINGS.serviceSettingsStatuses.push(new d.ServiceSettingsStatus(b))});var o=new a;b.isBoolean(j)||k.throwError("API_ERR_QUERY_API_3",["","forceDefaultServiceSettings","","boolean",d.toType(j)]);var p,q;return j&&j===!0?q=function(){n(),d.consoleLog("* Default service settings are forced in the init!")}:(q=function(a){if(a){var f=b.deepClone(a),j=function(a){c.SETTINGS.SETTINGS_SOURCE=c.SETTINGS_SOURCES.SERVICE_WITH_CLIENT_DEFAULTS,c.SETTINGS[a]=c.DEFAULTS[a]};a.Version&&b.isString(a.Version)&&(c.API_VERSION.service=a.Version),f=b.omit(f,b.union(c.SETTINGS.ExcludeNonServiceSettingsProperties,c.SETTINGS.ExcludeFromServiceSettingsParsing)),b.each(c.DEFAULTS,function(a,e){b.isUndefined(f[e])?j(e):(l(e,"received"),"AppSettings"===e&&(f[e]=f[e][0]),d.toType(f[e])===d.toType(c.DEFAULTS[e])?(l(e,"correctFormat"),b.isEqual(f[e],c.DEFAULTS[e])&&l(e,"upToDate"),c.SETTINGS[e]=f[e],c.SETTINGS.SETTINGS_SOURCE=c.SETTINGS_SOURCES.SERVICE):j(e)),c.SETTINGS.serviceSettingsStatuses=b.indexBy(c.SETTINGS.serviceSettingsStatuses,function(a){return a.name})}),e._parseClientIds(a.ClientTools),g._parseTypeIds(a.AnnotationTypes),c.SETTINGS.Metadata=d.parseMetadata(a.Metadata),b.each(c.SETTINGS.serviceSettingsStatuses,function(a,b){var c="";c=a.received&&a.correctFormat&&a.upToDate?"+":"-",d.consoleLog(c+b+": ",a)})}else d.consoleLog("* Problem receiving service data. Using defaults!"),c.SETTINGS.SETTINGS_SOURCE=c.SETTINGS_SOURCES.CLIENT_DEFAULTS,n();g.setInfo(c.SETTINGS.Metadata.Annotation),h.setInfo(c.SETTINGS.Metadata.Tag),i.setInfo(c.SETTINGS.Metadata.Container),m.setInfo(c.SETTINGS.Metadata.AnnotationSharedWith)},p=function(a,b){d.consoleLog("Error receiving service data: ",a),d.consoleLog("Error receiving service data (error additional data): ",b),d.consoleLog("* Problem receiving service data. Using defaults!"),n()}),j&&j===!0?o.resolve(q()):f.use(c.TRANSPORT_NAMES.AJAX).read({url:c.SERVER_URL+c.SERVICE_APP_SETTINGS,data:void 0,type:c.REQ_TYPE_GET},function(a){o.resolve(q(a))},function(a,b){o.reject(p(a,b))}),o};return o.init=function(a,f,g){function h(){void 0!==q&&null!==q&&e.setID(q),o.setApiInitialized(!0)}this.restoreDefaults(),this.setServerURL(a.serverUrl||a.serverURL||c.INTERNAL_DEFAULTS.SERVER_URL),this.setPostTunneling(b.isUndefined(a.usePostTunneling)?c.INTERNAL_DEFAULTS.USE_POST_TUNNELING:a.usePostTunneling),this.setToken(a.token||c.INTERNAL_DEFAULTS.TOKEN_AUTHN),this.setODataVersion(a.forceODataVersion||c.INTERNAL_DEFAULTS.TOKEN_AUTHN),this.setCORS(b.isUndefined(a.cors)?c.INTERNAL_DEFAULTS.CORS:a.cors),this.setSuppressValidation(b.isUndefined(a.suppressValidation)?c.INTERNAL_DEFAULTS.SUPPRESS_VALIDATION:a.suppressValidation),this.setTimeout(b.isUndefined(a.requestTimeout)?c.INTERNAL_DEFAULTS.REQUEST_TIMEOUT:a.requestTimeout),this.setNextLinkDomainStripping(b.isUndefined(a.nextLinkDomainStripping)?c.INTERNAL_DEFAULTS.NEXT_LINK_DOMAIN_STRIPPING:a.nextLinkDomainStripping),this.setParseDates(b.isUndefined(a.parseDates)?c.INTERNAL_DEFAULTS.DEFAULT_PARSE_DATE:a.parseDates),c.PLATFORM_KEEPALIVE_DEFAULT_DELAY=c.INTERNAL_DEFAULTS.PLATFORM_KEEPALIVE_DEFAULT_DELAY,q=a.clientId,f=f||a.successHandler,g=g||a.errorHandler;var i=r(a.forceDefaultServiceSettings||!1);i.then(function(){d.consoleLog("* Finished all init tasks."),h(),f&&f()},function(){d.consoleLog("* Error * Some init tasks failed. Library uses defaults."),h(),g&&g()})},o.getApiInitialized=function(){return c.API_INITIALIZED},o.setApiInitialized=function(a){c.API_INITIALIZED=a},o.getTimeout=function(){return c.REQUEST_TIMEOUT},o.setTimeout=function(a){!a||b.isObject(a)||b.isNull(a)||b.isBoolean(a)||isNaN(a)||a%1!==0?k.throwError("API_ERR_GENERAL_1",["requestTimeout","setTimeout","numeric",d.toType(a)]):b.isString(a)?c.REQUEST_TIMEOUT=parseInt(a):c.REQUEST_TIMEOUT=a},o.getInfo=function(){var a={};return a.APP_SETTINGS=c.SETTINGS.AppSettings,a.CLIENT_IDS_LIST=c.SETTINGS.ClientTools,a.SETTINGS_SOURCE=c.SETTINGS.SETTINGS_SOURCE,a},o.restoreDefaults=function(){this.setCORS(c.INTERNAL_DEFAULTS.CORS),this.setServerURL(c.INTERNAL_DEFAULTS.SERVER_URL),this.setODataVersion(c.INTERNAL_DEFAULTS.FORCE_ODATA_VERSION),this.setSuppressValidation(c.INTERNAL_DEFAULTS.SUPPRESS_VALIDATION),this.setNextLinkDomainStripping(c.INTERNAL_DEFAULTS.NEXT_LINK_DOMAIN_STRIPPING),this.setPostTunneling(c.INTERNAL_DEFAULTS.USE_POST_TUNNELING),this.setTimeout(c.INTERNAL_DEFAULTS.REQUEST_TIMEOUT),this.setToken(c.INTERNAL_DEFAULTS.TOKEN_AUTHN),this.setClientId(c.INTERNAL_DEFAULTS.CLIENT_ID)},o}),d("parser",["underscorenc"],function(a){function b(a){var b=a.len,c=e[a.com]||e.$equal;return function(a){return c(a.length,b)}}function c(b){var c=a.isArray(b.sp)?b.sp:[b.sp],d=e[b.com]||e.$in;return function(a){return d(a,c)}}var d={"function":a.isFunction,number:a.isNumber,array:a.isArray,object:a.isObject,string:a.isString,"boolean":a.isBoolean,undefined:a.isUndefined,"null":a.isNull},e={$gte:function(a,b){return!!(a>=b)},$gt:function(a,b){return!!(a>b)},$lte:function(a,b){return!!(a<=b)},$lt:function(a,b){return!!(a<b)},$equal:function(a,b){return!(a!==b)},$ne:function(a,b){return!(a===b)},$in:function(b,c){return!!a.isObject(b)&&a.every(c,function(a){return!!(a in b)})},$nin:function(b,c){return!!a.isObject(b)&&a.every(c,function(a){return!(a in b)})}},f={getConditionFunction:function(e){return a.isObject(e)?a.isUndefined(e.sp)?b(e):c(e):d[e]},getValue:function(b,c,d){return d=d||0,a.isObject(b)?c:c[d]}};return f}),d("annotationMaps",["underscorenc","config"],function(a,b){var c={};return c.deleteAnnotation=[b.NAMED_MAPS.error(),[b.NAMED_MAPS.success(),b.NAMED_MAPS.object()],{argIndex:0,p:"id",c:["number"]}],c.deleteAnnotations=[b.NAMED_MAPS.error(),[b.NAMED_MAPS.success(),b.NAMED_MAPS.object()],{argIndex:0,p:"annotationIdsList",c:["array"]}],c.updateAnnotation=[{argIndex:3,p:"errorHandler",c:[{len:4},"function"]},[{argIndex:2,p:"successHandler",c:["function"]},{argIndex:2,c:["object"]}],[{argIndex:1,p:"fieldsValues",c:["object"]},{argIndex:1,p:"fieldsValues",c:["null"],force:{}}],{argIndex:0,p:"id",c:["number"]}],c.createAnnotation=[{argIndex:2,p:"errorHandler",c:[{len:3},"function"]},[{argIndex:1,p:"successHandler",c:["function"]},{argIndex:1,c:["object"]}],{argIndex:0,p:"fieldsValues",c:["object"]}],c.getAnnotationsByTextString=[{argIndex:1,c:["object"]},{argIndex:0,p:"text",c:["string"]}],c.getAnnotationByID=[{argIndex:3,p:"errorHandler",c:[{len:4},"function"]},{argIndex:2,p:"successHandler",c:[{len:4},"function"]},[{argIndex:1,p:"fields",c:["array"]},{argIndex:1,c:["object"]}],{argIndex:0,p:"id",c:["number"]}],c.getAnnotations=[{argIndex:6,p:"errorHandler",c:[{len:7,com:"$gte"},"function"]},{argIndex:5,p:"successHandler",c:[{len:6,com:"$gte"},"function"]},{argIndex:4,p:"limitCount",c:[{len:5,com:"$gte"},"number"]},{argIndex:3,p:"limitFrom",c:[{len:4,com:"$gte"},"number"]},{argIndex:2,p:"orderBy",c:[{len:3,com:"$gte"},"array"]},{argIndex:1,p:"fields",c:[{len:2,com:"$gte"},"array"]},[{argIndex:0,p:"filters",c:[{len:1,com:"$gt"},"object"]},{argIndex:0,c:["object"]}]],c.getAnnotationsCount=[{argIndex:2,p:"errorHandler",c:[{len:3,com:"$gte"},"function"]},{argIndex:1,p:"successHandler",c:[{len:2,com:"$gte"},"function"]},[{argIndex:0,p:"filters",c:[{len:1,com:"$gt"},"object"]},{argIndex:0,c:["object"]}]],c}),d("tagsMaps",["underscorenc","config"],function(a,b){var c={};return c.createTagsForAnnotationId=[{argIndex:4,p:"errorHandler",c:[{len:5},"function"]},[{argIndex:3,p:"successHandler",c:[{len:4,com:"$gte"},"function"]},{argIndex:3,c:[{len:4,com:"$gte"},"object"]}],{argIndex:0,p:"annotationId",c:["number"]},{argIndex:1,p:"contentId",c:[]},{argIndex:2,p:"tagsList",c:["array"]}],c.getTagsByAnnotationId=[{argIndex:5,p:"errorHandler",c:[{len:6,com:"$gte"},"function"]},{argIndex:4,p:"successHandler",c:[{len:5,com:"$gte"},"function"]},{argIndex:3,p:"limitCount",c:[{len:4,com:"$gte"},"number"]},{argIndex:2,p:"limitFrom",c:[{len:3,com:"$gte"},"number"]},[{argIndex:1,p:"orderBy",c:[{len:2,com:"$gte"},"array"]},{argIndex:1,c:["object"]}],{argIndex:0,p:"annotationId",c:["number"]}],c.createAnnotationAndTags=[{argIndex:3,p:"errorHandler",c:[{len:4},"function"]},[{argIndex:2,p:"successHandler",c:[{len:3,com:"$gte"},"function"]},{argIndex:2,c:[{len:3,com:"$gte"},"object"]}],{argIndex:0,p:"annotationFieldsValues",c:["object"]},{argIndex:1,p:"tagsList",c:["array"]}],c.deleteTags=[{argIndex:2,p:"errorHandler",c:[{len:3},"function"]},[{argIndex:1,p:"successHandler",c:[{len:1,com:"$gte"},"function"]},{argIndex:1,c:[{len:1,com:"$gte"},"object"]}],{argIndex:0,p:"tagIdsList",c:["array"]}],c.getAnnotationsByTag=[{argIndex:1,c:["object"]},{argIndex:0,p:"tag",c:["string"]}],c.getTagsByContentId=[{argIndex:5,p:["errorHandler"],c:["function"]},{argIndex:4,p:["successHandler"],c:["function"]},{argIndex:3,p:["limitCount"],c:["number"]},{argIndex:2,p:["limitFrom"],c:["number"]},{argIndex:1,p:["orderBy"],c:["string"]},{argIndex:0,p:["contentId"],c:[]}],c}),d("argumentsMapper",["underscorenc","helpers","config","parser","annotationMaps","tagsMaps","errorManager"],function(a,b,c,d,e,f,g){var h=a.extend({},e,f),i=function(b,c,e){var f={passed:!1,message:""};if(f.passed=a.every(b.c,function(e){var f=d.getConditionFunction(e);if(!a.isFunction(f))return g.throwError("API_ERR_ARGUMENTS_MAPPER_1",[e]),!1;var h=d.getValue(e,c,b.argIndex);return f(h)}),!f.passed)return!1;var h=b.p||!1;if(h){var i={};i[h]=c[b.argIndex],!a.isNull(b.force)&&a.isNull(c[b.argIndex])&&(i[h]=b.force),a.extend(e,i)}else a.extend(e,c[b.argIndex]);return!0},j={run:function(c,d){h[d]||g.throwError("API_ERR_ARGUMENTS_MAPPER_2",[d]),a.isArray(h[d])||g.throwError("API_ERR_ARGUMENTS_MAPPER_3",[d]),h[d].length||g.throwError("API_ERR_ARGUMENTS_MAPPER_4",[d]);for(var e={},f=b.getArrayLengthIE8(h[d]),j=0;j<f;j++)a.isArray(h[d][j])||a.isObject(h[d][j])||g.throwError("API_ERR_ARGUMENTS_MAPPER_5",[d,j]),a.isArray(h[d][j])||(h[d][j]=[h[d][j]]),a.some(h[d][j],function(a){return i(a,c,e)});return e},setRules:function(a,b){h[b]=a}};return j}),d("annotationValidators",["underscorenc","config"],function(a,b){var c={};return c.deleteAnnotation={},c.deleteAnnotation.prevalidators=[{c:[{len:1,com:"$gte"}],em:"annotation_id {Number} is required"}],c.deleteAnnotation.validators=[b.NAMED_VALIDATORS.handlers,{p:["id"],c:["number"]}],c.deleteAnnotations={},c.deleteAnnotations.prevalidators=[{c:[{len:1,com:"$gte"}],em:"annotationIdsList {Array} is required"}],c.deleteAnnotations.validators=[b.NAMED_VALIDATORS.handlers,{p:["annotationIdsList"],c:["array"]}],c.updateAnnotation={},c.updateAnnotation.prevalidators=[{c:[{len:2,com:"$gte"}],em:"annotation_id {Number} and fieldsValues {object} are required arguments."}],c.updateAnnotation.validators=[b.NAMED_VALIDATORS.handlers,{p:["id","currentVisibilityId"],c:["number"]},{p:["fieldsValues"],c:["object"]},{p:["fieldsValues"],c:[{sp:["annotation_id"],com:"$nin"}],em:'"annotation_id" should not be passed in fieldsValues.'},{p:["visibility","visibilityInclude","visibilityExclude"],c:["string","array"]}],c.createAnnotation={},c.createAnnotation.prevalidators=[{c:[{len:1,com:"$gte"}],em:"fieldsValues {object} is required"}],c.createAnnotation.validators=[b.NAMED_VALIDATORS.handlers,{p:["fieldsValues"],c:["object"]},{p:["fieldsValues"],c:[{sp:["annotation_id","annotator_id"],com:"$nin"}],em:'"annotation_id" and "annotator_id" should not be passed in fieldsValues.'},{p:["visibility"],c:["string","array"]}],c.getAnnotationsByTextString={},c.getAnnotationsByTextString.prevalidators=[{c:[{len:1,com:"$gte"}],em:"text {String} is required"}],c.getAnnotationsByTextString.validators=[b.NAMED_VALIDATORS.handlers,{p:["text"],c:["string"]},{p:["fields"],c:["array"]},{p:["filters"],c:["object"]},{p:["limitFrom","limitCount"],c:["number"]},{p:["orderDesc","getCount","parseDate"],c:["boolean"]},{p:["visibility","orderBy"],c:["string","array"]}],c.getAnnotationByID={},c.getAnnotationByID.prevalidators=[{c:[{len:1,com:"$gte"}],em:"id {object} is required"}],c.getAnnotationByID.validators=[b.NAMED_VALIDATORS.handlers,{p:["id"],c:["number"]},{p:["fields"],c:["array"]},{p:["parseDate"],c:["boolean"]}],c.getAnnotations={},c.getAnnotations.prevalidators=[],c.getAnnotations.validators=[b.NAMED_VALIDATORS.handlers,{p:["fields"],c:["array"]},{p:["filters"],c:["object"]},{p:["next"],c:["string"]},{p:["limitFrom","limitCount"],c:["number"]},{p:["orderDesc","getCount","parseDate"],c:["boolean"]},{p:["parseDate"],c:["boolean"]},{p:["visibility","orderBy"],c:["string","array"]}],c.getAnnotationsCount={},c.getAnnotationsCount.prevalidators=[],c.getAnnotationsCount.validators=[b.NAMED_VALIDATORS.handlers,{p:["filters"],c:["object"]},{p:["visibility"],c:["string","array"]}],c}),d("tagsValidators",["underscorenc","config"],function(a,b){var c={};return c.createTagsForAnnotationId={},c.createTagsForAnnotationId.prevalidators=[{c:[{len:3,com:"$gte"}],em:"annotationId, contentId, tagsList are required"}],c.createTagsForAnnotationId.validators=[b.NAMED_VALIDATORS.handlers,{p:["annotationId"],c:["number"]},{p:["contentId"],c:["string"]},{p:["tagsList"],c:["array"]}],c.getTagsByAnnotationId={},c.getTagsByAnnotationId.prevalidators=[{c:[{len:1,com:"$gte"}],em:"annotationId {Number} is required"}],c.getTagsByAnnotationId.validators=[b.NAMED_VALIDATORS.handlers,{p:["filters"],c:["object"]},{p:["annotationId","limitFrom","limitCount"],c:["number"]},{p:["orderDesc","getCount"],c:["boolean"]},{p:["orderBy"],c:["string","array"]}],c.createAnnotationAndTags={},c.createAnnotationAndTags.prevalidators=[{c:[{len:2,com:"$gte"}],em:"annotationFieldsValues {object} and tagsList {string[]} are required"}],c.createAnnotationAndTags.validators=[b.NAMED_VALIDATORS.handlers,{p:["annotationFieldsValues"],c:["object"]},{p:["annotationFieldsValues"],c:[{sp:["annotation_id","annotator_id"],com:"$nin"}],em:"annotation_id and annotator_id should not be passed in annotationFieldsValues."},{p:["tagsList"],c:["array"]},{p:["visibility"],c:["string","array"]}],c.deleteTags={},c.deleteTags.prevalidators=[{c:[{len:1,com:"$gte"}],em:"tagIdsList is required"}],c.deleteTags.validators=[b.NAMED_VALIDATORS.handlers,{p:["tagIdsList"],c:["array"]}],c.getAnnotationsByTag={},c.getAnnotationsByTag.prevalidators=[{c:[{len:1,com:"$gte"}],em:"tag String is required"}],c.getAnnotationsByTag.validators=[b.NAMED_VALIDATORS.handlers,{p:["fields"],c:["array"]},{p:["tag"],c:["string"]},{p:["filters"],c:["object"]},{p:["limitFrom","limitCount"],c:["number"]},{p:["orderDesc","parseDate"],c:["boolean"]},{p:["visibility","orderByTag","orderByAnnotation"],c:["string","array"]}],c.getTagsByContentId={},c.getTagsByContentId.prevalidators=[{c:[{len:6}],em:"accept 6 params"}],c.getTagsByContentId.validators=[],c}),d("argumentsValidator",["underscorenc","config","parser","annotationValidators","tagsValidators","errorManager"],function(a,b,c,d,e,f){var g=["prevalidators","validators"],h=a.extend({},d,e),i=function(b,d){var e={passed:!1,message:"",err:""};return e.passed=a.every(b.p,function(f,g){var h=d[f],i=!1;return!(!a.isUndefined(h)&&!a.isNull(h))||(!!(i=a.some(b.c,function(b){var d=c.getConditionFunction(b);return a.isFunction(d)?d(h):(e.err='ArgumentsValidator: type "'+b+'" is not defined in validatorsMap',!1)}))||(e.message='ArgumentsValidator: "'+f+'" = '+h+" is not "+b.c+"!",!1))}),e.passed||(e.message=e.err||b.em||e.message||""),e},j=function(b,d){var e={passed:!1,message:""};return e.passed=a.every(b.c,function(f){var g=c.getConditionFunction(f);if(!a.isFunction(g))return e.message="argumentsValidator: prevalidation condition is not a function",!1;var h=c.getValue(f,d,b.argIndex);return g(h)}),e.passed||(e.message=e.message||b.em||""),e},k={prevalidators:j,validators:i},l=function(b,c,d){h[b]||f.throwError("API_ERR_ARGUMENTS_VALIDATOR_2",[b]),h[b][c]||f.throwError("API_ERR_ARGUMENTS_VALIDATOR_3",[c,b]);var e={passed:!1,message:""};a.each(h[b][c],function(a){if(e=k[c](a,d),!e.passed)throw e.message})},m={pre:function(a,b){l(b,"prevalidators",a)},run:function(a,b){l(b,"validators",a)},setRules:function(a,b,c){h[c]||(h[c]={}),h[c][b]=a},getRulesTypes:function(){return g}};return m}),d("argumentsProcessor",["underscorenc","config","helpers","argumentsMapper","argumentsValidator"],function(a,b,c,d,e){function f(){i="",j=void 0,k={},l=!1,m=!1,n=null}function g(){if(!m)throw"argumentsProcessor: [prevalidate, map, validate] called before function name is set"}function h(b,c){a.isObject(b)&&a.isString(c)&&(b.maps&&d.setRules(b.maps,c),a.each(e.getRulesTypes(),function(a){b[a]&&e.setRules(b[a],a,c)}))}var i="",j=void 0,k={},l=!1,m=!1,n=null,o={defaults:c.getEmptyParams()},p={init:function(){return this},start:function(){return f(),this},run:function(){return k},set:function(b,c){return c=c||null,l=a.isArguments(b),l?j=b||[]:k=b||{},n=c,this},against:function(b){return i=b,m=!0,a.isNull(n)||h(n,i),this},prevalidate:function(){return l?(g(),e.pre(j,i),this):this},map:function(){if(!l)return this;g();var b=d.run(j,i);return a.extend(k,b),this},validate:function(){return g(),e.run(k,i),this},useDefaults:function(){return k=a.extend({},o.defaults,k),this},runFullStack:function(a,b,c){return c=c||[],this.start().set(b,c).against(a).prevalidate().useDefaults().map().validate().run()}};return p.init()}),d("annotationAPI",["helpers","underscorenc","config","client","annotations","transportManager","argumentsProcessor","queryApiValidators"],function(a,b,c,d,e,f,g,h){var i={};return i.deleteAnnotation=function(b,c){h.doInitCheck();var d,f="deleteAnnotation";a.isServiceReady()&&(d=g.runFullStack(f,arguments),e.remove(d.id).done(d.successHandler).fail(d.errorHandler).run())},i.deleteAnnotations=function(c,d){h.doInitCheck();var f,i="deleteAnnotations";a.isServiceReady()&&(f=g.runFullStack(i,arguments),b.isFunction(f.successHandler)||(f.successHandler=function(){a.consoleLog("Delete ok")}),e.remove(f.annotationIdsList).done(f.successHandler).fail(f.errorHandler).run())},i.updateAnnotation=function(b,c,d){h.doInitCheck();var f,i="updateAnnotation";a.isServiceReady()&&(f=g.runFullStack(i,arguments),f.visibility&&(f.fieldsValues.visibility=f.visibility),f.currentVisibilityId&&(f.visibilityInclude||f.visibilityExclude)&&(f.fieldsValues.currentVisibilityId=f.currentVisibilityId,f.fieldsValues.visibilityInclude=f.visibilityInclude,f.fieldsValues.visibilityExclude=f.visibilityExclude),
e.update(f.id,f.fieldsValues).done(f.successHandler).fail(f.errorHandler).run())},i.createAnnotation=function(b,c){h.doInitCheck();var d,f="createAnnotation";a.isServiceReady()&&(d=g.runFullStack(f,arguments),d.visibility&&(d.fieldsValues.$visibility=d.visibility),e.create(d.fieldsValues).done(d.successHandler).fail(d.errorHandler).run())},i.getAnnotationsByTextString=function(c,d){h.doInitCheck();var f,i="getAnnotationsByTextString";a.isServiceReady()&&(f=g.runFullStack(i,arguments),f.visibility&&(f.filters=b.extend({},f.filters,{$visibility:f.visibility})),f.filters.$or=[{body_text:{$like:f.text}},{title:{$like:f.text}}],e.find(f.filters).outputFields(f.fields).limit(f.limitFrom,f.limitCount).order(f.orderBy,f.orderDesc).done(f.successHandler).fail(f.errorHandler).parseDates(f.parseDate).count(f.getCount).run())},i.getAnnotationByID=function(b,c){h.doInitCheck();var d,f="getAnnotationByID";a.isServiceReady()&&(d=g.runFullStack(f,arguments),e.findOne(d.id).outputFields(d.fields).done(d.successHandler).fail(d.errorHandler).parseDates(d.parseDate).run())},i.getAnnotations=function(c){h.doInitCheck();var d,f="getAnnotations";if(a.isServiceReady()){d=g.runFullStack(f,arguments),d.visibility&&(d.filters=b.extend({},d.filters,{$visibility:d.visibility}));var i=e.find(d.filters).outputFields(d.fields).limit(d.limitFrom,d.limitCount).done(d.successHandler).fail(d.errorHandler).parseDates(d.parseDate).count(d.getCount).next(d.next);d.orderBy&&i.order(d.orderBy,d.orderDesc),i.run()}},i.getAnnotationsCount=function(c){h.doInitCheck();var d,f="getAnnotationsCount";a.isServiceReady()&&(d=g.runFullStack(f,arguments),d.visibility&&(d.filters=b.extend({},d.filters,{$visibility:d.visibility})),e.find(d.filters).done(d.successHandler).fail(d.errorHandler).count().run())},i.Annotations=e,i}),d("tagsAPI",["helpers","underscorenc","config","client","annotations","tags","transportManager","argumentsProcessor","errorManager","queryApiValidators"],function(a,b,c,d,e,f,g,h,i,j){var k={};return k.createAnnotationAndTags=function(a,c,d){j.doInitCheck();var f,g;b.isFunction(d)?(f=d,g=arguments[3]):(f=d.successHandler,g=d.errorHandler),b.isNullUndef(d.visibility)||(a.$visibility=d.visibility);var h=b.map(c,function(b){return{value:b,content_id:a.content_id}});e.create(a).tags(h).done(function(a){f(a[0],b.rest(a))}).fail(g).run()},k.createTagsForAnnotationId=function(d,e,g,k){j.doInitCheck();var l,m="createTagsForAnnotationId";if(a.isServiceReady()){l=h.runFullStack(m,arguments),g.length>c.SETTINGS.AppSettings.MaxChangesetCount&&i.throwError("API_ERR_TRANSPORT_1",[c.SETTINGS.AppSettings.MaxChangesetCount]);var n=b.map(b.uniq(g),function(a){return{value:a}});f.create(n).commonFields({annotation_id:l.annotationId,content_id:l.contentId}).done(function(c){b.isObjectNotArray(c)&&(c=[c]),l.successHandler?l.successHandler(c):a.consoleLog("Create tags OK")}).fail(l.errorHandler).run()}},k.getTagsByAnnotationId=function(b,c){j.doInitCheck();var d,e="getTagsByAnnotationId";if(a.isServiceReady()){d=h.runFullStack(e,arguments);var g={annotation_id:d.annotationId};f.find(g).limit(d.limitFrom,d.limitCount).order(d.orderBy,d.orderDesc).count(d.getCount).fail(d.errorHandler).done(d.successHandler).run()}},k.getTagsByContentId=function(b,c,d,e,g,i){j.doInitCheck();var k,l="getTagsByContentId";if(a.isServiceReady()){k=h.runFullStack(l,arguments);var m={content_id:k.contentId};f.find(m).limit(k.limitFrom,k.limitCount).order(k.orderBy).fail(k.errorHandler).done(k.successHandler).run()}},k.deleteTags=function(b,c){j.doInitCheck();var d,e="deleteTags";a.isServiceReady()&&(d=h.runFullStack(e,arguments),f.remove(d.tagIdsList).done(d.successHandler).fail(d.errorHandler).run())},k.getAnnotationsByTag=function(a,b){throw"Not implemented."},k.getDistinctTags=function(b){var c="getDistinctTags";if(a.isServiceReady()){b=b||a.getEmptyParams(),a.areArgsValidType([{o:[b.successHandler,b.errorHandler],t:["function"]},{o:[b.contentId,b.forUser],t:["string"]},{o:[b.visibilityId],t:["number"]},{o:[b.visibility],t:["array","string"]}],c);var e=b.visibilityId;null!==e&&void 0!==e||(e=b.visibility?d.convertNamesToID(b.visibility):d.getID()),this.getDistinctTagsByVisibilityIdAndContentId(e,b.contentId?b.contentId:"",b.successHandler,b.errorHandler,b.forUser?b.forUser:"")}},k.getDistinctTagsByVisibilityIdAndContentId=function(c,d,e,g,h){if(a.isServiceReady()){var i={};!b.isNullUndef(d)&&b.isNonEmptyString(d)&&(i.content_id=d),b.isNullUndef(c)||(i.client_id=c),f.getDistinctTags(i).forUser(h?h:null).done(e).fail(g).run()}},k.Tags=f,k}),d("customODataAPI",["helpers","underscorenc","config","client","oDataService","transportManager","argumentsProcessor","requestManager"],function(a,b,c,d,e,f,g,h){var i={};return i.testHeartbeat=function(e){var i="testHeartbeat",j={validators:[{p:["successHandler","errorHandler"],c:["function"]}]};e=e||{},g.start().set(e,j).against(i).validate().run();var k=h.createSub(c.CRUD.find,!0,c.COLLECTIONS.entityless.nameUppercase);h.setProp(k,h.PROPS.BASE_URL,a.templatify("client_tools/<%= tail %>")),h.setProp(k,h.PROPS.FILTERS,d.isSet()?{client_tool_id:d.getID()}:{}),h.setProp(k,h.PROPS.COUNT,!0),b.isFunction(e.successHandler)&&h.setProp(h.PROPS.SUCCESS_HANDLER,e.successHandler),b.isFunction(e.errorHandler)&&h.setProp(h.PROPS.ERROR_HANDLER,e.errorHandler);var l=h.exportRequest();h._reset(),f.use(c.TRANSPORT_NAMES.ODATA).run(l)},i.getAnnotationsByUser=function(e,g,i,j,k,l,m,n,o){if(a.isServiceReady()){var p={user_guid:b.wrapInto(e,"'"),content_id:b.wrapInto(g.content_id,"'"),object_id:b.wrapInto(g.object_id,"'"),type_id:g.type_id};f.use(c.TRANSPORT_NAMES.ODATA).getFiltersParser();delete g.content_id,delete g.object_id,delete g.type_id,o&&(g.visibility_id=d.convertNamesToVisibilityIds(o));var q=h.createSub(c.CRUD.find,!0,c.COLLECTIONS.entityless.nameUppercase);h.setProp(q,h.PROPS.BASE_URL,a.templatify("GetAnnotationsByStudent/<%= tail %>")),g&&h.setProp(q,h.PROPS.FILTERS,g),i&&h.setProp(q,h.PROPS.FIELDS,i),j&&h.setProp(q,h.PROPS.ORDER_BY,j),k&&h.setProp(q,h.PROPS.LIMIT_FROM,k),l&&h.setProp(q,h.PROPS.LIMIT_COUNT,l),m&&h.setProp(h.PROPS.SUCCESS_HANDLER,m),n&&h.setProp(h.PROPS.ERROR_HANDLER,n),h.setProp(q,h.PROPS.QUERY_PARAMS,p);var r=h.exportRequest();h._reset(),f.use(c.TRANSPORT_NAMES.ODATA).run(r)}},i.getTeacherCommentsAsStudent=function(b,d,e,g,i,j,k,l){if(a.isServiceReady()){var m="Annotation/Comments?annotation_id=",n=m+b;a.consoleLog("READ request: "+n);var o=h.createSub(c.CRUD.find,!0,c.COLLECTIONS.entityless.nameUppercase);h.setProp(o,h.PROPS.BASE_URL,a.templatify(n)),d&&h.setProp(o,h.PROPS.FILTERS,d),e&&h.setProp(o,h.PROPS.FIELDS,e),g&&h.setProp(o,h.PROPS.ORDER_BY,g),i&&h.setProp(o,h.PROPS.LIMIT_FROM,i),j&&h.setProp(o,h.PROPS.LIMIT_COUNT,j),k&&h.setProp(h.PROPS.SUCCESS_HANDLER,k),l&&h.setProp(h.PROPS.ERROR_HANDLER,l),h.setProp(o,h.PROPS.IS_WEBAPI,!0);var p=h.exportRequest();h._reset(),f.use(c.TRANSPORT_NAMES.ODATA).run(p)}},i.markInteractiveNoteAsRead=function(b,d,e){if(a.isServiceReady()){var g="Annotation/InteractiveNoteMarkAsRead?annotation_id=",i=g+b;a.consoleLog("READ request: "+i);var j=h.createSub(c.CRUD.create,!0,c.COLLECTIONS.entityless.nameUppercase);h.setProp(j,h.PROPS.BASE_URL,a.templatify(i)),d&&h.setProp(h.PROPS.SUCCESS_HANDLER,d),e&&h.setProp(h.PROPS.ERROR_HANDLER,e),h.setProp(j,h.PROPS.IS_WEBAPI,!0);var k=h.exportRequest();h._reset(),f.use(c.TRANSPORT_NAMES.ODATA).run(k)}},i.markTeacherCommentAsRead=function(b,d,e){if(a.isServiceReady()){var g="annotation/TeacherCommentMarkAsRead/?annotation_id=",i=g+b;a.consoleLog("READ request: "+i);var j=h.createSub(c.CRUD.create,!0,c.COLLECTIONS.entityless.nameUppercase);h.setProp(j,h.PROPS.BASE_URL,a.templatify(i)),d&&h.setProp(h.PROPS.SUCCESS_HANDLER,d),e&&h.setProp(h.PROPS.ERROR_HANDLER,e),h.setProp(j,h.PROPS.IS_WEBAPI,!0);var k=h.exportRequest();h._reset(),f.use(c.TRANSPORT_NAMES.ODATA).run(k)}},i}),d("aggregationAPI",["helpers","underscorenc","config","transportManager","errorManager"],function(a,b,c,d,e){var f={};return f.getInteractiveNotesCountsForStudents=function(b,e,f,g,h){if(a.isServiceReady()){var i={};i.ContentId=b,i.ObjectId=e,i.AnnotationType=4,i.Ids=f,i.QueryType="studentlist";var j="action/Count/StudentNotesCount",k=a.getRequestURL(j,!0);d.use(c.TRANSPORT_NAMES.AJAX).read({url:k,data:i,type:c.REQ_TYPE_POST},g,h)}},f.getInteractiveNotesCountsForPages=function(b,e,f,g,h){if(a.isServiceReady()){var i={};i.ContentId=b,i.UserId=e,i.AnnotationType=4,i.Ids=f,i.QueryType="pagelist";var j="action/Count/PageNotesCount",k=a.getRequestURL(j,!0);d.use(c.TRANSPORT_NAMES.AJAX).read({url:k,data:i,type:c.REQ_TYPE_POST},g,h)}},f.getInteractiveNotesCountsForStudentsPages=function(b,e,f,g,h){if(a.isServiceReady()){var i={};i.ContentId=b,i.AnnotationType=4,i.Ids=f,i.StudentIds=e,i.QueryType="pagelist";var j="action/Count/TurnedInCountForPages",k=a.getRequestURL(j,!0);d.use(c.TRANSPORT_NAMES.AJAX).read({url:k,data:i,type:c.REQ_TYPE_POST},g,h)}},f.getCountsAsStudentForPages=function(b,e,f,g){if(a.isServiceReady()){var h={};h.ContentId=b,h.AnnotationType=4,h.Ids=e,h.QueryType="pagelist";var i="action/Count/AllNotesCountByPage",j=a.getRequestURL(i,!0);d.use(c.TRANSPORT_NAMES.AJAX).read({url:j,data:h,type:c.REQ_TYPE_POST},f,g)}},f.getCountsAsStudentForLessons=function(b,e,f,g){if(a.isServiceReady()){var h={};h.ContentId=b,h.AnnotationType=4,h.Ids=e,h.QueryType="pagelist";var i="action/Count/AllNotesCountByLesson",j=a.getRequestURL(i,!0);d.use(c.TRANSPORT_NAMES.AJAX).read({url:j,data:h,type:c.REQ_TYPE_POST},f,g)}},f.getCountsAsStudentForLessonsForUnit=function(b,e,f,g,h){if(a.isServiceReady()){var i={};i.ContentId=b,i.UnitId=e,i.AnnotationType=4,i.Ids=f,i.QueryType="pagelist";var j="action/Count/AllNotesCountByLesson",k=a.getRequestURL(j,!0);d.use(c.TRANSPORT_NAMES.AJAX).read({url:k,data:i,type:c.REQ_TYPE_POST},g,h)}},f.getCountsAsStudentForUnit=function(b,f,g,h){var i="getCountsAsStudentForUnit";if(a.isServiceReady()){arguments.length<=3&&e.throwError("API_ERR_AJAX_1",[i,4,""]),a.areArgsValidType([{o:[f],t:["string"]},{o:[b],t:["array"]},{o:[g,h],t:["function"]}],i);var j={};j.ids=b,j.contentId=f,j.annotationType=4;var k="action/count/AllNotesCountByUnit",l=a.getRequestURL(k,!0);d.use(c.TRANSPORT_NAMES.AJAX).read({url:l,data:j,type:c.REQ_TYPE_POST},g,h)}},f}),d("userAPI",["helpers","underscorenc","config","client","ajaxTransport"],function(a,b,c,d,e){var f={};return f.createInteractiveNoteWithImage=function(b,f,g,h){if(a.isServiceReady()&&!a.debugContainsAnnotationsId("annotation_id",b,"createAnnotation","annotation_id should be only used for querying!")&&!a.debugContainsAnnotationsId("annotator_id",b,"createAnnotation","annotator_id should not be send at any case to OData!")){d.isSet()&&(b.created_by_tool_id=d.getID());var i=JSON.stringify(b),j="----data-persistence-boundary-"+Math.floor(Math.random()*(new Date).getMilliseconds()),k="--"+j+"\r\n";k+='Content-Disposition: form-data; name="annotation"\r\n',k+="content-type: application/json\r\n\r\n",k+=i+"\r\n",k+="--"+j+"\r\n",k+='Content-Disposition: form-data; name="uploadfile"; filename="scratchpad_image.png"\r\n',k+="Content-Transfer-Encoding: base64\r\n",k+="Content-Type: image/png\r\n\r\n",k+=f+"\r\n\r\n--"+j+"--\r\n";var l="action/storage/upload",m=a.getRequestURL(l,!0),n=a.getHeader(c.REQ_TYPE_PUT);n["Content-Type"]="multipart/form-data; boundary="+j,e.read({type:a.getHTTPMethod(c.REQ_TYPE_POST),headers:n,url:m,contentType:"multipart/form-data; boundary="+j,data:k},function(b,c){g?g(b.annotation,c):(a.consoleLog("success"),a.consoleLog(a.debugParseResults(b)))},function(b,c){h?h(b,c):a.consoleLog("error: "+b+". responseAdditionalData: "+c)})}},f.updateInteractiveNoteWithImage=function(b,d,f,g,h){if(a.isServiceReady()&&!a.debugContainsAnnotationsId("annotator_id",d,"updateInteractiveNote","annotator_id should not be send at any case to OData!")&&!a.debugContainsAnnotationsId("annotation_id",d,"updateInteractiveNote","annotation_id should not be send as a part of fieldsValues!")){var i=JSON.stringify(d),j="----data-persistence-boundary-"+Math.floor(Math.random()*(new Date).getMilliseconds()),k="--"+j+"\r\n";k+='Content-Disposition: form-data; name="annotation"\r\n',k+="content-type: application/json\r\n\r\n",k+=i+"\r\n",k+="--"+j+"\r\n",k+='Content-Disposition: form-data; name="uploadfile"; filename="scratchpad_image.png"\r\n',k+="Content-Transfer-Encoding: base64\r\n",k+="Content-Type: image/png\r\n\r\n",k+=f+"\r\n\r\n--"+j+"--\r\n";var l="action/update/UpdateObjectAndAnnotationByAnnotationId/?annotation_id=",m=a.getRequestURL(l+b,!0),n=a.getHeader(c.REQ_TYPE_PUT);n["Content-Type"]="multipart/form-data; boundary="+j,e.read({type:a.getHTTPMethod(c.REQ_TYPE_PUT),headers:n,url:m,data:k},function(b,c){g?g(b.annotation,c):(a.consoleLog("success"),a.consoleLog(a.debugParseResults(b)))},function(b,c){h?h(b,c):a.consoleLog("testStatus: "+testStatus+". error: "+b)})}},f.getInteractiveNoteImageUrl=function(b,d,f){if(a.isServiceReady()){var g="action/download/geturl/?annotation_id=",h=a.getRequestURL(g+b,!0);e.read({type:a.getHTTPMethod(c.REQ_TYPE_GET),headers:a.getHeader({"X-Requested-With":"XMLHttpRequest"}),url:h},function(b,c){d?d(b.signed_url,c):(a.consoleLog("success"),a.consoleLog(b.signed_url))},function(b,c){f?f(b,c):a.consoleLog("error: "+b+". responseAdditionalData: "+c)})}},f.deleteInteractiveNoteWithImage=function(b,d,f){if(a.isServiceReady()){var g="action/delete/RemoveObjectAndAnnotationByAnnotationId/?annotation_id=",h=a.getRequestURL(g+b,!0);e.read({type:a.getHTTPMethod(c.REQ_TYPE_DELETE),headers:a.getHeader(c.REQ_TYPE_DELETE),url:h},function(b,c){d?d(b.annotation_id,c):(a.consoleLog("success"),a.consoleLog(b))},function(b,c){f?f(b,c):a.consoleLog("error: "+b+". responseAdditionalData: "+c)})}},f}),d("containersAPI",["underscorenc","helpers","config","client","annotations","containers","transportManager","argumentsProcessor","errorManager","queryApiValidators"],function(a,b,c,d,e,f,g,h,i,j){var k={},l=function(c){function d(b){j.doInitCheck(),(a.isNull(c)||a.isUndefined(c))&&i.throwError("API_ERR_QUERY_API_2",[h.entityName,h.keyField,"forContainer","addAnnotations"])}j.doInitCheck();var f={},g=!1,h=this;return a.isNumber(c)||a.isNull(c)||a.isUndefined(c)||i.throwError("API_ERR_QUERY_API_1",[h.entityName,"forContainer","container_id","number"]),f.withChildContainers=function(b){return j.doInitCheck(),g=!(!a.isUndefined(b)&&!a.isNull(b))||!!b,this},f.addAnnotations=function(b){return j.doInitCheck(),d("addAnnotations"),b=a.isNumber(b)?[b]:b,e.update(b).commonFields({container_id:c})},f.deleteAnnotations=function(c){return j.doInitCheck(),a.isArray(c)||a.isNumber(c)||i.throwError("API_ERR_QUERY_API_3",[h.entityName,"annotation_ids","deleteAnnotations","number or array",b.toType(c)]),(a.isNull(c)||a.isUndefined(c)||a.isArray(c)&&0===c.length)&&i.throwError("API_ERR_QUERY_API_4",[h.entityName,"deleteAnnotations","annotation_id(s)"]),a.isArray(c)||(c=[c]),e.update(c).commonFields({container_id:null})},f.findAnnotations=function(b){return j.doInitCheck(),d("findAnnotations"),b||(b={}),a.isNumber(c)&&(g?b.$sub={container:{$or:[{id:c},{parent_id:c}]}}:b.$sub={container:{id:c}}),e.find(b)},f.findAnnotationsByText=function(d,f){j.doInitCheck(),a.isString(d)||a.isArray(d)||i.throwError("API_ERR_QUERY_API_3",[h.entityName,"text","findAnnotationsByText","string or array",b.toType(d)]);var k={},l={};a.isNumber(c)&&(g?k.$sub={container:{$or:[{id:c},{parent_id:c}]}}:k.$sub={container:{id:c}});var m;return a.isArray(d)?(m=[],a.each(d,function(c){a.isString(c)||i.throwError("API_ERR_QUERY_API_3",[h.entityName,"text","findAnnotationsByText","string or array",b.toType(c)]),m.push({$like:c})})):m={$like:d},k.$or=[{title:m},{body_text:m}],a.isObject(f)&&a.extend(l,f),a.extend(l,{$and:k}),e.find(l)},f.findAllAnnotationsByText=function(b,d){j.doInitCheck();var f={};return a.isNumber(c)&&(g?f.$sub={container:{$or:[{id:c},{parent_id:c}]}}:f.$sub={container:{id:c}}),a.isObject(d)&&a.extend(f,d),e.findAllAnnotationsByText(b,f)},f.findAnnotationsByTags=function(b,d){j.doInitCheck();var f,h={};return a.isArray(b)||(b=[b]),a.isObject(d)&&a.extend(h,d),a.isNumber(c)&&(f=g?{$sub:{container:{$or:[{id:c},{parent_id:c}]}}}:{$sub:{container:{id:c}}}),a.isArray(b)&&a.extend(h,{$any:{tags:{value:b}}}),a.extend(h,f),e.find(h)},f},m=function(b){return j.doInitCheck(),a.isArray(b)||(b=[b]),e.update(b).commonFields({container_id:null})};return a.extend(f,{forContainer:l,removeAnnotations:m}),k.Containers=f,k}),d("experimentalAPI",["helpers","oDataService","underscorenc","config","client","transportManager","annotations"],function(a,b,c,d,e,f,g){var h={};return h.createAnnotationsBatch=function(b,d,e){a.isServiceReady()&&g.create(b).done(function(b){var e=c.pluck(b,"annotation_id");d?d(e):a.consoleLog(e)}).fail(e).run()},h.createAnnotationTagsAndFlags=function(a,b,c,d,e){throw"Not implemented."},h.getAnnotationsAndTags=function(a,b,c,d,e,f,g){throw"Not implemented."},h}),d("annotationSharedWithAPI",["underscorenc","helpers","config","client","annotationSharedWith"],function(a,b,c,d,e){var f={};return f.AnnotationSharedWith=e,f}),d("custom",["underscorenc","config","helpers","transportManager","client","queryAPI","info","errorManager","requestManager"],function(a,b,c,d,e,f,g,h,i){var j={getUsersForAnnotationId:{service:c.templatify("SharedWithAnnotators<%= tail %>")}},k={entityName:"custom",_defaultTransport:d.use(b.TRANSPORT_NAMES.ODATA),_transports:{},_request:{},_additionalActions:{},_urls:j,init:function(b){return a.defaults(this,f),a.extend(this,g),this},_getRequest:function(){return this._request},getUsersForAnnotationId:function(d){(a.isUndefined(d)||a.isObject(d)&&a.isUndefined(d.annotation_id))&&h.throwError("API_ERR_QUERY_API_3",[this.entityName,"annotation_id","getUsersForAnnotationId","object","undefined"]),(a.isObject(d)&&!a.isNumber(d.annotation_id)||!a.isNumber(d))&&h.throwError("API_ERR_QUERY_API_3",[this.entityName,"annotation_id","getUsersForAnnotationId","object",c.toType(d)]);var e={};e[b.QUERY_PARAMS.annotationId]=d;var f=this._customOperation({},b.CUSTOM_ENDPOINTS.GET_USERS_FOR_ANNOTATION_ID,b.CRUD.find,this.entityName);return i.setProp(f,i.PROPS.QUERY_PARAMS,e),i.setProp(f,i.PROPS.IS_WEBAPI,!0),this}};return k.init()}),d("customAPI",["underscorenc","helpers","config","custom"],function(a,b,c,d){var e={};return e.custom=d,e}),d("annService",["underscorenc","config","basicAPI","annotationAPI","tagsAPI","customODataAPI","aggregationAPI","userAPI","containersAPI","experimentalAPI","annotationSharedWithAPI","customAPI","requestManager","resetManager","annotations","containers","tags","annotationSharedWith","oDataService","queryAPI"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){var u={publicInterface:{},prepare:function(){return a.extend(this.publicInterface,c),a.extend(this.publicInterface,d),a.extend(this.publicInterface,e),a.extend(this.publicInterface,f),a.extend(this.publicInterface,g),a.extend(this.publicInterface,h),a.extend(this.publicInterface,i),a.extend(this.publicInterface,j),a.extend(this.publicInterface,k),a.extend(this.publicInterface,l),a.extend(this.publicInterface,{reqMan:m}),a.extend(this.publicInterface,{odata:s}),n.subscribe(o._reset),n.subscribe(q._reset),n.subscribe(p._reset),n.subscribe(r._reset),n.subscribe(t._reset),n.subscribe(m._reset),this.publicInterface}};return u.prepare()}),c("annService")});